<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Cache/Frontend/Class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Cache/Frontend/Class.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00026"></a>00026 require_once <span class="stringliteral">&#39;Zend/Cache/Core.php&#39;</span>;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00035"></a><a class="code" href="class_zend___cache___frontend___class.html">00035</a> <span class="keyword">class </span><a class="code" href="class_zend___cache___frontend___class.html">Zend_Cache_Frontend_Class</a> <span class="keyword">extends</span> <a class="code" href="class_zend___cache___core.html">Zend_Cache_Core</a>
<a name="l00036"></a>00036 {
<a name="l00055"></a><a class="code" href="class_zend___cache___frontend___class.html#a0a84b72274d4b3d2e0aec7d506448d14">00055</a>     <span class="keyword">protected</span> <a class="code" href="class_zend___cache___frontend___class.html#a0a84b72274d4b3d2e0aec7d506448d14">$_specificOptions</a> = array(
<a name="l00056"></a>00056         <span class="stringliteral">&#39;cached_entity&#39;</span> =&gt; null,
<a name="l00057"></a>00057         <span class="stringliteral">&#39;cache_by_default&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00058"></a>00058         <span class="stringliteral">&#39;cached_methods&#39;</span> =&gt; array(),
<a name="l00059"></a>00059         <span class="stringliteral">&#39;non_cached_methods&#39;</span> =&gt; array()
<a name="l00060"></a>00060     );
<a name="l00061"></a>00061 
<a name="l00067"></a>00067     <span class="keyword">private</span> $_tags = array();
<a name="l00068"></a>00068 
<a name="l00076"></a>00076     <span class="keyword">private</span> $_specificLifetime = <span class="keyword">false</span>;
<a name="l00077"></a>00077 
<a name="l00083"></a>00083     <span class="keyword">private</span> $_cachedEntity = null;
<a name="l00084"></a>00084 
<a name="l00092"></a>00092     <span class="keyword">private</span> $_cachedEntityLabel = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00093"></a>00093 
<a name="l00099"></a>00099     <span class="keyword">private</span> $_priority = 8;
<a name="l00100"></a>00100 
<a name="l00108"></a><a class="code" href="class_zend___cache___frontend___class.html#a2d2b2afcd896367c740d1eb4b486614b">00108</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#a2d2b2afcd896367c740d1eb4b486614b">__construct</a>(array $options = array())
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110         <span class="keywordflow">while</span> (list($name, $value) = each($options)) {
<a name="l00111"></a>00111             $this-&gt;<a class="code" href="class_zend___cache___frontend___class.html#a7184fec9134a57cae6ef66b3588513d1">setOption</a>($name, $value);
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113         <span class="keywordflow">if</span> ($this-&gt;_specificOptions[<span class="stringliteral">&#39;cached_entity&#39;</span>] === null) {
<a name="l00114"></a>00114             <a class="code" href="class_zend___cache.html#aa759b8586c8aca902bd2b96d8ce65ab1">Zend_Cache::throwException</a>(<span class="stringliteral">&#39;cached_entity must be set !&#39;</span>);
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116         $this-&gt;<a class="code" href="class_zend___cache___frontend___class.html#aae068d42fb76c1142095c0eb435fdf8e">setCachedEntity</a>($this-&gt;_specificOptions[<span class="stringliteral">&#39;cached_entity&#39;</span>]);
<a name="l00117"></a>00117         $this-&gt;<a class="code" href="class_zend___cache___frontend___class.html#a7184fec9134a57cae6ef66b3588513d1">setOption</a>(<span class="stringliteral">&#39;automatic_serialization&#39;</span>, <span class="keyword">true</span>);
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00126"></a><a class="code" href="class_zend___cache___frontend___class.html#a8d71c831063c370db8541636af10c509">00126</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#a8d71c831063c370db8541636af10c509">setSpecificLifetime</a>($specificLifetime = <span class="keyword">false</span>)
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128         $this-&gt;_specificLifetime = $specificLifetime;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 
<a name="l00136"></a><a class="code" href="class_zend___cache___frontend___class.html#a8f85e86a0294c2d785ad6c8561cf29fa">00136</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#a8f85e86a0294c2d785ad6c8561cf29fa">setPriority</a>($priority)
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138         $this-&gt;_priority = $priority;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140 
<a name="l00151"></a><a class="code" href="class_zend___cache___frontend___class.html#a7184fec9134a57cae6ef66b3588513d1">00151</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#a7184fec9134a57cae6ef66b3588513d1">setOption</a>($name, $value)
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153         <span class="keywordflow">if</span> ($name == <span class="stringliteral">&#39;cached_entity&#39;</span>) {
<a name="l00154"></a>00154             $this-&gt;<a class="code" href="class_zend___cache___frontend___class.html#aae068d42fb76c1142095c0eb435fdf8e">setCachedEntity</a>($value);
<a name="l00155"></a>00155         } <span class="keywordflow">else</span> {
<a name="l00156"></a>00156             <a class="code" href="class_zend___cache___frontend___class.html#a7184fec9134a57cae6ef66b3588513d1">parent::setOption</a>($name, $value);
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00168"></a><a class="code" href="class_zend___cache___frontend___class.html#aae068d42fb76c1142095c0eb435fdf8e">00168</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#aae068d42fb76c1142095c0eb435fdf8e">setCachedEntity</a>($cachedEntity)
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170         <span class="keywordflow">if</span> (!is_string($cachedEntity) &amp;&amp; !is_object($cachedEntity)) {
<a name="l00171"></a>00171             <a class="code" href="class_zend___cache.html#aa759b8586c8aca902bd2b96d8ce65ab1">Zend_Cache::throwException</a>(<span class="stringliteral">&#39;cached_entity must be an object or a class name&#39;</span>);
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         $this-&gt;_cachedEntity = $cachedEntity;
<a name="l00174"></a>00174         $this-&gt;_specificOptions[<span class="stringliteral">&#39;cached_entity&#39;</span>] = $cachedEntity;
<a name="l00175"></a>00175         <span class="keywordflow">if</span> (is_string($this-&gt;_cachedEntity)){
<a name="l00176"></a>00176             $this-&gt;_cachedEntityLabel = $this-&gt;_cachedEntity;
<a name="l00177"></a>00177         } <span class="keywordflow">else</span> {
<a name="l00178"></a>00178             $ro = <span class="keyword">new</span> ReflectionObject($this-&gt;_cachedEntity);
<a name="l00179"></a>00179             $this-&gt;_cachedEntityLabel = $ro-&gt;getName();
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00189"></a><a class="code" href="class_zend___cache___frontend___class.html#ae356a9f5284f28d65653007516f7f813">00189</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#ae356a9f5284f28d65653007516f7f813">setTagsArray</a>($tags = array())
<a name="l00190"></a>00190     {
<a name="l00191"></a>00191         $this-&gt;_tags = $tags;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 
<a name="l00201"></a><a class="code" href="class_zend___cache___frontend___class.html#ae3c1612573015dbb405087f657944fe6">00201</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___cache___frontend___class.html#ae3c1612573015dbb405087f657944fe6">__call</a>($name, $parameters)
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         $cacheBool1 = $this-&gt;_specificOptions[<span class="stringliteral">&#39;cache_by_default&#39;</span>];
<a name="l00204"></a>00204         $cacheBool2 = in_array($name, $this-&gt;_specificOptions[<span class="stringliteral">&#39;cached_methods&#39;</span>]);
<a name="l00205"></a>00205         $cacheBool3 = in_array($name, $this-&gt;_specificOptions[<span class="stringliteral">&#39;non_cached_methods&#39;</span>]);
<a name="l00206"></a>00206         $cache = (($cacheBool1 || $cacheBool2) &amp;&amp; (!$cacheBool3));
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (!$cache) {
<a name="l00208"></a>00208             <span class="comment">// We do not have not cache</span>
<a name="l00209"></a>00209             <span class="keywordflow">return</span> call_user_func_array(array($this-&gt;_cachedEntity, $name), $parameters);
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211         $id = $this-&gt;_makeId($name, $parameters);
<a name="l00212"></a>00212         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_zend___cache___core.html#a59a4562cc98f0681e6b8f1a9332ef503">test</a>($id)) {
<a name="l00213"></a>00213             <span class="comment">// A cache is available</span>
<a name="l00214"></a>00214             $result = $this-&gt;<a class="code" href="class_zend___cache___core.html#a136b6a0dbf9c1c01db9d7924cf83c4e9">load</a>($id);
<a name="l00215"></a>00215             $output = $result[0];
<a name="l00216"></a>00216             $return = $result[1];
<a name="l00217"></a>00217         } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218             <span class="comment">// A cache is not available</span>
<a name="l00219"></a>00219             ob_start();
<a name="l00220"></a>00220             ob_implicit_flush(<span class="keyword">false</span>);
<a name="l00221"></a>00221             $return = call_user_func_array(array($this-&gt;_cachedEntity, $name), $parameters);
<a name="l00222"></a>00222             $output = ob_get_contents();
<a name="l00223"></a>00223             ob_end_clean();
<a name="l00224"></a>00224             $data = array($output, $return);
<a name="l00225"></a>00225             $this-&gt;<a class="code" href="class_zend___cache___core.html#a3750a52feadae6d907afbeb3afa5d032">save</a>($data, $id, $this-&gt;_tags, $this-&gt;_specificLifetime, $this-&gt;_priority);
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         echo $output;
<a name="l00228"></a>00228         <span class="keywordflow">return</span> $return;
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 
<a name="l00238"></a>00238     <span class="keyword">private</span> function _makeId($name, $parameters)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         <span class="keywordflow">return</span> md5($this-&gt;_cachedEntityLabel . <span class="stringliteral">&#39;__&#39;</span> . $name . <span class="stringliteral">&#39;__&#39;</span> . serialize($parameters));
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:16 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
