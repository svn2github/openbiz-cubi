<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Validate/Date.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Validate/Date.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00025"></a>00025 require_once <span class="stringliteral">&#39;Zend/Validate/Abstract.php&#39;</span>;
<a name="l00026"></a>00026 
<a name="l00033"></a><a class="code" href="class_zend___validate___date.html">00033</a> <span class="keyword">class </span><a class="code" href="class_zend___validate___date.html">Zend_Validate_Date</a> <span class="keyword">extends</span> <a class="code" href="class_zend___validate___abstract.html">Zend_Validate_Abstract</a>
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035     <span class="keyword">const</span> INVALID        = <span class="stringliteral">&#39;dateInvalid&#39;</span>;
<a name="l00036"></a>00036     <span class="keyword">const</span> NOT_YYYY_MM_DD = <span class="stringliteral">&#39;dateNotYYYY-MM-DD&#39;</span>;
<a name="l00037"></a>00037     <span class="keyword">const</span> INVALID_DATE    = <span class="stringliteral">&#39;dateInvalidDate&#39;</span>;
<a name="l00038"></a>00038     <span class="keyword">const</span> FALSEFORMAT    = <span class="stringliteral">&#39;dateFalseFormat&#39;</span>;
<a name="l00039"></a>00039 
<a name="l00045"></a>00045     <span class="keyword">protected</span> $_messageTemplates = array(
<a name="l00046"></a>00046         self::INVALID        =&gt; <span class="stringliteral">&quot;Invalid type given, value should be string, integer, array or Zend_Date&quot;</span>,
<a name="l00047"></a>00047         self::NOT_YYYY_MM_DD =&gt; <span class="stringliteral">&quot;&#39;%value%&#39; is not of the format YYYY-MM-DD&quot;</span>,
<a name="l00048"></a>00048         self::INVALID_DATE   =&gt; <span class="stringliteral">&quot;&#39;%value%&#39; does not appear to be a valid date&quot;</span>,
<a name="l00049"></a>00049         self::FALSEFORMAT    =&gt; <span class="stringliteral">&quot;&#39;%value%&#39; does not fit given date format&quot;</span>
<a name="l00050"></a>00050     );
<a name="l00051"></a>00051 
<a name="l00057"></a>00057     <span class="keyword">protected</span> $_format;
<a name="l00058"></a>00058 
<a name="l00064"></a>00064     <span class="keyword">protected</span> $_locale;
<a name="l00065"></a>00065 
<a name="l00073"></a><a class="code" href="class_zend___validate___date.html#a2d244939804b17ae91ec017b599f4eed">00073</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#a2d244939804b17ae91ec017b599f4eed">__construct</a>($format = null, $locale = null)
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075         $this-&gt;<a class="code" href="class_zend___validate___date.html#a0054b3e5ed1ddbebb02595625597080a">setFormat</a>($format);
<a name="l00076"></a>00076         <span class="keywordflow">if</span> ($locale === null) {
<a name="l00077"></a>00077             require_once <span class="stringliteral">&#39;Zend/Registry.php&#39;</span>;
<a name="l00078"></a>00078             <span class="keywordflow">if</span> (<a class="code" href="class_zend___registry.html#ac8c396b3b76f72a1bac4e668721ddb2e">Zend_Registry::isRegistered</a>(<span class="stringliteral">&#39;Zend_Locale&#39;</span>)) {
<a name="l00079"></a>00079                 $locale = <a class="code" href="class_zend___registry.html#a68c12da739beec9f01e66b9a8f0dd24d">Zend_Registry::get</a>(<span class="stringliteral">&#39;Zend_Locale&#39;</span>);
<a name="l00080"></a>00080             }
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="keywordflow">if</span> ($locale !== null) {
<a name="l00084"></a>00084             $this-&gt;<a class="code" href="class_zend___validate___date.html#a0fb89675983893dbf686b0d22111b8e5">setLocale</a>($locale);
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 
<a name="l00093"></a><a class="code" href="class_zend___validate___date.html#ad532b661eb33c3e755bd3fa8ff1bd7af">00093</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#ad532b661eb33c3e755bd3fa8ff1bd7af">getLocale</a>()
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <span class="keywordflow">return</span> $this-&gt;_locale;
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 
<a name="l00104"></a><a class="code" href="class_zend___validate___date.html#a0fb89675983893dbf686b0d22111b8e5">00104</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#a0fb89675983893dbf686b0d22111b8e5">setLocale</a>($locale = null)
<a name="l00105"></a>00105     {
<a name="l00106"></a>00106         require_once <span class="stringliteral">&#39;Zend/Locale.php&#39;</span>;
<a name="l00107"></a>00107         $this-&gt;_locale = <a class="code" href="class_zend___locale.html#ad0f5fea4be8b74d2f0049b418a275492">Zend_Locale::findLocale</a>($locale);
<a name="l00108"></a>00108         <span class="keywordflow">return</span> $this;
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00116"></a><a class="code" href="class_zend___validate___date.html#ae3c4fbe3e8eb0d6755694bc597d6c52f">00116</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#ae3c4fbe3e8eb0d6755694bc597d6c52f">getFormat</a>()
<a name="l00117"></a>00117     {
<a name="l00118"></a>00118         <span class="keywordflow">return</span> $this-&gt;_format;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 
<a name="l00127"></a><a class="code" href="class_zend___validate___date.html#a0054b3e5ed1ddbebb02595625597080a">00127</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#a0054b3e5ed1ddbebb02595625597080a">setFormat</a>($format = null)
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129         $this-&gt;_format = $format;
<a name="l00130"></a>00130         <span class="keywordflow">return</span> $this;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00143"></a><a class="code" href="class_zend___validate___date.html#a72063d2e922edda5321b1970297eb0c3">00143</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___validate___date.html#a72063d2e922edda5321b1970297eb0c3">isValid</a>($value)
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145         <span class="keywordflow">if</span> (!is_string($value) &amp;&amp; !is_int($value) &amp;&amp; !is_float($value) &amp;&amp;
<a name="l00146"></a>00146             !is_array($value) &amp;&amp; !($value instanceof <a class="code" href="class_zend___date.html">Zend_Date</a>)) {
<a name="l00147"></a>00147             $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a76e75e85108a86fcefa1e9d7d4b833f9">_error</a>(self::INVALID);
<a name="l00148"></a>00148             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a67ec6ce5110ea66187cc89a2ef21a603">_setValue</a>($value);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="keywordflow">if</span> (($this-&gt;_format !== null) || ($this-&gt;_locale !== null) || is_array($value) ||
<a name="l00154"></a>00154              $value instanceof Zend_Date) {
<a name="l00155"></a>00155             require_once <span class="stringliteral">&#39;Zend/Date.php&#39;</span>;
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (!<a class="code" href="class_zend___date.html#aee512d1a9c20c2c34a9daa649731edb4">Zend_Date::isDate</a>($value, $this-&gt;_format, $this-&gt;_locale)) {
<a name="l00157"></a>00157                 <span class="keywordflow">if</span> ($this-&gt;_checkFormat($value) === <span class="keyword">false</span>) {
<a name="l00158"></a>00158                     $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a76e75e85108a86fcefa1e9d7d4b833f9">_error</a>(self::FALSEFORMAT);
<a name="l00159"></a>00159                 } <span class="keywordflow">else</span> {
<a name="l00160"></a>00160                     $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a76e75e85108a86fcefa1e9d7d4b833f9">_error</a>(self::INVALID_DATE);
<a name="l00161"></a>00161                 }
<a name="l00162"></a>00162                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00163"></a>00163             }
<a name="l00164"></a>00164         } <span class="keywordflow">else</span> {
<a name="l00165"></a>00165             <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^\d{4}-\d{2}-\d{2}$/&#39;</span>, $value)) {
<a name="l00166"></a>00166                 $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a76e75e85108a86fcefa1e9d7d4b833f9">_error</a>(self::NOT_YYYY_MM_DD);
<a name="l00167"></a>00167                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             list($year, $month, $day) = sscanf($value, <span class="stringliteral">&#39;%d-%d-%d&#39;</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             <span class="keywordflow">if</span> (!checkdate($month, $day, $year)) {
<a name="l00173"></a>00173                 $this-&gt;<a class="code" href="class_zend___validate___abstract.html#a76e75e85108a86fcefa1e9d7d4b833f9">_error</a>(self::INVALID_DATE);
<a name="l00174"></a>00174                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00175"></a>00175             }
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00187"></a>00187     <span class="keyword">private</span> function _checkFormat($value)
<a name="l00188"></a>00188     {
<a name="l00189"></a>00189         <span class="keywordflow">try</span> {
<a name="l00190"></a>00190             require_once <span class="stringliteral">&#39;Zend/Locale/Format.php&#39;</span>;
<a name="l00191"></a>00191             $parsed = <a class="code" href="class_zend___locale___format.html#a8aee4ce063a40a4009fd6d7ceb557f50">Zend_Locale_Format::getDate</a>($value, array(
<a name="l00192"></a>00192                                                   <span class="stringliteral">&#39;date_format&#39;</span> =&gt; $this-&gt;_format, <span class="stringliteral">&#39;format_type&#39;</span> =&gt; <span class="stringliteral">&#39;iso&#39;</span>,
<a name="l00193"></a>00193                                                   <span class="stringliteral">&#39;fix_date&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l00194"></a>00194             <span class="keywordflow">if</span> (isset($parsed[<span class="stringliteral">&#39;year&#39;</span>]) and ((strpos(strtoupper($this-&gt;_format), <span class="stringliteral">&#39;YY&#39;</span>) !== <span class="keyword">false</span>) and
<a name="l00195"></a>00195                 (strpos(strtoupper($this-&gt;_format), <span class="stringliteral">&#39;YYYY&#39;</span>) === <span class="keyword">false</span>))) {
<a name="l00196"></a>00196                 $parsed[<span class="stringliteral">&#39;year&#39;</span>] = <a class="code" href="class_zend___date.html#aa6664619e61f053a6e901bf5bf6e52f5">Zend_Date::getFullYear</a>($parsed[<span class="stringliteral">&#39;year&#39;</span>]);
<a name="l00197"></a>00197             }
<a name="l00198"></a>00198         } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00199"></a>00199             <span class="comment">// Date can not be parsed</span>
<a name="l00200"></a>00200             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="keywordflow">if</span> (((strpos($this-&gt;_format, <span class="charliteral">&#39;Y&#39;</span>) !== <span class="keyword">false</span>) or (strpos($this-&gt;_format, <span class="charliteral">&#39;y&#39;</span>) !== <span class="keyword">false</span>)) and
<a name="l00204"></a>00204             (!isset($parsed[<span class="stringliteral">&#39;year&#39;</span>]))) {
<a name="l00205"></a>00205             <span class="comment">// Year expected but not found</span>
<a name="l00206"></a>00206             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="keywordflow">if</span> ((strpos($this-&gt;_format, <span class="charliteral">&#39;M&#39;</span>) !== <span class="keyword">false</span>) and (!isset($parsed[<span class="stringliteral">&#39;month&#39;</span>]))) {
<a name="l00210"></a>00210             <span class="comment">// Month expected but not found</span>
<a name="l00211"></a>00211             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <span class="keywordflow">if</span> ((strpos($this-&gt;_format, <span class="charliteral">&#39;d&#39;</span>) !== <span class="keyword">false</span>) and (!isset($parsed[<span class="stringliteral">&#39;day&#39;</span>]))) {
<a name="l00215"></a>00215             <span class="comment">// Day expected but not found</span>
<a name="l00216"></a>00216             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         <span class="keywordflow">if</span> (((strpos($this-&gt;_format, <span class="charliteral">&#39;H&#39;</span>) !== <span class="keyword">false</span>) or (strpos($this-&gt;_format, <span class="charliteral">&#39;h&#39;</span>) !== <span class="keyword">false</span>)) and
<a name="l00220"></a>00220             (!isset($parsed[<span class="stringliteral">&#39;hour&#39;</span>]))) {
<a name="l00221"></a>00221             <span class="comment">// Hour expected but not found</span>
<a name="l00222"></a>00222             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="keywordflow">if</span> ((strpos($this-&gt;_format, <span class="charliteral">&#39;m&#39;</span>) !== <span class="keyword">false</span>) and (!isset($parsed[<span class="stringliteral">&#39;minute&#39;</span>]))) {
<a name="l00226"></a>00226             <span class="comment">// Minute expected but not found</span>
<a name="l00227"></a>00227             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="keywordflow">if</span> ((strpos($this-&gt;_format, <span class="charliteral">&#39;s&#39;</span>) !== <span class="keyword">false</span>) and (!isset($parsed[<span class="stringliteral">&#39;second&#39;</span>]))) {
<a name="l00231"></a>00231             <span class="comment">// Second expected  but not found</span>
<a name="l00232"></a>00232             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="comment">// Date fits the format</span>
<a name="l00236"></a>00236         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:17 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
