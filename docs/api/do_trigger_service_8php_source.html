<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/bin/service/doTriggerService.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/bin/service/doTriggerService.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00017"></a>00017 <span class="comment">/*</span>
<a name="l00018"></a>00018 <span class="comment">&lt;PluginService Name=&quot;&quot; Description=&quot;&quot; Package=&quot;&quot; Class=&quot;&quot; BizObjectName=&quot;&quot;&gt;</span>
<a name="l00019"></a>00019 <span class="comment">  &lt;DOTrigger TriggerType=&quot;INSERT|UPDATE|DELETE&quot;&gt; *</span>
<a name="l00020"></a>00020 <span class="comment">   &lt;TriggerCondition Expression=&quot;&quot; ExtraSearchRule=&quot;&quot; /&gt;</span>
<a name="l00021"></a>00021 <span class="comment">   &lt;TriggerActions&gt;</span>
<a name="l00022"></a>00022 <span class="comment">      &lt;TriggerAction Action=&quot;CallService|ExecuteSQL|ExecuteShell|CreateInboxItem|SendEmail|...&quot; Immediate=&quot;Y|N&quot; DelayMinutes=&quot;&quot; RepeatMinutes=&quot;&quot;&gt;</span>
<a name="l00023"></a>00023 <span class="comment">         &lt;ActionArgument Name=&quot;&quot; Value=&quot;&quot; /&gt; *</span>
<a name="l00024"></a>00024 <span class="comment">      &lt;/TriggerAction&gt;</span>
<a name="l00025"></a>00025 <span class="comment">   &lt;/TriggerActions&gt;</span>
<a name="l00026"></a>00026 <span class="comment">  &lt;/DOTrigger&gt;</span>
<a name="l00027"></a>00027 <span class="comment">&lt;/PluginService&gt;</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 
<a name="l00038"></a><a class="code" href="classdo_trigger_service.html">00038</a> <span class="keyword">class </span><a class="code" href="classdo_trigger_service.html">doTriggerService</a> <span class="keyword">extends</span> <a class="code" href="class_meta_object.html">MetaObject</a>
<a name="l00039"></a>00039 {
<a name="l00045"></a>00045     <span class="keyword">public</span> $m_DataObjName;
<a name="l00046"></a>00046 
<a name="l00052"></a>00052     <span class="keyword">public</span> $m_DOTriggerList = array();
<a name="l00053"></a>00053 
<a name="l00060"></a><a class="code" href="classdo_trigger_service.html#a847d8d60f037d0a016aca7006cf9dec6">00060</a>     function <a class="code" href="classdo_trigger_service.html#a847d8d60f037d0a016aca7006cf9dec6">__construct</a>(&amp;$xmlArr)
<a name="l00061"></a>00061     {
<a name="l00062"></a>00062         $this-&gt;<a class="code" href="classdo_trigger_service.html#a1db802d93a9f0badf186a646e1cdb161">readMetadata</a>($xmlArr);
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00072"></a><a class="code" href="classdo_trigger_service.html#a1db802d93a9f0badf186a646e1cdb161">00072</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a1db802d93a9f0badf186a646e1cdb161">readMetadata</a>(&amp;$xmlArr)
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074         parent::readMetaData($xmlArr);
<a name="l00075"></a>00075         
<a name="l00076"></a>00076         $this-&gt;m_DataObjName = $xmlArr[<span class="stringliteral">&quot;PLUGINSERVICE&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DATAOBJECTNAME&quot;</span>];
<a name="l00077"></a>00077         $this-&gt;m_DataObjName = $this-&gt;<a class="code" href="class_meta_object.html#a7a34962e72564b47da11d86bfde7cf79">prefixPackage</a>($this-&gt;m_DataObjName);
<a name="l00078"></a>00078         $this-&gt;<a class="code" href="class_meta_object.html#a30987b049d67f46fdeae84d7fea6e79f">readMetaCollection</a>($xmlArr[<span class="stringliteral">&quot;PLUGINSERVICE&quot;</span>][<span class="stringliteral">&quot;DOTRIGGER&quot;</span>], $tmpList);
<a name="l00079"></a>00079         <span class="keywordflow">if</span> (!$tmpList)
<a name="l00080"></a>00080             <span class="keywordflow">return</span>;
<a name="l00081"></a>00081         <span class="keywordflow">foreach</span> ($tmpList as $triggerXml)
<a name="l00082"></a>00082         {
<a name="l00083"></a>00083             $this-&gt;m_DOTriggerList[] = <span class="keyword">new</span> <a class="code" href="class_d_o_trigger.html">DOTrigger</a>($triggerXml);
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00094"></a><a class="code" href="classdo_trigger_service.html#ad0943a41c6202e48717b9bc441cbb5a4">00094</a>     <span class="keyword">public</span> function <a class="code" href="classdo_trigger_service.html#ad0943a41c6202e48717b9bc441cbb5a4">execute</a>($dataObj, $triggerType)
<a name="l00095"></a>00095     {
<a name="l00096"></a>00096         <span class="comment">/* @var $doTrigger DOTrigger */</span>
<a name="l00097"></a>00097         <span class="keywordflow">foreach</span> ($this-&gt;m_DOTriggerList as $doTrigger)
<a name="l00098"></a>00098         {            
<a name="l00099"></a>00099             <span class="keywordflow">if</span> ($doTrigger-&gt;m_TriggerType == $triggerType){                  ;
<a name="l00100"></a>00100                 $this-&gt;<a class="code" href="classdo_trigger_service.html#ad135fb29e8e573e347eea0f0e98027cf">executeAllActions</a>($doTrigger, $dataObj);
<a name="l00101"></a>00101             }
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 
<a name="l00112"></a><a class="code" href="classdo_trigger_service.html#ad135fb29e8e573e347eea0f0e98027cf">00112</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#ad135fb29e8e573e347eea0f0e98027cf">executeAllActions</a>($doTrigger, $dataObj)
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         <span class="keywordflow">if</span> (! $this-&gt;<a class="code" href="classdo_trigger_service.html#a9b5fc125014f3d4d6b1d28d950786f9d">matchCondition</a>($doTrigger, $dataObj))
<a name="l00115"></a>00115             <span class="keywordflow">return</span>;
<a name="l00116"></a>00116         <span class="comment">/* @var $triggerAction TriggerAction */</span>            
<a name="l00117"></a>00117         <span class="keywordflow">foreach</span> ($doTrigger-&gt;m_TriggerActions as $triggerAction)
<a name="l00118"></a>00118         {
<a name="l00119"></a>00119             $this-&gt;<a class="code" href="classdo_trigger_service.html#a32a03de3cf8829dd5d0e449bad9d7f40">executeAction</a>($triggerAction, $dataObj);
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 
<a name="l00130"></a><a class="code" href="classdo_trigger_service.html#a9b5fc125014f3d4d6b1d28d950786f9d">00130</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a9b5fc125014f3d4d6b1d28d950786f9d">matchCondition</a>($doTrigger, $dataObj)
<a name="l00131"></a>00131     {
<a name="l00132"></a>00132         <span class="comment">// evaluate expression</span>
<a name="l00133"></a>00133         $condExpr = $doTrigger-&gt;m_TriggerCondition[<span class="stringliteral">&quot;Expression&quot;</span>];
<a name="l00134"></a>00134         <span class="keywordflow">if</span> ($condExpr)
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136             $exprVal = <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($condExpr, $dataObj);
<a name="l00137"></a>00137             <span class="keywordflow">if</span> ($exprVal !== <span class="keyword">true</span>)
<a name="l00138"></a>00138                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140         <span class="comment">// do query with extra search rule, check if there&#39;s any record returned</span>
<a name="l00141"></a>00141         $extraSearchRule = $doTrigger-&gt;m_TriggerCondition[<span class="stringliteral">&quot;ExtraSearchRule&quot;</span>];
<a name="l00142"></a>00142         <span class="keywordflow">if</span> ($extraSearchRule)
<a name="l00143"></a>00143         {
<a name="l00144"></a>00144             $realSearchRule = <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($extraSearchRule, $dataObj);
<a name="l00145"></a>00145             $recordList = array();
<a name="l00146"></a>00146             <span class="comment">// get one record of the first page with additional searchrule</span>
<a name="l00147"></a>00147             $dataObj-&gt;fetchRecords($realSearchRule, $recordList, 1, 1, <span class="keyword">false</span>);
<a name="l00148"></a>00148             <span class="keywordflow">if</span> (count($recordList) == 0)
<a name="l00149"></a>00149                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 
<a name="l00161"></a><a class="code" href="classdo_trigger_service.html#a32a03de3cf8829dd5d0e449bad9d7f40">00161</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a32a03de3cf8829dd5d0e449bad9d7f40">executeAction</a>($triggerAction, $dataObj)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         <span class="comment">// action method        </span>
<a name="l00164"></a>00164         $methodName = $triggerAction-&gt;m_Action;        
<a name="l00165"></a>00165         <span class="comment">// action method arguments</span>
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (method_exists($this, $methodName))
<a name="l00167"></a>00167         {            
<a name="l00168"></a>00168             <span class="comment">// evaluate arguments as expression support</span>
<a name="l00169"></a>00169             <span class="keywordflow">foreach</span> ($triggerAction-&gt;m_ArgList as $argName =&gt; $argValue)
<a name="l00170"></a>00170                 $argList[$argName] = <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($argValue, $dataObj);
<a name="l00171"></a>00171             <span class="comment">// check the immediate flag</span>
<a name="l00172"></a>00172             <span class="keywordflow">if</span> ($triggerAction-&gt;m_Immediate == <span class="stringliteral">&quot;Y&quot;</span>) <span class="comment">// call the method if Immediate is &quot;Y&quot;</span>
<a name="l00173"></a>00173                 $this-&gt;$methodName($argList);
<a name="l00174"></a>00174             <span class="keywordflow">else</span>
<a name="l00175"></a>00175             { <span class="comment">// put it to a passive queue</span>
<a name="l00176"></a>00176                 <span class="comment">/* $passiveQueueSvc-&gt;Push($methodName,</span>
<a name="l00177"></a>00177 <span class="comment">                                      $argList, </span>
<a name="l00178"></a>00178 <span class="comment">                                      $triggerAction-&gt;m_DelayMinutes, </span>
<a name="l00179"></a>00179 <span class="comment">                                      $triggerAction-&gt;m_RepeatMinutes); */</span>
<a name="l00180"></a>00180             }
<a name="l00181"></a>00181         }
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 
<a name="l00192"></a>00192     <span class="keyword">private</span> function _composeActionMessage($triggerAction, $methodName, $argList)
<a name="l00193"></a>00193     {
<a name="l00194"></a>00194         $actionMsg[<span class="stringliteral">&quot;Method&quot;</span>] = $methodName;
<a name="l00195"></a>00195         $actionMsg[<span class="stringliteral">&quot;ArgList&quot;</span>] = $argList;
<a name="l00196"></a>00196         $actionMsg[<span class="stringliteral">&quot;DelayMinutes&quot;</span>] = $triggerAction-&gt;m_DelayMinutes;
<a name="l00197"></a>00197         $actionMsg[<span class="stringliteral">&quot;RepeatMinutes&quot;</span>] = $triggerAction-&gt;m_RepeatMinutes;
<a name="l00198"></a>00198         $actionMsg[<span class="stringliteral">&quot;StartTime&quot;</span>] = strftime(<span class="stringliteral">&quot;%Y-%m-%d %H:%M:%S&quot;</span>);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="keyword">protected</span> function callService($argList)
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203        $svcobj = $argList[<span class="stringliteral">&#39;Service&#39;</span>];
<a name="l00204"></a>00204        $method = $argList[<span class="stringliteral">&#39;Method&#39;</span>];
<a name="l00205"></a>00205        $svcobj = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($svcobj);
<a name="l00206"></a>00206        <span class="keywordflow">if</span>(!method_exists($svcobj,$method))
<a name="l00207"></a>00207        {
<a name="l00208"></a>00208               <span class="keywordflow">return</span>;
<a name="l00209"></a>00209        }       
<a name="l00210"></a>00210        unset($argList[<span class="stringliteral">&#39;Service&#39;</span>]);
<a name="l00211"></a>00211        unset($argList[<span class="stringliteral">&#39;Method&#39;</span>]);
<a name="l00212"></a>00212        <span class="keywordflow">return</span> call_user_func_array(array($svcobj,$method),$argList);
<a name="l00213"></a>00213        
<a name="l00214"></a>00214     }
<a name="l00221"></a><a class="code" href="classdo_trigger_service.html#a4f6194192feffe72364e26291c67c05e">00221</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a4f6194192feffe72364e26291c67c05e">executeShell</a>($argList)
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223         $Script = $argList[<span class="stringliteral">&quot;Script&quot;</span>];
<a name="l00224"></a>00224         $Inputs = $argList[<span class="stringliteral">&quot;Inputs&quot;</span>];
<a name="l00225"></a>00225         $command = <span class="stringliteral">&quot;$Script $Inputs&quot;</span>;
<a name="l00226"></a>00226         <span class="comment">//$result = exec($command, $output);</span>
<a name="l00227"></a>00227         exec($command);
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00237"></a><a class="code" href="classdo_trigger_service.html#a82922eb1677895aef4fab1ed50a2b8c5">00237</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a82922eb1677895aef4fab1ed50a2b8c5">executeSQL</a>($argList)
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239         $dbName = $argList[<span class="stringliteral">&quot;DBName&quot;</span>];
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (! $dbName)
<a name="l00241"></a>00241             $dbName = <span class="stringliteral">&quot;Default&quot;</span>;
<a name="l00242"></a>00242         $sql = $argList[<span class="stringliteral">&quot;SQL&quot;</span>];
<a name="l00243"></a>00243         $db = <a class="code" href="class_biz_system.html#a8f2d352158e1605a7121780c060eb28d">BizSystem::dbConnection</a>($dbName);
<a name="l00244"></a>00244         <span class="keywordflow">try</span>
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246             $resultSet = $db-&gt;query($sql);
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248         <span class="keywordflow">catch</span> (Exception $e)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             $errorMessage = <span class="stringliteral">&quot;Error in run SQL: &quot;</span> . $sql . <span class="stringliteral">&quot;. &quot;</span> . $e-&gt;getMessage();
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253 
<a name="l00260"></a><a class="code" href="classdo_trigger_service.html#abd94d7e323900fbe0c78e6fe1c2ef9f8">00260</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#abd94d7e323900fbe0c78e6fe1c2ef9f8">sendEmail</a>($argList)
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <span class="comment">// emailService</span>
<a name="l00263"></a>00263         $emailServiceName = $argList[<span class="stringliteral">&quot;EmailService&quot;</span>];
<a name="l00264"></a>00264         $emailService = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($emailServiceName);
<a name="l00265"></a>00265         <span class="keywordflow">if</span> ($emailService == null)
<a name="l00266"></a>00266             <span class="keywordflow">return</span>;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         $emailService-&gt;useAccount($argList[<span class="stringliteral">&quot;Account&quot;</span>]);
<a name="l00269"></a>00269         $TOs = doTriggerService::_makeArray($argList[<span class="stringliteral">&quot;TOs&quot;</span>]);
<a name="l00270"></a>00270         $CCs = doTriggerService::_makeArray($argList[<span class="stringliteral">&quot;CCs&quot;</span>]);
<a name="l00271"></a>00271         $BCCs = doTriggerService::_makeArray($argList[<span class="stringliteral">&quot;BCCs&quot;</span>]);
<a name="l00272"></a>00272         $Attachments = doTriggerService::_makeArray($argList[<span class="stringliteral">&quot;Attachments&quot;</span>]);
<a name="l00273"></a>00273         $subject = $argList[<span class="stringliteral">&quot;Subject&quot;</span>];
<a name="l00274"></a>00274         $body = $argList[<span class="stringliteral">&quot;Body&quot;</span>];
<a name="l00275"></a>00275         $ok = $emailService-&gt;sendEmail($TOs, $CCs, $BCCs, $subject, $body, $Attachments);
<a name="l00276"></a>00276         <span class="keywordflow">if</span> ($ok == <span class="keyword">false</span>)
<a name="l00277"></a>00277         {
<a name="l00278"></a>00278             <span class="keywordflow">return</span> $emailService-&gt;getErrorMsg();
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280         <span class="keywordflow">return</span> $ok;
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00289"></a><a class="code" href="classdo_trigger_service.html#ae2b8784fcd3c56c389b8c69a8d59d88c">00289</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#ae2b8784fcd3c56c389b8c69a8d59d88c">auditTrail</a>($argList)
<a name="l00290"></a>00290     {
<a name="l00291"></a>00291         $auditServiceName = $argList[<span class="stringliteral">&quot;AuditService&quot;</span>];
<a name="l00292"></a>00292         $auditService = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($auditServiceName);
<a name="l00293"></a>00293         <span class="keywordflow">if</span> ($auditService == null)
<a name="l00294"></a>00294             <span class="keywordflow">return</span>;
<a name="l00295"></a>00295         $dataObjName = $argList[<span class="stringliteral">&quot;DataObjectName&quot;</span>];
<a name="l00296"></a>00296         $ok = $auditService-&gt;audit($dataObjName);
<a name="l00297"></a>00297         <span class="keywordflow">if</span> ($ok == <span class="keyword">false</span>)
<a name="l00298"></a>00298         {
<a name="l00299"></a>00299             <span class="comment">// log $auditSvc-&gt;getErrorMsg();</span>
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00309"></a>00309     <span class="keyword">static</span> <span class="keyword">private</span> function _makeArray($string)
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311         <span class="keywordflow">if</span> (! $string)
<a name="l00312"></a>00312             <span class="keywordflow">return</span> null;
<a name="l00313"></a>00313         $arr = explode(<span class="stringliteral">&quot;;&quot;</span>, $string);
<a name="l00314"></a>00314         $size = count($arr);
<a name="l00315"></a>00315         <span class="keywordflow">for</span> ($i = 0; $i &lt; $size; $i ++)
<a name="l00316"></a>00316             $arr[$i] = trim($arr[$i]);
<a name="l00317"></a>00317         <span class="keywordflow">return</span> $arr;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00326"></a><a class="code" href="classdo_trigger_service.html#a8b6c326bcdea5a22becbd0a574a09d6b">00326</a>     <span class="keyword">protected</span> function <a class="code" href="classdo_trigger_service.html#a8b6c326bcdea5a22becbd0a574a09d6b">createInboxItem</a>($argList)
<a name="l00327"></a>00327     {    <span class="comment">// call inbox service</span>
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 
<a name="l00340"></a><a class="code" href="class_d_o_trigger.html">00340</a> <span class="keyword">class </span><a class="code" href="class_d_o_trigger.html">DOTrigger</a>
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342     <span class="keyword">public</span> $m_TriggerType;
<a name="l00343"></a>00343 
<a name="l00349"></a>00349     <span class="keyword">public</span> $m_TriggerCondition = array();
<a name="l00350"></a>00350 
<a name="l00356"></a>00356     <span class="keyword">public</span> $m_TriggerActions;
<a name="l00357"></a>00357 
<a name="l00364"></a><a class="code" href="class_d_o_trigger.html#a71eb1365b44422050d8062c2c83af02a">00364</a>     <span class="keyword">public</span> function <a class="code" href="class_d_o_trigger.html#a71eb1365b44422050d8062c2c83af02a">__construct</a> ($xmlArr)
<a name="l00365"></a>00365     {
<a name="l00366"></a>00366         $this-&gt;m_TriggerType = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TRIGGERTYPE&quot;</span>];
<a name="l00367"></a>00367         <span class="comment">// read in trigger condition</span>
<a name="l00368"></a>00368         $this-&gt;m_TriggerCondition[<span class="stringliteral">&quot;Expression&quot;</span>] = $xmlArr[<span class="stringliteral">&quot;TRIGGERCONDITION&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;EXPRESSION&quot;</span>];
<a name="l00369"></a>00369         $this-&gt;m_TriggerCondition[<span class="stringliteral">&quot;ExtraSearchRule&quot;</span>] = $xmlArr[<span class="stringliteral">&quot;TRIGGERCONDITION&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;EXTRASEARCHRULE&quot;</span>];
<a name="l00370"></a>00370         <span class="keywordflow">if</span>($xmlArr[<span class="stringliteral">&quot;TRIGGERACTIONS&quot;</span>][<span class="stringliteral">&quot;TRIGGERACTION&quot;</span>][0]){
<a name="l00371"></a>00371               <span class="keywordflow">foreach</span>($xmlArr[<span class="stringliteral">&quot;TRIGGERACTIONS&quot;</span>][<span class="stringliteral">&quot;TRIGGERACTION&quot;</span>] as $key=&gt;$value){  
<a name="l00372"></a>00372                      $this-&gt;m_TriggerActions[] = <span class="keyword">new</span> <a class="code" href="class_trigger_action.html">TriggerAction</a>($xmlArr[<span class="stringliteral">&quot;TRIGGERACTIONS&quot;</span>][<span class="stringliteral">&quot;TRIGGERACTION&quot;</span>][$key]);
<a name="l00373"></a>00373               }
<a name="l00374"></a>00374         }<span class="keywordflow">else</span>{
<a name="l00375"></a>00375               $this-&gt;m_TriggerActions = <span class="keyword">new</span> <a class="code" href="class_meta_iterator.html">MetaIterator</a>($xmlArr[<span class="stringliteral">&quot;TRIGGERACTIONS&quot;</span>][<span class="stringliteral">&quot;TRIGGERACTION&quot;</span>], <span class="stringliteral">&quot;TriggerAction&quot;</span>);
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377         
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00389"></a><a class="code" href="class_trigger_action.html">00389</a> <span class="keyword">class </span><a class="code" href="class_trigger_action.html">TriggerAction</a> <span class="keyword">extends</span> <a class="code" href="class_meta_object.html">MetaObject</a>
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391     <span class="keyword">public</span> $m_Name;
<a name="l00392"></a>00392     <span class="keyword">public</span> $m_Action;
<a name="l00393"></a>00393     <span class="keyword">public</span> $m_Immediate;
<a name="l00394"></a>00394     <span class="keyword">public</span> $m_DelayMinutes;
<a name="l00395"></a>00395     <span class="keyword">public</span> $m_RepeatMinutes;
<a name="l00396"></a>00396     <span class="keyword">public</span> $m_ArgList = array();
<a name="l00397"></a>00397 
<a name="l00404"></a><a class="code" href="class_trigger_action.html#a71eb1365b44422050d8062c2c83af02a">00404</a>     <span class="keyword">public</span> function <a class="code" href="class_trigger_action.html#a71eb1365b44422050d8062c2c83af02a">__construct</a> ($xmlArr)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406         $this-&gt;m_Name = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;NAME&quot;</span>];
<a name="l00407"></a>00407         $this-&gt;m_Action = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;ACTION&quot;</span>];
<a name="l00408"></a>00408         $this-&gt;m_Immediate = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;IMMEDIATE&quot;</span>];
<a name="l00409"></a>00409         $this-&gt;m_DelayMinutes = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DELAYMINUTES&quot;</span>];
<a name="l00410"></a>00410         $this-&gt;m_RepeatMinutes = $xmlArr[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;REPEATMINUTES&quot;</span>];
<a name="l00411"></a>00411         $this-&gt;<a class="code" href="class_meta_object.html#a30987b049d67f46fdeae84d7fea6e79f">readMetaCollection</a>($xmlArr[<span class="stringliteral">&quot;ACTIONARGUMENT&quot;</span>], $tmpList);
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (! $tmpList)
<a name="l00413"></a>00413             <span class="keywordflow">return</span>;
<a name="l00414"></a>00414         <span class="keywordflow">foreach</span> ($tmpList as $arg)
<a name="l00415"></a>00415         {
<a name="l00416"></a>00416             $this-&gt;m_ArgList[$arg[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;NAME&quot;</span>]] = $arg[<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;VALUE&quot;</span>];
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:09:13 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
