<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Ldap.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Ldap.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00029"></a><a class="code" href="class_zend___ldap.html">00029</a> <span class="keyword">class </span><a class="code" href="class_zend___ldap.html">Zend_Ldap</a>
<a name="l00030"></a>00030 {
<a name="l00031"></a>00031     <span class="keyword">const</span> SEARCH_SCOPE_SUB  = 1;
<a name="l00032"></a>00032     <span class="keyword">const</span> SEARCH_SCOPE_ONE  = 2;
<a name="l00033"></a>00033     <span class="keyword">const</span> SEARCH_SCOPE_BASE = 3;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="keyword">const</span> ACCTNAME_FORM_DN        = 1;
<a name="l00036"></a>00036     <span class="keyword">const</span> ACCTNAME_FORM_USERNAME  = 2;
<a name="l00037"></a>00037     <span class="keyword">const</span> ACCTNAME_FORM_BACKSLASH = 3;
<a name="l00038"></a>00038     <span class="keyword">const</span> ACCTNAME_FORM_PRINCIPAL = 4;
<a name="l00039"></a>00039 
<a name="l00045"></a>00045     <span class="keyword">private</span> $_connectString;
<a name="l00046"></a>00046 
<a name="l00052"></a>00052     <span class="keyword">protected</span> $_options = null;
<a name="l00053"></a>00053 
<a name="l00059"></a>00059     <span class="keyword">protected</span> $_resource = null;
<a name="l00060"></a>00060 
<a name="l00066"></a>00066     <span class="keyword">protected</span> $_rootDse = null;
<a name="l00067"></a>00067 
<a name="l00073"></a>00073     <span class="keyword">protected</span> $_schema = null;
<a name="l00074"></a>00074 
<a name="l00080"></a><a class="code" href="class_zend___ldap.html#acdd5e8b6ccc9412d9bbae94e608a2ea3">00080</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_zend___ldap.html#acdd5e8b6ccc9412d9bbae94e608a2ea3">filterEscape</a>($str)
<a name="l00081"></a>00081     {
<a name="l00085"></a>00085         require_once <span class="stringliteral">&#39;Zend/Ldap/Filter/Abstract.php&#39;</span>;
<a name="l00086"></a>00086         <span class="keywordflow">return</span> Zend_Ldap_Filter_Abstract::escapeValue($str);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088 
<a name="l00097"></a><a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">00097</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">explodeDn</a>($dn, array &amp;$keys = null, array &amp;$vals = null)
<a name="l00098"></a>00098     {
<a name="l00102"></a>00102         require_once <span class="stringliteral">&#39;Zend/Ldap/Dn.php&#39;</span>;
<a name="l00103"></a>00103         <span class="keywordflow">return</span> Zend_Ldap_Dn::checkDn($dn, $keys, $vals);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 
<a name="l00112"></a><a class="code" href="class_zend___ldap.html#aa7f5a18682ecb8e0dc450e26cebfaa37">00112</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#aa7f5a18682ecb8e0dc450e26cebfaa37">__construct</a>($options = array())
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         $this-&gt;<a class="code" href="class_zend___ldap.html#a8213e4c39213f7d6250f72ff6f2699f2">setOptions</a>($options);
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 
<a name="l00122"></a><a class="code" href="class_zend___ldap.html#a421831a265621325e1fdd19aace0c758">00122</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a421831a265621325e1fdd19aace0c758">__destruct</a>()
<a name="l00123"></a>00123     {
<a name="l00124"></a>00124         $this-&gt;<a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">disconnect</a>();
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126 
<a name="l00130"></a><a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">00130</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>()
<a name="l00131"></a>00131     {
<a name="l00132"></a>00132         <span class="keywordflow">return</span> $this-&gt;_resource;
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134 
<a name="l00140"></a><a class="code" href="class_zend___ldap.html#aeb3d06b62e5222903e9324435c198ca3">00140</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#aeb3d06b62e5222903e9324435c198ca3">getLastErrorCode</a>()
<a name="l00141"></a>00141     {
<a name="l00142"></a>00142         $ret = @ldap_get_option($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), LDAP_OPT_ERROR_NUMBER, $err);
<a name="l00143"></a>00143         <span class="keywordflow">if</span> ($ret === <span class="keyword">true</span>) {
<a name="l00144"></a>00144             <span class="keywordflow">if</span> ($err &lt;= -1 &amp;&amp; $err &gt;= -17) {
<a name="l00148"></a>00148                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00149"></a>00149                 <span class="comment">/* For some reason draft-ietf-ldapext-ldap-c-api-xx.txt error</span>
<a name="l00150"></a>00150 <span class="comment">                 * codes in OpenLDAP are negative values from -1 to -17.</span>
<a name="l00151"></a>00151 <span class="comment">                 */</span>
<a name="l00152"></a>00152                 $err = Zend_Ldap_Exception::LDAP_SERVER_DOWN + (-$err - 1);
<a name="l00153"></a>00153             }
<a name="l00154"></a>00154             <span class="keywordflow">return</span> $err;
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         <span class="keywordflow">return</span> 0;
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158 
<a name="l00166"></a><a class="code" href="class_zend___ldap.html#a910777b2295cda08fe943ab28bec2b53">00166</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a910777b2295cda08fe943ab28bec2b53">getLastError</a>(&amp;$errorCode = null, array &amp;$errorMessages = null)
<a name="l00167"></a>00167     {
<a name="l00168"></a>00168         $errorCode = $this-&gt;<a class="code" href="class_zend___ldap.html#aeb3d06b62e5222903e9324435c198ca3">getLastErrorCode</a>();
<a name="l00169"></a>00169         $errorMessages = array();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="comment">/* The various error retrieval functions can return</span>
<a name="l00172"></a>00172 <span class="comment">         * different things so we just try to collect what we</span>
<a name="l00173"></a>00173 <span class="comment">         * can and eliminate dupes.</span>
<a name="l00174"></a>00174 <span class="comment">         */</span>
<a name="l00175"></a>00175         $estr1 = @ldap_error($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>());
<a name="l00176"></a>00176         <span class="keywordflow">if</span> ($errorCode !== 0 &amp;&amp; $estr1 === <span class="stringliteral">&#39;Success&#39;</span>) {
<a name="l00177"></a>00177             $estr1 = @ldap_err2str($errorCode);
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179         <span class="keywordflow">if</span> (!empty($estr1)) {
<a name="l00180"></a>00180             $errorMessages[] = $estr1;
<a name="l00181"></a>00181         }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         @ldap_get_option($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), LDAP_OPT_ERROR_STRING, $estr2);
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (!empty($estr2) &amp;&amp; !in_array($estr2, $errorMessages)) {
<a name="l00185"></a>00185             $errorMessages[] = $estr2;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         $message = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00189"></a>00189         <span class="keywordflow">if</span> ($errorCode &gt; 0) {
<a name="l00190"></a>00190             $message = <span class="stringliteral">&#39;0x&#39;</span> . dechex($errorCode) . <span class="charliteral">&#39; &#39;</span>;
<a name="l00191"></a>00191         } <span class="keywordflow">else</span> {
<a name="l00192"></a>00192             $message = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (<a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($errorMessages) &gt; 0) {
<a name="l00195"></a>00195             $message .= <span class="charliteral">&#39;(&#39;</span> . implode(<span class="stringliteral">&#39;; &#39;</span>, $errorMessages) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00196"></a>00196         } <span class="keywordflow">else</span> {
<a name="l00197"></a>00197             $message .= <span class="stringliteral">&#39;(no error message from LDAP)&#39;</span>;
<a name="l00198"></a>00198         }
<a name="l00199"></a>00199         <span class="keywordflow">return</span> $message;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00226"></a><a class="code" href="class_zend___ldap.html#a8213e4c39213f7d6250f72ff6f2699f2">00226</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a8213e4c39213f7d6250f72ff6f2699f2">setOptions</a>($options)
<a name="l00227"></a>00227     {
<a name="l00228"></a>00228         <span class="keywordflow">if</span> ($options instanceof <a class="code" href="class_zend___config.html">Zend_Config</a>) {
<a name="l00229"></a>00229             $options = $options-&gt;toArray();
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         $permittedOptions = array(
<a name="l00233"></a>00233             <span class="stringliteral">&#39;host&#39;</span>                   =&gt; null,
<a name="l00234"></a>00234             <span class="stringliteral">&#39;port&#39;</span>                   =&gt; 0,
<a name="l00235"></a>00235             <span class="stringliteral">&#39;useSsl&#39;</span>                 =&gt; <span class="keyword">false</span>,
<a name="l00236"></a>00236             <span class="stringliteral">&#39;username&#39;</span>               =&gt; null,
<a name="l00237"></a>00237             <span class="stringliteral">&#39;password&#39;</span>               =&gt; null,
<a name="l00238"></a>00238             <span class="stringliteral">&#39;bindRequiresDn&#39;</span>         =&gt; <span class="keyword">false</span>,
<a name="l00239"></a>00239             <span class="stringliteral">&#39;baseDn&#39;</span>                 =&gt; null,
<a name="l00240"></a>00240             <span class="stringliteral">&#39;accountCanonicalForm&#39;</span>   =&gt; null,
<a name="l00241"></a>00241             <span class="stringliteral">&#39;accountDomainName&#39;</span>      =&gt; null,
<a name="l00242"></a>00242             <span class="stringliteral">&#39;accountDomainNameShort&#39;</span> =&gt; null,
<a name="l00243"></a>00243             <span class="stringliteral">&#39;accountFilterFormat&#39;</span>    =&gt; null,
<a name="l00244"></a>00244             <span class="stringliteral">&#39;allowEmptyPassword&#39;</span>     =&gt; <span class="keyword">false</span>,
<a name="l00245"></a>00245             <span class="stringliteral">&#39;useStartTls&#39;</span>            =&gt; <span class="keyword">false</span>,
<a name="l00246"></a>00246             <span class="stringliteral">&#39;optReferrals&#39;</span>           =&gt; <span class="keyword">false</span>,
<a name="l00247"></a>00247             <span class="stringliteral">&#39;tryUsernameSplit&#39;</span>       =&gt; <span class="keyword">true</span>,
<a name="l00248"></a>00248         );
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         <span class="keywordflow">foreach</span> ($permittedOptions as $key =&gt; $val) {
<a name="l00251"></a>00251             <span class="keywordflow">if</span> (array_key_exists($key, $options)) {
<a name="l00252"></a>00252                 $val = $options[$key];
<a name="l00253"></a>00253                 unset($options[$key]);
<a name="l00254"></a>00254                 <span class="comment">/* Enforce typing. This eliminates issues like Zend_Config_Ini</span>
<a name="l00255"></a>00255 <span class="comment">                 * returning &#39;1&#39; as a string (ZF-3163).</span>
<a name="l00256"></a>00256 <span class="comment">                 */</span>
<a name="l00257"></a>00257                 <span class="keywordflow">switch</span> ($key) {
<a name="l00258"></a>00258                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;port&#39;</span>:
<a name="l00259"></a>00259                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;accountCanonicalForm&#39;</span>:
<a name="l00260"></a>00260                         $permittedOptions[$key] = (int)$val;
<a name="l00261"></a>00261                         <span class="keywordflow">break</span>;
<a name="l00262"></a>00262                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;useSsl&#39;</span>:
<a name="l00263"></a>00263                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;bindRequiresDn&#39;</span>:
<a name="l00264"></a>00264                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;allowEmptyPassword&#39;</span>:
<a name="l00265"></a>00265                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;useStartTls&#39;</span>:
<a name="l00266"></a>00266                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;optReferrals&#39;</span>:
<a name="l00267"></a>00267                     <span class="keywordflow">case</span> <span class="stringliteral">&#39;tryUsernameSplit&#39;</span>:
<a name="l00268"></a>00268                         $permittedOptions[$key] = ($val === <span class="keyword">true</span> ||
<a name="l00269"></a>00269                                 $val === <span class="charliteral">&#39;1&#39;</span> || strcasecmp($val, <span class="stringliteral">&#39;true&#39;</span>) == 0);
<a name="l00270"></a>00270                         <span class="keywordflow">break</span>;
<a name="l00271"></a>00271                     <span class="keywordflow">default</span>:
<a name="l00272"></a>00272                         $permittedOptions[$key] = trim($val);
<a name="l00273"></a>00273                         <span class="keywordflow">break</span>;
<a name="l00274"></a>00274                 }
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (<a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($options) &gt; 0) {
<a name="l00278"></a>00278             $key = key($options);
<a name="l00282"></a>00282             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00283"></a>00283             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&quot;Unknown Zend_Ldap option: $key&quot;</span>);
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285         $this-&gt;_options = $permittedOptions;
<a name="l00286"></a>00286         <span class="keywordflow">return</span> $this;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00292"></a><a class="code" href="class_zend___ldap.html#a1a49b8dded6e91a52e2fd07195d334da">00292</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a1a49b8dded6e91a52e2fd07195d334da">getOptions</a>()
<a name="l00293"></a>00293     {
<a name="l00294"></a>00294         <span class="keywordflow">return</span> $this-&gt;_options;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00300"></a><a class="code" href="class_zend___ldap.html#aeb96785ed5f10aa0412fa1c362af52f7">00300</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#aeb96785ed5f10aa0412fa1c362af52f7">_getHost</a>()
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;host&#39;</span>];
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 
<a name="l00308"></a><a class="code" href="class_zend___ldap.html#a03b465be90f5ad272dd40cb468a33874">00308</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a03b465be90f5ad272dd40cb468a33874">_getPort</a>()
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;port&#39;</span>];
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00316"></a><a class="code" href="class_zend___ldap.html#a711a36391681e3324c92f0d9df23dbbe">00316</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a711a36391681e3324c92f0d9df23dbbe">_getUseSsl</a>()
<a name="l00317"></a>00317     {
<a name="l00318"></a>00318         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;useSsl&#39;</span>];
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00324"></a><a class="code" href="class_zend___ldap.html#ae971e1148ab8b8f6ea25666b6fb77f77">00324</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#ae971e1148ab8b8f6ea25666b6fb77f77">_getUsername</a>()
<a name="l00325"></a>00325     {
<a name="l00326"></a>00326         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;username&#39;</span>];
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 
<a name="l00332"></a><a class="code" href="class_zend___ldap.html#a5f2babfb2d8367930d4877c50462c90e">00332</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a5f2babfb2d8367930d4877c50462c90e">_getPassword</a>()
<a name="l00333"></a>00333     {
<a name="l00334"></a>00334         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;password&#39;</span>];
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 
<a name="l00340"></a><a class="code" href="class_zend___ldap.html#a0511d46be36323cd3668074d0ec50136">00340</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a0511d46be36323cd3668074d0ec50136">_getBindRequiresDn</a>()
<a name="l00341"></a>00341     {
<a name="l00342"></a>00342         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;bindRequiresDn&#39;</span>];
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00350"></a><a class="code" href="class_zend___ldap.html#a9cece4593d7c30ec17181f1733fe4d98">00350</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a9cece4593d7c30ec17181f1733fe4d98">getBaseDn</a>()
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;baseDn&#39;</span>];
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00359"></a><a class="code" href="class_zend___ldap.html#a2fbec30822f45e1cebad01d295cb9cd8">00359</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a2fbec30822f45e1cebad01d295cb9cd8">_getAccountCanonicalForm</a>()
<a name="l00360"></a>00360     {
<a name="l00361"></a>00361         <span class="comment">/* Account names should always be qualified with a domain. In some scenarios</span>
<a name="l00362"></a>00362 <span class="comment">         * using non-qualified account names can lead to security vulnerabilities. If</span>
<a name="l00363"></a>00363 <span class="comment">         * no account canonical form is specified, we guess based in what domain</span>
<a name="l00364"></a>00364 <span class="comment">         * names have been supplied.</span>
<a name="l00365"></a>00365 <span class="comment">         */</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         $accountCanonicalForm = $this-&gt;_options[<span class="stringliteral">&#39;accountCanonicalForm&#39;</span>];
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (!$accountCanonicalForm) {
<a name="l00369"></a>00369             $accountDomainName = $this-&gt;<a class="code" href="class_zend___ldap.html#a1a5c00c2f6470f70cbd3ca55222f6c77">_getAccountDomainName</a>();
<a name="l00370"></a>00370             $accountDomainNameShort = $this-&gt;<a class="code" href="class_zend___ldap.html#ab8760ecd0656895fbab9488028fcf6e9">_getAccountDomainNameShort</a>();
<a name="l00371"></a>00371             <span class="keywordflow">if</span> ($accountDomainNameShort) {
<a name="l00372"></a>00372                 $accountCanonicalForm = Zend_Ldap::ACCTNAME_FORM_BACKSLASH;
<a name="l00373"></a>00373             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($accountDomainName) {
<a name="l00374"></a>00374                 $accountCanonicalForm = Zend_Ldap::ACCTNAME_FORM_PRINCIPAL;
<a name="l00375"></a>00375             } <span class="keywordflow">else</span> {
<a name="l00376"></a>00376                 $accountCanonicalForm = Zend_Ldap::ACCTNAME_FORM_USERNAME;
<a name="l00377"></a>00377             }
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="keywordflow">return</span> $accountCanonicalForm;
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00386"></a><a class="code" href="class_zend___ldap.html#a1a5c00c2f6470f70cbd3ca55222f6c77">00386</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a1a5c00c2f6470f70cbd3ca55222f6c77">_getAccountDomainName</a>()
<a name="l00387"></a>00387     {
<a name="l00388"></a>00388         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;accountDomainName&#39;</span>];
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00394"></a><a class="code" href="class_zend___ldap.html#ab8760ecd0656895fbab9488028fcf6e9">00394</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#ab8760ecd0656895fbab9488028fcf6e9">_getAccountDomainNameShort</a>()
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;accountDomainNameShort&#39;</span>];
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00403"></a><a class="code" href="class_zend___ldap.html#a3ce1288d5d81c61853c042db3ecfabbf">00403</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a3ce1288d5d81c61853c042db3ecfabbf">_getAccountFilterFormat</a>()
<a name="l00404"></a>00404     {
<a name="l00405"></a>00405         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;accountFilterFormat&#39;</span>];
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00411"></a><a class="code" href="class_zend___ldap.html#a860e395646933c96f1644fc98553ea3a">00411</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a860e395646933c96f1644fc98553ea3a">_getAllowEmptyPassword</a>()
<a name="l00412"></a>00412     {
<a name="l00413"></a>00413         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;allowEmptyPassword&#39;</span>];
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00419"></a><a class="code" href="class_zend___ldap.html#aa84a81e59365893e4782f7a5dfee6a8a">00419</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#aa84a81e59365893e4782f7a5dfee6a8a">_getUseStartTls</a>()
<a name="l00420"></a>00420     {
<a name="l00421"></a>00421         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;useStartTls&#39;</span>];
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00427"></a><a class="code" href="class_zend___ldap.html#a2415dcf8f0fa14a1dab19ac2e9c6c1c7">00427</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a2415dcf8f0fa14a1dab19ac2e9c6c1c7">_getOptReferrals</a>()
<a name="l00428"></a>00428     {
<a name="l00429"></a>00429         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;optReferrals&#39;</span>];
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 
<a name="l00435"></a><a class="code" href="class_zend___ldap.html#acefe0ef86ebc127bad14652c278cf9bb">00435</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#acefe0ef86ebc127bad14652c278cf9bb">_getTryUsernameSplit</a>()
<a name="l00436"></a>00436     {
<a name="l00437"></a>00437         <span class="keywordflow">return</span> $this-&gt;_options[<span class="stringliteral">&#39;tryUsernameSplit&#39;</span>];
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00443"></a><a class="code" href="class_zend___ldap.html#aa08bb93b6ac971b6b88ccfeb0c3c4965">00443</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#aa08bb93b6ac971b6b88ccfeb0c3c4965">_getAccountFilter</a>($acctname)
<a name="l00444"></a>00444     {
<a name="l00448"></a>00448         require_once <span class="stringliteral">&#39;Zend/Ldap/Filter/Abstract.php&#39;</span>;
<a name="l00449"></a>00449         $this-&gt;<a class="code" href="class_zend___ldap.html#aed4f9cadfde25efdbc0476528d2066e3">_splitName</a>($acctname, $dname, $aname);
<a name="l00450"></a>00450         $accountFilterFormat = $this-&gt;<a class="code" href="class_zend___ldap.html#a3ce1288d5d81c61853c042db3ecfabbf">_getAccountFilterFormat</a>();
<a name="l00451"></a>00451         $aname = Zend_Ldap_Filter_Abstract::escapeValue($aname);
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ($accountFilterFormat) {
<a name="l00453"></a>00453             <span class="keywordflow">return</span> sprintf($accountFilterFormat, $aname);
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_zend___ldap.html#a0511d46be36323cd3668074d0ec50136">_getBindRequiresDn</a>()) {
<a name="l00456"></a>00456             <span class="comment">// is there a better way to detect this?</span>
<a name="l00457"></a>00457             <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&quot;(&amp;(objectClass=user)(sAMAccountName=%s))&quot;</span>, $aname);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&quot;(&amp;(objectClass=posixAccount)(uid=%s))&quot;</span>, $aname);
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00468"></a><a class="code" href="class_zend___ldap.html#aed4f9cadfde25efdbc0476528d2066e3">00468</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#aed4f9cadfde25efdbc0476528d2066e3">_splitName</a>($name, &amp;$dname, &amp;$aname)
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470         $dname = null;
<a name="l00471"></a>00471         $aname = $name;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_zend___ldap.html#acefe0ef86ebc127bad14652c278cf9bb">_getTryUsernameSplit</a>()) {
<a name="l00474"></a>00474             <span class="keywordflow">return</span>;
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         $pos = strpos($name, <span class="charliteral">&#39;@&#39;</span>);
<a name="l00478"></a>00478         <span class="keywordflow">if</span> ($pos) {
<a name="l00479"></a>00479             $dname = substr($name, $pos + 1);
<a name="l00480"></a>00480             $aname = substr($name, 0, $pos);
<a name="l00481"></a>00481         } <span class="keywordflow">else</span> {
<a name="l00482"></a>00482             $pos = strpos($name, <span class="charliteral">&#39;\\&#39;</span>);
<a name="l00483"></a>00483             <span class="keywordflow">if</span> ($pos) {
<a name="l00484"></a>00484                 $dname = substr($name, 0, $pos);
<a name="l00485"></a>00485                 $aname = substr($name, $pos + 1);
<a name="l00486"></a>00486             }
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489 
<a name="l00495"></a><a class="code" href="class_zend___ldap.html#ab5c2f15ec8c71e8eb198b25bebc92e1e">00495</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#ab5c2f15ec8c71e8eb198b25bebc92e1e">_getAccountDn</a>($acctname)
<a name="l00496"></a>00496     {
<a name="l00500"></a>00500         require_once <span class="stringliteral">&#39;Zend/Ldap/Dn.php&#39;</span>;
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (Zend_Ldap_Dn::checkDn($acctname)) <span class="keywordflow">return</span> $acctname;
<a name="l00502"></a>00502         $acctname = $this-&gt;<a class="code" href="class_zend___ldap.html#a6e7ab092f76b2cb9b665bb8a58b51c0f">getCanonicalAccountName</a>($acctname, Zend_Ldap::ACCTNAME_FORM_USERNAME);
<a name="l00503"></a>00503         $acct = $this-&gt;<a class="code" href="class_zend___ldap.html#a2f34ed6bb89e09079584322661deadcc">_getAccount</a>($acctname, array(<span class="stringliteral">&#39;dn&#39;</span>));
<a name="l00504"></a>00504         <span class="keywordflow">return</span> $acct[<span class="stringliteral">&#39;dn&#39;</span>];
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00511"></a><a class="code" href="class_zend___ldap.html#aa7504519ed8a59e69e7a9bd59c2d0e35">00511</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#aa7504519ed8a59e69e7a9bd59c2d0e35">_isPossibleAuthority</a>($dname)
<a name="l00512"></a>00512     {
<a name="l00513"></a>00513         <span class="keywordflow">if</span> ($dname === null) {
<a name="l00514"></a>00514             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00515"></a>00515         }
<a name="l00516"></a>00516         $accountDomainName = $this-&gt;<a class="code" href="class_zend___ldap.html#a1a5c00c2f6470f70cbd3ca55222f6c77">_getAccountDomainName</a>();
<a name="l00517"></a>00517         $accountDomainNameShort = $this-&gt;<a class="code" href="class_zend___ldap.html#ab8760ecd0656895fbab9488028fcf6e9">_getAccountDomainNameShort</a>();
<a name="l00518"></a>00518         <span class="keywordflow">if</span> ($accountDomainName === null &amp;&amp; $accountDomainNameShort === null) {
<a name="l00519"></a>00519             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (strcasecmp($dname, $accountDomainName) == 0) {
<a name="l00522"></a>00522             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (strcasecmp($dname, $accountDomainNameShort) == 0) {
<a name="l00525"></a>00525             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00526"></a>00526         }
<a name="l00527"></a>00527         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 
<a name="l00536"></a><a class="code" href="class_zend___ldap.html#a6e7ab092f76b2cb9b665bb8a58b51c0f">00536</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a6e7ab092f76b2cb9b665bb8a58b51c0f">getCanonicalAccountName</a>($acctname, $form = 0)
<a name="l00537"></a>00537     {
<a name="l00538"></a>00538         $this-&gt;<a class="code" href="class_zend___ldap.html#aed4f9cadfde25efdbc0476528d2066e3">_splitName</a>($acctname, $dname, $uname);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_zend___ldap.html#aa7504519ed8a59e69e7a9bd59c2d0e35">_isPossibleAuthority</a>($dname)) {
<a name="l00544"></a>00544             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00545"></a>00545             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null,
<a name="l00546"></a>00546                 <span class="stringliteral">&quot;Binding domain is not an authority for user: $acctname&quot;</span>,
<a name="l00547"></a>00547                 Zend_Ldap_Exception::LDAP_X_DOMAIN_MISMATCH);
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <span class="keywordflow">if</span> (!$uname) {
<a name="l00554"></a>00554             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00555"></a>00555             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&quot;Invalid account name syntax: $acctname&quot;</span>);
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;mb_strtolower&#39;</span>)) {
<a name="l00559"></a>00559             $uname = mb_strtolower($uname, <span class="stringliteral">&#39;UTF-8&#39;</span>);
<a name="l00560"></a>00560         } <span class="keywordflow">else</span> {
<a name="l00561"></a>00561             $uname = strtolower($uname);
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         <span class="keywordflow">if</span> ($form === 0) {
<a name="l00565"></a>00565             $form = $this-&gt;<a class="code" href="class_zend___ldap.html#a2fbec30822f45e1cebad01d295cb9cd8">_getAccountCanonicalForm</a>();
<a name="l00566"></a>00566         }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <span class="keywordflow">switch</span> ($form) {
<a name="l00569"></a>00569             <span class="keywordflow">case</span> Zend_Ldap::ACCTNAME_FORM_DN:
<a name="l00570"></a>00570                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#ab5c2f15ec8c71e8eb198b25bebc92e1e">_getAccountDn</a>($acctname);
<a name="l00571"></a>00571             <span class="keywordflow">case</span> Zend_Ldap::ACCTNAME_FORM_USERNAME:
<a name="l00572"></a>00572                 <span class="keywordflow">return</span> $uname;
<a name="l00573"></a>00573             <span class="keywordflow">case</span> Zend_Ldap::ACCTNAME_FORM_BACKSLASH:
<a name="l00574"></a>00574                 $accountDomainNameShort = $this-&gt;<a class="code" href="class_zend___ldap.html#ab8760ecd0656895fbab9488028fcf6e9">_getAccountDomainNameShort</a>();
<a name="l00575"></a>00575                 <span class="keywordflow">if</span> (!$accountDomainNameShort) {
<a name="l00579"></a>00579                     require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00580"></a>00580                     <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;Option required: accountDomainNameShort&#39;</span>);
<a name="l00581"></a>00581                 }
<a name="l00582"></a>00582                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;$accountDomainNameShort\\$uname&quot;</span>;
<a name="l00583"></a>00583             <span class="keywordflow">case</span> Zend_Ldap::ACCTNAME_FORM_PRINCIPAL:
<a name="l00584"></a>00584                 $accountDomainName = $this-&gt;<a class="code" href="class_zend___ldap.html#a1a5c00c2f6470f70cbd3ca55222f6c77">_getAccountDomainName</a>();
<a name="l00585"></a>00585                 <span class="keywordflow">if</span> (!$accountDomainName) {
<a name="l00589"></a>00589                     require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00590"></a>00590                     <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;Option required: accountDomainName&#39;</span>);
<a name="l00591"></a>00591                 }
<a name="l00592"></a>00592                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;$uname@$accountDomainName&quot;</span>;
<a name="l00593"></a>00593             <span class="keywordflow">default</span>:
<a name="l00597"></a>00597                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00598"></a>00598                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&quot;Unknown canonical name form: $form&quot;</span>);
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601 
<a name="l00607"></a><a class="code" href="class_zend___ldap.html#a2f34ed6bb89e09079584322661deadcc">00607</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#a2f34ed6bb89e09079584322661deadcc">_getAccount</a>($acctname, array $attrs = null)
<a name="l00608"></a>00608     {
<a name="l00609"></a>00609         $baseDn = $this-&gt;<a class="code" href="class_zend___ldap.html#a9cece4593d7c30ec17181f1733fe4d98">getBaseDn</a>();
<a name="l00610"></a>00610         <span class="keywordflow">if</span> (!$baseDn) {
<a name="l00614"></a>00614             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00615"></a>00615             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;Base DN not set&#39;</span>);
<a name="l00616"></a>00616         }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618         $accountFilter = $this-&gt;<a class="code" href="class_zend___ldap.html#aa08bb93b6ac971b6b88ccfeb0c3c4965">_getAccountFilter</a>($acctname);
<a name="l00619"></a>00619         <span class="keywordflow">if</span> (!$accountFilter) {
<a name="l00623"></a>00623             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00624"></a>00624             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;Invalid account filter&#39;</span>);
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         <span class="keywordflow">if</span> (!is_resource($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>())) {
<a name="l00628"></a>00628             $this-&gt;<a class="code" href="class_zend___ldap.html#ac0cb20ba2e92a492c399cc9ed932a30e">bind</a>();
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         $accounts = $this-&gt;<a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">search</a>($accountFilter, $baseDn, self::SEARCH_SCOPE_SUB, $attrs);
<a name="l00632"></a>00632         $count = $accounts-&gt;count();
<a name="l00633"></a>00633         <span class="keywordflow">if</span> ($count === 1) {
<a name="l00634"></a>00634             $acct = $accounts-&gt;getFirst();
<a name="l00635"></a>00635             $accounts-&gt;close();
<a name="l00636"></a>00636             <span class="keywordflow">return</span> $acct;
<a name="l00637"></a>00637         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($count === 0) {
<a name="l00641"></a>00641             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00642"></a>00642             $code = Zend_Ldap_Exception::LDAP_NO_SUCH_OBJECT;
<a name="l00643"></a>00643             $str = <span class="stringliteral">&quot;No object found for: $accountFilter&quot;</span>;
<a name="l00644"></a>00644         } <span class="keywordflow">else</span> {
<a name="l00648"></a>00648             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00649"></a>00649             $code = Zend_Ldap_Exception::LDAP_OPERATIONS_ERROR;
<a name="l00650"></a>00650             $str = <span class="stringliteral">&quot;Unexpected result count ($count) for: $accountFilter&quot;</span>;
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652         $accounts-&gt;close();
<a name="l00656"></a>00656         require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00657"></a>00657         <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, $str, $code);
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 
<a name="l00663"></a><a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">00663</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">disconnect</a>()
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665         <span class="keywordflow">if</span> (is_resource($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>())) {
<a name="l00666"></a>00666             <span class="keywordflow">if</span> (!extension_loaded(<span class="stringliteral">&#39;ldap&#39;</span>)) {
<a name="l00670"></a>00670                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00671"></a>00671                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;LDAP extension not loaded&#39;</span>,
<a name="l00672"></a>00672                     Zend_Ldap_Exception::LDAP_X_EXTENSION_NOT_LOADED);
<a name="l00673"></a>00673             }
<a name="l00674"></a>00674             @ldap_unbind($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>());
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676         $this-&gt;_resource = null;
<a name="l00677"></a>00677         <span class="keywordflow">return</span> $this;
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679 
<a name="l00688"></a><a class="code" href="class_zend___ldap.html#a67bef4528c23f4970373e95c925be856">00688</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a67bef4528c23f4970373e95c925be856">connect</a>($host = null, $port = null, $useSsl = null, $useStartTls = null)
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690         <span class="keywordflow">if</span> ($host === null) {
<a name="l00691"></a>00691             $host = $this-&gt;<a class="code" href="class_zend___ldap.html#aeb96785ed5f10aa0412fa1c362af52f7">_getHost</a>();
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693         <span class="keywordflow">if</span> ($port === null) {
<a name="l00694"></a>00694             $port = $this-&gt;<a class="code" href="class_zend___ldap.html#a03b465be90f5ad272dd40cb468a33874">_getPort</a>();
<a name="l00695"></a>00695         } <span class="keywordflow">else</span> {
<a name="l00696"></a>00696             $port = (int)$port;
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698         <span class="keywordflow">if</span> ($useSsl === null) {
<a name="l00699"></a>00699             $useSsl = $this-&gt;<a class="code" href="class_zend___ldap.html#a711a36391681e3324c92f0d9df23dbbe">_getUseSsl</a>();
<a name="l00700"></a>00700         } <span class="keywordflow">else</span> {
<a name="l00701"></a>00701             $useSsl = (bool)$useSsl;
<a name="l00702"></a>00702         }
<a name="l00703"></a>00703         <span class="keywordflow">if</span> ($useStartTls === null) {
<a name="l00704"></a>00704             $useStartTls = $this-&gt;<a class="code" href="class_zend___ldap.html#aa84a81e59365893e4782f7a5dfee6a8a">_getUseStartTls</a>();
<a name="l00705"></a>00705         } <span class="keywordflow">else</span> {
<a name="l00706"></a>00706             $useStartTls = (bool)$useStartTls;
<a name="l00707"></a>00707         }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="keywordflow">if</span> (!$host) {
<a name="l00713"></a>00713             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00714"></a>00714             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;A host parameter is required&#39;</span>);
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717         <span class="comment">/* To connect using SSL it seems the client tries to verify the server</span>
<a name="l00718"></a>00718 <span class="comment">         * certificate by default. One way to disable this behavior is to set</span>
<a name="l00719"></a>00719 <span class="comment">         * &#39;TLS_REQCERT never&#39; in OpenLDAP&#39;s ldap.conf and restarting Apache. Or,</span>
<a name="l00720"></a>00720 <span class="comment">         * if you really care about the server&#39;s cert you can put a cert on the</span>
<a name="l00721"></a>00721 <span class="comment">         * web server.</span>
<a name="l00722"></a>00722 <span class="comment">         */</span>
<a name="l00723"></a>00723         $url = ($useSsl) ? <span class="stringliteral">&quot;ldaps://$host&quot;</span> : <span class="stringliteral">&quot;ldap://$host&quot;</span>;
<a name="l00724"></a>00724         <span class="keywordflow">if</span> ($port) {
<a name="l00725"></a>00725             $url .= <span class="stringliteral">&quot;:$port&quot;</span>;
<a name="l00726"></a>00726         }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728         <span class="comment">/* Because ldap_connect doesn&#39;t really try to connect, any connect error</span>
<a name="l00729"></a>00729 <span class="comment">         * will actually occur during the ldap_bind call. Therefore, we save the</span>
<a name="l00730"></a>00730 <span class="comment">         * connect string here for reporting it in error handling in bind().</span>
<a name="l00731"></a>00731 <span class="comment">         */</span>
<a name="l00732"></a>00732         $this-&gt;_connectString = $url;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734         $this-&gt;<a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">disconnect</a>();
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="keywordflow">if</span> (!extension_loaded(<span class="stringliteral">&#39;ldap&#39;</span>)) {
<a name="l00740"></a>00740             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00741"></a>00741             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;LDAP extension not loaded&#39;</span>,
<a name="l00742"></a>00742                 Zend_Ldap_Exception::LDAP_X_EXTENSION_NOT_LOADED);
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745         <span class="comment">/* Only OpenLDAP 2.2 + supports URLs so if SSL is not requested, just</span>
<a name="l00746"></a>00746 <span class="comment">         * use the old form.</span>
<a name="l00747"></a>00747 <span class="comment">         */</span>
<a name="l00748"></a>00748         $resource = ($useSsl) ? @ldap_connect($url) : @ldap_connect($host, $port);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750         <span class="keywordflow">if</span> (is_resource($resource) === <span class="keyword">true</span>) {
<a name="l00751"></a>00751             $this-&gt;_resource = $resource;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753             $optReferrals = ($this-&gt;<a class="code" href="class_zend___ldap.html#a2415dcf8f0fa14a1dab19ac2e9c6c1c7">_getOptReferrals</a>()) ? 1 : 0;
<a name="l00754"></a>00754             <span class="keywordflow">if</span> (@ldap_set_option($resource, LDAP_OPT_PROTOCOL_VERSION, 3) &amp;&amp;
<a name="l00755"></a>00755                         @ldap_set_option($resource, LDAP_OPT_REFERRALS, $optReferrals)) {
<a name="l00756"></a>00756                 <span class="keywordflow">if</span> ($useSsl || !$useStartTls || @ldap_start_tls($resource)) {
<a name="l00757"></a>00757                     <span class="keywordflow">return</span> $this;
<a name="l00758"></a>00758                 }
<a name="l00759"></a>00759             }
<a name="l00760"></a>00760 
<a name="l00764"></a>00764             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00765"></a>00765             $zle = <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&quot;$host:$port&quot;</span>);
<a name="l00766"></a>00766             $this-&gt;<a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">disconnect</a>();
<a name="l00767"></a>00767             <span class="keywordflow">throw</span> $zle;
<a name="l00768"></a>00768         }
<a name="l00772"></a>00772         require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00773"></a>00773         <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&quot;Failed to connect to LDAP server: $host:$port&quot;</span>);
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 
<a name="l00782"></a><a class="code" href="class_zend___ldap.html#ac0cb20ba2e92a492c399cc9ed932a30e">00782</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#ac0cb20ba2e92a492c399cc9ed932a30e">bind</a>($username = null, $password = null)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784         $moreCreds = <span class="keyword">true</span>;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <span class="keywordflow">if</span> ($username === null) {
<a name="l00787"></a>00787             $username = $this-&gt;<a class="code" href="class_zend___ldap.html#ae971e1148ab8b8f6ea25666b6fb77f77">_getUsername</a>();
<a name="l00788"></a>00788             $password = $this-&gt;<a class="code" href="class_zend___ldap.html#a5f2babfb2d8367930d4877c50462c90e">_getPassword</a>();
<a name="l00789"></a>00789             $moreCreds = <span class="keyword">false</span>;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         <span class="keywordflow">if</span> ($username === null) {
<a name="l00793"></a>00793             <span class="comment">/* Perform anonymous bind</span>
<a name="l00794"></a>00794 <span class="comment">             */</span>
<a name="l00795"></a>00795             $password = null;
<a name="l00796"></a>00796         } <span class="keywordflow">else</span> {
<a name="l00797"></a>00797             <span class="comment">/* Check to make sure the username is in DN form.</span>
<a name="l00798"></a>00798 <span class="comment">             */</span>
<a name="l00802"></a>00802             require_once <span class="stringliteral">&#39;Zend/Ldap/Dn.php&#39;</span>;
<a name="l00803"></a>00803             <span class="keywordflow">if</span> (!Zend_Ldap_Dn::checkDn($username)) {
<a name="l00804"></a>00804                 <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_zend___ldap.html#a0511d46be36323cd3668074d0ec50136">_getBindRequiresDn</a>()) {
<a name="l00805"></a>00805                     <span class="comment">/* moreCreds stops an infinite loop if _getUsername does not</span>
<a name="l00806"></a>00806 <span class="comment">                     * return a DN and the bind requires it</span>
<a name="l00807"></a>00807 <span class="comment">                     */</span>
<a name="l00808"></a>00808                     <span class="keywordflow">if</span> ($moreCreds) {
<a name="l00809"></a>00809                         <span class="keywordflow">try</span> {
<a name="l00810"></a>00810                             $username = $this-&gt;<a class="code" href="class_zend___ldap.html#ab5c2f15ec8c71e8eb198b25bebc92e1e">_getAccountDn</a>($username);
<a name="l00811"></a>00811                         } <span class="keywordflow">catch</span> (Zend_Ldap_Exception $zle) {
<a name="l00812"></a>00812                             <span class="keywordflow">switch</span> ($zle-&gt;getCode()) {
<a name="l00813"></a>00813                                 <span class="keywordflow">case</span> Zend_Ldap_Exception::LDAP_NO_SUCH_OBJECT:
<a name="l00814"></a>00814                                 <span class="keywordflow">case</span> Zend_Ldap_Exception::LDAP_X_DOMAIN_MISMATCH:
<a name="l00815"></a>00815                                 <span class="keywordflow">case</span> Zend_Ldap_Exception::LDAP_X_EXTENSION_NOT_LOADED:
<a name="l00816"></a>00816                                     <span class="keywordflow">throw</span> $zle;
<a name="l00817"></a>00817                             }
<a name="l00818"></a>00818                             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null,
<a name="l00819"></a>00819                                 <span class="stringliteral">&#39;Failed to retrieve DN for account: &#39;</span> . $username .
<a name="l00820"></a>00820                                 <span class="stringliteral">&#39; [&#39;</span> . $zle-&gt;getMessage() . <span class="charliteral">&#39;]&#39;</span>,
<a name="l00821"></a>00821                                 Zend_Ldap_Exception::LDAP_OPERATIONS_ERROR);
<a name="l00822"></a>00822                         }
<a name="l00823"></a>00823                     } <span class="keywordflow">else</span> {
<a name="l00827"></a>00827                         require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00828"></a>00828                         <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null, <span class="stringliteral">&#39;Binding requires username in DN form&#39;</span>);
<a name="l00829"></a>00829                     }
<a name="l00830"></a>00830                 } <span class="keywordflow">else</span> {
<a name="l00831"></a>00831                     $username = $this-&gt;<a class="code" href="class_zend___ldap.html#a6e7ab092f76b2cb9b665bb8a58b51c0f">getCanonicalAccountName</a>($username,
<a name="l00832"></a>00832                         $this-&gt;<a class="code" href="class_zend___ldap.html#a2fbec30822f45e1cebad01d295cb9cd8">_getAccountCanonicalForm</a>());
<a name="l00833"></a>00833                 }
<a name="l00834"></a>00834             }
<a name="l00835"></a>00835         }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (!is_resource($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>())) {
<a name="l00838"></a>00838             $this-&gt;<a class="code" href="class_zend___ldap.html#a67bef4528c23f4970373e95c925be856">connect</a>();
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         <span class="keywordflow">if</span> ($username !== null &amp;&amp; $password === <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $this-&gt;<a class="code" href="class_zend___ldap.html#a860e395646933c96f1644fc98553ea3a">_getAllowEmptyPassword</a>() !== <span class="keyword">true</span>) {
<a name="l00845"></a>00845             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00846"></a>00846             $zle = <span class="keyword">new</span> Zend_Ldap_Exception(null,
<a name="l00847"></a>00847                 <span class="stringliteral">&#39;Empty password not allowed - see allowEmptyPassword option.&#39;</span>);
<a name="l00848"></a>00848         } <span class="keywordflow">else</span> {
<a name="l00849"></a>00849             <span class="keywordflow">if</span> (@ldap_bind($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $username, $password)) {
<a name="l00850"></a>00850                 <span class="keywordflow">return</span> $this;
<a name="l00851"></a>00851             }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853             $message = ($username === null) ? $this-&gt;_connectString : $username;
<a name="l00857"></a>00857             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00858"></a>00858             <span class="keywordflow">switch</span> ($this-&gt;<a class="code" href="class_zend___ldap.html#aeb3d06b62e5222903e9324435c198ca3">getLastErrorCode</a>()) {
<a name="l00859"></a>00859                 <span class="keywordflow">case</span> Zend_Ldap_Exception::LDAP_SERVER_DOWN:
<a name="l00860"></a>00860                     <span class="comment">/* If the error is related to establishing a connection rather than binding,</span>
<a name="l00861"></a>00861 <span class="comment">                     * the connect string is more informative than the username.</span>
<a name="l00862"></a>00862 <span class="comment">                     */</span>
<a name="l00863"></a>00863                     $message = $this-&gt;_connectString;
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866             $zle = <span class="keyword">new</span> Zend_Ldap_Exception($this, $message);
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868         $this-&gt;<a class="code" href="class_zend___ldap.html#abe175fcf658475bc56e9d6fa02bc88ec">disconnect</a>();
<a name="l00869"></a>00869         <span class="keywordflow">throw</span> $zle;
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00884"></a><a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">00884</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">search</a>($filter, $basedn = null, $scope = self::SEARCH_SCOPE_SUB,
<a name="l00885"></a>00885         array $attributes = array(), $sort = null, $collectionClass = null)
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887         <span class="keywordflow">if</span> ($basedn === null) {
<a name="l00888"></a>00888             $basedn = $this-&gt;<a class="code" href="class_zend___ldap.html#a9cece4593d7c30ec17181f1733fe4d98">getBaseDn</a>();
<a name="l00889"></a>00889         }
<a name="l00890"></a>00890         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($basedn instanceof Zend_Ldap_Dn) {
<a name="l00891"></a>00891             $basedn = $basedn-&gt;toString();
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894         <span class="keywordflow">if</span> ($filter instanceof Zend_Ldap_Filter_Abstract) {
<a name="l00895"></a>00895             $filter = $filter-&gt;toString();
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898         <span class="keywordflow">switch</span> ($scope) {
<a name="l00899"></a>00899             <span class="keywordflow">case</span> self::SEARCH_SCOPE_ONE:
<a name="l00900"></a>00900                 $search = @ldap_list($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $basedn, $filter, $attributes);
<a name="l00901"></a>00901                 <span class="keywordflow">break</span>;
<a name="l00902"></a>00902             <span class="keywordflow">case</span> self::SEARCH_SCOPE_BASE:
<a name="l00903"></a>00903                 $search = @ldap_read($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $basedn, $filter, $attributes);
<a name="l00904"></a>00904                 <span class="keywordflow">break</span>;
<a name="l00905"></a>00905             <span class="keywordflow">case</span> self::SEARCH_SCOPE_SUB:
<a name="l00906"></a>00906             <span class="keywordflow">default</span>:
<a name="l00907"></a>00907                 $search = @ldap_search($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $basedn, $filter, $attributes);
<a name="l00908"></a>00908                 <span class="keywordflow">break</span>;
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911         <span class="keywordflow">if</span>($search === <span class="keyword">false</span>) {
<a name="l00915"></a>00915             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00916"></a>00916             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;searching: &#39;</span> . $filter);
<a name="l00917"></a>00917         }
<a name="l00918"></a>00918         <span class="keywordflow">if</span> (!is_null($sort) &amp;&amp; is_string($sort)) {
<a name="l00919"></a>00919             $isSorted = @ldap_sort($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $search, $sort);
<a name="l00920"></a>00920             <span class="keywordflow">if</span>($search === <span class="keyword">false</span>) {
<a name="l00924"></a>00924                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00925"></a>00925                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;sorting: &#39;</span> . $sort);
<a name="l00926"></a>00926             }
<a name="l00927"></a>00927         }
<a name="l00928"></a>00928 
<a name="l00932"></a>00932         require_once <span class="stringliteral">&#39;Zend/Ldap/Collection/Iterator/Default.php&#39;</span>;
<a name="l00933"></a>00933         $iterator = <span class="keyword">new</span> Zend_Ldap_Collection_Iterator_Default($this, $search);
<a name="l00934"></a>00934         <span class="keywordflow">if</span> ($collectionClass === null) {
<a name="l00938"></a>00938             require_once <span class="stringliteral">&#39;Zend/Ldap/Collection.php&#39;</span>;
<a name="l00939"></a>00939             <span class="keywordflow">return</span> <span class="keyword">new</span> Zend_Ldap_Collection($iterator);
<a name="l00940"></a>00940         } <span class="keywordflow">else</span> {
<a name="l00941"></a>00941             $collectionClass = (string)$collectionClass;
<a name="l00942"></a>00942             <span class="keywordflow">if</span> (!class_exists($collectionClass)) {
<a name="l00946"></a>00946                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00947"></a>00947                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null,
<a name="l00948"></a>00948                     <span class="stringliteral">&quot;Class &#39;$collectionClass&#39; can not be found&quot;</span>);
<a name="l00949"></a>00949             }
<a name="l00950"></a>00950             <span class="keywordflow">if</span> (!is_subclass_of($collectionClass, <span class="stringliteral">&#39;Zend_Ldap_Collection&#39;</span>)) {
<a name="l00954"></a>00954                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l00955"></a>00955                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception(null,
<a name="l00956"></a>00956                     <span class="stringliteral">&quot;Class &#39;$collectionClass&#39; must subclass &#39;Zend_Ldap_Collection&#39;&quot;</span>);
<a name="l00957"></a>00957             }
<a name="l00958"></a>00958             <span class="keywordflow">return</span> <span class="keyword">new</span> $collectionClass($iterator);
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960     }
<a name="l00961"></a>00961 
<a name="l00971"></a><a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">00971</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($filter, $basedn = null, $scope = self::SEARCH_SCOPE_SUB)
<a name="l00972"></a>00972     {
<a name="l00973"></a>00973         <span class="keywordflow">try</span> {
<a name="l00974"></a>00974             $result = $this-&gt;<a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">search</a>($filter, $basedn, $scope, array(<span class="stringliteral">&#39;dn&#39;</span>), null);
<a name="l00975"></a>00975         } <span class="keywordflow">catch</span> (Zend_Ldap_Exception $e) {
<a name="l00976"></a>00976             <span class="keywordflow">if</span> ($e-&gt;getCode() === Zend_Ldap_Exception::LDAP_NO_SUCH_OBJECT) <span class="keywordflow">return</span> 0;
<a name="l00977"></a>00977             <span class="keywordflow">else</span> <span class="keywordflow">throw</span> $e;
<a name="l00978"></a>00978         }
<a name="l00979"></a>00979         <span class="keywordflow">return</span> $result-&gt;count();
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981 
<a name="l00989"></a><a class="code" href="class_zend___ldap.html#a381610be73872ef0de0b2a9d8bb09f84">00989</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a381610be73872ef0de0b2a9d8bb09f84">countChildren</a>($dn)
<a name="l00990"></a>00990     {
<a name="l00991"></a>00991         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>(<span class="stringliteral">&#39;(objectClass=*)&#39;</span>, $dn, self::SEARCH_SCOPE_ONE);
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993 
<a name="l01001"></a><a class="code" href="class_zend___ldap.html#af18560eb77b90cafad5bc7b3a64018e2">01001</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#af18560eb77b90cafad5bc7b3a64018e2">exists</a>($dn)
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003         <span class="keywordflow">return</span> ($this-&gt;<a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>(<span class="stringliteral">&#39;(objectClass=*)&#39;</span>, $dn, self::SEARCH_SCOPE_BASE) == 1);
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005 
<a name="l01017"></a><a class="code" href="class_zend___ldap.html#a24f08bad50ea0d4a8a46c373cbe0f172">01017</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a24f08bad50ea0d4a8a46c373cbe0f172">searchEntries</a>($filter, $basedn = null, $scope = self::SEARCH_SCOPE_SUB,
<a name="l01018"></a>01018         array $attributes = array(), $sort = null)
<a name="l01019"></a>01019     {
<a name="l01020"></a>01020         $result = $this-&gt;<a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">search</a>($filter, $basedn, $scope, $attributes, $sort);
<a name="l01021"></a>01021         <span class="keywordflow">return</span> $result-&gt;toArray();
<a name="l01022"></a>01022     }
<a name="l01023"></a>01023 
<a name="l01033"></a><a class="code" href="class_zend___ldap.html#ab86a570c8855b0a3bc53f45492ddad99">01033</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#ab86a570c8855b0a3bc53f45492ddad99">getEntry</a>($dn, array $attributes = array(), $throwOnNotFound = <span class="keyword">false</span>)
<a name="l01034"></a>01034     {
<a name="l01035"></a>01035         <span class="keywordflow">try</span> {
<a name="l01036"></a>01036             $result = $this-&gt;<a class="code" href="class_zend___ldap.html#a4a1dbad58de127bdeda93668e7a58bf2">search</a>(<span class="stringliteral">&quot;(objectClass=*)&quot;</span>, $dn, self::SEARCH_SCOPE_BASE,
<a name="l01037"></a>01037                 $attributes, null);
<a name="l01038"></a>01038             <span class="keywordflow">return</span> $result-&gt;getFirst();
<a name="l01039"></a>01039         } <span class="keywordflow">catch</span> (Zend_Ldap_Exception $e){
<a name="l01040"></a>01040             <span class="keywordflow">if</span> ($throwOnNotFound !== <span class="keyword">false</span>) <span class="keywordflow">throw</span> $e;
<a name="l01041"></a>01041         }
<a name="l01042"></a>01042         <span class="keywordflow">return</span> null;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044 
<a name="l01052"></a><a class="code" href="class_zend___ldap.html#a0c7f23d8b698f971cf44ec23c5a9e74c">01052</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_zend___ldap.html#a0c7f23d8b698f971cf44ec23c5a9e74c">prepareLdapEntryArray</a>(array &amp;$entry)
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054         <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;dn&#39;</span>, $entry)) unset($entry[<span class="stringliteral">&#39;dn&#39;</span>]);
<a name="l01055"></a>01055         <span class="keywordflow">foreach</span> ($entry as $key =&gt; $value) {
<a name="l01056"></a>01056             <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01057"></a>01057                 <span class="keywordflow">foreach</span> ($value as $i =&gt; $v) {
<a name="l01058"></a>01058                     <span class="keywordflow">if</span> (is_null($v)) unset($value[$i]);
<a name="l01059"></a>01059                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!is_scalar($v)) {
<a name="l01060"></a>01060                         <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidArgumentException(<span class="stringliteral">&#39;Only scalar values allowed in LDAP data&#39;</span>);
<a name="l01061"></a>01061                     } <span class="keywordflow">else</span> {
<a name="l01062"></a>01062                         $v = (string)$v;
<a name="l01063"></a>01063                         <span class="keywordflow">if</span> (strlen($v) == 0) {
<a name="l01064"></a>01064                             unset($value[$i]);
<a name="l01065"></a>01065                         } <span class="keywordflow">else</span> {
<a name="l01066"></a>01066                             $value[$i] = $v;
<a name="l01067"></a>01067                         }
<a name="l01068"></a>01068                     }
<a name="l01069"></a>01069                 }
<a name="l01070"></a>01070                 $entry[$key] = array_values($value);
<a name="l01071"></a>01071             } <span class="keywordflow">else</span> {
<a name="l01072"></a>01072                 <span class="keywordflow">if</span> (is_null($value)) $entry[$key] = array();
<a name="l01073"></a>01073                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!is_scalar($value)) {
<a name="l01074"></a>01074                     <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidArgumentException(<span class="stringliteral">&#39;Only scalar values allowed in LDAP data&#39;</span>);
<a name="l01075"></a>01075                 } <span class="keywordflow">else</span> {
<a name="l01076"></a>01076                     $value = (string)$value;
<a name="l01077"></a>01077                     <span class="keywordflow">if</span> (strlen($value) == 0) {
<a name="l01078"></a>01078                         $entry[$key] = array();
<a name="l01079"></a>01079                     } <span class="keywordflow">else</span> {
<a name="l01080"></a>01080                         $entry[$key] = array($value);
<a name="l01081"></a>01081                     }
<a name="l01082"></a>01082                 }
<a name="l01083"></a>01083             }
<a name="l01084"></a>01084         }
<a name="l01085"></a>01085         $entry = array_change_key_case($entry, CASE_LOWER);
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087 
<a name="l01096"></a><a class="code" href="class_zend___ldap.html#a7204e1227ef307d9a3437288badf55c6">01096</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a7204e1227ef307d9a3437288badf55c6">add</a>($dn, array $entry)
<a name="l01097"></a>01097     {
<a name="l01098"></a>01098         <span class="keywordflow">if</span> (!($dn instanceof Zend_Ldap_Dn)) {
<a name="l01099"></a>01099             $dn = Zend_Ldap_Dn::factory($dn, null);
<a name="l01100"></a>01100         }
<a name="l01101"></a>01101         <a class="code" href="class_zend___ldap.html#a0c7f23d8b698f971cf44ec23c5a9e74c">self::prepareLdapEntryArray</a>($entry);
<a name="l01102"></a>01102         <span class="keywordflow">foreach</span> ($entry as $key =&gt; $value) {
<a name="l01103"></a>01103             <span class="keywordflow">if</span> (is_array($value) &amp;&amp; <a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($value) === 0) {
<a name="l01104"></a>01104                 unset($entry[$key]);
<a name="l01105"></a>01105             }
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         $rdnParts = $dn-&gt;getRdn(Zend_Ldap_Dn::ATTR_CASEFOLD_LOWER);
<a name="l01109"></a>01109         <span class="keywordflow">foreach</span> ($rdnParts as $key =&gt; $value) {
<a name="l01110"></a>01110             $value = Zend_Ldap_Dn::unescapeValue($value);
<a name="l01111"></a>01111             <span class="keywordflow">if</span> (!array_key_exists($key, $entry) ||
<a name="l01112"></a>01112                     !in_array($value, $entry[$key]) ||
<a name="l01113"></a>01113                     <a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($entry[$key]) !== 1) {
<a name="l01114"></a>01114                 $entry[$key] = array($value);
<a name="l01115"></a>01115             }
<a name="l01116"></a>01116         }
<a name="l01117"></a>01117         $adAttributes = array(<span class="stringliteral">&#39;distinguishedname&#39;</span>, <span class="stringliteral">&#39;instancetype&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;objectcategory&#39;</span>,
<a name="l01118"></a>01118             <span class="stringliteral">&#39;objectguid&#39;</span>, <span class="stringliteral">&#39;usnchanged&#39;</span>, <span class="stringliteral">&#39;usncreated&#39;</span>, <span class="stringliteral">&#39;whenchanged&#39;</span>, <span class="stringliteral">&#39;whencreated&#39;</span>);
<a name="l01119"></a>01119         <span class="keywordflow">foreach</span> ($adAttributes as $attr) {
<a name="l01120"></a>01120             <span class="keywordflow">if</span> (array_key_exists($attr, $entry)) {
<a name="l01121"></a>01121                 unset($entry[$attr]);
<a name="l01122"></a>01122             }
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125         $isAdded = @ldap_add($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $dn-&gt;toString(), $entry);
<a name="l01126"></a>01126         <span class="keywordflow">if</span>($isAdded === <span class="keyword">false</span>) {
<a name="l01130"></a>01130             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l01131"></a>01131             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;adding: &#39;</span> . $dn-&gt;toString());
<a name="l01132"></a>01132         }
<a name="l01133"></a>01133         <span class="keywordflow">return</span> $this;
<a name="l01134"></a>01134     }
<a name="l01135"></a>01135 
<a name="l01144"></a><a class="code" href="class_zend___ldap.html#a4a89f1a387fe3351eb9a42695049ebae">01144</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a4a89f1a387fe3351eb9a42695049ebae">update</a>($dn, array $entry)
<a name="l01145"></a>01145     {
<a name="l01146"></a>01146         <span class="keywordflow">if</span> (!($dn instanceof Zend_Ldap_Dn)) {
<a name="l01147"></a>01147             $dn = Zend_Ldap_Dn::factory($dn, null);
<a name="l01148"></a>01148         }
<a name="l01149"></a>01149         <a class="code" href="class_zend___ldap.html#a0c7f23d8b698f971cf44ec23c5a9e74c">self::prepareLdapEntryArray</a>($entry);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         $rdnParts = $dn-&gt;getRdn(Zend_Ldap_Dn::ATTR_CASEFOLD_LOWER);
<a name="l01152"></a>01152         $adAttributes = array(<span class="stringliteral">&#39;distinguishedname&#39;</span>, <span class="stringliteral">&#39;instancetype&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;objectcategory&#39;</span>,
<a name="l01153"></a>01153             <span class="stringliteral">&#39;objectguid&#39;</span>, <span class="stringliteral">&#39;usnchanged&#39;</span>, <span class="stringliteral">&#39;usncreated&#39;</span>, <span class="stringliteral">&#39;whenchanged&#39;</span>, <span class="stringliteral">&#39;whencreated&#39;</span>);
<a name="l01154"></a>01154         $stripAttributes = array_merge(array_keys($rdnParts), $adAttributes);
<a name="l01155"></a>01155         <span class="keywordflow">foreach</span> ($stripAttributes as $attr) {
<a name="l01156"></a>01156             <span class="keywordflow">if</span> (array_key_exists($attr, $entry)) {
<a name="l01157"></a>01157                 unset($entry[$attr]);
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159         }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161         <span class="keywordflow">if</span> (<a class="code" href="class_zend___ldap.html#a3a50ca2dc0f8ac69756fb257ec9f21fd">count</a>($entry) &gt; 0) {
<a name="l01162"></a>01162             $isModified = @ldap_modify($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $dn-&gt;toString(), $entry);
<a name="l01163"></a>01163             <span class="keywordflow">if</span>($isModified === <span class="keyword">false</span>) {
<a name="l01167"></a>01167                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l01168"></a>01168                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;updating: &#39;</span> . $dn-&gt;toString());
<a name="l01169"></a>01169             }
<a name="l01170"></a>01170         }
<a name="l01171"></a>01171         <span class="keywordflow">return</span> $this;
<a name="l01172"></a>01172     }
<a name="l01173"></a>01173 
<a name="l01185"></a><a class="code" href="class_zend___ldap.html#a634a602661ed9408307c8056b4ec253b">01185</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a634a602661ed9408307c8056b4ec253b">save</a>($dn, array $entry)
<a name="l01186"></a>01186     {
<a name="l01187"></a>01187         <span class="keywordflow">if</span> ($dn instanceof Zend_Ldap_Dn) {
<a name="l01188"></a>01188             $dn = $dn-&gt;toString();
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_zend___ldap.html#af18560eb77b90cafad5bc7b3a64018e2">exists</a>($dn)) $this-&gt;<a class="code" href="class_zend___ldap.html#a4a89f1a387fe3351eb9a42695049ebae">update</a>($dn, $entry);
<a name="l01191"></a>01191         <span class="keywordflow">else</span> $this-&gt;<a class="code" href="class_zend___ldap.html#a7204e1227ef307d9a3437288badf55c6">add</a>($dn, $entry);
<a name="l01192"></a>01192         <span class="keywordflow">return</span> $this;
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194 
<a name="l01203"></a><a class="code" href="class_zend___ldap.html#a466b5c415cc07dd4feea071aa99edbc2">01203</a>     <span class="keyword">public</span> function <span class="keyword">delete</span>($dn, $recursively = <span class="keyword">false</span>)
<a name="l01204"></a>01204     {
<a name="l01205"></a>01205         <span class="keywordflow">if</span> ($dn instanceof Zend_Ldap_Dn) {
<a name="l01206"></a>01206             $dn = $dn-&gt;toString();
<a name="l01207"></a>01207         }
<a name="l01208"></a>01208         <span class="keywordflow">if</span> ($recursively === <span class="keyword">true</span>) {
<a name="l01209"></a>01209             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_zend___ldap.html#a381610be73872ef0de0b2a9d8bb09f84">countChildren</a>($dn)&gt;0) {
<a name="l01210"></a>01210                 $children = $this-&gt;<a class="code" href="class_zend___ldap.html#af8270b641d432d2fa5f54158c5da4f03">_getChildrenDns</a>($dn);
<a name="l01211"></a>01211                 <span class="keywordflow">foreach</span> ($children as $c) {
<a name="l01212"></a>01212                     $this-&gt;<span class="keyword">delete</span>($c, <span class="keyword">true</span>);
<a name="l01213"></a>01213                 }
<a name="l01214"></a>01214             }
<a name="l01215"></a>01215         }
<a name="l01216"></a>01216         $isDeleted = @ldap_delete($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $dn);
<a name="l01217"></a>01217         <span class="keywordflow">if</span>($isDeleted === <span class="keyword">false</span>) {
<a name="l01221"></a>01221             require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l01222"></a>01222             <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;deleting: &#39;</span> . $dn);
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224         <span class="keywordflow">return</span> $this;
<a name="l01225"></a>01225     }
<a name="l01226"></a>01226 
<a name="l01236"></a><a class="code" href="class_zend___ldap.html#af8270b641d432d2fa5f54158c5da4f03">01236</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___ldap.html#af8270b641d432d2fa5f54158c5da4f03">_getChildrenDns</a>($parentDn)
<a name="l01237"></a>01237     {
<a name="l01238"></a>01238         <span class="keywordflow">if</span> ($parentDn instanceof Zend_Ldap_Dn) {
<a name="l01239"></a>01239             $parentDn = $parentDn-&gt;toString();
<a name="l01240"></a>01240         }
<a name="l01241"></a>01241         $children = array();
<a name="l01242"></a>01242         $search = @ldap_list($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $parentDn, <span class="stringliteral">&#39;(objectClass=*)&#39;</span>, array(<span class="stringliteral">&#39;dn&#39;</span>));
<a name="l01243"></a>01243         <span class="keywordflow">for</span> ($entry = @ldap_first_entry($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $search);
<a name="l01244"></a>01244                 $entry !== <span class="keyword">false</span>;
<a name="l01245"></a>01245                 $entry = @ldap_next_entry($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $entry)) {
<a name="l01246"></a>01246             $childDn = @ldap_get_dn($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $entry);
<a name="l01247"></a>01247             <span class="keywordflow">if</span> ($childDn === <span class="keyword">false</span>) {
<a name="l01251"></a>01251                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l01252"></a>01252                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;getting dn&#39;</span>);
<a name="l01253"></a>01253             }
<a name="l01254"></a>01254             $children[] = $childDn;
<a name="l01255"></a>01255         }
<a name="l01256"></a>01256         @ldap_free_result($search);
<a name="l01257"></a>01257         <span class="keywordflow">return</span> $children;
<a name="l01258"></a>01258     }
<a name="l01259"></a>01259 
<a name="l01270"></a><a class="code" href="class_zend___ldap.html#aadf2afe8eb4de3ab750f582a0c3b99dd">01270</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#aadf2afe8eb4de3ab750f582a0c3b99dd">moveToSubtree</a>($from, $to, $recursively = <span class="keyword">false</span>, $alwaysEmulate = <span class="keyword">false</span>)
<a name="l01271"></a>01271     {
<a name="l01272"></a>01272         <span class="keywordflow">if</span> ($from instanceof Zend_Ldap_Dn) {
<a name="l01273"></a>01273             $orgDnParts = $from-&gt;toArray();
<a name="l01274"></a>01274         } <span class="keywordflow">else</span> {
<a name="l01275"></a>01275             $orgDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($from);
<a name="l01276"></a>01276         }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278         <span class="keywordflow">if</span> ($to instanceof Zend_Ldap_Dn) {
<a name="l01279"></a>01279             $newParentDnParts = $to-&gt;toArray();
<a name="l01280"></a>01280         } <span class="keywordflow">else</span> {
<a name="l01281"></a>01281             $newParentDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($to);
<a name="l01282"></a>01282         }
<a name="l01283"></a>01283 
<a name="l01284"></a>01284         $newDnParts = array_merge(array(array_shift($orgDnParts)), $newParentDnParts);
<a name="l01285"></a>01285         $newDn = Zend_Ldap_Dn::fromArray($newDnParts);
<a name="l01286"></a>01286         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#affb998bbb77f92a79bb69b0af5df6532">rename</a>($from, $newDn, $recursively, $alwaysEmulate);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288 
<a name="l01301"></a><a class="code" href="class_zend___ldap.html#a248effe8a914c2d6757d25f904115925">01301</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a248effe8a914c2d6757d25f904115925">move</a>($from, $to, $recursively = <span class="keyword">false</span>, $alwaysEmulate = <span class="keyword">false</span>)
<a name="l01302"></a>01302     {
<a name="l01303"></a>01303         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#affb998bbb77f92a79bb69b0af5df6532">rename</a>($from, $to, $recursively, $alwaysEmulate);
<a name="l01304"></a>01304     }
<a name="l01305"></a>01305 
<a name="l01318"></a><a class="code" href="class_zend___ldap.html#affb998bbb77f92a79bb69b0af5df6532">01318</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#affb998bbb77f92a79bb69b0af5df6532">rename</a>($from, $to, $recursively = <span class="keyword">false</span>, $alwaysEmulate = <span class="keyword">false</span>)
<a name="l01319"></a>01319     {
<a name="l01320"></a>01320         $emulate = (bool)$alwaysEmulate;
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;ldap_rename&#39;</span>)) $emulate = <span class="keyword">true</span>;
<a name="l01322"></a>01322         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($recursively) $emulate = <span class="keyword">true</span>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         <span class="keywordflow">if</span> ($emulate === <span class="keyword">false</span>) {
<a name="l01325"></a>01325             <span class="keywordflow">if</span> ($from instanceof Zend_Ldap_Dn) {
<a name="l01326"></a>01326                 $from = $from-&gt;toString();
<a name="l01327"></a>01327             }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329             <span class="keywordflow">if</span> ($to instanceof Zend_Ldap_Dn) {
<a name="l01330"></a>01330                 $newDnParts = $to-&gt;toArray();
<a name="l01331"></a>01331             } <span class="keywordflow">else</span> {
<a name="l01332"></a>01332                 $newDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($to);
<a name="l01333"></a>01333             }
<a name="l01334"></a>01334 
<a name="l01335"></a>01335             $newRdn = Zend_Ldap_Dn::implodeRdn(array_shift($newDnParts));
<a name="l01336"></a>01336             $newParent = Zend_Ldap_Dn::implodeDn($newDnParts);
<a name="l01337"></a>01337             $isOK = @ldap_rename($this-&gt;<a class="code" href="class_zend___ldap.html#a8c5a689e9be7d35d0d01d0194637a7d2">getResource</a>(), $from, $newRdn, $newParent, <span class="keyword">true</span>);
<a name="l01338"></a>01338             <span class="keywordflow">if</span>($isOK === <span class="keyword">false</span>) {
<a name="l01342"></a>01342                 require_once <span class="stringliteral">&#39;Zend/Ldap/Exception.php&#39;</span>;
<a name="l01343"></a>01343                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Zend_Ldap_Exception($this, <span class="stringliteral">&#39;renaming &#39;</span> . $from . <span class="stringliteral">&#39; to &#39;</span> . $to);
<a name="l01344"></a>01344             }
<a name="l01345"></a>01345             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_zend___ldap.html#af18560eb77b90cafad5bc7b3a64018e2">exists</a>($to)) $emulate = <span class="keyword">true</span>;
<a name="l01346"></a>01346         }
<a name="l01347"></a>01347         <span class="keywordflow">if</span> ($emulate) {
<a name="l01348"></a>01348             $this-&gt;<a class="code" href="class_zend___ldap.html#ad97d4b34c1ead408510c10f1f8c85ab4">copy</a>($from, $to, $recursively);
<a name="l01349"></a>01349             $this-&gt;<span class="keyword">delete</span>($from, $recursively);
<a name="l01350"></a>01350         }
<a name="l01351"></a>01351         <span class="keywordflow">return</span> $this;
<a name="l01352"></a>01352     }
<a name="l01353"></a>01353 
<a name="l01363"></a><a class="code" href="class_zend___ldap.html#a314f442baa14201b868003a7c713ecaa">01363</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a314f442baa14201b868003a7c713ecaa">copyToSubtree</a>($from, $to, $recursively = <span class="keyword">false</span>)
<a name="l01364"></a>01364     {
<a name="l01365"></a>01365         <span class="keywordflow">if</span> ($from instanceof Zend_Ldap_Dn) {
<a name="l01366"></a>01366             $orgDnParts = $from-&gt;toArray();
<a name="l01367"></a>01367         } <span class="keywordflow">else</span> {
<a name="l01368"></a>01368             $orgDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($from);
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371         <span class="keywordflow">if</span> ($to instanceof Zend_Ldap_Dn) {
<a name="l01372"></a>01372             $newParentDnParts = $to-&gt;toArray();
<a name="l01373"></a>01373         } <span class="keywordflow">else</span> {
<a name="l01374"></a>01374             $newParentDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($to);
<a name="l01375"></a>01375         }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377         $newDnParts = array_merge(array(array_shift($orgDnParts)), $newParentDnParts);
<a name="l01378"></a>01378         $newDn = Zend_Ldap_Dn::fromArray($newDnParts);
<a name="l01379"></a>01379         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#ad97d4b34c1ead408510c10f1f8c85ab4">copy</a>($from, $newDn, $recursively);
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381 
<a name="l01391"></a><a class="code" href="class_zend___ldap.html#ad97d4b34c1ead408510c10f1f8c85ab4">01391</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#ad97d4b34c1ead408510c10f1f8c85ab4">copy</a>($from, $to, $recursively = <span class="keyword">false</span>)
<a name="l01392"></a>01392     {
<a name="l01393"></a>01393         $entry = $this-&gt;<a class="code" href="class_zend___ldap.html#ab86a570c8855b0a3bc53f45492ddad99">getEntry</a>($from, array(), <span class="keyword">true</span>);
<a name="l01394"></a>01394 
<a name="l01395"></a>01395         <span class="keywordflow">if</span> ($to instanceof Zend_Ldap_Dn) {
<a name="l01396"></a>01396             $toDnParts = $to-&gt;toArray();
<a name="l01397"></a>01397         } <span class="keywordflow">else</span> {
<a name="l01398"></a>01398             $toDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($to);
<a name="l01399"></a>01399         }
<a name="l01400"></a>01400         $this-&gt;<a class="code" href="class_zend___ldap.html#a7204e1227ef307d9a3437288badf55c6">add</a>($to, $entry);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402         <span class="keywordflow">if</span> ($recursively === <span class="keyword">true</span> &amp;&amp; $this-&gt;<a class="code" href="class_zend___ldap.html#a381610be73872ef0de0b2a9d8bb09f84">countChildren</a>($from)&gt;0) {
<a name="l01403"></a>01403             $children = $this-&gt;<a class="code" href="class_zend___ldap.html#af8270b641d432d2fa5f54158c5da4f03">_getChildrenDns</a>($from);
<a name="l01404"></a>01404             <span class="keywordflow">foreach</span> ($children as $c) {
<a name="l01405"></a>01405                 $cDnParts = <a class="code" href="class_zend___ldap.html#ac5ab7768a69f2dde7b28ca35fc2210eb">Zend_Ldap_Dn::explodeDn</a>($c);
<a name="l01406"></a>01406                 $newChildParts = array_merge(array(array_shift($cDnParts)), $toDnParts);
<a name="l01407"></a>01407                 $newChild = Zend_Ldap_Dn::implodeDn($newChildParts);
<a name="l01408"></a>01408                 $this-&gt;<a class="code" href="class_zend___ldap.html#ad97d4b34c1ead408510c10f1f8c85ab4">copy</a>($c, $newChild, <span class="keyword">true</span>);
<a name="l01409"></a>01409             }
<a name="l01410"></a>01410         }
<a name="l01411"></a>01411         <span class="keywordflow">return</span> $this;
<a name="l01412"></a>01412     }
<a name="l01413"></a>01413 
<a name="l01421"></a><a class="code" href="class_zend___ldap.html#ac9f44602398c03e8e408a0da4be2000c">01421</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#ac9f44602398c03e8e408a0da4be2000c">getNode</a>($dn)
<a name="l01422"></a>01422     {
<a name="l01426"></a>01426         require_once <span class="stringliteral">&#39;Zend/Ldap/Node.php&#39;</span>;
<a name="l01427"></a>01427         <span class="keywordflow">return</span> Zend_Ldap_Node::fromLdap($dn, $this);
<a name="l01428"></a>01428     }
<a name="l01429"></a>01429 
<a name="l01436"></a><a class="code" href="class_zend___ldap.html#a35e05483e7f3252d91fa83394936e14d">01436</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a35e05483e7f3252d91fa83394936e14d">getBaseNode</a>()
<a name="l01437"></a>01437     {
<a name="l01438"></a>01438         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___ldap.html#ac9f44602398c03e8e408a0da4be2000c">getNode</a>($this-&gt;<a class="code" href="class_zend___ldap.html#a9cece4593d7c30ec17181f1733fe4d98">getBaseDn</a>(), $this);
<a name="l01439"></a>01439     }
<a name="l01440"></a>01440 
<a name="l01447"></a><a class="code" href="class_zend___ldap.html#ae5ce0999eb40c8e2e9662108827e96fb">01447</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#ae5ce0999eb40c8e2e9662108827e96fb">getRootDse</a>()
<a name="l01448"></a>01448     {
<a name="l01449"></a>01449         <span class="keywordflow">if</span> ($this-&gt;_rootDse === null) {
<a name="l01453"></a>01453             require_once <span class="stringliteral">&#39;Zend/Ldap/Node/RootDse.php&#39;</span>;
<a name="l01454"></a>01454             $this-&gt;_rootDse = Zend_Ldap_Node_RootDse::create($this);
<a name="l01455"></a>01455         }
<a name="l01456"></a>01456         <span class="keywordflow">return</span> $this-&gt;_rootDse;
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458 
<a name="l01465"></a><a class="code" href="class_zend___ldap.html#a41b42bcfd0572f6481a2a323d73c9977">01465</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___ldap.html#a41b42bcfd0572f6481a2a323d73c9977">getSchema</a>()
<a name="l01466"></a>01466     {
<a name="l01467"></a>01467         <span class="keywordflow">if</span> ($this-&gt;_schema === null) {
<a name="l01471"></a>01471             require_once <span class="stringliteral">&#39;Zend/Ldap/Node/Schema.php&#39;</span>;
<a name="l01472"></a>01472             $this-&gt;_schema = Zend_Ldap_Node_Schema::create($this);
<a name="l01473"></a>01473         }
<a name="l01474"></a>01474         <span class="keywordflow">return</span> $this-&gt;_schema;
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:17 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
