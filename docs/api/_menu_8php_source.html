<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/View/Helper/Navigation/Menu.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/View/Helper/Navigation/Menu.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00026"></a>00026 require_once <span class="stringliteral">&#39;Zend/View/Helper/Navigation/HelperAbstract.php&#39;</span>;
<a name="l00027"></a>00027 
<a name="l00037"></a><a class="code" href="class_zend___view___helper___navigation___menu.html">00037</a> <span class="keyword">class </span><a class="code" href="class_zend___view___helper___navigation___menu.html">Zend_View_Helper_Navigation_Menu</a>
<a name="l00038"></a>00038     <span class="keyword">extends</span> <a class="code" href="class_zend___view___helper___navigation___helper_abstract.html">Zend_View_Helper_Navigation_HelperAbstract</a>
<a name="l00039"></a>00039 {
<a name="l00045"></a>00045     <span class="keyword">protected</span> $_ulClass = <span class="stringliteral">&#39;navigation&#39;</span>;
<a name="l00046"></a>00046 
<a name="l00052"></a>00052     <span class="keyword">protected</span> $_onlyActiveBranch = <span class="keyword">false</span>;
<a name="l00053"></a>00053 
<a name="l00059"></a>00059     <span class="keyword">protected</span> $_renderParents = <span class="keyword">true</span>;
<a name="l00060"></a>00060 
<a name="l00066"></a>00066     <span class="keyword">protected</span> $_partial = null;
<a name="l00067"></a>00067 
<a name="l00077"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a4ae55769271951549d0ed1ea07c88772">00077</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a4ae55769271951549d0ed1ea07c88772">menu</a>(Zend_Navigation_Container $container = null)
<a name="l00078"></a>00078     {
<a name="l00079"></a>00079         <span class="keywordflow">if</span> (null !== $container) {
<a name="l00080"></a>00080             $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a37c4c72db14a5f987396a241167560b6">setContainer</a>($container);
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="keywordflow">return</span> $this;
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="comment">// Accessors:</span>
<a name="l00087"></a>00087 
<a name="l00094"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a1375aa8cdff433ad0502a768c62bd45a">00094</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a1375aa8cdff433ad0502a768c62bd45a">setUlClass</a>($ulClass)
<a name="l00095"></a>00095     {
<a name="l00096"></a>00096         <span class="keywordflow">if</span> (is_string($ulClass)) {
<a name="l00097"></a>00097             $this-&gt;_ulClass = $ulClass;
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         <span class="keywordflow">return</span> $this;
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00108"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#aada608812c2f84feeae06fc3bf638a39">00108</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#aada608812c2f84feeae06fc3bf638a39">getUlClass</a>()
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110         <span class="keywordflow">return</span> $this-&gt;_ulClass;
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112 
<a name="l00120"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a5bb5e0e37423e432484f7dc6dd08b3cb">00120</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a5bb5e0e37423e432484f7dc6dd08b3cb">setOnlyActiveBranch</a>($flag = <span class="keyword">true</span>)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         $this-&gt;_onlyActiveBranch = (bool) $flag;
<a name="l00123"></a>00123         <span class="keywordflow">return</span> $this;
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 
<a name="l00134"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#af35af8174b6513b95b59da8525a7b708">00134</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#af35af8174b6513b95b59da8525a7b708">getOnlyActiveBranch</a>()
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136         <span class="keywordflow">return</span> $this-&gt;_onlyActiveBranch;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 
<a name="l00149"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a123448ce24c030c8d9bf2a73395ce335">00149</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a123448ce24c030c8d9bf2a73395ce335">setRenderParents</a>($flag = <span class="keyword">true</span>)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         $this-&gt;_renderParents = (bool) $flag;
<a name="l00152"></a>00152         <span class="keywordflow">return</span> $this;
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00163"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#addb6e2c854e38ca7d4f26469cecd29b6">00163</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#addb6e2c854e38ca7d4f26469cecd29b6">getRenderParents</a>()
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165         <span class="keywordflow">return</span> $this-&gt;_renderParents;
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00179"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a6aa77a2d43add4f52aa11ebcd461840a">00179</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a6aa77a2d43add4f52aa11ebcd461840a">setPartial</a>($partial)
<a name="l00180"></a>00180     {
<a name="l00181"></a>00181         <span class="keywordflow">if</span> (null === $partial || is_string($partial) || is_array($partial)) {
<a name="l00182"></a>00182             $this-&gt;_partial = $partial;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         <span class="keywordflow">return</span> $this;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00193"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a848bf14c895554e9455c9f8c08d2afe5">00193</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a848bf14c895554e9455c9f8c08d2afe5">getPartial</a>()
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195         <span class="keywordflow">return</span> $this-&gt;_partial;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="comment">// Public methods:</span>
<a name="l00199"></a>00199 
<a name="l00209"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a13a1eab32bba55c8ec29e28e9fd083f9">00209</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a13a1eab32bba55c8ec29e28e9fd083f9">htmlify</a>(Zend_Navigation_Page $page)
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <span class="comment">// get label and title for translating</span>
<a name="l00212"></a>00212         $label = $page-&gt;getLabel();
<a name="l00213"></a>00213         $title = $page-&gt;getTitle();
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="comment">// translate label and title?</span>
<a name="l00216"></a>00216         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a5a497267daecc033c852b8c687837031">getUseTranslator</a>() &amp;&amp; $t = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a4b5bf5bf92166dc1c551fe8cfabfb5ae">getTranslator</a>()) {
<a name="l00217"></a>00217             <span class="keywordflow">if</span> (is_string($label) &amp;&amp; !empty($label)) {
<a name="l00218"></a>00218                 $label = $t-&gt;translate($label);
<a name="l00219"></a>00219             }
<a name="l00220"></a>00220             <span class="keywordflow">if</span> (is_string($title) &amp;&amp; !empty($title)) {
<a name="l00221"></a>00221                 $title = $t-&gt;translate($title);
<a name="l00222"></a>00222             }
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">// get attribs for element</span>
<a name="l00226"></a>00226         $attribs = array(
<a name="l00227"></a>00227             <span class="stringliteral">&#39;id&#39;</span>     =&gt; $page-&gt;getId(),
<a name="l00228"></a>00228             <span class="stringliteral">&#39;title&#39;</span>  =&gt; $title,
<a name="l00229"></a>00229             <span class="stringliteral">&#39;class&#39;</span>  =&gt; $page-&gt;getClass()
<a name="l00230"></a>00230         );
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="comment">// does page have a href?</span>
<a name="l00233"></a>00233         <span class="keywordflow">if</span> ($href = $page-&gt;getHref()) {
<a name="l00234"></a>00234             $element = <span class="charliteral">&#39;a&#39;</span>;
<a name="l00235"></a>00235             $attribs[<span class="stringliteral">&#39;href&#39;</span>] = $href;
<a name="l00236"></a>00236             $attribs[<span class="stringliteral">&#39;target&#39;</span>] = $page-&gt;getTarget();
<a name="l00237"></a>00237         } <span class="keywordflow">else</span> {
<a name="l00238"></a>00238             $element = <span class="stringliteral">&#39;span&#39;</span>;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="keywordflow">return</span> <span class="charliteral">&#39;&lt;&#39;</span> . $element . $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ace08c584bb4e68a329bf718780e64f24">_htmlAttribs</a>($attribs) . <span class="charliteral">&#39;&gt;&#39;</span>
<a name="l00242"></a>00242              . $this-&gt;view-&gt;escape($label)
<a name="l00243"></a>00243              . <span class="stringliteral">&#39;&lt;/&#39;</span> . $element . <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00252"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a2e8f1b5c5f8d03aff52a4cf57979b155">00252</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a2e8f1b5c5f8d03aff52a4cf57979b155">_normalizeOptions</a>(array $options = array())
<a name="l00253"></a>00253     {
<a name="l00254"></a>00254         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;indent&#39;</span>])) {
<a name="l00255"></a>00255             $options[<span class="stringliteral">&#39;indent&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a03e93f15a6c144ca7a4edb6a6932d6c2">_getWhitespace</a>($options[<span class="stringliteral">&#39;indent&#39;</span>]);
<a name="l00256"></a>00256         } <span class="keywordflow">else</span> {
<a name="l00257"></a>00257             $options[<span class="stringliteral">&#39;indent&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a0a09e0110a81470ca7791be5738f353f">getIndent</a>();
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (isset($options[<span class="stringliteral">&#39;ulClass&#39;</span>]) &amp;&amp; $options[<span class="stringliteral">&#39;ulClass&#39;</span>] !== null) {
<a name="l00261"></a>00261             $options[<span class="stringliteral">&#39;ulClass&#39;</span>] = (string) $options[<span class="stringliteral">&#39;ulClass&#39;</span>];
<a name="l00262"></a>00262         } <span class="keywordflow">else</span> {
<a name="l00263"></a>00263             $options[<span class="stringliteral">&#39;ulClass&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#aada608812c2f84feeae06fc3bf638a39">getUlClass</a>();
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;minDepth&#39;</span>, $options)) {
<a name="l00267"></a>00267             <span class="keywordflow">if</span> (null !== $options[<span class="stringliteral">&#39;minDepth&#39;</span>]) {
<a name="l00268"></a>00268                 $options[<span class="stringliteral">&#39;minDepth&#39;</span>] = (int) $options[<span class="stringliteral">&#39;minDepth&#39;</span>];
<a name="l00269"></a>00269             }
<a name="l00270"></a>00270         } <span class="keywordflow">else</span> {
<a name="l00271"></a>00271             $options[<span class="stringliteral">&#39;minDepth&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#aaf857f70cd06625b841d27c6516bb0c3">getMinDepth</a>();
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;minDepth&#39;</span>] &lt; 0 || $options[<span class="stringliteral">&#39;minDepth&#39;</span>] === null) {
<a name="l00275"></a>00275             $options[<span class="stringliteral">&#39;minDepth&#39;</span>] = 0;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         <span class="keywordflow">if</span> (array_key_exists(<span class="stringliteral">&#39;maxDepth&#39;</span>, $options)) {
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (null !== $options[<span class="stringliteral">&#39;maxDepth&#39;</span>]) {
<a name="l00280"></a>00280                 $options[<span class="stringliteral">&#39;maxDepth&#39;</span>] = (int) $options[<span class="stringliteral">&#39;maxDepth&#39;</span>];
<a name="l00281"></a>00281             }
<a name="l00282"></a>00282         } <span class="keywordflow">else</span> {
<a name="l00283"></a>00283             $options[<span class="stringliteral">&#39;maxDepth&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ad19103d4fff46dd1fce5dd8c1950533b">getMaxDepth</a>();
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (!isset($options[<span class="stringliteral">&#39;onlyActiveBranch&#39;</span>])) {
<a name="l00287"></a>00287             $options[<span class="stringliteral">&#39;onlyActiveBranch&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#af35af8174b6513b95b59da8525a7b708">getOnlyActiveBranch</a>();
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="keywordflow">if</span> (!isset($options[<span class="stringliteral">&#39;renderParents&#39;</span>])) {
<a name="l00291"></a>00291             $options[<span class="stringliteral">&#39;renderParents&#39;</span>] = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#addb6e2c854e38ca7d4f26469cecd29b6">getRenderParents</a>();
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="keywordflow">return</span> $options;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// Render methods:</span>
<a name="l00298"></a>00298 
<a name="l00311"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#af04f51012aa23192ff6c24dd98329810">00311</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#af04f51012aa23192ff6c24dd98329810">_renderDeepestMenu</a>(Zend_Navigation_Container $container,
<a name="l00312"></a>00312                                           $ulClass,
<a name="l00313"></a>00313                                           $indent,
<a name="l00314"></a>00314                                           $minDepth,
<a name="l00315"></a>00315                                           $maxDepth)
<a name="l00316"></a>00316     {
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (!$active = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ab70dd20926800179b517b8fc5ccde069">findActive</a>($container, $minDepth - 1, $maxDepth)) {
<a name="l00318"></a>00318             <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <span class="comment">// special case if active page is one below minDepth</span>
<a name="l00322"></a>00322         <span class="keywordflow">if</span> ($active[<span class="stringliteral">&#39;depth&#39;</span>] &lt; $minDepth) {
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (!$active[<span class="stringliteral">&#39;page&#39;</span>]-&gt;hasPages()) {
<a name="l00324"></a>00324                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!$active[<span class="stringliteral">&#39;page&#39;</span>]-&gt;hasPages()) {
<a name="l00327"></a>00327             <span class="comment">// found pages has no children; render siblings</span>
<a name="l00328"></a>00328             $active[<span class="stringliteral">&#39;page&#39;</span>] = $active[<span class="stringliteral">&#39;page&#39;</span>]-&gt;getParent();
<a name="l00329"></a>00329         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_int($maxDepth) &amp;&amp; $active[<span class="stringliteral">&#39;depth&#39;</span>] +1 &gt; $maxDepth) {
<a name="l00330"></a>00330             <span class="comment">// children are below max depth; render siblings</span>
<a name="l00331"></a>00331             $active[<span class="stringliteral">&#39;page&#39;</span>] = $active[<span class="stringliteral">&#39;page&#39;</span>]-&gt;getParent();
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         $ulClass = $ulClass ? <span class="stringliteral">&#39; class=&quot;&#39;</span> . $ulClass . <span class="charliteral">&#39;&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00335"></a>00335         $html = $indent . <span class="stringliteral">&#39;&lt;ul&#39;</span> . $ulClass . <span class="charliteral">&#39;&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         <span class="keywordflow">foreach</span> ($active[<span class="stringliteral">&#39;page&#39;</span>] as $subPage) {
<a name="l00338"></a>00338             <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ac36d82558e54f5f3dbb7cdb31520c39a">accept</a>($subPage)) {
<a name="l00339"></a>00339                 <span class="keywordflow">continue</span>;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341             $liClass = $subPage-&gt;isActive(<span class="keyword">true</span>) ? <span class="stringliteral">&#39; class=&quot;active&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00342"></a>00342             $html .= $indent . <span class="stringliteral">&#39;    &lt;li&#39;</span> . $liClass . <span class="charliteral">&#39;&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00343"></a>00343             $html .= $indent . <span class="stringliteral">&#39;        &#39;</span> . $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a13a1eab32bba55c8ec29e28e9fd083f9">htmlify</a>($subPage) . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00344"></a>00344             $html .= $indent . <span class="stringliteral">&#39;    &lt;/li&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         $html .= $indent . <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <span class="keywordflow">return</span> $html;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00363"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a768a06d834f6e81ee4c79ec1649d7523">00363</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a768a06d834f6e81ee4c79ec1649d7523">_renderMenu</a>(Zend_Navigation_Container $container,
<a name="l00364"></a>00364                                    $ulClass,
<a name="l00365"></a>00365                                    $indent,
<a name="l00366"></a>00366                                    $minDepth,
<a name="l00367"></a>00367                                    $maxDepth,
<a name="l00368"></a>00368                                    $onlyActive)
<a name="l00369"></a>00369     {
<a name="l00370"></a>00370         $html = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">// find deepest active</span>
<a name="l00373"></a>00373         <span class="keywordflow">if</span> ($found = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ab70dd20926800179b517b8fc5ccde069">findActive</a>($container, $minDepth, $maxDepth)) {
<a name="l00374"></a>00374             $foundPage = $found[<span class="stringliteral">&#39;page&#39;</span>];
<a name="l00375"></a>00375             $foundDepth = $found[<span class="stringliteral">&#39;depth&#39;</span>];
<a name="l00376"></a>00376         } <span class="keywordflow">else</span> {
<a name="l00377"></a>00377             $foundPage = null;
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="comment">// create iterator</span>
<a name="l00381"></a>00381         $iterator = <span class="keyword">new</span> RecursiveIteratorIterator($container,
<a name="l00382"></a>00382                             RecursiveIteratorIterator::SELF_FIRST);
<a name="l00383"></a>00383         <span class="keywordflow">if</span> (is_int($maxDepth)) {
<a name="l00384"></a>00384             $iterator-&gt;setMaxDepth($maxDepth);
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="comment">// iterate container</span>
<a name="l00388"></a>00388         $prevDepth = -1;
<a name="l00389"></a>00389         <span class="keywordflow">foreach</span> ($iterator as $page) {
<a name="l00390"></a>00390             $depth = $iterator-&gt;getDepth();
<a name="l00391"></a>00391             $isActive = $page-&gt;isActive(<span class="keyword">true</span>);
<a name="l00392"></a>00392             <span class="keywordflow">if</span> ($depth &lt; $minDepth || !$this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#ac36d82558e54f5f3dbb7cdb31520c39a">accept</a>($page)) {
<a name="l00393"></a>00393                 <span class="comment">// page is below minDepth or not accepted by acl/visibilty</span>
<a name="l00394"></a>00394                 <span class="keywordflow">continue</span>;
<a name="l00395"></a>00395             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($onlyActive &amp;&amp; !$isActive) {
<a name="l00396"></a>00396                 <span class="comment">// page is not active itself, but might be in the active branch</span>
<a name="l00397"></a>00397                 $accept = <span class="keyword">false</span>;
<a name="l00398"></a>00398                 <span class="keywordflow">if</span> ($foundPage) {
<a name="l00399"></a>00399                     <span class="keywordflow">if</span> ($foundPage-&gt;hasPage($page)) {
<a name="l00400"></a>00400                         <span class="comment">// accept if page is a direct child of the active page</span>
<a name="l00401"></a>00401                         $accept = <span class="keyword">true</span>;
<a name="l00402"></a>00402                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($foundPage-&gt;getParent()-&gt;hasPage($page)) {
<a name="l00403"></a>00403                         <span class="comment">// page is a sibling of the active page...</span>
<a name="l00404"></a>00404                         <span class="keywordflow">if</span> (!$foundPage-&gt;hasPages() ||
<a name="l00405"></a>00405                             is_int($maxDepth) &amp;&amp; $foundDepth + 1 &gt; $maxDepth) {
<a name="l00406"></a>00406                             <span class="comment">// accept if active page has no children, or the</span>
<a name="l00407"></a>00407                             <span class="comment">// children are too deep to be rendered</span>
<a name="l00408"></a>00408                             $accept = <span class="keyword">true</span>;
<a name="l00409"></a>00409                         }
<a name="l00410"></a>00410                     }
<a name="l00411"></a>00411                 }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413                 <span class="keywordflow">if</span> (!$accept) {
<a name="l00414"></a>00414                     <span class="keywordflow">continue</span>;
<a name="l00415"></a>00415                 }
<a name="l00416"></a>00416             }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418             <span class="comment">// make sure indentation is correct</span>
<a name="l00419"></a>00419             $depth -= $minDepth;
<a name="l00420"></a>00420             $myIndent = $indent . str_repeat(<span class="stringliteral">&#39;        &#39;</span>, $depth);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422             <span class="keywordflow">if</span> ($depth &gt; $prevDepth) {
<a name="l00423"></a>00423                 <span class="comment">// start new ul tag</span>
<a name="l00424"></a>00424                 <span class="keywordflow">if</span> ($ulClass &amp;&amp; $depth ==  0) {
<a name="l00425"></a>00425                     $ulClass = <span class="stringliteral">&#39; class=&quot;&#39;</span> . $ulClass . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00426"></a>00426                 } <span class="keywordflow">else</span> {
<a name="l00427"></a>00427                     $ulClass = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00428"></a>00428                 }
<a name="l00429"></a>00429                 $html .= $myIndent . <span class="stringliteral">&#39;&lt;ul&#39;</span> . $ulClass . <span class="charliteral">&#39;&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00430"></a>00430             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($prevDepth &gt; $depth) {
<a name="l00431"></a>00431                 <span class="comment">// close li/ul tags until we&#39;re at current depth</span>
<a name="l00432"></a>00432                 <span class="keywordflow">for</span> ($i = $prevDepth; $i &gt; $depth; $i--) {
<a name="l00433"></a>00433                     $ind = $indent . str_repeat(<span class="stringliteral">&#39;        &#39;</span>, $i);
<a name="l00434"></a>00434                     $html .= $ind . <span class="stringliteral">&#39;    &lt;/li&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00435"></a>00435                     $html .= $ind . <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00436"></a>00436                 }
<a name="l00437"></a>00437                 <span class="comment">// close previous li tag</span>
<a name="l00438"></a>00438                 $html .= $myIndent . <span class="stringliteral">&#39;    &lt;/li&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00439"></a>00439             } <span class="keywordflow">else</span> {
<a name="l00440"></a>00440                 <span class="comment">// close previous li tag</span>
<a name="l00441"></a>00441                 $html .= $myIndent . <span class="stringliteral">&#39;    &lt;/li&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00442"></a>00442             }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444             <span class="comment">// render li tag and page</span>
<a name="l00445"></a>00445             $liClass = $isActive ? <span class="stringliteral">&#39; class=&quot;active&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00446"></a>00446             $html .= $myIndent . <span class="stringliteral">&#39;    &lt;li&#39;</span> . $liClass . <span class="charliteral">&#39;&gt;&#39;</span> . self::EOL
<a name="l00447"></a>00447                    . $myIndent . <span class="stringliteral">&#39;        &#39;</span> . $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a13a1eab32bba55c8ec29e28e9fd083f9">htmlify</a>($page) . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449             <span class="comment">// store as previous depth for next iteration</span>
<a name="l00450"></a>00450             $prevDepth = $depth;
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         <span class="keywordflow">if</span> ($html) {
<a name="l00454"></a>00454             <span class="comment">// done iterating container; close open ul/li tags</span>
<a name="l00455"></a>00455             <span class="keywordflow">for</span> ($i = $prevDepth+1; $i &gt; 0; $i--) {
<a name="l00456"></a>00456                 $myIndent = $indent . str_repeat(<span class="stringliteral">&#39;        &#39;</span>, $i-1);
<a name="l00457"></a>00457                 $html .= $myIndent . <span class="stringliteral">&#39;    &lt;/li&gt;&#39;</span> . self::EOL
<a name="l00458"></a>00458                        . $myIndent . <span class="stringliteral">&#39;&lt;/ul&gt;&#39;</span> . <a class="code" href="class_zend___view___helper___html_element.html#a0603d6ece8c5d37b4b7db697db053a4b">self::EOL</a>;
<a name="l00459"></a>00459             }
<a name="l00460"></a>00460             $html = rtrim($html, self::EOL);
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <span class="keywordflow">return</span> $html;
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465 
<a name="l00484"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#afa7d10d2024a537d37e45e03bebd38b6">00484</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#afa7d10d2024a537d37e45e03bebd38b6">renderMenu</a>(Zend_Navigation_Container $container = null,
<a name="l00485"></a>00485                                array $options = array())
<a name="l00486"></a>00486     {
<a name="l00487"></a>00487         <span class="keywordflow">if</span> (null === $container) {
<a name="l00488"></a>00488             $container = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a53e2ca32cf29808b0b18cd5accf3c4db">getContainer</a>();
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         $options = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a2e8f1b5c5f8d03aff52a4cf57979b155">_normalizeOptions</a>($options);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="keywordflow">if</span> ($options[<span class="stringliteral">&#39;onlyActiveBranch&#39;</span>] &amp;&amp; !$options[<span class="stringliteral">&#39;renderParents&#39;</span>]) {
<a name="l00494"></a>00494             $html = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#af04f51012aa23192ff6c24dd98329810">_renderDeepestMenu</a>($container,
<a name="l00495"></a>00495                                               $options[<span class="stringliteral">&#39;ulClass&#39;</span>],
<a name="l00496"></a>00496                                               $options[<span class="stringliteral">&#39;indent&#39;</span>],
<a name="l00497"></a>00497                                               $options[<span class="stringliteral">&#39;minDepth&#39;</span>],
<a name="l00498"></a>00498                                               $options[<span class="stringliteral">&#39;maxDepth&#39;</span>]);
<a name="l00499"></a>00499         } <span class="keywordflow">else</span> {
<a name="l00500"></a>00500             $html = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a768a06d834f6e81ee4c79ec1649d7523">_renderMenu</a>($container,
<a name="l00501"></a>00501                                        $options[<span class="stringliteral">&#39;ulClass&#39;</span>],
<a name="l00502"></a>00502                                        $options[<span class="stringliteral">&#39;indent&#39;</span>],
<a name="l00503"></a>00503                                        $options[<span class="stringliteral">&#39;minDepth&#39;</span>],
<a name="l00504"></a>00504                                        $options[<span class="stringliteral">&#39;maxDepth&#39;</span>],
<a name="l00505"></a>00505                                        $options[<span class="stringliteral">&#39;onlyActiveBranch&#39;</span>]);
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="keywordflow">return</span> $html;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 
<a name="l00541"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a241f3a33cfb0e395506a069cd6a84f60">00541</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a241f3a33cfb0e395506a069cd6a84f60">renderSubMenu</a>(Zend_Navigation_Container $container = null,
<a name="l00542"></a>00542                                   $ulClass = null,
<a name="l00543"></a>00543                                   $indent = null)
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#afa7d10d2024a537d37e45e03bebd38b6">renderMenu</a>($container, array(
<a name="l00546"></a>00546             <span class="stringliteral">&#39;indent&#39;</span>           =&gt; $indent,
<a name="l00547"></a>00547             <span class="stringliteral">&#39;ulClass&#39;</span>          =&gt; $ulClass,
<a name="l00548"></a>00548             <span class="stringliteral">&#39;minDepth&#39;</span>         =&gt; null,
<a name="l00549"></a>00549             <span class="stringliteral">&#39;maxDepth&#39;</span>         =&gt; null,
<a name="l00550"></a>00550             <span class="stringliteral">&#39;onlyActiveBranch&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00551"></a>00551             <span class="stringliteral">&#39;renderParents&#39;</span>    =&gt; <span class="keyword">false</span>
<a name="l00552"></a>00552         ));
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 
<a name="l00577"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a8feef29524569cf49c948f479b61835d">00577</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a8feef29524569cf49c948f479b61835d">renderPartial</a>(Zend_Navigation_Container $container = null,
<a name="l00578"></a>00578                                   $partial = null)
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <span class="keywordflow">if</span> (null === $container) {
<a name="l00581"></a>00581             $container = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___helper_abstract.html#a53e2ca32cf29808b0b18cd5accf3c4db">getContainer</a>();
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584         <span class="keywordflow">if</span> (null === $partial) {
<a name="l00585"></a>00585             $partial = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a848bf14c895554e9455c9f8c08d2afe5">getPartial</a>();
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588         <span class="keywordflow">if</span> (empty($partial)) {
<a name="l00589"></a>00589             require_once <span class="stringliteral">&#39;Zend/View/Exception.php&#39;</span>;
<a name="l00590"></a>00590             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___view___exception.html">Zend_View_Exception</a>(
<a name="l00591"></a>00591                     <span class="stringliteral">&#39;Unable to render menu: No partial view script provided&#39;</span>);
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         $model = array(
<a name="l00595"></a>00595             <span class="stringliteral">&#39;container&#39;</span> =&gt; $container
<a name="l00596"></a>00596         );
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         <span class="keywordflow">if</span> (is_array($partial)) {
<a name="l00599"></a>00599             <span class="keywordflow">if</span> (count($partial) != 2) {
<a name="l00600"></a>00600                 require_once <span class="stringliteral">&#39;Zend/View/Exception.php&#39;</span>;
<a name="l00601"></a>00601                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___view___exception.html">Zend_View_Exception</a>(
<a name="l00602"></a>00602                         <span class="stringliteral">&#39;Unable to render menu: A view partial supplied as &#39;</span> .
<a name="l00603"></a>00603                         <span class="stringliteral">&#39;an array must contain two values: partial view &#39;</span> .
<a name="l00604"></a>00604                         <span class="stringliteral">&#39;script and module where script can be found&#39;</span>);
<a name="l00605"></a>00605             }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             <span class="keywordflow">return</span> $this-&gt;view-&gt;partial($partial[0], $partial[1], $model);
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610         <span class="keywordflow">return</span> $this-&gt;view-&gt;partial($partial, null, $model);
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="comment">// Zend_View_Helper_Navigation_Helper:</span>
<a name="l00614"></a>00614 
<a name="l00633"></a><a class="code" href="class_zend___view___helper___navigation___menu.html#a2c590181ad57691158a1c2924e438554">00633</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___view___helper___navigation___menu.html#a2c590181ad57691158a1c2924e438554">render</a>(Zend_Navigation_Container $container = null)
<a name="l00634"></a>00634     {
<a name="l00635"></a>00635         <span class="keywordflow">if</span> ($partial = $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a848bf14c895554e9455c9f8c08d2afe5">getPartial</a>()) {
<a name="l00636"></a>00636             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#a8feef29524569cf49c948f479b61835d">renderPartial</a>($container, $partial);
<a name="l00637"></a>00637         } <span class="keywordflow">else</span> {
<a name="l00638"></a>00638             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___view___helper___navigation___menu.html#afa7d10d2024a537d37e45e03bebd38b6">renderMenu</a>($container);
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:18 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
