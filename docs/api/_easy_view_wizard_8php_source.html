<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/bin/easy/EasyViewWizard.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/bin/easy/EasyViewWizard.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?<a class="code" href="category_p_h_p.html">PHP</a>
<a name="l00025"></a><a class="code" href="class_easy_view_wizard.html">00025</a> <span class="keyword">class </span><a class="code" href="class_easy_view_wizard.html">EasyViewWizard</a> <span class="keyword">extends</span> <a class="code" href="class_easy_view.html">EasyView</a>
<a name="l00026"></a>00026 {
<a name="l00027"></a>00027     <span class="keyword">protected</span> $m_CurrentStep;
<a name="l00028"></a>00028     <span class="keyword">protected</span> $m_FormStates;    <span class="comment">// (formname, visited, committed)</span>
<a name="l00029"></a>00029     <span class="keyword">protected</span> $m_DropSession = <span class="keyword">false</span>;
<a name="l00030"></a>00030     <span class="keyword">protected</span> $m_NaviMethod = <span class="stringliteral">&#39;SwitchPage&#39;</span>;
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="class_easy_view_wizard.html#a1db802d93a9f0badf186a646e1cdb161">00032</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_view_wizard.html#a1db802d93a9f0badf186a646e1cdb161">readMetadata</a>(&amp;$xmlArr)
<a name="l00033"></a>00033     {
<a name="l00034"></a>00034         parent::readMetaData($xmlArr);
<a name="l00035"></a>00035         $this-&gt;m_NaviMethod = isset($xmlArr[<span class="stringliteral">&quot;EASYVIEW&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;NAVIMETHOD&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYVIEW&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;NAVIMETHOD&quot;</span>] :<span class="stringliteral">&#39;SwitchPage&#39;</span>;
<a name="l00036"></a>00036     }
<a name="l00043"></a><a class="code" href="class_easy_view_wizard.html#a0497a4964b544d4cb511f7809a191a5d">00043</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a0497a4964b544d4cb511f7809a191a5d">getSessionVars</a>($sessionContext)
<a name="l00044"></a>00044     {
<a name="l00045"></a>00045         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;FormStates&quot;</span>, $this-&gt;m_FormStates, <span class="keyword">true</span>);
<a name="l00046"></a>00046         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;CurrentStep&quot;</span>, $this-&gt;m_CurrentStep, <span class="keyword">true</span>);
<a name="l00047"></a>00047     }
<a name="l00048"></a>00048 
<a name="l00055"></a><a class="code" href="class_easy_view_wizard.html#a14c87f47346e9868b05b6cc33d020021">00055</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a14c87f47346e9868b05b6cc33d020021">setSessionVars</a>($sessionContext)
<a name="l00056"></a>00056     {
<a name="l00057"></a>00057         <span class="keywordflow">if</span> ($this-&gt;m_DropSession){
<a name="l00058"></a>00058             $sessionContext-&gt;cleanObj($this-&gt;m_Name, <span class="keyword">true</span>);
<a name="l00059"></a>00059         }<span class="keywordflow">else</span>{
<a name="l00060"></a>00060             $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;FormStates&quot;</span>, $this-&gt;m_FormStates, <span class="keyword">true</span>);
<a name="l00061"></a>00061             $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;CurrentStep&quot;</span>, $this-&gt;m_CurrentStep, <span class="keyword">true</span>);
<a name="l00062"></a>00062         }
<a name="l00063"></a>00063         
<a name="l00064"></a>00064     }
<a name="l00065"></a>00065 
<a name="l00072"></a><a class="code" href="class_easy_view_wizard.html#a5ea617defced2833678b138544810d35">00072</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_view_wizard.html#a5ea617defced2833678b138544810d35">initAllForms</a>()
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075 
<a name="l00081"></a><a class="code" href="class_easy_view_wizard.html#a3c934047380a0debb627d77d51bb85c8">00081</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_view_wizard.html#a3c934047380a0debb627d77d51bb85c8">processRequest</a>()
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083         <a class="code" href="class_easy_view_wizard.html#a3c934047380a0debb627d77d51bb85c8">parent::processRequest</a>();
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         $step = $this-&gt;<a class="code" href="class_easy_view_wizard.html#a8c10d82ce4005a51c021f375175e117a">getCurrentStep</a>();
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         <span class="comment">// only display given step form</span>
<a name="l00088"></a>00088         $i = 1;
<a name="l00089"></a>00089         <span class="keywordflow">foreach</span> ($this-&gt;m_FormRefs as $formRef)
<a name="l00090"></a>00090         {
<a name="l00091"></a>00091             <span class="keywordflow">if</span> ($i == $step)
<a name="l00092"></a>00092                 $formRef-&gt;m_Display = <span class="keyword">true</span>;
<a name="l00093"></a>00093             <span class="keywordflow">else</span>
<a name="l00094"></a>00094                 $formRef-&gt;m_Display = <span class="keyword">false</span>;
<a name="l00095"></a>00095             $i++;
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098         
<a name="l00099"></a>00099     <span class="keyword">protected</span> function getStepName($step)
<a name="l00100"></a>00100     {
<a name="l00101"></a>00101               $i = 1;
<a name="l00102"></a>00102         <span class="keywordflow">foreach</span> ($this-&gt;m_FormRefs as $formRef){
<a name="l00103"></a>00103             <span class="keywordflow">if</span>($i == $step){              
<a name="l00104"></a>00104               <span class="keywordflow">return</span> $formRef-&gt;m_Name;
<a name="l00105"></a>00105             }               
<a name="l00106"></a>00106             $i++;
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110         
<a name="l00116"></a><a class="code" href="class_easy_view_wizard.html#a8c10d82ce4005a51c021f375175e117a">00116</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a8c10d82ce4005a51c021f375175e117a">getCurrentStep</a>()
<a name="l00117"></a>00117     {
<a name="l00118"></a>00118        <span class="keywordflow">if</span>($this-&gt;m_CurrentStep){
<a name="l00119"></a>00119               <span class="keywordflow">return</span> $this-&gt;m_CurrentStep;
<a name="l00120"></a>00120        }<span class="keywordflow">else</span>{
<a name="l00121"></a>00121                $step = isset($_GET[<span class="stringliteral">&#39;step&#39;</span>]) ? $_GET[<span class="stringliteral">&#39;step&#39;</span>] : 1;
<a name="l00122"></a>00122        
<a name="l00123"></a>00123                $numForms = 0;
<a name="l00124"></a>00124                <span class="keywordflow">foreach</span> ($this-&gt;m_FormRefs as $formRef)
<a name="l00125"></a>00125                    $numForms++;
<a name="l00126"></a>00126        
<a name="l00127"></a>00127                <span class="keywordflow">if</span> ($step &lt; 1)
<a name="l00128"></a>00128                    $step = 1;
<a name="l00129"></a>00129                <span class="keywordflow">if</span> ($step &gt; $numForms)
<a name="l00130"></a>00130                    $step = $numForms;
<a name="l00131"></a>00131                $this-&gt;m_CurrentStep = $step;
<a name="l00132"></a>00132                <span class="keywordflow">return</span> $step;
<a name="l00133"></a>00133        }
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00142"></a><a class="code" href="class_easy_view_wizard.html#ace88bb98c1602e2b890fc3f613977fa5">00142</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#ace88bb98c1602e2b890fc3f613977fa5">renderStep</a>($step)
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144        <span class="keywordflow">if</span>($this-&gt;m_CurrentStep){
<a name="l00145"></a>00145               $currentStep = $this-&gt;m_CurrentStep;
<a name="l00146"></a>00146        }<span class="keywordflow">else</span>{
<a name="l00147"></a>00147               $currentStep = $this-&gt;<a class="code" href="class_easy_view_wizard.html#a8c10d82ce4005a51c021f375175e117a">getCurrentStep</a>();
<a name="l00148"></a>00148        }
<a name="l00149"></a>00149         <span class="keywordflow">if</span> ($currentStep == $step)
<a name="l00150"></a>00150             <span class="keywordflow">return</span>;
<a name="l00151"></a>00151               <span class="keywordflow">switch</span>(strtoupper($this-&gt;m_NaviMethod)){
<a name="l00152"></a>00152                      <span class="keywordflow">case</span> <span class="stringliteral">&quot;SWITCHFORM&quot;</span>:
<a name="l00153"></a>00153                             $targetForm = $this-&gt;getStepName($step);
<a name="l00154"></a>00154                             $currentForm = $this-&gt;getStepName($currentStep);
<a name="l00155"></a>00155                             $this-&gt;m_CurrentStep = $step;             
<a name="l00156"></a>00156                             $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($currentForm);
<a name="l00157"></a>00157                             $formObj-&gt;switchForm($targetForm);
<a name="l00158"></a>00158                             <span class="keywordflow">break</span>;
<a name="l00159"></a>00159                             
<a name="l00160"></a>00160                      <span class="keywordflow">case</span> <span class="stringliteral">&quot;SWITCHPAGE&quot;</span>:
<a name="l00161"></a>00161                      <span class="keywordflow">default</span>:
<a name="l00162"></a>00162                             $url = <span class="stringliteral">&quot;controller.php?view=&quot;</span>.$this-&gt;m_Name.<span class="stringliteral">&quot;&amp;step=&quot;</span>.$step;
<a name="l00163"></a>00163                       <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;ReDirectPage($url);
<a name="l00164"></a>00164                             <span class="keywordflow">break</span>;
<a name="l00165"></a>00165                      
<a name="l00166"></a>00166               }
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00175"></a><a class="code" href="class_easy_view_wizard.html#a68bb8e459e5d77692e8ab5cf7eb4e79a">00175</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a68bb8e459e5d77692e8ab5cf7eb4e79a">getFormInputs</a>($formName)
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177         $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName);
<a name="l00178"></a>00178         $rec = $formObj-&gt;getActiveRecord();
<a name="l00179"></a>00179         <span class="keywordflow">return</span> $rec;
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00190"></a><a class="code" href="class_easy_view_wizard.html#a2ad6a0c00970808f725d322bec69b824">00190</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a2ad6a0c00970808f725d322bec69b824">setFormState</a>($formName, $state, $value)
<a name="l00191"></a>00191     {
<a name="l00192"></a>00192         $this-&gt;m_FormStates[$formName][$state] = $value;
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00200"></a><a class="code" href="class_easy_view_wizard.html#af5674c27d4a92f6228565010eacbb9cb">00200</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#af5674c27d4a92f6228565010eacbb9cb">commit</a>()
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202         <span class="comment">// call all step forms Commit method</span>
<a name="l00203"></a>00203         <span class="keywordflow">foreach</span> ($this-&gt;m_FormStates as $formName=&gt;$state)
<a name="l00204"></a>00204         {
<a name="l00205"></a>00205             <span class="keywordflow">if</span> ($state[<span class="stringliteral">&#39;visited&#39;</span>])
<a name="l00206"></a>00206             {
<a name="l00207"></a>00207                 $r = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName)-&gt;commit();
<a name="l00208"></a>00208                 <span class="keywordflow">if</span> (!$r)
<a name="l00209"></a>00209                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211         }              
<a name="l00212"></a>00212         <span class="keywordflow">foreach</span> ($this-&gt;m_FormStates as $formName=&gt;$state)
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214             <span class="keywordflow">if</span> ($state[<span class="stringliteral">&#39;visited&#39;</span>])
<a name="l00215"></a>00215             {
<a name="l00216"></a>00216                 $r = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName)-&gt;dropSession();
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (!$r)
<a name="l00218"></a>00218                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00219"></a>00219             }
<a name="l00220"></a>00220         } 
<a name="l00221"></a>00221                 
<a name="l00222"></a>00222         $this-&gt;m_DropSession = <span class="keyword">true</span>;
<a name="l00223"></a>00223         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225    
<a name="l00231"></a><a class="code" href="class_easy_view_wizard.html#a649b2b3005c687ae78c9d1d65e973493">00231</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#a649b2b3005c687ae78c9d1d65e973493">cancel</a>()
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233         <span class="comment">// call all step forms Cancel method</span>
<a name="l00234"></a>00234         <span class="keywordflow">foreach</span> ($this-&gt;m_FormStates as $formName=&gt;$state)
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236             <span class="keywordflow">if</span> ($state[<span class="stringliteral">&#39;visited&#39;</span>])
<a name="l00237"></a>00237                 <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName)-&gt;cancel();
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239         $this-&gt;m_DropSession = <span class="keyword">true</span>;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241 
<a name="l00248"></a><a class="code" href="class_easy_view_wizard.html#afbb8fcc4c21113c915263f4a1ca3c0c5">00248</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_view_wizard.html#afbb8fcc4c21113c915263f4a1ca3c0c5">outputAttrs</a>()
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250         $out = <a class="code" href="class_easy_view_wizard.html#afbb8fcc4c21113c915263f4a1ca3c0c5">parent::outputAttrs</a>();
<a name="l00251"></a>00251         $out[<span class="stringliteral">&#39;step&#39;</span>] = $this-&gt;m_CurrentStep;
<a name="l00252"></a>00252         $out[<span class="stringliteral">&#39;forms&#39;</span>] = $this-&gt;m_FormRefs;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <span class="keywordflow">return</span> $out;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:09:13 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
