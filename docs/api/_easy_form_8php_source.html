<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/bin/easy/EasyForm.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/bin/easy/EasyForm.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00017"></a>00017 include_once(OPENBIZ_BIN.<span class="stringliteral">&quot;/easy/Panel.php&quot;</span>);
<a name="l00018"></a>00018 include_once(OPENBIZ_BIN.<span class="stringliteral">&quot;/util/QueryStringParam.php&quot;</span>);
<a name="l00019"></a>00019 
<a name="l00028"></a><a class="code" href="class_easy_form.html">00028</a> <span class="keyword">class </span><a class="code" href="class_easy_form.html">EasyForm</a> <span class="keyword">extends</span> <a class="code" href="class_meta_object.html">MetaObject</a> implements <a class="code" href="interfacei_session_object.html">iSessionObject</a>
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030     <span class="keyword">public</span> $DATAFORMAT = <span class="stringliteral">&#39;RECORD&#39;</span>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     <span class="comment">// metadata vars are public, necessary for metadata inheritance</span>
<a name="l00033"></a>00033     <span class="keyword">public</span> $m_Title;
<a name="l00034"></a>00034     <span class="keyword">public</span> $m_Icon;
<a name="l00035"></a>00035     <span class="keyword">public</span> $m_Description;
<a name="l00036"></a>00036     <span class="keyword">public</span> $m_jsClass;
<a name="l00037"></a>00037     <span class="keyword">public</span> $m_DataObjName;
<a name="l00038"></a>00038     <span class="keyword">public</span> $m_Height;
<a name="l00039"></a>00039     <span class="keyword">public</span> $m_Width;
<a name="l00040"></a>00040     <span class="keyword">public</span> $m_DefaultForm;
<a name="l00041"></a>00041   
<a name="l00042"></a>00042     <span class="keyword">public</span> $m_CanUpdateRecord;
<a name="l00043"></a>00043     <span class="keyword">public</span> $m_DirectMethodList = null; <span class="comment">//list of method that can directly from browser</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="keyword">public</span> $m_Panels; 
<a name="l00046"></a>00046 
<a name="l00052"></a>00052     <span class="keyword">public</span> $m_InheritFrom;
<a name="l00053"></a>00053     
<a name="l00059"></a>00059     <span class="keyword">public</span> $m_DataPanel;
<a name="l00064"></a>00064     <span class="keyword">public</span> $m_ActionPanel;
<a name="l00069"></a>00069     <span class="keyword">public</span> $m_NavPanel;
<a name="l00074"></a>00074     <span class="keyword">public</span> $m_SearchPanel;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="keyword">public</span> $m_TemplateEngine;
<a name="l00077"></a>00077     <span class="keyword">public</span> $m_TemplateFile;
<a name="l00078"></a>00078     <span class="keyword">public</span> $m_FormType;
<a name="l00079"></a>00079     <span class="keyword">public</span> $m_SubForms = null;
<a name="l00080"></a>00080     <span class="keyword">public</span> $m_EventName;
<a name="l00081"></a>00081     <span class="keyword">public</span> $m_Range = 10;
<a name="l00082"></a>00082     <span class="keyword">public</span> $m_CacheLifeTime = 0;
<a name="l00083"></a>00083     <span class="keyword">public</span> $m_FormParams;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">// parent form is the form that trigger the popup. &quot;this&quot; form is a popup form</span>
<a name="l00086"></a>00086     <span class="keyword">public</span> $m_ParentFormName;
<a name="l00087"></a>00087     <span class="comment">// the form that drives navigation - the 1st form deplayed in the view</span>
<a name="l00088"></a>00088     <span class="keyword">public</span> $m_DefaultFormName = null;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="comment">// query helper</span>
<a name="l00091"></a>00091     <span class="keyword">public</span> $m_QueryStringParam;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="keyword">public</span> $m_Errors;   <span class="comment">// errors array (error_element, error_message)</span>
<a name="l00094"></a>00094     <span class="keyword">public</span> $m_Notices;  <span class="comment">// list of notice messages</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096     <span class="comment">// basic form vars</span>
<a name="l00097"></a>00097     <span class="keyword">protected</span> $m_DataObj;
<a name="l00098"></a>00098     <span class="keyword">protected</span> $m_RecordId = null;
<a name="l00099"></a>00099     <span class="keyword">public</span> $m_ActiveRecord = null;
<a name="l00100"></a>00100     <span class="keyword">public</span> $m_FormInputs = null;
<a name="l00101"></a>00101     <span class="keyword">public</span> $m_SearchRule = null;
<a name="l00102"></a>00102     <span class="keyword">public</span> $m_FixSearchRule = null; <span class="comment">// FixSearchRule is the search rule always applying on the search</span>
<a name="l00103"></a>00103     
<a name="l00104"></a>00104     <span class="keyword">public</span> $m_SortRule = null;
<a name="l00105"></a>00105     
<a name="l00106"></a>00106     <span class="keyword">protected</span> $m_DefaultFixSearchRule = null;
<a name="l00107"></a>00107     <span class="keyword">protected</span> $m_SearchRuleBindValues;
<a name="l00108"></a>00108     <span class="keyword">protected</span> $m_Referer = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00109"></a>00109     <span class="keyword">public</span> $m_MessageFile = null;
<a name="l00110"></a>00110     <span class="keyword">protected</span> $m_hasError = <span class="keyword">false</span>;
<a name="l00111"></a>00111     <span class="keyword">protected</span> $m_ValidateErrors = array();
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="comment">// vars for grid(list)</span>
<a name="l00114"></a>00114     <span class="keyword">protected</span> $m_CurrentPage = 1;
<a name="l00115"></a>00115     <span class="keyword">protected</span> $m_StartItem = 1;
<a name="l00116"></a>00116     <span class="keyword">public</span> $m_TotalPages = 1;
<a name="l00117"></a>00117     <span class="keyword">protected</span> $m_TotalRecords = 0;
<a name="l00118"></a>00118     <span class="keyword">protected</span> $m_RecordSet = null;
<a name="l00119"></a>00119     <span class="keyword">protected</span> $m_RefreshData = <span class="keyword">false</span>;
<a name="l00120"></a>00120     <span class="keyword">protected</span> $m_Resource = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="keyword">protected</span> $m_Messages;
<a name="l00123"></a>00123     <span class="keyword">protected</span> $m_InvokingElement = null;
<a name="l00124"></a>00124     
<a name="l00125"></a>00125     <span class="keyword">public</span> $m_AutoRefresh=0;
<a name="l00126"></a>00126     
<a name="l00127"></a>00127     <span class="keyword">public</span> $m_ReferenceFormName; <span class="comment">//switch from which form</span>
<a name="l00128"></a>00128     <span class="keyword">protected</span> $m_RecordAllowAccess = <span class="keyword">true</span>;
<a name="l00129"></a>00129 
<a name="l00136"></a><a class="code" href="class_easy_form.html#a847d8d60f037d0a016aca7006cf9dec6">00136</a>     function <a class="code" href="class_easy_form.html#a847d8d60f037d0a016aca7006cf9dec6">__construct</a>(&amp;$xmlArr)
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138         $this-&gt;<a class="code" href="class_easy_form.html#a1db802d93a9f0badf186a646e1cdb161">readMetadata</a>($xmlArr);
<a name="l00139"></a>00139         <span class="comment">//echo $_GET[&#39;referer&#39;];</span>
<a name="l00140"></a>00140         $this-&gt;<a class="code" href="class_easy_form.html#af2761d5e4dc7c2fc4ac4955afe2ef1e8">inheritParentObj</a>();
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="class_easy_form.html#a6ababfde848794c7d2cf1679caaf57d1">00143</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a6ababfde848794c7d2cf1679caaf57d1">allowAccess</a>($access=null)
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145        <span class="keywordflow">if</span>(!$this-&gt;m_RecordAllowAccess)
<a name="l00146"></a>00146        {
<a name="l00151"></a>00151               <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00152"></a>00152        }
<a name="l00153"></a>00153        $result = <a class="code" href="class_easy_form.html#a6ababfde848794c7d2cf1679caaf57d1">parent::allowAccess</a>($access);          
<a name="l00154"></a>00154        <span class="keywordflow">return</span> $result ;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156     
<a name="l00163"></a><a class="code" href="class_easy_form.html#a1db802d93a9f0badf186a646e1cdb161">00163</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a1db802d93a9f0badf186a646e1cdb161">readMetadata</a>(&amp;$xmlArr)
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165         parent::readMetaData($xmlArr);
<a name="l00166"></a>00166         $this-&gt;m_InheritFrom = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;INHERITFROM&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;INHERITFROM&quot;</span>] : null;        
<a name="l00167"></a>00167         $this-&gt;m_Title = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TITLE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TITLE&quot;</span>] : null;
<a name="l00168"></a>00168         $this-&gt;m_Icon = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;ICON&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;ICON&quot;</span>] : null;        
<a name="l00169"></a>00169         $this-&gt;m_Description = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DESCRIPTION&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DESCRIPTION&quot;</span>] : null;
<a name="l00170"></a>00170         $this-&gt;m_jsClass = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;JSCLASS&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;JSCLASS&quot;</span>] : null;
<a name="l00171"></a>00171         $this-&gt;m_Height = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;HEIGHT&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;HEIGHT&quot;</span>] : null;
<a name="l00172"></a>00172         $this-&gt;m_Width = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;WIDTH&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;WIDTH&quot;</span>] : null;
<a name="l00173"></a>00173         $this-&gt;m_DefaultForm = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DEFAULTFORM&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DEFAULTFORM&quot;</span>] : null;
<a name="l00174"></a>00174         $this-&gt;m_TemplateEngine = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TEMPLATEENGINE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TEMPLATEENGINE&quot;</span>] : null;
<a name="l00175"></a>00175         $this-&gt;m_TemplateFile = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TEMPLATEFILE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;TEMPLATEFILE&quot;</span>] : null;
<a name="l00176"></a>00176         $this-&gt;m_FormType = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;FORMTYPE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;FORMTYPE&quot;</span>] : null;
<a name="l00177"></a>00177         $this-&gt;m_Range = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;PAGESIZE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;PAGESIZE&quot;</span>] : $this-&gt;m_Range;
<a name="l00178"></a>00178         $this-&gt;m_FixSearchRule = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SEARCHRULE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SEARCHRULE&quot;</span>] : null;
<a name="l00179"></a>00179         $this-&gt;m_SortRule = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SORTRULE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SORTRULE&quot;</span>] : null;
<a name="l00180"></a>00180               $this-&gt;m_DefaultFixSearchRule = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SEARCHRULE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;SEARCHRULE&quot;</span>] : null;
<a name="l00181"></a>00181         
<a name="l00182"></a>00182         $this-&gt;m_Name = $this-&gt;<a class="code" href="class_meta_object.html#a7a34962e72564b47da11d86bfde7cf79">prefixPackage</a>($this-&gt;m_Name);
<a name="l00183"></a>00183         <span class="keywordflow">if</span> ($this-&gt;m_InheritFrom == <span class="stringliteral">&#39;@sourceMeta&#39;</span>) $this-&gt;m_InheritFrom = <span class="charliteral">&#39;@&#39;</span>.$this-&gt;m_Name;
<a name="l00184"></a>00184         <span class="keywordflow">else</span> $this-&gt;m_InheritFrom = $this-&gt;<a class="code" href="class_meta_object.html#a7a34962e72564b47da11d86bfde7cf79">prefixPackage</a>($this-&gt;m_InheritFrom);
<a name="l00185"></a>00185         $this-&gt;m_DataObjName = $this-&gt;<a class="code" href="class_meta_object.html#a7a34962e72564b47da11d86bfde7cf79">prefixPackage</a>($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;BIZDATAOBJ&quot;</span>]);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DIRECTMETHOD&quot;</span>]))
<a name="l00188"></a>00188             $this-&gt;m_DirectMethodList = explode(<span class="stringliteral">&quot;,&quot;</span>, strtolower(str_replace(<span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;&quot;</span>,$xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;DIRECTMETHOD&quot;</span>])));
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         $this-&gt;m_DataPanel = <span class="keyword">new</span> <a class="code" href="class_panel.html">Panel</a>($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;DATAPANEL&quot;</span>][<span class="stringliteral">&quot;ELEMENT&quot;</span>],<span class="stringliteral">&quot;&quot;</span>,$this);
<a name="l00191"></a>00191         $this-&gt;m_ActionPanel = <span class="keyword">new</span> <a class="code" href="class_panel.html">Panel</a>($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ACTIONPANEL&quot;</span>][<span class="stringliteral">&quot;ELEMENT&quot;</span>],<span class="stringliteral">&quot;&quot;</span>,$this);
<a name="l00192"></a>00192         $this-&gt;m_NavPanel = <span class="keyword">new</span> <a class="code" href="class_panel.html">Panel</a>($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;NAVPANEL&quot;</span>][<span class="stringliteral">&quot;ELEMENT&quot;</span>],<span class="stringliteral">&quot;&quot;</span>,$this);
<a name="l00193"></a>00193         $this-&gt;m_SearchPanel = <span class="keyword">new</span> <a class="code" href="class_panel.html">Panel</a>($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;SEARCHPANEL&quot;</span>][<span class="stringliteral">&quot;ELEMENT&quot;</span>],<span class="stringliteral">&quot;&quot;</span>,$this);
<a name="l00194"></a>00194         $this-&gt;m_Panels = array($this-&gt;m_DataPanel, $this-&gt;m_ActionPanel, $this-&gt;m_NavPanel, $this-&gt;m_SearchPanel);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         $this-&gt;m_FormType = strtoupper($this-&gt;m_FormType);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         $this-&gt;m_EventName = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;EVENTNAME&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;EVENTNAME&quot;</span>] : null;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         $this-&gt;m_MessageFile = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;MESSAGEFILE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;MESSAGEFILE&quot;</span>] : null;
<a name="l00201"></a>00201         $this-&gt;m_Messages = <a class="code" href="class_resource.html#a66826405edc53b33073ed69eac7b49f4">Resource::loadMessage</a>($this-&gt;m_MessageFile , $this-&gt;m_Package);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         $this-&gt;m_CacheLifeTime = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;CACHELIFETIME&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;CACHELIFETIME&quot;</span>] : <span class="stringliteral">&quot;0&quot;</span>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         $this-&gt;m_CurrentPage = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;STARTPAGE&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;STARTPAGE&quot;</span>] : 1;
<a name="l00206"></a>00206         $this-&gt;m_StartItem = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;STARTITEM&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;STARTITEM&quot;</span>] : 1;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         $this-&gt;m_AutoRefresh = isset($xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;AUTOREFRESH&quot;</span>]) ? $xmlArr[<span class="stringliteral">&quot;EASYFORM&quot;</span>][<span class="stringliteral">&quot;ATTRIBUTES&quot;</span>][<span class="stringliteral">&quot;AUTOREFRESH&quot;</span>] : 0;
<a name="l00209"></a>00209         
<a name="l00210"></a>00210         <span class="comment">// parse access</span>
<a name="l00211"></a>00211         <span class="keywordflow">if</span> ($this-&gt;m_Access)
<a name="l00212"></a>00212         {
<a name="l00213"></a>00213             $arr = explode (<span class="stringliteral">&quot;.&quot;</span>, $this-&gt;m_Access);
<a name="l00214"></a>00214             $this-&gt;m_Resource = $arr[0];
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         <span class="keywordflow">if</span> ($this-&gt;m_jsClass == <span class="stringliteral">&quot;jbForm&quot;</span> &amp;&amp; strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;LIST&quot;</span>) $this-&gt;m_jsClass = <span class="stringliteral">&quot;Openbiz.TableForm&quot;</span>;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> ($this-&gt;m_jsClass == <span class="stringliteral">&quot;jbForm&quot;</span>) $this-&gt;m_jsClass = <span class="stringliteral">&quot;Openbiz.Form&quot;</span>;
<a name="l00218"></a>00218         
<a name="l00219"></a>00219               $this-&gt;translate();  <span class="comment">// translate for multi-language support</span>
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 
<a name="l00227"></a><a class="code" href="class_easy_form.html#af2761d5e4dc7c2fc4ac4955afe2ef1e8">00227</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#af2761d5e4dc7c2fc4ac4955afe2ef1e8">inheritParentObj</a>()
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (!$this-&gt;m_InheritFrom) <span class="keywordflow">return</span>;
<a name="l00230"></a>00230         $parentObj = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($this-&gt;m_InheritFrom);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         $this-&gt;m_Title = $this-&gt;m_Title ? $this-&gt;m_Title : $parentObj-&gt;m_Title;
<a name="l00233"></a>00233         $this-&gt;m_Icon = $this-&gt;m_Icon ? $this-&gt;m_Icon : $parentObj-&gt;m_Icon;        
<a name="l00234"></a>00234         $this-&gt;m_Description  = $this-&gt;m_Description ? $this-&gt;m_Description : $parentObj-&gt;m_Description;
<a name="l00235"></a>00235         $this-&gt;m_jsClass   = $this-&gt;m_jsClass ? $this-&gt;m_jsClass : $parentObj-&gt;m_jsClass;
<a name="l00236"></a>00236         $this-&gt;m_Height   = $this-&gt;m_Height ? $this-&gt;m_Height : $parentObj-&gt;m_Height;
<a name="l00237"></a>00237         $this-&gt;m_Width   = $this-&gt;m_Width ? $this-&gt;m_Width : $parentObj-&gt;m_Width;
<a name="l00238"></a>00238         $this-&gt;m_DefaultForm   = $this-&gt;m_DefaultForm ? $this-&gt;m_DefaultForm : $parentObj-&gt;m_DefaultForm;        
<a name="l00239"></a>00239         $this-&gt;m_TemplateEngine   = $this-&gt;m_TemplateEngine ? $this-&gt;m_TemplateEngine : $parentObj-&gt;m_TemplateEngine;
<a name="l00240"></a>00240         $this-&gt;m_TemplateFile   = $this-&gt;m_TemplateFile ? $this-&gt;m_TemplateFile : $parentObj-&gt;m_TemplateFile;        
<a name="l00241"></a>00241         $this-&gt;m_FormType   = $this-&gt;m_FormType ? $this-&gt;m_FormType : $parentObj-&gt;m_FormType;
<a name="l00242"></a>00242         $this-&gt;m_Range   = $this-&gt;m_Range ? $this-&gt;m_Range : $parentObj-&gt;m_Range;
<a name="l00243"></a>00243         $this-&gt;m_FixSearchRule   = $this-&gt;m_FixSearchRule ? $this-&gt;m_FixSearchRule : $parentObj-&gt;m_FixSearchRule;
<a name="l00244"></a>00244         $this-&gt;m_DefaultFixSearchRule   = $this-&gt;m_DefaultFixSearchRule ? $this-&gt;m_DefaultFixSearchRule : $parentObj-&gt;m_DefaultFixSearchRule;                     
<a name="l00245"></a>00245         $this-&gt;m_DataObjName   = $this-&gt;m_DataObjName ? $this-&gt;m_DataObjName : $parentObj-&gt;m_DataObjName;
<a name="l00246"></a>00246         $this-&gt;m_DirectMethodList   = $this-&gt;m_DirectMethodList ? $this-&gt;m_DirectMethodList : $parentObj-&gt;m_DirectMethodList;
<a name="l00247"></a>00247         $this-&gt;m_EventName   = $this-&gt;m_EventName ? $this-&gt;m_EventName : $parentObj-&gt;m_EventName;
<a name="l00248"></a>00248         $this-&gt;m_MessageFile   = $this-&gt;m_MessageFile ? $this-&gt;m_MessageFile : $parentObj-&gt;m_MessageFile;
<a name="l00249"></a>00249         $this-&gt;m_Messages = <a class="code" href="class_resource.html#a66826405edc53b33073ed69eac7b49f4">Resource::loadMessage</a>($this-&gt;m_MessageFile , $this-&gt;m_Package);
<a name="l00250"></a>00250               $this-&gt;m_CacheLifeTime   = $this-&gt;m_CacheLifeTime ? $this-&gt;m_CacheLifeTime : $parentObj-&gt;m_CacheLifeTime;
<a name="l00251"></a>00251               $this-&gt;m_CurrentPage   = $this-&gt;m_CurrentPage ? $this-&gt;m_CurrentPage : $parentObj-&gt;m_CurrentPage;
<a name="l00252"></a>00252               $this-&gt;m_StartItem   = $this-&gt;m_StartItem ? $this-&gt;m_StartItem : $parentObj-&gt;m_StartItem;        
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         $this-&gt;m_DataPanel-&gt;merge($parentObj-&gt;m_DataPanel);
<a name="l00255"></a>00255         $this-&gt;m_ActionPanel-&gt;merge($parentObj-&gt;m_ActionPanel);
<a name="l00256"></a>00256         $this-&gt;m_NavPanel-&gt;merge($parentObj-&gt;m_NavPanel);
<a name="l00257"></a>00257         $this-&gt;m_SearchPanel-&gt;merge($parentObj-&gt;m_SearchPanel);        
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">if</span>($this-&gt;m_DataPanel-&gt;current()){
<a name="l00260"></a>00260                <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $elem)
<a name="l00261"></a>00261                    $elem-&gt;adjustFormName($this-&gt;m_Name);
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">if</span>($this-&gt;m_ActionPanel-&gt;current()){
<a name="l00264"></a>00264                <span class="keywordflow">foreach</span> ($this-&gt;m_ActionPanel as $elem)
<a name="l00265"></a>00265                    $elem-&gt;adjustFormName($this-&gt;m_Name);
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267         <span class="keywordflow">if</span>($this-&gt;m_NavPanel-&gt;current()){                
<a name="l00268"></a>00268                <span class="keywordflow">foreach</span> ($this-&gt;m_NavPanel as $elem)
<a name="l00269"></a>00269                    $elem-&gt;adjustFormName($this-&gt;m_Name);
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271         <span class="keywordflow">if</span>($this-&gt;m_SearchPanel-&gt;current()){
<a name="l00272"></a>00272                <span class="keywordflow">foreach</span> ($this-&gt;m_SearchPanel as $elem)
<a name="l00273"></a>00273                    $elem-&gt;adjustFormName($this-&gt;m_Name);            
<a name="l00274"></a>00274         }   
<a name="l00275"></a>00275               $this-&gt;m_Panels = array($this-&gt;m_DataPanel, $this-&gt;m_ActionPanel, $this-&gt;m_NavPanel, $this-&gt;m_SearchPanel);            
<a name="l00276"></a>00276     }    
<a name="l00277"></a>00277     
<a name="l00285"></a><a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">00285</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>($messageId, $params=array())
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         $message = isset($this-&gt;m_Messages[$messageId]) ? $this-&gt;m_Messages[$messageId] : constant($messageId);
<a name="l00288"></a>00288         <span class="comment">//$message = I18n::getInstance()-&gt;translate($message);</span>
<a name="l00289"></a>00289         $message = I18n::t($message, $messageId, $this-&gt;getModuleName($this-&gt;m_Name));        
<a name="l00290"></a>00290         $msg = @vsprintf($message,$params);
<a name="l00291"></a>00291         <span class="keywordflow">if</span>(!$msg){ <span class="comment">//maybe in translation missing some %s can cause it returns null</span>
<a name="l00292"></a>00292               $msg = $message;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         <span class="keywordflow">return</span> $msg;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keyword">public</span> function canDisplayForm()
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299        
<a name="l00300"></a>00300        <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;m_DataPermControl==<span class="charliteral">&#39;Y&#39;</span>)
<a name="l00301"></a>00301         {
<a name="l00302"></a>00302               <span class="keywordflow">switch</span>(strtolower($this-&gt;m_FormType))
<a name="l00303"></a>00303               {
<a name="l00304"></a>00304                      <span class="keywordflow">default</span>:
<a name="l00305"></a>00305                      <span class="keywordflow">case</span> <span class="stringliteral">&#39;list&#39;</span>:
<a name="l00306"></a>00306                             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00307"></a>00307                             <span class="keywordflow">break</span>;
<a name="l00308"></a>00308                      <span class="keywordflow">case</span> <span class="stringliteral">&#39;detail&#39;</span>:
<a name="l00309"></a>00309                             $permCode=1;
<a name="l00310"></a>00310                             <span class="keywordflow">break</span>;  
<a name="l00311"></a>00311                             
<a name="l00312"></a>00312                      <span class="keywordflow">case</span> <span class="stringliteral">&#39;edit&#39;</span>:
<a name="l00313"></a>00313                             $permCode=2;
<a name="l00314"></a>00314                             <span class="keywordflow">break</span>;                                    
<a name="l00315"></a>00315               }
<a name="l00316"></a>00316                $svcObj = BizSystem::GetService(DATAPERM_SERVICE);
<a name="l00317"></a>00317                $result = $svcObj-&gt;checkDataPerm($this-&gt;<a class="code" href="class_easy_form.html#a38ac74df0eb521f827ed815c2bbde0b1">fetchData</a>(),$permCode,$this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>());
<a name="l00318"></a>00318                <span class="keywordflow">if</span>($result == <span class="keyword">false</span>)
<a name="l00319"></a>00319                {
<a name="l00320"></a>00320                      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00321"></a>00321                }
<a name="l00322"></a>00322         }     
<a name="l00323"></a>00323         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="keyword">public</span> function canDeleteRecord($rec)
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328        
<a name="l00329"></a>00329        <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;m_DataPermControl==<span class="charliteral">&#39;Y&#39;</span>)
<a name="l00330"></a>00330         {                          
<a name="l00331"></a>00331                $svcObj = BizSystem::GetService(DATAPERM_SERVICE);
<a name="l00332"></a>00332                $result = $svcObj-&gt;checkDataPerm($rec,3,$this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>());
<a name="l00333"></a>00333                <span class="keywordflow">if</span>($result == <span class="keyword">false</span>)
<a name="l00334"></a>00334                {
<a name="l00335"></a>00335                      <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00336"></a>00336                }
<a name="l00337"></a>00337         }     
<a name="l00338"></a>00338         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     
<a name="l00341"></a>00341     
<a name="l00348"></a><a class="code" href="class_easy_form.html#a0497a4964b544d4cb511f7809a191a5d">00348</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a0497a4964b544d4cb511f7809a191a5d">getSessionVars</a>($sessionContext)
<a name="l00349"></a>00349     {
<a name="l00350"></a>00350         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;RecordId&quot;</span>, $this-&gt;m_RecordId);
<a name="l00351"></a>00351         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;FixSearchRule&quot;</span>, $this-&gt;m_FixSearchRule);
<a name="l00352"></a>00352         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchRule&quot;</span>, $this-&gt;m_SearchRule);
<a name="l00353"></a>00353         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchRuleBindValues&quot;</span>, $this-&gt;m_SearchRuleBindValues);
<a name="l00354"></a>00354         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SubForms&quot;</span>, $this-&gt;m_SubForms);
<a name="l00355"></a>00355         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;ParentFormName&quot;</span>, $this-&gt;m_ParentFormName);
<a name="l00356"></a>00356         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;DefaultFormName&quot;</span>, $this-&gt;m_DefaultFormName);
<a name="l00357"></a>00357         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;CurrentPage&quot;</span>, $this-&gt;m_CurrentPage);
<a name="l00358"></a>00358         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;PageSize&quot;</span>, $this-&gt;m_Range);
<a name="l00359"></a>00359         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;ReferenceFormName&quot;</span>, $this-&gt;m_ReferenceFormName);
<a name="l00360"></a>00360         $sessionContext-&gt;getObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchPanelValues&quot;</span>, $this-&gt;m_SearchPanelValues);
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00369"></a><a class="code" href="class_easy_form.html#a14c87f47346e9868b05b6cc33d020021">00369</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a14c87f47346e9868b05b6cc33d020021">setSessionVars</a>($sessionContext)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;RecordId&quot;</span>, $this-&gt;m_RecordId);
<a name="l00372"></a>00372         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;FixSearchRule&quot;</span>, $this-&gt;m_FixSearchRule);
<a name="l00373"></a>00373         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchRule&quot;</span>, $this-&gt;m_SearchRule);        
<a name="l00374"></a>00374         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchRuleBindValues&quot;</span>, $this-&gt;m_SearchRuleBindValues);
<a name="l00375"></a>00375         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SubForms&quot;</span>, $this-&gt;m_SubForms);
<a name="l00376"></a>00376         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;ParentFormName&quot;</span>, $this-&gt;m_ParentFormName);
<a name="l00377"></a>00377         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;DefaultFormName&quot;</span>, $this-&gt;m_DefaultFormName);
<a name="l00378"></a>00378         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;CurrentPage&quot;</span>, $this-&gt;m_CurrentPage);
<a name="l00379"></a>00379         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;PageSize&quot;</span>, $this-&gt;m_Range);
<a name="l00380"></a>00380         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;ReferenceFormName&quot;</span>, $this-&gt;m_ReferenceFormName);
<a name="l00381"></a>00381         $sessionContext-&gt;setObjVar($this-&gt;m_Name, <span class="stringliteral">&quot;SearchPanelValues&quot;</span>, $this-&gt;m_SearchPanelValues);        
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00389"></a><a class="code" href="class_easy_form.html#a969cad912937b1e2e6e66b49d8148738">00389</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a969cad912937b1e2e6e66b49d8148738">invoke</a>()
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391         $argList = func_get_args();
<a name="l00392"></a>00392         $param1 = array_shift($argList);
<a name="l00393"></a>00393         <span class="comment">// first one is element:eventhandler</span>
<a name="l00394"></a>00394         list ($elementName, $eventHandlerName) = explode(<span class="stringliteral">&quot;:&quot;</span>, $param1);        
<a name="l00395"></a>00395         $element = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($elementName);
<a name="l00396"></a>00396         $eventHandler = $element-&gt;m_EventHandlers-&gt;get($eventHandlerName);
<a name="l00397"></a>00397         $this-&gt;m_InvokingElement = array($element, $eventHandler);
<a name="l00398"></a>00398         <span class="comment">// find the matching function</span>
<a name="l00399"></a>00399         list($funcName, $funcParams) = $eventHandler-&gt;parseFunction($eventHandler-&gt;m_OrigFunction);
<a name="l00400"></a>00400         <span class="comment">// call the function with rest parameters</span>
<a name="l00401"></a>00401         <span class="keywordflow">return</span> call_user_func_array(array($this, $funcName), $argList);
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403     
<a name="l00410"></a><a class="code" href="class_easy_form.html#ac349808ebbbeff6369b42bfdf2b0d6ba">00410</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ac349808ebbbeff6369b42bfdf2b0d6ba">validateRequest</a>($methodName)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412         $methodName = strtolower($methodName);
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <span class="keywordflow">if</span> ($methodName == <span class="stringliteral">&quot;selectrecord&quot;</span> || $methodName == <span class="stringliteral">&quot;invoke&quot;</span> || $methodName=<span class="stringliteral">&quot;sortrecord&quot;</span>) 
<a name="l00415"></a>00415             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00416"></a>00416         <span class="comment">// element, eventhandler</span>
<a name="l00417"></a>00417         list($element, $eventHandler) = $this-&gt;<a class="code" href="class_easy_form.html#a15d343efcbc80c8b61a60c3f2f01e759">getInvokingElement</a>();
<a name="l00418"></a>00418         <span class="keywordflow">if</span> ($element &amp;&amp; $eventHandler)
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420             <span class="keywordflow">if</span> (stripos($eventHandler-&gt;m_OrigFunction, $methodName)===0)
<a name="l00421"></a>00421                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423         <span class="comment">// scan elements to match method</span>
<a name="l00424"></a>00424         <span class="keywordflow">foreach</span> ($this-&gt;m_Panels as $panel)
<a name="l00425"></a>00425         {
<a name="l00426"></a>00426             <span class="keywordflow">foreach</span> ($panel as $elem) 
<a name="l00427"></a>00427                 <span class="keywordflow">if</span> ($elem-&gt;matchRemoteMethod($methodName)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         <span class="keywordflow">if</span> (is_array($this-&gt;m_DirectMethodList))
<a name="l00431"></a>00431         {
<a name="l00432"></a>00432             <span class="keywordflow">foreach</span> ($this-&gt;m_DirectMethodList as $value)
<a name="l00433"></a>00433             {
<a name="l00434"></a>00434                 <span class="keywordflow">if</span> ($methodName == $value) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00448"></a><a class="code" href="class_easy_form.html#ade17b04a708bb62c5c29d4cd0b68fc32">00448</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ade17b04a708bb62c5c29d4cd0b68fc32">getProperty</a>($propertyName)
<a name="l00449"></a>00449     {
<a name="l00450"></a>00450         $ret = <a class="code" href="class_easy_form.html#ade17b04a708bb62c5c29d4cd0b68fc32">parent::getProperty</a>($propertyName);
<a name="l00451"></a>00451         <span class="keywordflow">if</span> ($ret !== null) <span class="keywordflow">return</span> $ret;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         $pos1 = strpos($propertyName, <span class="stringliteral">&quot;[&quot;</span>);
<a name="l00454"></a>00454         $pos2 = strpos($propertyName, <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00455"></a>00455         <span class="keywordflow">if</span> ($pos1&gt;0 &amp;&amp; $pos2&gt;$pos1)
<a name="l00456"></a>00456         {
<a name="l00457"></a>00457             $propType = substr($propertyName, 0, $pos1);
<a name="l00458"></a>00458             $elementName = substr($propertyName, $pos1+1,$pos2-$pos1-1);
<a name="l00459"></a>00459             <span class="keywordflow">switch</span>(strtolower($propType))
<a name="l00460"></a>00460             {
<a name="l00461"></a>00461                             <span class="keywordflow">case</span> <span class="stringliteral">&#39;param&#39;</span>:               
<a name="l00462"></a>00462               <span class="keywordflow">case</span> <span class="stringliteral">&#39;params&#39;</span>:
<a name="l00463"></a>00463                      $result = $this-&gt;m_FormParams[$elementName];
<a name="l00464"></a>00464                      <span class="keywordflow">break</span>;
<a name="l00465"></a>00465               <span class="keywordflow">default</span>:
<a name="l00466"></a>00466                      
<a name="l00467"></a>00467                      $result = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($elementName);
<a name="l00468"></a>00468                      <span class="keywordflow">break</span>;
<a name="l00469"></a>00469             }            
<a name="l00470"></a>00470             <span class="keywordflow">return</span> $result;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473 
<a name="l00479"></a><a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">00479</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481         <span class="keywordflow">if</span> (!$this-&gt;m_DataObj)
<a name="l00482"></a>00482         {
<a name="l00483"></a>00483             <span class="keywordflow">if</span> ($this-&gt;m_DataObjName)
<a name="l00484"></a>00484                 $this-&gt;m_DataObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($this-&gt;m_DataObjName);
<a name="l00485"></a>00485             <span class="keywordflow">if</span>($this-&gt;m_DataObj)
<a name="l00486"></a>00486                 $this-&gt;m_DataObj-&gt;m_BizFormName = $this-&gt;m_Name;
<a name="l00487"></a>00487             <span class="keywordflow">else</span>
<a name="l00488"></a>00488             {
<a name="l00489"></a>00489                 <span class="comment">//BizSystem::clientProxy()-&gt;showErrorMessage(&quot;Cannot get DataObj of &quot;.$this-&gt;m_DataObjName.&quot;, please check your metadata file.&quot;);</span>
<a name="l00490"></a>00490                 <span class="keywordflow">return</span> null;
<a name="l00491"></a>00491             }
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493         <span class="keywordflow">return</span> $this-&gt;m_DataObj;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00502"></a><a class="code" href="class_easy_form.html#ab8c8ea3a93354f3c1a67a9374adb49f5">00502</a>     <span class="keyword">final</span> <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ab8c8ea3a93354f3c1a67a9374adb49f5">setDataObj</a>($dataObj)
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         $this-&gt;m_DataObj = $dataObj;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506 
<a name="l00513"></a><a class="code" href="class_easy_form.html#afbb8fcc4c21113c915263f4a1ca3c0c5">00513</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#afbb8fcc4c21113c915263f4a1ca3c0c5">outputAttrs</a>()
<a name="l00514"></a>00514     {
<a name="l00515"></a>00515         $output[<span class="stringliteral">&#39;name&#39;</span>] = $this-&gt;m_Name;
<a name="l00516"></a>00516         $output[<span class="stringliteral">&#39;title&#39;</span>] = <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($this-&gt;m_Title, $this);
<a name="l00517"></a>00517         $output[<span class="stringliteral">&#39;icon&#39;</span>] = $this-&gt;m_Icon;
<a name="l00518"></a>00518         $output[<span class="stringliteral">&#39;hasSubform&#39;</span>] = $this-&gt;m_SubForms ? 1 : 0;
<a name="l00519"></a>00519         $output[<span class="stringliteral">&#39;currentPage&#39;</span>] = $this-&gt;m_CurrentPage;
<a name="l00520"></a>00520         $output[<span class="stringliteral">&#39;currentRecordId&#39;</span>] = $this-&gt;m_RecordId;
<a name="l00521"></a>00521         $output[<span class="stringliteral">&#39;totalPages&#39;</span>] = $this-&gt;m_TotalPages;
<a name="l00522"></a>00522         $output[<span class="stringliteral">&#39;totalRecords&#39;</span>] = $this-&gt;m_TotalRecords;
<a name="l00523"></a>00523         $output[<span class="stringliteral">&#39;description&#39;</span>] = str_replace(<span class="charliteral">&#39;\n&#39;</span>, <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>, <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($this-&gt;m_Description,$this));
<a name="l00524"></a>00524         $output[<span class="stringliteral">&#39;elementSets&#39;</span>] = $this-&gt;getElementSet();
<a name="l00525"></a>00525         $output[<span class="stringliteral">&#39;tabSets&#39;</span>] = $this-&gt;getTabSet();
<a name="l00526"></a>00526         $output[<span class="stringliteral">&#39;ActionElementSets&#39;</span>] = $this-&gt;getElementSet($this-&gt;m_ActionPanel);    
<a name="l00527"></a>00527         <span class="keywordflow">if</span>($output[<span class="stringliteral">&#39;icon&#39;</span>])
<a name="l00528"></a>00528         {   
<a name="l00529"></a>00529                <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&quot;/{.*}/si&quot;</span>,$output[<span class="stringliteral">&#39;icon&#39;</span>]))
<a name="l00530"></a>00530                {
<a name="l00531"></a>00531                      $output[<span class="stringliteral">&#39;icon&#39;</span>] = <a class="code" href="class_expression.html#a85d5504074029bc1ebe18dd8de91571c">Expression::evaluateExpression</a>($output[<span class="stringliteral">&#39;icon&#39;</span>], null);
<a name="l00532"></a>00532                }
<a name="l00533"></a>00533                <span class="keywordflow">else</span>
<a name="l00534"></a>00534                {
<a name="l00535"></a>00535                      $output[<span class="stringliteral">&#39;icon&#39;</span>] = THEME_URL . <span class="stringliteral">&quot;/&quot;</span> . Resource::getCurrentTheme() . <span class="stringliteral">&quot;/images/&quot;</span>.$output[<span class="stringliteral">&#39;icon&#39;</span>];
<a name="l00536"></a>00536                }
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538         <span class="keywordflow">return</span> $output;
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00548"></a><a class="code" href="class_easy_form.html#a0727e1b8b77e4daf5347a2d43149bff2">00548</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a0727e1b8b77e4daf5347a2d43149bff2">processDataObjError</a>($errCode = 0)
<a name="l00549"></a>00549     {
<a name="l00550"></a>00550         $errorMsg = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;getErrorMessage();
<a name="l00551"></a>00551         <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_ERR, <span class="stringliteral">&quot;DATAOBJ&quot;</span>, <span class="stringliteral">&quot;DataObj error = &quot;</span>.$errorMsg);
<a name="l00552"></a>00552         <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showErrorMessage($errorMsg);
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 
<a name="l00561"></a><a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">00561</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>($errors)
<a name="l00562"></a>00562     {
<a name="l00563"></a>00563         $this-&gt;m_Errors = $errors;
<a name="l00564"></a>00564         $this-&gt;m_hasError = <span class="keyword">true</span>;
<a name="l00565"></a>00565         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567 
<a name="l00575"></a><a class="code" href="class_easy_form.html#af9731432265713729727ea8a96d73842">00575</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#af9731432265713729727ea8a96d73842">processBDOException</a>($e)
<a name="l00576"></a>00576     {
<a name="l00577"></a>00577         $errorMsg = $e-&gt;getMessage();
<a name="l00578"></a>00578         <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_ERR, <span class="stringliteral">&quot;DATAOBJ&quot;</span>, <span class="stringliteral">&quot;DataObj error = &quot;</span>.$errorMsg);
<a name="l00579"></a>00579         <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showClientAlert($errorMsg);   <span class="comment">//showErrorMessage($errorMsg);</span>
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 
<a name="l00588"></a><a class="code" href="class_easy_form.html#acc26c268a812d1eeefc158226580a01a">00588</a>     <span class="keyword">final</span> <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#acc26c268a812d1eeefc158226580a01a">setSubForms</a>($subForms)
<a name="l00589"></a>00589     {
<a name="l00590"></a>00590         <span class="comment">// sub controls string with format: ctrl1;ctrl2...</span>
<a name="l00591"></a>00591         <span class="keywordflow">if</span> (!$subForms || strlen($subForms) &lt; 1)
<a name="l00592"></a>00592         {
<a name="l00593"></a>00593             $this-&gt;m_SubForms = null;
<a name="l00594"></a>00594             <span class="keywordflow">return</span>;
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596         $subFormArr = explode(<span class="stringliteral">&quot;;&quot;</span>, $subForms);
<a name="l00597"></a>00597         unset($this-&gt;m_SubForms);
<a name="l00598"></a>00598         <span class="keywordflow">foreach</span> ($subFormArr as $subForm)
<a name="l00599"></a>00599         {
<a name="l00600"></a>00600             $this-&gt;m_SubForms[] = $this-&gt;<a class="code" href="class_meta_object.html#a7a34962e72564b47da11d86bfde7cf79">prefixPackage</a>($subForm);
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00610"></a><a class="code" href="class_easy_form.html#a70ed31c90f3ad9bd31b8ad60a39f87ad">00610</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a70ed31c90f3ad9bd31b8ad60a39f87ad">getViewObject</a>()
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612         global $g_BizSystem;
<a name="l00613"></a>00613         $viewName = $g_BizSystem-&gt;getCurrentViewName();
<a name="l00614"></a>00614         <span class="keywordflow">if</span> (!$viewName) <span class="keywordflow">return</span> null;
<a name="l00615"></a>00615         $viewObj = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($viewName);
<a name="l00616"></a>00616         <span class="keywordflow">return</span> $viewObj;
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00624"></a><a class="code" href="class_easy_form.html#ae5a3541cd79bde8e9366f992a19e7c5b">00624</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ae5a3541cd79bde8e9366f992a19e7c5b">getSubForms</a>()
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626         <span class="comment">// ask view to give its subforms if not set yet</span>
<a name="l00627"></a>00627         <span class="keywordflow">return</span> $this-&gt;m_SubForms;
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 
<a name="l00636"></a><a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">00636</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($elementName)
<a name="l00637"></a>00637     {
<a name="l00638"></a>00638         <span class="keywordflow">if</span> ($this-&gt;m_DataPanel-&gt;get($elementName)) <span class="keywordflow">return</span> $this-&gt;m_DataPanel-&gt;get($elementName);
<a name="l00639"></a>00639         <span class="keywordflow">if</span> ($this-&gt;m_ActionPanel-&gt;get($elementName)) <span class="keywordflow">return</span> $this-&gt;m_ActionPanel-&gt;get($elementName);
<a name="l00640"></a>00640         <span class="keywordflow">if</span> ($this-&gt;m_NavPanel-&gt;get($elementName)) <span class="keywordflow">return</span> $this-&gt;m_NavPanel-&gt;get($elementName);
<a name="l00641"></a>00641         <span class="keywordflow">if</span> ($this-&gt;m_SearchPanel-&gt;get($elementName)) <span class="keywordflow">return</span> $this-&gt;m_SearchPanel-&gt;get($elementName);
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643     
<a name="l00644"></a>00644     <span class="keyword">public</span> function getElementSet($panel = null)
<a name="l00645"></a>00645     {
<a name="l00646"></a>00646        <span class="keywordflow">if</span>(!$panel){
<a name="l00647"></a>00647               $panel = $this-&gt;m_DataPanel;
<a name="l00648"></a>00648        }
<a name="l00649"></a>00649        $setArr = array();
<a name="l00650"></a>00650        $panel-&gt;rewind();
<a name="l00651"></a>00651         <span class="keywordflow">while</span>($panel-&gt;valid())            
<a name="l00652"></a>00652         {      
<a name="l00653"></a>00653               $elem = $panel-&gt;current();
<a name="l00654"></a>00654               $panel-&gt;next();    
<a name="l00655"></a>00655               <span class="keywordflow">if</span>($elem-&gt;m_ElementSet &amp;&amp; $elem-&gt;canDisplayed()){
<a name="l00656"></a>00656                      <span class="comment">//is it in array</span>
<a name="l00657"></a>00657                      <span class="keywordflow">if</span>(in_array($elem-&gt;m_ElementSet,$setArr)){
<a name="l00658"></a>00658                             <span class="keywordflow">continue</span>;
<a name="l00659"></a>00659                      }<span class="keywordflow">else</span>{
<a name="l00660"></a>00660                             array_push($setArr,$elem-&gt;m_ElementSet);
<a name="l00661"></a>00661                      }
<a name="l00662"></a>00662               }                          
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664         <span class="keywordflow">return</span> $setArr;
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666     
<a name="l00667"></a>00667        <span class="keyword">public</span> function getTabSet($panel = null)
<a name="l00668"></a>00668     {
<a name="l00669"></a>00669        <span class="keywordflow">if</span>(!$panel){
<a name="l00670"></a>00670               $panel = $this-&gt;m_DataPanel;
<a name="l00671"></a>00671        }
<a name="l00672"></a>00672        $setArr = array();
<a name="l00673"></a>00673        $tabSetArr = array();
<a name="l00674"></a>00674        $panel-&gt;rewind();
<a name="l00675"></a>00675         <span class="keywordflow">while</span>($panel-&gt;valid())            
<a name="l00676"></a>00676         {      
<a name="l00677"></a>00677               $elem = $panel-&gt;current();
<a name="l00678"></a>00678               $panel-&gt;next();    
<a name="l00679"></a>00679               <span class="keywordflow">if</span>($elem-&gt;m_TabSet &amp;&amp; $elem-&gt;canDisplayed()){
<a name="l00680"></a>00680                      <span class="comment">//is it in array</span>
<a name="l00681"></a>00681                      <span class="keywordflow">if</span>(in_array($elem-&gt;m_TabSet,$setArr)){
<a name="l00682"></a>00682                             <span class="keywordflow">continue</span>;
<a name="l00683"></a>00683                      }<span class="keywordflow">else</span>{
<a name="l00684"></a>00684                             $setArr[$elem-&gt;m_TabSetCode]=$elem-&gt;m_TabSet;
<a name="l00685"></a>00685                      }
<a name="l00686"></a>00686               }                                               
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688         <span class="keywordflow">foreach</span>($setArr as $tabsetCode=&gt;$tabset)
<a name="l00689"></a>00689         {
<a name="l00690"></a>00690               $elemSetArr = array();
<a name="l00691"></a>00691               $panel-&gt;rewind();
<a name="l00692"></a>00692                <span class="keywordflow">while</span>($panel-&gt;valid())            
<a name="l00693"></a>00693                {      
<a name="l00694"></a>00694                      $elem = $panel-&gt;current();
<a name="l00695"></a>00695                      $panel-&gt;next();    
<a name="l00696"></a>00696                      <span class="keywordflow">if</span>($elem-&gt;m_ElementSet &amp;&amp; $elem-&gt;canDisplayed()){
<a name="l00697"></a>00697                             <span class="comment">//is it in array</span>
<a name="l00698"></a>00698                             <span class="keywordflow">if</span>( $elem-&gt;m_TabSetCode!= $tabsetCode || 
<a name="l00699"></a>00699                                    in_array($elem-&gt;m_ElementSet,$elemSetArr)){
<a name="l00700"></a>00700                                    <span class="keywordflow">continue</span>;
<a name="l00701"></a>00701                             }<span class="keywordflow">else</span>{
<a name="l00702"></a>00702                                    array_push($elemSetArr,$elem-&gt;m_ElementSet);
<a name="l00703"></a>00703                             }
<a name="l00704"></a>00704                      }                                               
<a name="l00705"></a>00705                }
<a name="l00706"></a>00706                $tabSetArr[$tabsetCode][<span class="stringliteral">&#39;SetName&#39;</span>] = $tabset;
<a name="l00707"></a>00707                $tabSetArr[$tabsetCode][<span class="stringliteral">&#39;Elems&#39;</span>] = $elemSetArr;
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709         <span class="keywordflow">return</span> $tabSetArr;
<a name="l00710"></a>00710     }    
<a name="l00711"></a>00711 
<a name="l00718"></a><a class="code" href="class_easy_form.html#a664369c26fc251927f4f5ac54a908944">00718</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a664369c26fc251927f4f5ac54a908944">getErrorElements</a>($fields)
<a name="l00719"></a>00719     {
<a name="l00720"></a>00720         $errElements = array();
<a name="l00721"></a>00721         <span class="keywordflow">foreach</span> ($fields as $field=&gt;$error)
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723             $element = $this-&gt;m_DataPanel-&gt;getByField($field);
<a name="l00724"></a>00724             $errElements[$element-&gt;m_Name]=$error;
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726         <span class="keywordflow">return</span> $errElements;
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728 
<a name="l00738"></a><a class="code" href="class_easy_form.html#a4cba68e60908d93a2f10dddee940a689">00738</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a4cba68e60908d93a2f10dddee940a689">loadPicker</a>($formName, $elementName=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00739"></a>00739     {
<a name="l00740"></a>00740         <span class="comment">// set the ParentFormName and ParentCtrlName of the popup form</span>
<a name="l00741"></a>00741         <span class="comment">/* @var $pickerForm EasyForm */</span>
<a name="l00742"></a>00742         $pickerForm = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744         <span class="keywordflow">if</span> ($elementName != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00745"></a>00745         {
<a name="l00746"></a>00746             <span class="comment">// set the picker map as well</span>
<a name="l00747"></a>00747             $element = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($elementName);
<a name="l00748"></a>00748             $pickerMap = $element-&gt;m_PickerMap;
<a name="l00749"></a>00749         }
<a name="l00750"></a>00750               $currentRecord = $this-&gt;<a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>();
<a name="l00751"></a>00751         $pickerForm-&gt;setParentFormData($this-&gt;m_Name, $elementName, $pickerMap);
<a name="l00752"></a>00752         $pickerForm-&gt;m_ParentFormRecord = $currentRecord;
<a name="l00753"></a>00753         <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;redrawForm(<span class="stringliteral">&quot;DIALOG&quot;</span>, $pickerForm-&gt;render());
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     
<a name="l00756"></a>00756     <span class="keyword">public</span> function loadDialog($formName, $id=null,$transId=<span class="keyword">false</span>)
<a name="l00757"></a>00757     {
<a name="l00758"></a>00758        $paramFields = array();
<a name="l00759"></a>00759         <span class="keywordflow">if</span> ($id!=null)
<a name="l00760"></a>00760             $paramFields[<span class="stringliteral">&quot;Id&quot;</span>] = $id;
<a name="l00761"></a>00761         <span class="keywordflow">if</span> ($transId!=<span class="keyword">false</span>)
<a name="l00762"></a>00762             $paramFields[<span class="stringliteral">&quot;Id&quot;</span>] = $this-&gt;m_RecordId;
<a name="l00763"></a>00763         $this-&gt;<a class="code" href="class_easy_form.html#aef7c4ff0a903eb04e7af25a6baea3d35">_showForm</a>($formName, <span class="stringliteral">&quot;Dialog&quot;</span>, $paramFields);
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00774"></a><a class="code" href="class_easy_form.html#a40fbc1d15978ef8ecaf29614cf3cc70a">00774</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a40fbc1d15978ef8ecaf29614cf3cc70a">callService</a>($class, $method, $param = null)
<a name="l00775"></a>00775     {
<a name="l00776"></a>00776         $service = <a class="code" href="class_biz_system.html#a6729150f2baee41fce746a2f21defd96">BizSystem::getService</a>($class);
<a name="l00777"></a>00777         <span class="keywordflow">if</span>($param){
<a name="l00778"></a>00778               <span class="keywordflow">return</span> $service-&gt;$method($param);
<a name="l00779"></a>00779         }<span class="keywordflow">else</span>{
<a name="l00780"></a>00780               <span class="keywordflow">return</span> $service-&gt;$method($this-&gt;m_Name);
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 
<a name="l00790"></a><a class="code" href="class_easy_form.html#a3817c0cb7f3646146cbfd0601c786fef">00790</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a3817c0cb7f3646146cbfd0601c786fef">setRequestParams</a>($paramFields)
<a name="l00791"></a>00791     {                
<a name="l00792"></a>00792         <span class="keywordflow">if</span> ($paramFields)
<a name="l00793"></a>00793         {
<a name="l00794"></a>00794               $this-&gt;m_FixSearchRule=null; <span class="comment">// reset fixsearchrule to clean the previous one in session</span>
<a name="l00795"></a>00795             <span class="keywordflow">foreach</span>($paramFields as $fieldName=&gt;$val)
<a name="l00796"></a>00796             {
<a name="l00797"></a>00797                 $element = $this-&gt;m_DataPanel-&gt;getByField($fieldName);
<a name="l00798"></a>00798                 <span class="keywordflow">if</span>($element-&gt;m_AllowURLParam==<span class="charliteral">&#39;Y&#39;</span>)
<a name="l00799"></a>00799                 {
<a name="l00800"></a>00800                      <span class="keywordflow">if</span>(!$this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>())<span class="keywordflow">return</span>;
<a name="l00801"></a>00801                     <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;getField($fieldName)-&gt;checkValueType($val))
<a name="l00802"></a>00802                     {
<a name="l00803"></a>00803                         <span class="comment">//$this-&gt;setFixSearchRule(&quot;[$fldName]=&#39;$val&#39;&quot;);</span>
<a name="l00804"></a>00804                         $queryString = <a class="code" href="class_query_string_param.html#afe4e61acb95e6bda80a154f68a579eb9">QueryStringParam::formatQueryString</a>(<span class="stringliteral">&quot;[$fieldName]&quot;</span>, <span class="stringliteral">&quot;=&quot;</span>, $val);
<a name="l00805"></a>00805                         $this-&gt;<a class="code" href="class_easy_form.html#a35edc47d7ce4feb5de1a223b3e134306">setFixSearchRule</a>($queryString,<span class="keyword">false</span>);
<a name="l00806"></a>00806                         $this-&gt;m_SearchRuleBindValues = <a class="code" href="class_query_string_param.html#a5f5178ba6a939066124770d70cf1bef5">QueryStringParam::getBindValues</a>();
<a name="l00807"></a>00807                     }
<a name="l00808"></a>00808                 }
<a name="l00809"></a>00809             }
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="keyword">public</span> function setCurrentPage($pageid)
<a name="l00814"></a>00814     {
<a name="l00815"></a>00815        $this-&gt;m_CurrentPage = $pageid;
<a name="l00816"></a>00816     }
<a name="l00822"></a><a class="code" href="class_easy_form.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">00822</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">close</a>()
<a name="l00823"></a>00823     {
<a name="l00824"></a>00824         <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;closePopup();
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826 
<a name="l00832"></a><a class="code" href="class_easy_form.html#a20e3df73edd7359bec20a8862ceb3d33">00832</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a20e3df73edd7359bec20a8862ceb3d33">renderParent</a>()
<a name="l00833"></a>00833     {
<a name="l00834"></a>00834         <span class="comment">/* @var $parentForm EasyForm */</span>
<a name="l00835"></a>00835         $parentForm = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($this-&gt;m_ParentFormName);
<a name="l00836"></a>00836         $parentForm-&gt;rerender();
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00847"></a><a class="code" href="class_easy_form.html#a35edc47d7ce4feb5de1a223b3e134306">00847</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a35edc47d7ce4feb5de1a223b3e134306">setFixSearchRule</a>($rule = null, $cleanActualRule = <span class="keyword">true</span>)
<a name="l00848"></a>00848     {
<a name="l00849"></a>00849         <span class="keywordflow">if</span> ($cleanActualRule)
<a name="l00850"></a>00850             $this-&gt;m_FixSearchRule = $this-&gt;m_DefaultFixSearchRule;
<a name="l00851"></a>00851             
<a name="l00852"></a>00852         <span class="keywordflow">if</span> ($this-&gt;m_FixSearchRule &amp;&amp; $rule)
<a name="l00853"></a>00853         {            
<a name="l00854"></a>00854             <span class="keywordflow">if</span> (strpos($this-&gt;m_FixSearchRule, $rule) === <span class="keyword">false</span>)
<a name="l00855"></a>00855             {
<a name="l00856"></a>00856                 $this-&gt;m_FixSearchRule = $this-&gt;m_FixSearchRule . <span class="stringliteral">&quot; AND &quot;</span> . $rule;
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858         }
<a name="l00859"></a>00859         <span class="keywordflow">if</span> (!$this-&gt;m_FixSearchRule &amp;&amp; $rule){
<a name="l00860"></a>00860             $this-&gt;m_FixSearchRule = $rule;
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863 
<a name="l00869"></a><a class="code" href="class_easy_form.html#ad3526d375e393f0f13721877488493b6">00869</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ad3526d375e393f0f13721877488493b6">fetchDataSet</a>()
<a name="l00870"></a>00870     {
<a name="l00871"></a>00871         $dataObj = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>();
<a name="l00872"></a>00872 
<a name="l00873"></a>00873         <span class="keywordflow">if</span> (!$dataObj) <span class="keywordflow">return</span> null;
<a name="l00874"></a>00874         
<a name="l00875"></a>00875         <a class="code" href="class_query_string_param.html#a03a34bddde00ab8e85f84e0f55421497">QueryStringParam::setBindValues</a>($this-&gt;m_SearchRuleBindValues);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877         <span class="keywordflow">if</span> ($this-&gt;m_RefreshData)
<a name="l00878"></a>00878             $dataObj-&gt;resetRules();
<a name="l00879"></a>00879         <span class="keywordflow">else</span>
<a name="l00880"></a>00880             $dataObj-&gt;clearSearchRule();
<a name="l00881"></a>00881 
<a name="l00882"></a>00882         <span class="keywordflow">if</span> ($this-&gt;m_FixSearchRule)
<a name="l00883"></a>00883         {
<a name="l00884"></a>00884             <span class="keywordflow">if</span> ($this-&gt;m_SearchRule)
<a name="l00885"></a>00885                 $searchRule = $this-&gt;m_SearchRule . <span class="stringliteral">&quot; AND &quot;</span> . $this-&gt;m_FixSearchRule;
<a name="l00886"></a>00886             <span class="keywordflow">else</span>
<a name="l00887"></a>00887                 $searchRule = $this-&gt;m_FixSearchRule;
<a name="l00888"></a>00888         }
<a name="l00889"></a>00889         <span class="keywordflow">else</span>
<a name="l00890"></a>00890             $searchRule = $this-&gt;m_SearchRule;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         $dataObj-&gt;setSearchRule($searchRule);        
<a name="l00893"></a>00893         <span class="keywordflow">if</span>($this-&gt;m_StartItem&gt;1)
<a name="l00894"></a>00894         {
<a name="l00895"></a>00895             $dataObj-&gt;setLimit($this-&gt;m_Range, $this-&gt;m_StartItem);
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897         <span class="keywordflow">else</span>
<a name="l00898"></a>00898         {
<a name="l00899"></a>00899             $dataObj-&gt;setLimit($this-&gt;m_Range, ($this-&gt;m_CurrentPage-1)*$this-&gt;m_Range);
<a name="l00900"></a>00900         }      
<a name="l00901"></a>00901         <span class="keywordflow">if</span>($this-&gt;m_SortRule &amp;&amp; $this-&gt;m_SortRule != $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;m_SortRule)
<a name="l00902"></a>00902         {
<a name="l00903"></a>00903                      $dataObj-&gt;setSortRule($this-&gt;m_SortRule);
<a name="l00904"></a>00904         }          
<a name="l00905"></a>00905         $resultRecords = $dataObj-&gt;fetch();
<a name="l00906"></a>00906         $this-&gt;m_TotalRecords = $dataObj-&gt;count();
<a name="l00907"></a>00907         <span class="keywordflow">if</span> ($this-&gt;m_Range &amp;&amp; $this-&gt;m_Range &gt; 0)
<a name="l00908"></a>00908             $this-&gt;m_TotalPages = ceil($this-&gt;m_TotalRecords/$this-&gt;m_Range);
<a name="l00909"></a>00909         $selectedIndex = 0;
<a name="l00910"></a>00910         
<a name="l00911"></a>00911         <span class="comment">//if current page is large than total pages ,then reset current page to last page</span>
<a name="l00912"></a>00912         <span class="keywordflow">if</span>($this-&gt;m_CurrentPage&gt;$this-&gt;m_TotalPages &amp;&amp; $this-&gt;m_TotalPages&gt;0)
<a name="l00913"></a>00913         {
<a name="l00914"></a>00914               $this-&gt;m_CurrentPage = $this-&gt;m_TotalPages;
<a name="l00915"></a>00915               $dataObj-&gt;setLimit($this-&gt;m_Range, ($this-&gt;m_CurrentPage-1)*$this-&gt;m_Range);
<a name="l00916"></a>00916               $resultRecords = $dataObj-&gt;fetch();
<a name="l00917"></a>00917         }
<a name="l00918"></a>00918         
<a name="l00919"></a>00919         $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;setActiveRecord($resultRecords[$selectedIndex]);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         QueryStringParam::ReSet();
<a name="l00922"></a>00922               <span class="keywordflow">if</span>(!$this-&gt;m_RecordId)
<a name="l00923"></a>00923               {
<a name="l00924"></a>00924                      $this-&gt;m_RecordId = $resultRecords[0][<span class="stringliteral">&quot;Id&quot;</span>];
<a name="l00925"></a>00925               }<span class="keywordflow">else</span>{
<a name="l00926"></a>00926                      $foundRecordId = <span class="keyword">false</span>;
<a name="l00927"></a>00927                      <span class="keywordflow">foreach</span>($resultRecords as $record)
<a name="l00928"></a>00928                      {
<a name="l00929"></a>00929                             <span class="keywordflow">if</span>($this-&gt;m_RecordId==$record[<span class="stringliteral">&#39;Id&#39;</span>])
<a name="l00930"></a>00930                             {
<a name="l00931"></a>00931                                    $foundRecordId = <span class="keyword">true</span>;
<a name="l00932"></a>00932                             }
<a name="l00933"></a>00933                      }
<a name="l00934"></a>00934                      <span class="keywordflow">if</span>($foundRecordId == <span class="keyword">false</span>)
<a name="l00935"></a>00935                      {
<a name="l00936"></a>00936                             $this-&gt;m_RecordId=$result[0][<span class="stringliteral">&#39;Id&#39;</span>];
<a name="l00937"></a>00937                      }                    
<a name="l00938"></a>00938               }
<a name="l00939"></a>00939               
<a name="l00940"></a>00940         <span class="keywordflow">return</span> $resultRecords;
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942 
<a name="l00948"></a><a class="code" href="class_easy_form.html#a38ac74df0eb521f827ed815c2bbde0b1">00948</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a38ac74df0eb521f827ed815c2bbde0b1">fetchData</a>()
<a name="l00949"></a>00949     {         
<a name="l00950"></a>00950         <span class="comment">// if has valid active record, return it, otherwise do a query</span>
<a name="l00951"></a>00951         <span class="keywordflow">if</span> ($this-&gt;m_ActiveRecord != null)
<a name="l00952"></a>00952             <span class="keywordflow">return</span> $this-&gt;m_ActiveRecord;
<a name="l00953"></a>00953         
<a name="l00954"></a>00954         $dataObj = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>();
<a name="l00955"></a>00955         <span class="keywordflow">if</span> ($dataObj == null) <span class="keywordflow">return</span>;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957         <span class="keywordflow">if</span> (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;NEW&quot;</span>)
<a name="l00958"></a>00958             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_easy_form.html#a95a880b9f639a7184f5319e9d15b588a">getNewRecord</a>();
<a name="l00959"></a>00959               
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (!$this-&gt;m_FixSearchRule &amp;&amp; !$this-&gt;m_SearchRule){ 
<a name="l00961"></a>00961               <span class="comment">//if its a default sub form,even no search rule, but can still fetch a default record </span>
<a name="l00962"></a>00962               <span class="keywordflow">if</span>(!is_array($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;m_Association)){
<a name="l00963"></a>00963                      <span class="comment">//only if its a default sub form and without any association then return emply array</span>
<a name="l00964"></a>00964                      <span class="keywordflow">return</span> array();
<a name="l00965"></a>00965               }
<a name="l00966"></a>00966         }<span class="keywordflow">else</span>{       
<a name="l00967"></a>00967               <a class="code" href="class_query_string_param.html#a03a34bddde00ab8e85f84e0f55421497">QueryStringParam::setBindValues</a>($this-&gt;m_SearchRuleBindValues);
<a name="l00968"></a>00968                
<a name="l00969"></a>00969                      
<a name="l00970"></a>00970                <span class="keywordflow">if</span> ($this-&gt;m_RefreshData)   $dataObj-&gt;resetRules();
<a name="l00971"></a>00971                <span class="keywordflow">else</span> $dataObj-&gt;clearSearchRule();
<a name="l00972"></a>00972        
<a name="l00973"></a>00973                <span class="keywordflow">if</span> ($this-&gt;m_FixSearchRule)
<a name="l00974"></a>00974                {
<a name="l00975"></a>00975                    <span class="keywordflow">if</span> ($this-&gt;m_SearchRule)
<a name="l00976"></a>00976                        $searchRule = $this-&gt;m_SearchRule . <span class="stringliteral">&quot; AND &quot;</span> . $this-&gt;m_FixSearchRule;
<a name="l00977"></a>00977                    <span class="keywordflow">else</span>
<a name="l00978"></a>00978                        $searchRule = $this-&gt;m_FixSearchRule;
<a name="l00979"></a>00979                }
<a name="l00980"></a>00980                
<a name="l00981"></a>00981                $dataObj-&gt;setSearchRule($searchRule);
<a name="l00982"></a>00982                <a class="code" href="class_query_string_param.html#a03a34bddde00ab8e85f84e0f55421497">QueryStringParam::setBindValues</a>($this-&gt;m_SearchRuleBindValues);
<a name="l00983"></a>00983                $dataObj-&gt;setLimit(1);
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985         $resultRecords = $dataObj-&gt;fetch();
<a name="l00986"></a>00986               <span class="keywordflow">if</span>(!count($resultRecords))
<a name="l00987"></a>00987               {
<a name="l00988"></a>00988                      $this-&gt;m_RecordAllowAccess=<span class="keyword">false</span>;
<a name="l00989"></a>00989               }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         $this-&gt;m_RecordId = $resultRecords[0][<span class="stringliteral">&#39;Id&#39;</span>];
<a name="l00992"></a>00992         $this-&gt;<a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">setActiveRecord</a>($resultRecords[0]);      
<a name="l00993"></a>00993         
<a name="l00994"></a>00994         QueryStringParam::ReSet();
<a name="l00995"></a>00995        <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()){
<a name="l00996"></a>00996                      $this-&gt;m_CanUpdateRecord = (int)$this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;canUpdateRecord();
<a name="l00997"></a>00997        }        
<a name="l00998"></a>00998         <span class="keywordflow">return</span> $resultRecords[0];
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01007"></a><a class="code" href="class_easy_form.html#af257d587a47f747ac99f7ea89b0e3a32">01007</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#af257d587a47f747ac99f7ea89b0e3a32">gotoPage</a>($page=1)
<a name="l01008"></a>01008     {
<a name="l01009"></a>01009         $tgtPage = intval($page);
<a name="l01010"></a>01010         <span class="keywordflow">if</span> ($tgtPage == 0) $tgtPage = 1;
<a name="l01011"></a>01011         $this-&gt;m_CurrentPage = $tgtPage;
<a name="l01012"></a>01012         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014     <span class="keyword">public</span> function gotoSelectedPage($elemName)
<a name="l01015"></a>01015     {
<a name="l01016"></a>01016         $page = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(str_replace(<span class="stringliteral">&quot;.&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>, $this-&gt;m_Name).<span class="charliteral">&#39;_&#39;</span>.$elemName);
<a name="l01017"></a>01017        $this-&gt;<a class="code" href="class_easy_form.html#af257d587a47f747ac99f7ea89b0e3a32">gotoPage</a>($page);
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019     <span class="keyword">public</span> function setPageSize($elemName)
<a name="l01020"></a>01020     {
<a name="l01021"></a>01021         $pagesize = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(str_replace(<span class="stringliteral">&quot;.&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>, $this-&gt;m_Name).<span class="charliteral">&#39;_&#39;</span>.$elemName);
<a name="l01022"></a>01022        $this-&gt;m_Range=$pagesize;
<a name="l01023"></a>01023        $this-&gt;UpdateForm();
<a name="l01024"></a>01024     }    
<a name="l01033"></a><a class="code" href="class_easy_form.html#a0aa5b2a2eb9946d0e985687bc15e51b4">01033</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a0aa5b2a2eb9946d0e985687bc15e51b4">sortRecord</a>($sortCol, $order=<span class="stringliteral">&#39;ASC&#39;</span>)
<a name="l01034"></a>01034     {
<a name="l01035"></a>01035         $element = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($sortCol);
<a name="l01036"></a>01036         <span class="comment">// turn off the OnSort flag of the old onsort field</span>
<a name="l01037"></a>01037         $element-&gt;setSortFlag(null);
<a name="l01038"></a>01038         <span class="comment">// turn on the OnSort flag of the new onsort field</span>
<a name="l01039"></a>01039         <span class="keywordflow">if</span> ($order == <span class="stringliteral">&quot;ASC&quot;</span>)
<a name="l01040"></a>01040             $order = <span class="stringliteral">&quot;DESC&quot;</span>;
<a name="l01041"></a>01041         <span class="keywordflow">else</span>
<a name="l01042"></a>01042             $order = <span class="stringliteral">&quot;ASC&quot;</span>;
<a name="l01043"></a>01043         $element-&gt;setSortFlag($order);
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         <span class="comment">// change the sort rule and issue the query</span>
<a name="l01046"></a>01046         $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;setSortRule(<span class="stringliteral">&quot;[&quot;</span> . $element-&gt;m_FieldName . <span class="stringliteral">&quot;] &quot;</span> . $order);
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         <span class="comment">// move to 1st page</span>
<a name="l01049"></a>01049         $this-&gt;m_CurrentPage = 1;
<a name="l01050"></a>01050         $this-&gt;m_SortRule = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054 
<a name="l01060"></a><a class="code" href="class_easy_form.html#a0b269ace607ab745b5c2ac549f1f3b08">01060</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a0b269ace607ab745b5c2ac549f1f3b08">runSearch</a>()
<a name="l01061"></a>01061     {
<a name="l01062"></a>01062         include_once(OPENBIZ_BIN.<span class="stringliteral">&quot;/easy/SearchHelper.php&quot;</span>);
<a name="l01063"></a>01063         $searchRule = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01064"></a>01064         <span class="keywordflow">foreach</span> ($this-&gt;m_SearchPanel as $element)
<a name="l01065"></a>01065         {
<a name="l01066"></a>01066             $searchStr = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01067"></a>01067               <span class="keywordflow">if</span>(method_exists($element,<span class="stringliteral">&quot;getSearchRule&quot;</span>)){
<a name="l01068"></a>01068                      $searchStr = $element-&gt;getSearchRule();                 
<a name="l01069"></a>01069               }<span class="keywordflow">else</span>{               
<a name="l01070"></a>01070                    <span class="keywordflow">if</span> (!$element-&gt;m_FieldName)
<a name="l01071"></a>01071                        <span class="keywordflow">continue</span>;
<a name="l01072"></a>01072        
<a name="l01073"></a>01073                    $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($element-&gt;m_Name);            
<a name="l01074"></a>01074                    <span class="keywordflow">if</span>($element-&gt;m_FuzzySearch==<span class="stringliteral">&quot;Y&quot;</span>)
<a name="l01075"></a>01075                    {
<a name="l01076"></a>01076                        $value=<span class="stringliteral">&quot;*$value*&quot;</span>;
<a name="l01077"></a>01077                    }
<a name="l01078"></a>01078                    <span class="keywordflow">if</span> ($value!=<span class="stringliteral">&#39;&#39;</span>)
<a name="l01079"></a>01079                    {
<a name="l01080"></a>01080                        $searchStr = inputValToRule($element-&gt;m_FieldName, $value, $this);                 
<a name="l01081"></a>01081                    }
<a name="l01082"></a>01082               }
<a name="l01083"></a>01083               <span class="keywordflow">if</span>($searchStr){
<a name="l01084"></a>01084                      <span class="keywordflow">if</span> ($searchRule == <span class="stringliteral">&quot;&quot;</span>)
<a name="l01085"></a>01085                     $searchRule .= $searchStr;
<a name="l01086"></a>01086                 <span class="keywordflow">else</span>
<a name="l01087"></a>01087                     $searchRule .= <span class="stringliteral">&quot; AND &quot;</span> . $searchStr;
<a name="l01088"></a>01088               }
<a name="l01089"></a>01089         }
<a name="l01090"></a>01090         $this-&gt;m_SearchRule = $searchRule;
<a name="l01091"></a>01091         $this-&gt;m_SearchRuleBindValues = <a class="code" href="class_query_string_param.html#a5f5178ba6a939066124770d70cf1bef5">QueryStringParam::getBindValues</a>();
<a name="l01092"></a>01092         
<a name="l01093"></a>01093 
<a name="l01094"></a>01094         $this-&gt;m_RefreshData = <span class="keyword">true</span>;
<a name="l01095"></a>01095 
<a name="l01096"></a>01096         $this-&gt;m_CurrentPage = 1;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098         <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_DEBUG,<span class="stringliteral">&quot;FORMOBJ&quot;</span>,$this-&gt;m_Name.<span class="stringliteral">&quot;::runSearch(), SearchRule=&quot;</span>.$this-&gt;m_SearchRule);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100               $recArr = $this-&gt;<a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>();              
<a name="l01101"></a>01101               
<a name="l01102"></a>01102               $this-&gt;m_SearchPanelValues = $recArr;
<a name="l01103"></a>01103               
<a name="l01104"></a>01104         
<a name="l01105"></a>01105         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01106"></a>01106         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108 
<a name="l01114"></a><a class="code" href="class_easy_form.html#a5d3f4160632eebbdec1d1e9bf8a3d510">01114</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a5d3f4160632eebbdec1d1e9bf8a3d510">resetSearch</a>()
<a name="l01115"></a>01115     {
<a name="l01116"></a>01116         $this-&gt;m_SearchRule = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01117"></a>01117         $this-&gt;m_RefreshData = <span class="keyword">true</span>;
<a name="l01118"></a>01118         $this-&gt;m_CurrentPage = 1;
<a name="l01119"></a>01119         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01120"></a>01120         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122     
<a name="l01123"></a>01123     <span class="keyword">public</span> function setSearchRule($searchRule, $searchRuleBindValues=null)
<a name="l01124"></a>01124     {
<a name="l01125"></a>01125        $this-&gt;m_SearchRule = $searchRule;
<a name="l01126"></a>01126        $this-&gt;m_SearchRuleBindValues = $searchRuleBindValues;
<a name="l01127"></a>01127        $this-&gt;m_RefreshData = <span class="keyword">true</span>;
<a name="l01128"></a>01128         $this-&gt;m_CurrentPage = 1;
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130     
<a name="l01136"></a><a class="code" href="class_easy_form.html#a44283849d1849ef432f360425f8c6907">01136</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a44283849d1849ef432f360425f8c6907">newRecord</a>()
<a name="l01137"></a>01137     {
<a name="l01138"></a>01138         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140 
<a name="l01148"></a><a class="code" href="class_easy_form.html#a0a9be34d99077d5d3ea572ca7e59200a">01148</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a0a9be34d99077d5d3ea572ca7e59200a">copyRecord</a>($id=null)
<a name="l01149"></a>01149     {
<a name="l01150"></a>01150         <span class="keywordflow">if</span> ($id==null || $id==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01151"></a>01151             $id = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (!$id)
<a name="l01154"></a>01154         {
<a name="l01155"></a>01155             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showClientAlert($this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;PLEASE_EDIT_A_RECORD&quot;</span>));
<a name="l01156"></a>01156             <span class="keywordflow">return</span>;
<a name="l01157"></a>01157         }
<a name="l01158"></a>01158         $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($id);
<a name="l01159"></a>01159         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01160"></a>01160     }
<a name="l01161"></a>01161 
<a name="l01169"></a><a class="code" href="class_easy_form.html#a32687fce665ec940eadd9d119c193632">01169</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a32687fce665ec940eadd9d119c193632">editRecord</a>($id=null)
<a name="l01170"></a>01170     {
<a name="l01171"></a>01171         <span class="keywordflow">if</span> ($id==null || $id==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01172"></a>01172             $id = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l01173"></a>01173               
<a name="l01174"></a>01174         <span class="keywordflow">if</span> (!isset($id))
<a name="l01175"></a>01175         {
<a name="l01176"></a>01176             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showClientAlert($this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;PLEASE_EDIT_A_RECORD&quot;</span>));
<a name="l01177"></a>01177             <span class="keywordflow">return</span>;
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180         <span class="comment">// update the active record with new update record</span>
<a name="l01181"></a>01181         $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($id);
<a name="l01182"></a>01182 
<a name="l01183"></a>01183         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185 
<a name="l01194"></a><a class="code" href="class_easy_form.html#aef7c4ff0a903eb04e7af25a6baea3d35">01194</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#aef7c4ff0a903eb04e7af25a6baea3d35">_showForm</a>($formName, $target, $paramFields)
<a name="l01195"></a>01195     {
<a name="l01196"></a>01196        
<a name="l01197"></a>01197        $formName_org = $formName;
<a name="l01198"></a>01198         <span class="keywordflow">if</span> (!$this-&gt;m_DefaultFormName)
<a name="l01199"></a>01199               $this-&gt;m_DefaultFormName = $this-&gt;m_Name;
<a name="l01200"></a>01200        <span class="keywordflow">if</span> ($formName == null)
<a name="l01201"></a>01201        {
<a name="l01202"></a>01202               <span class="keywordflow">if</span>($this-&gt;m_ReferenceFormName == null)
<a name="l01203"></a>01203               {
<a name="l01204"></a>01204                      $formName = $this-&gt;m_DefaultFormName;
<a name="l01205"></a>01205               }<span class="keywordflow">else</span>{
<a name="l01206"></a>01206                      <span class="keywordflow">if</span>($formName = $this-&gt;m_ReferenceFormName){
<a name="l01207"></a>01207                             <span class="comment">//this judgement is for anti endless loop between swtich forms</span>
<a name="l01208"></a>01208                             $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($this-&gt;m_ReferenceFormName);
<a name="l01209"></a>01209                             <span class="keywordflow">if</span>($formObj-&gt;m_ReferenceFormName == $this-&gt;m_Name){                                 
<a name="l01210"></a>01210                                    $formName = $this-&gt;m_DefaultFormName;
<a name="l01211"></a>01211                             }<span class="keywordflow">else</span>{                             
<a name="l01212"></a>01212                                    $formName = $this-&gt;m_ReferenceFormName;
<a name="l01213"></a>01213                             }
<a name="l01214"></a>01214                      }
<a name="l01215"></a>01215               }
<a name="l01216"></a>01216        }
<a name="l01217"></a>01217        <span class="comment">//if($this-&gt;getViewObject()-&gt;isInFormRefLibs($formName))</span>
<a name="l01218"></a>01218         {
<a name="l01219"></a>01219             <span class="comment">// get the form object</span>
<a name="l01220"></a>01220             <span class="comment">/* @var $formObj EasyForm */</span>
<a name="l01221"></a>01221             $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($formName);
<a name="l01222"></a>01222             $formObj-&gt;m_DefaultFormName = $this-&gt;m_DefaultFormName;
<a name="l01223"></a>01223             <span class="keywordflow">if</span>($formName_org){
<a name="l01224"></a>01224               <span class="comment">//RefenerenceForm records where the from switch from</span>
<a name="l01225"></a>01225                      <span class="keywordflow">if</span>( $this-&gt;m_FormType!=<span class="stringliteral">&#39;EDIT&#39;</span> &amp;&amp;
<a name="l01226"></a>01226                             $this-&gt;m_FormType!=<span class="stringliteral">&#39;NEW&#39;</span> &amp;&amp;
<a name="l01227"></a>01227                             $this-&gt;m_FormType!=<span class="stringliteral">&#39;COPY&#39;</span> ){
<a name="l01228"></a>01228                      $formObj-&gt;m_ReferenceFormName = $this-&gt;m_Name;
<a name="l01229"></a>01229                      } 
<a name="l01230"></a>01230             }
<a name="l01231"></a>01231             
<a name="l01232"></a>01232             <span class="comment">//if has more than Id field as params then $clearFixSearchRule is false, means join all where rules</span>
<a name="l01233"></a>01233             $paramTemp = $paramFields;           
<a name="l01234"></a>01234             unset($paramTemp[<span class="stringliteral">&#39;Id&#39;</span>]);
<a name="l01235"></a>01235             <span class="keywordflow">if</span>(count($paramTemp)){
<a name="l01236"></a>01236               $clearFixSearchRule = <span class="keyword">false</span>;
<a name="l01237"></a>01237             }<span class="keywordflow">else</span>{
<a name="l01238"></a>01238               $clearFixSearchRule = <span class="keyword">true</span>;
<a name="l01239"></a>01239             }
<a name="l01240"></a>01240             <span class="keywordflow">foreach</span>($paramFields as $fieldName=&gt;$val){                
<a name="l01241"></a>01241               $formObj-&gt;m_FormParams[$fieldName] = $val;
<a name="l01242"></a>01242                 $formObj-&gt;setFixSearchRule(<span class="stringliteral">&quot;[$fieldName]=&#39;$val&#39;&quot;</span>,$clearFixSearchRule);                
<a name="l01243"></a>01243                 <span class="keywordflow">if</span>($fieldName==<span class="stringliteral">&quot;Id&quot;</span>){
<a name="l01244"></a>01244                      $formObj-&gt;setRecordId($val);
<a name="l01245"></a>01245                 }
<a name="l01246"></a>01246             }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248             <span class="keywordflow">if</span>(!$formObj-&gt;canDisplayForm())
<a name="l01249"></a>01249             {
<a name="l01250"></a>01250               $formObj-&gt;m_ErrorMessage = $this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;FORM_OPERATION_NOT_PERMITTED&quot;</span>,$formObj-&gt;m_Name);
<a name="l01251"></a>01251          
<a name="l01252"></a>01252                      <span class="keywordflow">if</span> (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;LIST&quot;</span>){
<a name="l01253"></a>01253                             <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_ERR, <span class="stringliteral">&quot;DATAOBJ&quot;</span>, <span class="stringliteral">&quot;DataObj error = &quot;</span>.$errorMsg);
<a name="l01254"></a>01254                             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showClientAlert($formObj-&gt;m_ErrorMessage);
<a name="l01255"></a>01255                      }<span class="keywordflow">else</span>{
<a name="l01256"></a>01256                             $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>(array($formObj-&gt;m_ErrorMessage));   
<a name="l01257"></a>01257                      }
<a name="l01258"></a>01258                    
<a name="l01259"></a>01259                    <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01260"></a>01260             }           
<a name="l01261"></a>01261              
<a name="l01262"></a>01262             <span class="keywordflow">switch</span> ($target)
<a name="l01263"></a>01263             {
<a name="l01264"></a>01264                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;Popup&quot;</span>:
<a name="l01265"></a>01265                     $formObj-&gt;m_ParentFormName = $this-&gt;m_Name;
<a name="l01266"></a>01266                     echo $formObj-&gt;render();
<a name="l01267"></a>01267                     <span class="keywordflow">break</span>;
<a name="l01268"></a>01268                 <span class="keywordflow">case</span> <span class="stringliteral">&quot;Dialog&quot;</span>:
<a name="l01269"></a>01269                     $formObj-&gt;m_ParentFormName = $this-&gt;m_Name;
<a name="l01270"></a>01270                     <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;redrawForm(<span class="stringliteral">&quot;DIALOG&quot;</span>, $formObj-&gt;render());
<a name="l01271"></a>01271                     <span class="keywordflow">break</span>;
<a name="l01272"></a>01272                 <span class="keywordflow">default</span>:
<a name="l01273"></a>01273                     <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;redrawForm($this-&gt;m_Name, $formObj-&gt;render());
<a name="l01274"></a>01274             }
<a name="l01275"></a>01275         }
<a name="l01276"></a>01276     }
<a name="l01277"></a>01277 
<a name="l01285"></a><a class="code" href="class_easy_form.html#abaacec03117854cd7fcc2540295768e8">01285</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#abaacec03117854cd7fcc2540295768e8">deleteRecord</a>($id=null)
<a name="l01286"></a>01286     {
<a name="l01287"></a>01287         <span class="keywordflow">if</span> ($id==null || $id==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01288"></a>01288             $id = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290         $selIds = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;row_selections&#39;</span>, <span class="keyword">false</span>);
<a name="l01291"></a>01291         <span class="keywordflow">if</span> ($selIds == null)
<a name="l01292"></a>01292             $selIds[] = $id;
<a name="l01293"></a>01293         <span class="keywordflow">foreach</span> ($selIds as $id)
<a name="l01294"></a>01294         {            
<a name="l01295"></a>01295             $dataRec = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;fetchById($id);
<a name="l01296"></a>01296             $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;setActiveRecord($dataRec);
<a name="l01297"></a>01297             
<a name="l01298"></a>01298             <span class="keywordflow">if</span>(!$this-&gt;canDeleteRecord($dataRec))
<a name="l01299"></a>01299             {
<a name="l01300"></a>01300               $this-&gt;m_ErrorMessage = $this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;FORM_OPERATION_NOT_PERMITTED&quot;</span>,$this-&gt;m_Name);         
<a name="l01301"></a>01301                      <span class="keywordflow">if</span> (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;LIST&quot;</span>){
<a name="l01302"></a>01302                             <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_ERR, <span class="stringliteral">&quot;DATAOBJ&quot;</span>, <span class="stringliteral">&quot;DataObj error = &quot;</span>.$errorMsg);
<a name="l01303"></a>01303                             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showClientAlert($this-&gt;m_ErrorMessage);
<a name="l01304"></a>01304                      }<span class="keywordflow">else</span>{
<a name="l01305"></a>01305                             $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>(array($this-&gt;m_ErrorMessage));      
<a name="l01306"></a>01306                      }      
<a name="l01307"></a>01307                      <span class="keywordflow">return</span>;
<a name="l01308"></a>01308             }
<a name="l01309"></a>01309             
<a name="l01310"></a>01310             <span class="comment">// take care of exception</span>
<a name="l01311"></a>01311             <span class="keywordflow">try</span>
<a name="l01312"></a>01312             {
<a name="l01313"></a>01313                 $dataRec-&gt;delete();
<a name="l01314"></a>01314             } <span class="keywordflow">catch</span> (<a class="code" href="class_b_d_o_exception.html">BDOException</a> $e)
<a name="l01315"></a>01315             {
<a name="l01316"></a>01316                 <span class="comment">// call $this-&gt;processBDOException($e);</span>
<a name="l01317"></a>01317                 $this-&gt;<a class="code" href="class_easy_form.html#af9731432265713729727ea8a96d73842">processBDOException</a>($e);
<a name="l01318"></a>01318                 <span class="keywordflow">return</span>;
<a name="l01319"></a>01319             }
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <span class="keywordflow">if</span> (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;LIST&quot;</span>)
<a name="l01322"></a>01322             $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01325"></a>01325         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 
<a name="l01333"></a><a class="code" href="class_easy_form.html#a5eca79a16a171c80aea4860c2e8fbe84">01333</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a5eca79a16a171c80aea4860c2e8fbe84">removeRecord</a> ()
<a name="l01334"></a>01334     {
<a name="l01335"></a>01335        <span class="keywordflow">if</span> ($id==null || $id==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01336"></a>01336             $id = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338         $selIds = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;row_selections&#39;</span>, <span class="keyword">false</span>);
<a name="l01339"></a>01339         <span class="keywordflow">if</span> ($selIds == null)
<a name="l01340"></a>01340             $selIds[] = $id;
<a name="l01341"></a>01341         <span class="keywordflow">foreach</span> ($selIds as $id)
<a name="l01342"></a>01342         { 
<a name="l01343"></a>01343               
<a name="l01344"></a>01344               $rec = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;fetchById($id);
<a name="l01345"></a>01345                $ok = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;removeRecord($rec, $bPrtObjUpdated);
<a name="l01346"></a>01346                <span class="keywordflow">if</span> (! $ok)
<a name="l01347"></a>01347                    <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_easy_form.html#a0727e1b8b77e4daf5347a2d43149bff2">processDataObjError</a>($ok);
<a name="l01348"></a>01348         }        
<a name="l01349"></a>01349 
<a name="l01350"></a>01350         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01351"></a>01351         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01352"></a>01352               <span class="keywordflow">if</span>($this-&gt;m_ParentFormName)
<a name="l01353"></a>01353               {
<a name="l01354"></a>01354                      $this-&gt;<a class="code" href="class_easy_form.html#a20e3df73edd7359bec20a8862ceb3d33">renderParent</a>();
<a name="l01355"></a>01355               }
<a name="l01356"></a>01356      }
<a name="l01357"></a>01357 
<a name="l01365"></a><a class="code" href="class_easy_form.html#a6f41933d34404dcdd82eb7f376e99e50">01365</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a6f41933d34404dcdd82eb7f376e99e50">selectRecord</a>($recId)
<a name="l01366"></a>01366     {
<a name="l01367"></a>01367         <span class="keywordflow">if</span> ($recId==null || $recId==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01368"></a>01368             $recId = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l01369"></a>01369         $this-&gt;m_RecordId = $recId;
<a name="l01370"></a>01370         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()){
<a name="l01371"></a>01371               $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;setActiveRecordId($this-&gt;m_RecordId);
<a name="l01372"></a>01372         }
<a name="l01373"></a>01373         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>(<span class="keyword">false</span>); <span class="comment">// not redraw the this form, but draw the subforms</span>
<a name="l01374"></a>01374         <span class="comment">//$this-&gt;rerender(); </span>
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376 
<a name="l01382"></a><a class="code" href="class_easy_form.html#a4367099c21173a8a3f5dff165cff6c7a">01382</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a4367099c21173a8a3f5dff165cff6c7a">getElementID</a>()
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384         $id = $this-&gt;m_DataPanel-&gt;getByField(<span class="stringliteral">&#39;Id&#39;</span>)-&gt;getValue();
<a name="l01385"></a>01385         <span class="keywordflow">if</span>($id)
<a name="l01386"></a>01386         {
<a name="l01387"></a>01387             <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)$id;
<a name="l01388"></a>01388         }
<a name="l01389"></a>01389         <span class="keywordflow">else</span>
<a name="l01390"></a>01390         {
<a name="l01391"></a>01391             <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)$this-&gt;m_RecordId;
<a name="l01392"></a>01392         }
<a name="l01393"></a>01393     }
<a name="l01394"></a>01394 
<a name="l01402"></a><a class="code" href="class_easy_form.html#aae5ece995d0eadd7585a080c1952fb83">01402</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#aae5ece995d0eadd7585a080c1952fb83">saveRecord</a>()
<a name="l01403"></a>01403     {
<a name="l01404"></a>01404         <span class="keywordflow">if</span> (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&quot;NEW&quot;</span>)
<a name="l01405"></a>01405         {
<a name="l01406"></a>01406             $this-&gt;<a class="code" href="class_easy_form.html#a3510e359acc3518312436d50f9cbde51">insertRecord</a>();
<a name="l01407"></a>01407         }
<a name="l01408"></a>01408         <span class="keywordflow">else</span>
<a name="l01409"></a>01409         {
<a name="l01410"></a>01410             $this-&gt;<a class="code" href="class_easy_form.html#ae5ce2b9e429c3f400d1a9b74c78b48f1">updateRecord</a>();
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412     }
<a name="l01413"></a>01413 
<a name="l01419"></a><a class="code" href="class_easy_form.html#ae5ce2b9e429c3f400d1a9b74c78b48f1">01419</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ae5ce2b9e429c3f400d1a9b74c78b48f1">updateRecord</a>()
<a name="l01420"></a>01420     {
<a name="l01421"></a>01421         $currentRec = $this-&gt;<a class="code" href="class_easy_form.html#a38ac74df0eb521f827ed815c2bbde0b1">fetchData</a>();
<a name="l01422"></a>01422         $recArr = $this-&gt;<a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>();
<a name="l01423"></a>01423         $this-&gt;<a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">setActiveRecord</a>($recArr);
<a name="l01424"></a>01424         <span class="keywordflow">if</span> (count($recArr) != 0){
<a name="l01425"></a>01425               
<a name="l01426"></a>01426                <span class="keywordflow">try</span>
<a name="l01427"></a>01427                {
<a name="l01428"></a>01428                    $this-&gt;ValidateForm();
<a name="l01429"></a>01429                }
<a name="l01430"></a>01430                <span class="keywordflow">catch</span> (<a class="code" href="class_validation_exception.html">ValidationException</a> $e)
<a name="l01431"></a>01431                {
<a name="l01432"></a>01432                    $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>($e-&gt;m_Errors);
<a name="l01433"></a>01433                    <span class="keywordflow">return</span>;
<a name="l01434"></a>01434                }
<a name="l01435"></a>01435        
<a name="l01436"></a>01436                <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_easy_form.html#a22a8409a820a88e424d9fc9a71a5932a">_doUpdate</a>($recArr, $currentRec) == <span class="keyword">false</span>)
<a name="l01437"></a>01437                    <span class="keywordflow">return</span>;
<a name="l01438"></a>01438         
<a name="l01439"></a>01439         }
<a name="l01440"></a>01440         <span class="comment">// in case of popup form, close it, then rerender the parent form</span>
<a name="l01441"></a>01441         <span class="keywordflow">if</span> ($this-&gt;m_ParentFormName)
<a name="l01442"></a>01442         {
<a name="l01443"></a>01443             $this-&gt;<a class="code" href="class_easy_form.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">close</a>();
<a name="l01444"></a>01444 
<a name="l01445"></a>01445             $this-&gt;<a class="code" href="class_easy_form.html#a20e3df73edd7359bec20a8862ceb3d33">renderParent</a>();
<a name="l01446"></a>01446         }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448         
<a name="l01449"></a>01449         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     
<a name="l01454"></a>01454        <span class="keyword">public</span> function updateFieldValueAdd($id,$fld_name,$value,$min,$max)
<a name="l01455"></a>01455     {         
<a name="l01456"></a>01456        <span class="keywordflow">if</span>($value&gt;=$max){
<a name="l01457"></a>01457               $value = $min;
<a name="l01458"></a>01458        }<span class="keywordflow">else</span>{
<a name="l01459"></a>01459               $value++;
<a name="l01460"></a>01460        }
<a name="l01461"></a>01461               <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_easy_form.html#a386c5a3fcb3daea95ab0e98a4cafd8bf">updateFieldValue</a>($id,$fld_name,$value);
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     }        
<a name="l01464"></a>01464     
<a name="l01465"></a>01465        <span class="keyword">public</span> function updateFieldValueXor($id,$fld_name,$value)
<a name="l01466"></a>01466     {         
<a name="l01467"></a>01467        <span class="keywordflow">if</span>($value&gt;0){
<a name="l01468"></a>01468               $value_xor = 0;
<a name="l01469"></a>01469        }<span class="keywordflow">else</span>{
<a name="l01470"></a>01470               $value_xor = 1;
<a name="l01471"></a>01471        }
<a name="l01472"></a>01472               <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_easy_form.html#a386c5a3fcb3daea95ab0e98a4cafd8bf">updateFieldValue</a>($id,$fld_name,$value_xor);
<a name="l01473"></a>01473 
<a name="l01474"></a>01474     }    
<a name="l01475"></a>01475     
<a name="l01481"></a><a class="code" href="class_easy_form.html#a386c5a3fcb3daea95ab0e98a4cafd8bf">01481</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a386c5a3fcb3daea95ab0e98a4cafd8bf">updateFieldValue</a>($Id,$fld_name,$value)
<a name="l01482"></a>01482     {
<a name="l01483"></a>01483        
<a name="l01484"></a>01484               $element = $this-&gt;m_DataPanel-&gt;get($fld_name);
<a name="l01485"></a>01485               $fieldname = $element-&gt;m_FieldName;
<a name="l01486"></a>01486         $currentRec = $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($Id);
<a name="l01487"></a>01487         $recArr = $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($Id);
<a name="l01488"></a>01488               $recArr[$fieldname]=$value;
<a name="l01489"></a>01489         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_easy_form.html#a22a8409a820a88e424d9fc9a71a5932a">_doUpdate</a>($recArr, $currentRec) == <span class="keyword">false</span>)
<a name="l01490"></a>01490             <span class="keywordflow">return</span>;
<a name="l01491"></a>01491               $this-&gt;UpdateForm();
<a name="l01492"></a>01492     }
<a name="l01500"></a><a class="code" href="class_easy_form.html#a22a8409a820a88e424d9fc9a71a5932a">01500</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a22a8409a820a88e424d9fc9a71a5932a">_doUpdate</a>($inputRecord, $currentRecord)
<a name="l01501"></a>01501     {
<a name="l01502"></a>01502 
<a name="l01503"></a>01503 
<a name="l01504"></a>01504         $dataRec = <span class="keyword">new</span> <a class="code" href="class_data_record.html">DataRecord</a>($currentRecord, $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>());
<a name="l01505"></a>01505 
<a name="l01506"></a>01506         <span class="keywordflow">foreach</span> ($inputRecord as $k =&gt; $v){
<a name="l01507"></a>01507               $dataRec[$k] = $v; <span class="comment">// or $dataRec-&gt;$k = $v;</span>
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509 
<a name="l01510"></a>01510         <span class="keywordflow">try</span>
<a name="l01511"></a>01511         {
<a name="l01512"></a>01512             $dataRec-&gt;save();
<a name="l01513"></a>01513         }
<a name="l01514"></a>01514         <span class="keywordflow">catch</span> (<a class="code" href="class_validation_exception.html">ValidationException</a> $e)
<a name="l01515"></a>01515         {
<a name="l01516"></a>01516             $errElements = $this-&gt;<a class="code" href="class_easy_form.html#a664369c26fc251927f4f5ac54a908944">getErrorElements</a>($e-&gt;m_Errors);           
<a name="l01517"></a>01517               <span class="keywordflow">if</span>(count($e-&gt;m_Errors)==count($errElements)){
<a name="l01518"></a>01518               $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>($errElements);
<a name="l01519"></a>01519             }<span class="keywordflow">else</span>{                 
<a name="l01520"></a>01520               $errmsg = implode(<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>,$e-&gt;m_Errors);
<a name="l01521"></a>01521                       <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showErrorMessage($errmsg);
<a name="l01522"></a>01522             }
<a name="l01523"></a>01523             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01524"></a>01524         }
<a name="l01525"></a>01525         <span class="keywordflow">catch</span> (<a class="code" href="class_b_d_o_exception.html">BDOException</a> $e)
<a name="l01526"></a>01526         {
<a name="l01527"></a>01527             $this-&gt;<a class="code" href="class_easy_form.html#af9731432265713729727ea8a96d73842">processBDOException</a>($e);
<a name="l01528"></a>01528             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01529"></a>01529         }
<a name="l01530"></a>01530               $this-&gt;m_ActiveRecord = null;
<a name="l01531"></a>01531         $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($dataRec[<span class="stringliteral">&quot;Id&quot;</span>]);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01534"></a>01534         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536 
<a name="l01542"></a><a class="code" href="class_easy_form.html#a3510e359acc3518312436d50f9cbde51">01542</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a3510e359acc3518312436d50f9cbde51">insertRecord</a>()
<a name="l01543"></a>01543     {
<a name="l01544"></a>01544         $recArr = $this-&gt;<a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>();
<a name="l01545"></a>01545         $this-&gt;<a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">setActiveRecord</a>($recArr);
<a name="l01546"></a>01546         <span class="keywordflow">if</span> (count($recArr) == 0)
<a name="l01547"></a>01547             <span class="keywordflow">return</span>;
<a name="l01548"></a>01548 
<a name="l01549"></a>01549         <span class="keywordflow">try</span>
<a name="l01550"></a>01550         {
<a name="l01551"></a>01551             $this-&gt;ValidateForm();
<a name="l01552"></a>01552         }
<a name="l01553"></a>01553         <span class="keywordflow">catch</span> (<a class="code" href="class_validation_exception.html">ValidationException</a> $e)
<a name="l01554"></a>01554         {
<a name="l01555"></a>01555             $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>($e-&gt;m_Errors);
<a name="l01556"></a>01556             <span class="keywordflow">return</span>;
<a name="l01557"></a>01557         }
<a name="l01558"></a>01558 
<a name="l01559"></a>01559         $this-&gt;<a class="code" href="class_easy_form.html#a613a31d4e8c9693801fa4ae1ba0644b6">_doInsert</a>($recArr);
<a name="l01560"></a>01560         
<a name="l01561"></a>01561         
<a name="l01562"></a>01562 
<a name="l01563"></a>01563         <span class="comment">// in case of popup form, close it, then rerender the parent form</span>
<a name="l01564"></a>01564         <span class="keywordflow">if</span> ($this-&gt;m_ParentFormName)
<a name="l01565"></a>01565         {
<a name="l01566"></a>01566             $this-&gt;<a class="code" href="class_easy_form.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">close</a>();
<a name="l01567"></a>01567 
<a name="l01568"></a>01568             $this-&gt;<a class="code" href="class_easy_form.html#a20e3df73edd7359bec20a8862ceb3d33">renderParent</a>();
<a name="l01569"></a>01569         }
<a name="l01570"></a>01570 
<a name="l01571"></a>01571         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01572"></a>01572     }
<a name="l01573"></a>01573 
<a name="l01580"></a><a class="code" href="class_easy_form.html#a613a31d4e8c9693801fa4ae1ba0644b6">01580</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a613a31d4e8c9693801fa4ae1ba0644b6">_doInsert</a>($inputRecord)
<a name="l01581"></a>01581     {
<a name="l01582"></a>01582        
<a name="l01583"></a>01583         $dataRec = <span class="keyword">new</span> <a class="code" href="class_data_record.html">DataRecord</a>(null, $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>());
<a name="l01584"></a>01584 
<a name="l01585"></a>01585         <span class="comment">// $inputRecord[&#39;Id&#39;] = null; // comment it out for name PK case </span>
<a name="l01586"></a>01586         <span class="keywordflow">foreach</span> ($inputRecord as $k =&gt; $v)
<a name="l01587"></a>01587             $dataRec[$k] = $v; <span class="comment">// or $dataRec-&gt;$k = $v;</span>
<a name="l01588"></a>01588 
<a name="l01589"></a>01589         <span class="keywordflow">try</span>
<a name="l01590"></a>01590         {
<a name="l01591"></a>01591            $dataRec-&gt;save();
<a name="l01592"></a>01592         }
<a name="l01593"></a>01593         <span class="keywordflow">catch</span> (<a class="code" href="class_validation_exception.html">ValidationException</a> $e)
<a name="l01594"></a>01594         {
<a name="l01595"></a>01595             $errElements = $this-&gt;<a class="code" href="class_easy_form.html#a664369c26fc251927f4f5ac54a908944">getErrorElements</a>($e-&gt;m_Errors);
<a name="l01596"></a>01596             <span class="keywordflow">if</span>(count($e-&gt;m_Errors)==count($errElements)){
<a name="l01597"></a>01597               $this-&gt;<a class="code" href="class_easy_form.html#a44d87432a7016815c9a8bdc468b4c74e">processFormObjError</a>($errElements);
<a name="l01598"></a>01598             }<span class="keywordflow">else</span>{                 
<a name="l01599"></a>01599               $errmsg = implode(<span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>,$e-&gt;m_Errors);
<a name="l01600"></a>01600                       <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;showErrorMessage($errmsg);
<a name="l01601"></a>01601             }
<a name="l01602"></a>01602             <span class="keywordflow">return</span>;
<a name="l01603"></a>01603         }
<a name="l01604"></a>01604         <span class="keywordflow">catch</span> (<a class="code" href="class_b_d_o_exception.html">BDOException</a> $e)
<a name="l01605"></a>01605         {
<a name="l01606"></a>01606             $this-&gt;<a class="code" href="class_easy_form.html#af9731432265713729727ea8a96d73842">processBDOException</a>($e);
<a name="l01607"></a>01607             <span class="keywordflow">return</span>;
<a name="l01608"></a>01608         }
<a name="l01609"></a>01609               $this-&gt;m_ActiveRecord = null;
<a name="l01610"></a>01610         $this-&gt;<a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($dataRec[<span class="stringliteral">&quot;Id&quot;</span>]);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         $this-&gt;<a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>();
<a name="l01613"></a>01613         <span class="keywordflow">return</span> $dataRec[<span class="stringliteral">&quot;Id&quot;</span>];
<a name="l01614"></a>01614     }
<a name="l01615"></a>01615 
<a name="l01621"></a><a class="code" href="class_easy_form.html#a649b2b3005c687ae78c9d1d65e973493">01621</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a649b2b3005c687ae78c9d1d65e973493">cancel</a>()
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         $this-&gt;<a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>();
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625 
<a name="l01632"></a><a class="code" href="class_easy_form.html#a10bc86aec45f3e2b6737f7cff2cf0feb">01632</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a10bc86aec45f3e2b6737f7cff2cf0feb">updateForm</a>()
<a name="l01633"></a>01633     {
<a name="l01634"></a>01634         <span class="comment">// read the input to form controls</span>
<a name="l01635"></a>01635         <span class="comment">//@todo: read inputs but should be skipp uploaders elements</span>
<a name="l01636"></a>01636         $recArr = $this-&gt;<a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>();        
<a name="l01637"></a>01637         $this-&gt;<a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">setActiveRecord</a>($recArr);        
<a name="l01638"></a>01638         $this-&gt;<a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>();
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640 
<a name="l01649"></a><a class="code" href="class_easy_form.html#aa70e2874ac41e81f5f2fb1983b3007b1">01649</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#aa70e2874ac41e81f5f2fb1983b3007b1">autoSuggest</a>($input)
<a name="l01650"></a>01650     {
<a name="l01651"></a>01651        $foo = $_POST;
<a name="l01652"></a>01652        $hidden_flag = FALSE;
<a name="l01653"></a>01653         <span class="keywordflow">if</span> (strpos($input, <span class="stringliteral">&#39;_hidden&#39;</span>))
<a name="l01654"></a>01654         {
<a name="l01655"></a>01655             $realInput = str_replace(<span class="stringliteral">&#39;_hidden&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $input);
<a name="l01656"></a>01656                      $hidden_flag = TRUE;            
<a name="l01657"></a>01657         } <span class="keywordflow">else</span>
<a name="l01658"></a>01658         {
<a name="l01659"></a>01659             $realInput = $input;
<a name="l01660"></a>01660         }
<a name="l01661"></a>01661 
<a name="l01662"></a>01662         $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($input);
<a name="l01663"></a>01663 
<a name="l01664"></a>01664         <span class="comment">// get the select from list of the element</span>
<a name="l01665"></a>01665         $element = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($realInput);
<a name="l01666"></a>01666         $element-&gt;setValue($value);
<a name="l01667"></a>01667         $fromlist = array();
<a name="l01668"></a>01668         $element-&gt;getFromList($fromlist);
<a name="l01669"></a>01669         echo <span class="stringliteral">&quot;&lt;ul&gt;&quot;</span>;
<a name="l01670"></a>01670         <span class="keywordflow">if</span> ($fromlist)
<a name="l01671"></a>01671         {
<a name="l01672"></a>01672             <span class="keywordflow">if</span> ($hidden_flag = TRUE)
<a name="l01673"></a>01673             {
<a name="l01674"></a>01674               $count=0;
<a name="l01675"></a>01675                 <span class="keywordflow">foreach</span> ($fromlist as $item)
<a name="l01676"></a>01676                 {                  
<a name="l01677"></a>01677                     echo <span class="stringliteral">&quot;&lt;li id=&quot;</span> . $item[<span class="stringliteral">&#39;txt&#39;</span>] . <span class="stringliteral">&quot;&gt;&quot;</span> . $item[<span class="stringliteral">&#39;val&#39;</span>] . <span class="stringliteral">&quot;&lt;/li&gt;&quot;</span>;
<a name="l01678"></a>01678                     $count++;
<a name="l01679"></a>01679                     <span class="keywordflow">if</span>($count&gt;=5) <span class="keywordflow">break</span>;
<a name="l01680"></a>01680                 }
<a name="l01681"></a>01681             }
<a name="l01682"></a>01682             <span class="keywordflow">else</span>
<a name="l01683"></a>01683             {
<a name="l01684"></a>01684               $count=0;
<a name="l01685"></a>01685                 <span class="keywordflow">foreach</span> ($fromlist as $item)
<a name="l01686"></a>01686                 {
<a name="l01687"></a>01687                     echo <span class="stringliteral">&quot;&lt;li&gt;&quot;</span> . $item[<span class="stringliteral">&#39;txt&#39;</span>] . <span class="stringliteral">&quot;&lt;/li&gt;&quot;</span>;
<a name="l01688"></a>01688                     $count++;
<a name="l01689"></a>01689                     <span class="keywordflow">if</span>($count&gt;=5) <span class="keywordflow">break</span>;
<a name="l01690"></a>01690                 }
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692         }
<a name="l01693"></a>01693         echo <span class="stringliteral">&quot;&lt;/ul&gt;&quot;</span>;
<a name="l01694"></a>01694     }
<a name="l01695"></a>01695 
<a name="l01703"></a><a class="code" href="class_easy_form.html#a9c69d48ee0b1af84d7d55331ee7f6bda">01703</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a9c69d48ee0b1af84d7d55331ee7f6bda">validateForm</a>($cleanError = <span class="keyword">true</span>)
<a name="l01704"></a>01704     {
<a name="l01705"></a>01705         <span class="keywordflow">if</span>($cleanError == <span class="keyword">true</span>)
<a name="l01706"></a>01706         {
<a name="l01707"></a>01707             $this-&gt;m_ValidateErrors = array();
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709         $this-&gt;m_DataPanel-&gt;rewind();
<a name="l01710"></a>01710         <span class="keywordflow">while</span>($this-&gt;m_DataPanel-&gt;valid())
<a name="l01711"></a>01711         {
<a name="l01712"></a>01712             <span class="comment">/* @var $element Element */</span>
<a name="l01713"></a>01713             $element = $this-&gt;m_DataPanel-&gt;current();
<a name="l01714"></a>01714             <span class="keywordflow">if</span>($element-&gt;m_Label)
<a name="l01715"></a>01715             {
<a name="l01716"></a>01716                 $elementName = $element-&gt;m_Label;
<a name="l01717"></a>01717             }
<a name="l01718"></a>01718             <span class="keywordflow">else</span>
<a name="l01719"></a>01719             {
<a name="l01720"></a>01720                 $elementName = $element-&gt;m_Text;
<a name="l01721"></a>01721             }
<a name="l01722"></a>01722             <span class="keywordflow">if</span> ($element-&gt;checkRequired() === <span class="keyword">true</span> &amp;&amp;
<a name="l01723"></a>01723                     ($element-&gt;m_Value==null || $element-&gt;m_Value == <span class="stringliteral">&quot;&quot;</span>))
<a name="l01724"></a>01724             {
<a name="l01725"></a>01725                 $errorMessage = $this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;FORM_ELEMENT_REQUIRED&quot;</span>,array($elementName));
<a name="l01726"></a>01726                 $this-&gt;m_ValidateErrors[$element-&gt;m_Name] = $errorMessage;
<a name="l01727"></a>01727                 <span class="comment">//return false;</span>
<a name="l01728"></a>01728             }
<a name="l01729"></a>01729             elseif ($element-&gt;m_Value!==null &amp;&amp; $element-&gt;Validate() == <span class="keyword">false</span>)
<a name="l01730"></a>01730             {
<a name="l01731"></a>01731                 $validateService = <a class="code" href="class_biz_system.html#a6729150f2baee41fce746a2f21defd96">BizSystem::getService</a>(VALIDATE_SERVICE);
<a name="l01732"></a>01732                 $errorMessage = $this-&gt;<a class="code" href="class_easy_form.html#a52e9eb4fb51cfef13a1648efe1d0c3d3">getMessage</a>(<span class="stringliteral">&quot;FORM_ELEMENT_INVALID_INPUT&quot;</span>,array($elementName,$value,$element-&gt;m_Validator));                
<a name="l01733"></a>01733                 <span class="keywordflow">if</span> ($errorMessage == <span class="keyword">false</span>)
<a name="l01734"></a>01734                 { <span class="comment">//Couldn&#39;t get a clear error message so let&#39;s try this</span>
<a name="l01735"></a>01735                     $errorMessage = $validateService-&gt;getErrorMessage($element-&gt;m_Validator, $elementName);
<a name="l01736"></a>01736                 }
<a name="l01737"></a>01737                 $this-&gt;m_ValidateErrors[$element-&gt;m_Name] = $errorMessage;
<a name="l01738"></a>01738                 <span class="comment">//return false;</span>
<a name="l01739"></a>01739             }
<a name="l01740"></a>01740             $this-&gt;m_DataPanel-&gt;next() ;
<a name="l01741"></a>01741         }
<a name="l01742"></a>01742         <span class="keywordflow">if</span> (count($this-&gt;m_ValidateErrors) &gt; 0)
<a name="l01743"></a>01743         {
<a name="l01744"></a>01744             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_validation_exception.html">ValidationException</a>($this-&gt;m_ValidateErrors);
<a name="l01745"></a>01745             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01746"></a>01746         }
<a name="l01747"></a>01747         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749     
<a name="l01755"></a><a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">01755</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#aa1cca28cf3008654e803cee1d0381efc">readInputRecord</a>()
<a name="l01756"></a>01756     {
<a name="l01757"></a>01757         $recArr = array();
<a name="l01758"></a>01758         <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $element)
<a name="l01759"></a>01759         {
<a name="l01760"></a>01760             $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($element-&gt;m_Name);
<a name="l01761"></a>01761             <span class="keywordflow">if</span> ($value ===null &amp;&amp; (
<a name="l01762"></a>01762                  !is_a($element,<span class="stringliteral">&quot;FileUploader&quot;</span>)
<a name="l01763"></a>01763               &amp;&amp; !is_a($element,<span class="stringliteral">&quot;FormElement&quot;</span>)
<a name="l01764"></a>01764               &amp;&amp; !is_subclass_of($element,<span class="stringliteral">&quot;FileUploader&quot;</span>)
<a name="l01765"></a>01765               &amp;&amp; !is_a($element,<span class="stringliteral">&quot;Checkbox&quot;</span>)             
<a name="l01766"></a>01766               )){           
<a name="l01767"></a>01767               <span class="keywordflow">continue</span>;
<a name="l01768"></a>01768             }
<a name="l01769"></a>01769             $element-&gt;setValue($value);
<a name="l01770"></a>01770             $this-&gt;m_FormInputs[$element-&gt;m_Name] = $value;
<a name="l01771"></a>01771             $value = $element-&gt;getValue();
<a name="l01772"></a>01772             <span class="keywordflow">if</span> ( $element-&gt;m_FieldName)
<a name="l01773"></a>01773                 $recArr[$element-&gt;m_FieldName] = $value;
<a name="l01774"></a>01774         }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776         <span class="keywordflow">foreach</span> ($this-&gt;m_SearchPanel as $element)
<a name="l01777"></a>01777         {
<a name="l01778"></a>01778             $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($element-&gt;m_Name);
<a name="l01779"></a>01779             $element-&gt;setValue($value);
<a name="l01780"></a>01780             $this-&gt;m_FormInputs[$element-&gt;m_Name] = $value;
<a name="l01781"></a>01781             $value = $element-&gt;getValue();
<a name="l01782"></a>01782             <span class="keywordflow">if</span> ($value !== null &amp;&amp; $element-&gt;m_FieldName)
<a name="l01783"></a>01783                 $recArr[$element-&gt;m_FieldName] = $value;
<a name="l01784"></a>01784         }
<a name="l01785"></a>01785         <span class="keywordflow">return</span> $recArr;
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01793"></a><a class="code" href="class_easy_form.html#afc37b7f5977f29a39897eaa6238ae940">01793</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#afc37b7f5977f29a39897eaa6238ae940">readInputs</a>()
<a name="l01794"></a>01794     {
<a name="l01795"></a>01795         $inputArr = array();
<a name="l01796"></a>01796         <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $element)
<a name="l01797"></a>01797         {
<a name="l01798"></a>01798             $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($element-&gt;m_Name);
<a name="l01799"></a>01799             $element-&gt;setValue($value);
<a name="l01800"></a>01800             $inputArr[$element-&gt;m_Name] = $value;
<a name="l01801"></a>01801         }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803         <span class="keywordflow">foreach</span> ($this-&gt;m_SearchPanel as $element)
<a name="l01804"></a>01804         {
<a name="l01805"></a>01805             $value = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs($element-&gt;m_Name);
<a name="l01806"></a>01806             $element-&gt;setValue($value);
<a name="l01807"></a>01807             $inputArr[$element-&gt;m_Name] = $value;
<a name="l01808"></a>01808         }
<a name="l01809"></a>01809         <span class="keywordflow">return</span> $inputArr;
<a name="l01810"></a>01810     }
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     <span class="keyword">public</span> function setFormInputs($inputArr=null)
<a name="l01814"></a>01814     {
<a name="l01815"></a>01815         <span class="keywordflow">if</span>(!$inputArr){
<a name="l01816"></a>01816               $inputArr = $this-&gt;m_FormInputs;
<a name="l01817"></a>01817         } 
<a name="l01818"></a>01818        <span class="keywordflow">if</span>(!is_array($inputArr)){
<a name="l01819"></a>01819               $inputArr = array();
<a name="l01820"></a>01820         }        
<a name="l01821"></a>01821         <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $element)
<a name="l01822"></a>01822         {
<a name="l01823"></a>01823             <span class="keywordflow">if</span> (isset($inputArr[$element-&gt;m_Name]))
<a name="l01824"></a>01824             {             
<a name="l01825"></a>01825               $element-&gt;setValue($inputArr[$element-&gt;m_Name]);                          
<a name="l01826"></a>01826             }
<a name="l01827"></a>01827         }
<a name="l01828"></a>01828 
<a name="l01829"></a>01829         <span class="keywordflow">foreach</span> ($this-&gt;m_SearchPanel as $element)
<a name="l01830"></a>01830         {
<a name="l01831"></a>01831             <span class="keywordflow">if</span> (isset($inputArr[$element-&gt;m_Name]))
<a name="l01832"></a>01832             {
<a name="l01833"></a>01833               $element-&gt;setValue($inputArr[$element-&gt;m_Name]);
<a name="l01834"></a>01834             }
<a name="l01835"></a>01835         }
<a name="l01836"></a>01836         <span class="keywordflow">return</span> $inputArr;
<a name="l01837"></a>01837     }    
<a name="l01838"></a>01838 
<a name="l01844"></a><a class="code" href="class_easy_form.html#a95a880b9f639a7184f5319e9d15b588a">01844</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a95a880b9f639a7184f5319e9d15b588a">getNewRecord</a>()
<a name="l01845"></a>01845     {
<a name="l01846"></a>01846         $recArr = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;newRecord();
<a name="l01847"></a>01847         <span class="keywordflow">if</span> (! $recArr)
<a name="l01848"></a>01848             <span class="keywordflow">return</span> null;
<a name="l01849"></a>01849         <span class="comment">// load default values if new record value is empty</span>
<a name="l01850"></a>01850         $defaultRecArr = array();
<a name="l01851"></a>01851         <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $element)
<a name="l01852"></a>01852         {
<a name="l01853"></a>01853             <span class="keywordflow">if</span> ($element-&gt;m_FieldName)
<a name="l01854"></a>01854             {
<a name="l01855"></a>01855                 $defaultRecArr[$element-&gt;m_FieldName] = $element-&gt;getDefaultValue();
<a name="l01856"></a>01856             }
<a name="l01857"></a>01857         }
<a name="l01858"></a>01858         <span class="keywordflow">foreach</span> ($recArr as $field =&gt; $val)
<a name="l01859"></a>01859         {
<a name="l01860"></a>01860             <span class="keywordflow">if</span> ($val == <span class="stringliteral">&quot;&quot;</span> &amp;&amp; $defaultRecArr[$field] != <span class="stringliteral">&quot;&quot;</span>)
<a name="l01861"></a>01861             {
<a name="l01862"></a>01862                 $recArr[$field] = $defaultRecArr[$field];
<a name="l01863"></a>01863             }
<a name="l01864"></a>01864         }
<a name="l01865"></a>01865         <span class="keywordflow">return</span> $recArr;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867 
<a name="l01875"></a><a class="code" href="class_easy_form.html#afde88292c44dc59faf017738dae6dffb">01875</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#afde88292c44dc59faf017738dae6dffb">render</a>()
<a name="l01876"></a>01876     {
<a name="l01877"></a>01877         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_easy_form.html#a6ababfde848794c7d2cf1679caaf57d1">allowAccess</a>())
<a name="l01878"></a>01878             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01879"></a>01879         $this-&gt;<a class="code" href="class_easy_form.html#a543d4488b170c3e8c3283cae6650b12b">setClientScripts</a>();
<a name="l01880"></a>01880 
<a name="l01881"></a>01881         <span class="keywordflow">if</span>($this-&gt;m_CacheLifeTime&gt;0 &amp;&amp; $this-&gt;m_SubForms == null)
<a name="l01882"></a>01882         {
<a name="l01883"></a>01883             $cache_id = md5($this-&gt;m_Name);
<a name="l01884"></a>01884             <span class="comment">//try to process cache service.</span>
<a name="l01885"></a>01885             $cacheSvc = <a class="code" href="class_biz_system.html#a6729150f2baee41fce746a2f21defd96">BizSystem::getService</a>(CACHE_SERVICE,1);
<a name="l01886"></a>01886             $cacheSvc-&gt;init($this-&gt;m_Name,$this-&gt;m_CacheLifeTime);
<a name="l01887"></a>01887             <span class="keywordflow">if</span>($cacheSvc-&gt;test($cache_id))
<a name="l01888"></a>01888             {
<a name="l01889"></a>01889                 <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_DEBUG, <span class="stringliteral">&quot;FORM&quot;</span>, <span class="stringliteral">&quot;Cache Hit. form name = &quot;</span>.$this-&gt;m_Name);
<a name="l01890"></a>01890                 $output = $cacheSvc-&gt;load($cache_id);
<a name="l01891"></a>01891             }
<a name="l01892"></a>01892             <span class="keywordflow">else</span>
<a name="l01893"></a>01893             {
<a name="l01894"></a>01894                 <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_DEBUG, <span class="stringliteral">&quot;FORM&quot;</span>, <span class="stringliteral">&quot;Set cache. form name = &quot;</span>.$this-&gt;m_Name);
<a name="l01895"></a>01895                 $output = $this-&gt;<a class="code" href="class_easy_form.html#aa1008c36a9f8e921dc8cd0b5d462ff78">renderHTML</a>();
<a name="l01896"></a>01896                 $cacheSvc-&gt;save($output, $cache_id);
<a name="l01897"></a>01897             }
<a name="l01898"></a>01898             <span class="keywordflow">return</span> $output;
<a name="l01899"></a>01899         }
<a name="l01900"></a>01900 
<a name="l01901"></a>01901         <span class="comment">//Moved the renderHTML function infront of declaring subforms</span>
<a name="l01902"></a>01902         $renderedHTML = $this-&gt;<a class="code" href="class_easy_form.html#aa1008c36a9f8e921dc8cd0b5d462ff78">renderHTML</a>();
<a name="l01903"></a>01903 
<a name="l01904"></a>01904         <span class="comment">// prepare the subforms&#39; dataobjs, since the subform relates to parent form by dataobj association</span>
<a name="l01905"></a>01905         <span class="keywordflow">if</span> ($this-&gt;m_SubForms &amp;&amp; $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>())
<a name="l01906"></a>01906         {
<a name="l01907"></a>01907             <span class="keywordflow">foreach</span> ($this-&gt;m_SubForms as $subForm)
<a name="l01908"></a>01908             {
<a name="l01909"></a>01909                 $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($subForm);
<a name="l01910"></a>01910                 $dataObj = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;getRefObject($formObj-&gt;m_DataObjName);
<a name="l01911"></a>01911                 <span class="keywordflow">if</span> ($dataObj)
<a name="l01912"></a>01912                     $formObj-&gt;setDataObj($dataObj);
<a name="l01913"></a>01913             }
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915               <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_easy_form.html#a6ababfde848794c7d2cf1679caaf57d1">allowAccess</a>())
<a name="l01916"></a>01916               {
<a name="l01917"></a>01917            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01918"></a>01918               }
<a name="l01919"></a>01919         <span class="keywordflow">return</span> $renderedHTML;
<a name="l01920"></a>01920     }
<a name="l01921"></a>01921 
<a name="l01927"></a><a class="code" href="class_easy_form.html#ae60d42d564176f4afad66cb6d8a5431c">01927</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#ae60d42d564176f4afad66cb6d8a5431c">renderContextMenu</a> ()
<a name="l01928"></a>01928     {
<a name="l01929"></a>01929         $menuList = array();
<a name="l01930"></a>01930         <span class="keywordflow">foreach</span> ($this-&gt;m_Panels as $panel)
<a name="l01931"></a>01931         {
<a name="l01932"></a>01932             $panel-&gt;rewind();
<a name="l01933"></a>01933             <span class="keywordflow">while</span> ($element = $panel-&gt;current())
<a name="l01934"></a>01934             {
<a name="l01935"></a>01935                 $panel-&gt;next();
<a name="l01936"></a>01936                 <span class="keywordflow">if</span> (method_exists($element,<span class="stringliteral">&#39;getContextMenu&#39;</span>) &amp;&amp; $menus = $element-&gt;getContextMenu())
<a name="l01937"></a>01937                 {
<a name="l01938"></a>01938                     <span class="keywordflow">foreach</span> ($menus as $m)
<a name="l01939"></a>01939                         $menuList[] = $m;
<a name="l01940"></a>01940                 }
<a name="l01941"></a>01941             }
<a name="l01942"></a>01942         }
<a name="l01943"></a>01943         <span class="keywordflow">if</span> (count($menuList) == 0)
<a name="l01944"></a>01944             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01945"></a>01945         $str = <span class="stringliteral">&quot;&lt;div  class=&#39;contextMenu&#39; id=&#39;&quot;</span> . $this-&gt;m_Name . <span class="stringliteral">&quot;_contextmenu&#39;&gt;\n&quot;</span>;
<a name="l01946"></a>01946         $str .= <span class="stringliteral">&quot;&lt;div class=\&quot;contextMenu_header\&quot; &gt;&lt;/div&gt;\n&quot;</span>;
<a name="l01947"></a>01947         $str .= <span class="stringliteral">&quot;&lt;ul&gt;\n&quot;</span>;
<a name="l01948"></a>01948         <span class="keywordflow">foreach</span> ($menuList as $m)
<a name="l01949"></a>01949         {
<a name="l01950"></a>01950             $func = $m[<span class="stringliteral">&#39;func&#39;</span>];
<a name="l01951"></a>01951             $shortcutKey = isset($m[<span class="stringliteral">&#39;key&#39;</span>]) ? <span class="stringliteral">&quot; (&quot;</span>.$m[<span class="stringliteral">&#39;key&#39;</span>].<span class="stringliteral">&quot;)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l01952"></a>01952             $str .= <span class="stringliteral">&quot;&lt;li&gt;&lt;a href=\&quot;javascript:void(0)\&quot; onclick=\&quot;$func\&quot;&gt;&quot;</span>.$m[<span class="stringliteral">&#39;text&#39;</span>].$shortcutKey.<span class="stringliteral">&quot;&lt;/a&gt;&lt;/li&gt;\n&quot;</span>;
<a name="l01953"></a>01953         }
<a name="l01954"></a>01954         $str .= <span class="stringliteral">&quot;&lt;/ul&gt;\n&quot;</span>;
<a name="l01955"></a>01955         $str .= <span class="stringliteral">&quot;&lt;div class=\&quot;contextMenu_footer\&quot; &gt;&lt;/div&gt;\n&quot;</span>;
<a name="l01956"></a>01956         $str .= <span class="stringliteral">&quot;&lt;/div&gt;\n&quot;</span>;
<a name="l01957"></a>01957         $str .= <span class="stringliteral">&quot;</span>
<a name="l01958"></a>01958 <span class="stringliteral">&lt;script&gt;</span>
<a name="l01959"></a>01959 <span class="stringliteral">$(&#39;&quot;</span>.$this-&gt;m_Name.<span class="stringliteral">&quot;&#39;).removeAttribute(&#39;onContextMenu&#39;);</span>
<a name="l01960"></a>01960 <span class="stringliteral">$(&#39;&quot;</span>.$this-&gt;m_Name.<span class="stringliteral">&quot;&#39;).oncontextmenu=function(event){return Openbiz.Menu.show(event, &#39;&quot;</span>.$this-&gt;m_Name.<span class="stringliteral">&quot;_contextmenu&#39;);};</span>
<a name="l01961"></a>01961 <span class="stringliteral">$(&#39;&quot;</span>.$this-&gt;m_Name.<span class="stringliteral">&quot;&#39;).observe(&#39;click&#39;,Openbiz.Menu.hide);</span>
<a name="l01962"></a>01962 <span class="stringliteral">&lt;/script&gt;&quot;</span>;
<a name="l01963"></a>01963         <span class="keywordflow">return</span> $str;
<a name="l01964"></a>01964     }
<a name="l01965"></a>01965 
<a name="l01973"></a><a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">01973</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a75545a3a11720fe6d5c316d316fb2df6">rerender</a>($redrawForm=<span class="keyword">true</span>, $hasRecordChange=<span class="keyword">true</span>)
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975         <span class="keywordflow">if</span> ($redrawForm)
<a name="l01976"></a>01976         {
<a name="l01977"></a>01977             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;redrawForm($this-&gt;m_Name, $this-&gt;<a class="code" href="class_easy_form.html#aa1008c36a9f8e921dc8cd0b5d462ff78">renderHTML</a>());
<a name="l01978"></a>01978         }
<a name="l01979"></a>01979 
<a name="l01980"></a>01980         <span class="keywordflow">if</span> ($hasRecordChange)
<a name="l01981"></a>01981         {
<a name="l01982"></a>01982             $this-&gt;<a class="code" href="class_easy_form.html#a9e579367ca9368a8ee3426757db0998d">rerenderSubForms</a>();
<a name="l01983"></a>01983         }
<a name="l01984"></a>01984     }
<a name="l01985"></a>01985 
<a name="l01992"></a><a class="code" href="class_easy_form.html#a9e579367ca9368a8ee3426757db0998d">01992</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a9e579367ca9368a8ee3426757db0998d">rerenderSubForms</a>()
<a name="l01993"></a>01993     {
<a name="l01994"></a>01994         <span class="keywordflow">if</span> (! $this-&gt;m_SubForms)
<a name="l01995"></a>01995             <span class="keywordflow">return</span>;
<a name="l01996"></a>01996         <span class="keywordflow">foreach</span> ($this-&gt;m_SubForms as $subForm)
<a name="l01997"></a>01997         {
<a name="l01998"></a>01998             $formObj = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getObject($subForm);
<a name="l01999"></a>01999             $dataObj = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;getRefObject($formObj-&gt;m_DataObjName);
<a name="l02000"></a>02000             <span class="keywordflow">if</span> ($dataObj)
<a name="l02001"></a>02001                 $formObj-&gt;setDataObj($dataObj);
<a name="l02002"></a>02002             $formObj-&gt;rerender();
<a name="l02003"></a>02003         }
<a name="l02004"></a>02004         <span class="keywordflow">return</span>;
<a name="l02005"></a>02005     }
<a name="l02006"></a>02006 
<a name="l02012"></a><a class="code" href="class_easy_form.html#aa1008c36a9f8e921dc8cd0b5d462ff78">02012</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#aa1008c36a9f8e921dc8cd0b5d462ff78">renderHTML</a>()
<a name="l02013"></a>02013     {                       
<a name="l02014"></a>02014         include_once(OPENBIZ_BIN.<span class="stringliteral">&quot;/easy/FormRenderer.php&quot;</span>);
<a name="l02015"></a>02015         $formHTML = <a class="code" href="class_easy_form.html#afde88292c44dc59faf017738dae6dffb">FormRenderer::render</a>($this);
<a name="l02016"></a>02016         $otherHTML = $this-&gt;rendercontextmenu();
<a name="l02017"></a>02017         
<a name="l02018"></a>02018         
<a name="l02019"></a>02019         <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/iPad/si&#39;</span>,$_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]) || 
<a name="l02020"></a>02020               preg_match(<span class="stringliteral">&#39;/iPhone/si&#39;</span>,$_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>])){
<a name="l02021"></a>02021                      $otherHTML.=<span class="stringliteral">&quot;</span>
<a name="l02022"></a>02022 <span class="stringliteral">                     &lt;script&gt;</span>
<a name="l02023"></a>02023 <span class="stringliteral">                            var a=document.getElementsByTagName(&#39;a&#39;);</span>
<a name="l02024"></a>02024 <span class="stringliteral">                            for(var i=0;i&lt;a.length;i++)</span>
<a name="l02025"></a>02025 <span class="stringliteral">                            {</span>
<a name="l02026"></a>02026 <span class="stringliteral">                                   if(a[i].getAttribute(&#39;href&#39;).indexOf(&#39;javascript:&#39;)==-1</span>
<a name="l02027"></a>02027 <span class="stringliteral">                                   &amp;&amp; a[i].getAttribute(&#39;href&#39;).indexOf(&#39;#&#39;)==-1)</span>
<a name="l02028"></a>02028 <span class="stringliteral">                                          {</span>
<a name="l02029"></a>02029 <span class="stringliteral">                                              a[i].onclick=function()</span>
<a name="l02030"></a>02030 <span class="stringliteral">                                              {</span>
<a name="l02031"></a>02031 <span class="stringliteral">                                                     try{</span>
<a name="l02032"></a>02032 <span class="stringliteral">                                                        show_loader();</span>
<a name="l02033"></a>02033 <span class="stringliteral">                                                 }catch(e){</span>
<a name="l02034"></a>02034 <span class="stringliteral">                                                        </span>
<a name="l02035"></a>02035 <span class="stringliteral">                                                 }</span>
<a name="l02036"></a>02036 <span class="stringliteral">                                                  window.location=this.getAttribute(&#39;href&#39;);</span>
<a name="l02037"></a>02037 <span class="stringliteral">                                                  return false</span>
<a name="l02038"></a>02038 <span class="stringliteral">                                              }</span>
<a name="l02039"></a>02039 <span class="stringliteral">                                          }else{</span>
<a name="l02040"></a>02040 <span class="stringliteral">                                          }</span>
<a name="l02041"></a>02041 <span class="stringliteral">                            } </span>
<a name="l02042"></a>02042 <span class="stringliteral">                            &lt;/script&gt;                   </span>
<a name="l02043"></a>02043 <span class="stringliteral">                     &quot;</span>;
<a name="l02044"></a>02044               } 
<a name="l02045"></a>02045         <span class="keywordflow">if</span>(!$this-&gt;m_ParentFormName)
<a name="l02046"></a>02046         {
<a name="l02047"></a>02047               <span class="keywordflow">if</span> (($viewObj = $this-&gt;<a class="code" href="class_easy_form.html#a70ed31c90f3ad9bd31b8ad60a39f87ad">getViewObject</a>())!=null)
<a name="l02048"></a>02048                 $viewObj-&gt;m_LastRenderedForm = $this-&gt;m_Name;
<a name="l02049"></a>02049         }
<a name="l02050"></a>02050         <span class="keywordflow">return</span> $formHTML .<span class="stringliteral">&quot;\n&quot;</span>. $otherHTML;
<a name="l02051"></a>02051     }
<a name="l02052"></a>02052 
<a name="l02058"></a><a class="code" href="class_easy_form.html#a27936a509c257572409599f157ff681a">02058</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a27936a509c257572409599f157ff681a">getEventLogMsg</a>()
<a name="l02059"></a>02059     {
<a name="l02060"></a>02060         list($element, $eventHandler) = $this-&gt;<a class="code" href="class_easy_form.html#a15d343efcbc80c8b61a60c3f2f01e759">getInvokingElement</a>();
<a name="l02061"></a>02061         $eventLogMsg = $eventHandler-&gt;m_EventLogMsg;
<a name="l02062"></a>02062         <span class="keywordflow">if</span>($eventLogMsg)
<a name="l02063"></a>02063         {
<a name="l02064"></a>02064             <span class="keywordflow">return</span> $eventLogMsg;
<a name="l02065"></a>02065         }
<a name="l02066"></a>02066         <span class="keywordflow">else</span>
<a name="l02067"></a>02067         {
<a name="l02068"></a>02068             <span class="keywordflow">return</span> null;
<a name="l02069"></a>02069         }
<a name="l02070"></a>02070     }
<a name="l02071"></a>02071 
<a name="l02077"></a><a class="code" href="class_easy_form.html#a69fa9e0c4d5e4506a6e6fc38af5e53d8">02077</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a69fa9e0c4d5e4506a6e6fc38af5e53d8">getOnEventElements</a>()
<a name="l02078"></a>02078     {
<a name="l02079"></a>02079         $elementList = array();
<a name="l02080"></a>02080         <span class="keywordflow">foreach</span> ($this-&gt;m_DataPanel as $element)
<a name="l02081"></a>02081         {
<a name="l02082"></a>02082             <span class="keywordflow">if</span> ($element-&gt;m_OnEventLog==<span class="stringliteral">&quot;Y&quot;</span>)
<a name="l02083"></a>02083                 $elementList[] = $element-&gt;m_Value;
<a name="l02084"></a>02084         }
<a name="l02085"></a>02085         <span class="keywordflow">return</span> $elementList;
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087 
<a name="l02093"></a><a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">02093</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#af7869ff2f0c1b81688eb42db0552a9be">runEventLog</a>()
<a name="l02094"></a>02094     {
<a name="l02095"></a>02095         $logMessage = $this-&gt;<a class="code" href="class_easy_form.html#a27936a509c257572409599f157ff681a">getEventLogMsg</a>();
<a name="l02096"></a>02096         $eventName = $this-&gt;m_EventName;
<a name="l02097"></a>02097         <span class="keywordflow">if</span>($logMessage &amp;&amp; $eventName)
<a name="l02098"></a>02098         {
<a name="l02099"></a>02099             $logElements = $this-&gt;<a class="code" href="class_easy_form.html#a69fa9e0c4d5e4506a6e6fc38af5e53d8">getOnEventElements</a>();
<a name="l02100"></a>02100             $eventlog       = <a class="code" href="class_biz_system.html#a6729150f2baee41fce746a2f21defd96">BizSystem::getService</a>(EVENTLOG_SERVICE);
<a name="l02101"></a>02101             $eventlog-&gt;log($eventName, $logMessage, $logElements);
<a name="l02102"></a>02102         }
<a name="l02103"></a>02103     }
<a name="l02104"></a>02104 
<a name="l02110"></a><a class="code" href="class_easy_form.html#a622f315c5158bfbd3968ee3c4da51bcd">02110</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a622f315c5158bfbd3968ee3c4da51bcd">getRedirectPage</a>()
<a name="l02111"></a>02111     {
<a name="l02112"></a>02112         <span class="comment">// get the control that issues the call</span>
<a name="l02113"></a>02113         <span class="comment">// __this is elementName:eventHandlerName</span>
<a name="l02114"></a>02114         list($element, $eventHandler) = $this-&gt;<a class="code" href="class_easy_form.html#a15d343efcbc80c8b61a60c3f2f01e759">getInvokingElement</a>();
<a name="l02115"></a>02115         $eventHandlerName = $eventHandler-&gt;m_Name;
<a name="l02116"></a>02116         $redirectPage = $element-&gt;getRedirectPage($eventHandlerName); <span class="comment">// need to get postaction of eventhandler</span>
<a name="l02117"></a>02117         $functionType = $element-&gt;getFunctionType($eventHandlerName);
<a name="l02118"></a>02118         <span class="keywordflow">switch</span> ($functionType)
<a name="l02119"></a>02119         {
<a name="l02120"></a>02120             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Popup&quot;</span>:
<a name="l02121"></a>02121             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Prop_Window&quot;</span>:
<a name="l02122"></a>02122             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Prop_Dialog&quot;</span>:
<a name="l02123"></a>02123                 $target = <span class="stringliteral">&quot;Popup&quot;</span>;
<a name="l02124"></a>02124                 <span class="keywordflow">break</span>;
<a name="l02125"></a>02125             <span class="keywordflow">default</span>:
<a name="l02126"></a>02126                 $target = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02127"></a>02127         }
<a name="l02128"></a>02128         <span class="keywordflow">return</span> array($redirectPage, $target);
<a name="l02129"></a>02129     }
<a name="l02130"></a>02130 
<a name="l02139"></a><a class="code" href="class_easy_form.html#a1b207d41cdc76e0f84048f6a55164f50">02139</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#a1b207d41cdc76e0f84048f6a55164f50">switchForm</a>($formName=null, $id=null, $params=null, $target=null)
<a name="l02140"></a>02140     {         
<a name="l02141"></a>02141        $paramFields = array();
<a name="l02142"></a>02142        <span class="keywordflow">if</span>($params){
<a name="l02143"></a>02143               parse_str(urldecode($params),$paramFields);
<a name="l02144"></a>02144        }
<a name="l02145"></a>02145         <span class="keywordflow">if</span> ($id!=null)
<a name="l02146"></a>02146             $paramFields[<span class="stringliteral">&quot;Id&quot;</span>] = $id;
<a name="l02147"></a>02147         $this-&gt;<a class="code" href="class_easy_form.html#aef7c4ff0a903eb04e7af25a6baea3d35">_showForm</a>($formName, $target, $paramFields);
<a name="l02148"></a>02148     }
<a name="l02149"></a>02149     
<a name="l02150"></a>02150     <span class="keyword">public</span> function parentSwitchForm($formName=null, $id=null, $params=null, $target=null)
<a name="l02151"></a>02151     {
<a name="l02152"></a>02152        <span class="keywordflow">if</span>($this-&gt;m_ParentFormName){
<a name="l02153"></a>02153               $formObj = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($this-&gt;m_ParentFormName);
<a name="l02154"></a>02154               <span class="keywordflow">return</span> $formObj-&gt;switchForm($formName, $id, $params, $target);
<a name="l02155"></a>02155        }
<a name="l02156"></a>02156     }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158        <span class="keyword">public</span> function targetSwitchForm($targetForm, $formName=null, $id=null, $params=null, $target=null)
<a name="l02159"></a>02159     {
<a name="l02160"></a>02160        <span class="keywordflow">if</span>($targetForm){
<a name="l02161"></a>02161               $formObj = <a class="code" href="class_biz_system.html#adf8b5ec7deab8481298eb73aa56493a0">BizSystem::getObject</a>($targetForm);
<a name="l02162"></a>02162               <span class="keywordflow">if</span>($formObj){
<a name="l02163"></a>02163                      <span class="keywordflow">return</span> $formObj-&gt;switchForm($formName, $id, $params, $target);
<a name="l02164"></a>02164               }
<a name="l02165"></a>02165        }
<a name="l02166"></a>02166     }
<a name="l02172"></a><a class="code" href="class_easy_form.html#a15d343efcbc80c8b61a60c3f2f01e759">02172</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a15d343efcbc80c8b61a60c3f2f01e759">getInvokingElement</a>()
<a name="l02173"></a>02173     {
<a name="l02174"></a>02174        <span class="keywordflow">if</span> ($this-&gt;m_InvokingElement)
<a name="l02175"></a>02175               <span class="keywordflow">return</span> $this-&gt;m_InvokingElement;
<a name="l02176"></a>02176        <span class="comment">// __this is elementName:eventHandlerName</span>
<a name="l02177"></a>02177         $elementAndEventName = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&quot;__this&quot;</span>);
<a name="l02178"></a>02178         <span class="keywordflow">if</span> (! $elementAndEventName)
<a name="l02179"></a>02179               <span class="keywordflow">return</span> array(null,null);
<a name="l02180"></a>02180         list ($elementName, $eventHandlerName) = explode(<span class="stringliteral">&quot;:&quot;</span>, $elementAndEventName);
<a name="l02181"></a>02181         $element = $this-&gt;<a class="code" href="class_easy_form.html#a214fbd6ab24d8a6efdcb305a5ecdae6b">getElement</a>($elementName);
<a name="l02182"></a>02182         $eventHandler = $element-&gt;m_EventHandlers-&gt;get($eventHandlerName);
<a name="l02183"></a>02183         $this-&gt;m_InvokingElement = array($element, $eventHandler);
<a name="l02184"></a>02184         <span class="keywordflow">return</span> $this-&gt;m_InvokingElement;
<a name="l02185"></a>02185     }
<a name="l02186"></a>02186 
<a name="l02192"></a><a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">02192</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#af446ebc060117e121c1ebff59f6bb02f">processPostAction</a>()
<a name="l02193"></a>02193     {
<a name="l02194"></a>02194         <span class="comment">// get the $redirectPage from eventHandler</span>
<a name="l02195"></a>02195         list($redirectPage,$target) = $this-&gt;<a class="code" href="class_easy_form.html#a622f315c5158bfbd3968ee3c4da51bcd">getRedirectPage</a>();
<a name="l02196"></a>02196         <span class="keywordflow">if</span> ($redirectPage)
<a name="l02197"></a>02197         {
<a name="l02198"></a>02198             <span class="keywordflow">if</span>($this-&gt;m_hasError==<span class="keyword">false</span>)
<a name="l02199"></a>02199             {
<a name="l02200"></a>02200                 <span class="comment">// if the redirectpage start with &quot;form=&quot;, render the form to the target which is defined by FuntionType</span>
<a name="l02201"></a>02201                 <span class="keywordflow">if</span> (strpos($redirectPage,<span class="stringliteral">&quot;form=&quot;</span>) === 0)
<a name="l02202"></a>02202                 {
<a name="l02203"></a>02203                     parse_str($redirectPage, $output);
<a name="l02204"></a>02204                     $formName = $output[<span class="stringliteral">&#39;form&#39;</span>];
<a name="l02205"></a>02205 
<a name="l02206"></a>02206                     <span class="comment">// parse query string. e.g. fld:Id=val&amp;fld:name=val</span>
<a name="l02207"></a>02207                     $paramFields = array();
<a name="l02208"></a>02208                     <span class="keywordflow">foreach</span> ($output as $key=&gt;$value)
<a name="l02209"></a>02209                     {
<a name="l02210"></a>02210                         <span class="keywordflow">if</span> (substr($key, 0, 4) == <span class="stringliteral">&quot;fld:&quot;</span>)
<a name="l02211"></a>02211                         {
<a name="l02212"></a>02212                             $fieldName = substr($key, 4);
<a name="l02213"></a>02213                             $paramFields[$fieldName] = $value;
<a name="l02214"></a>02214                         }
<a name="l02215"></a>02215                     }
<a name="l02216"></a>02216 
<a name="l02217"></a>02217                     $this-&gt;<a class="code" href="class_easy_form.html#aef7c4ff0a903eb04e7af25a6baea3d35">_showForm</a>($formName, $target, $paramFields);
<a name="l02218"></a>02218                 }
<a name="l02219"></a>02219                 <span class="keywordflow">else</span>
<a name="l02220"></a>02220                 {
<a name="l02221"></a>02221                     <span class="comment">// otherwise, do page redirection</span>
<a name="l02222"></a>02222                     <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;ReDirectPage($redirectPage);
<a name="l02223"></a>02223                 }
<a name="l02224"></a>02224             }
<a name="l02225"></a>02225         }
<a name="l02226"></a>02226     }
<a name="l02227"></a>02227 
<a name="l02234"></a><a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">02234</a>     <span class="keyword">public</span> function <a class="code" href="class_easy_form.html#ab2716c79ef6a6d4c3ef237eec4775a77">getActiveRecord</a>($recId=null)
<a name="l02235"></a>02235     {
<a name="l02236"></a>02236         <span class="keywordflow">if</span> ($this-&gt;m_ActiveRecord != null)
<a name="l02237"></a>02237         {
<a name="l02238"></a>02238             <span class="keywordflow">if</span>($this-&gt;m_ActiveRecord[<span class="stringliteral">&#39;Id&#39;</span>] != null)
<a name="l02239"></a>02239             {
<a name="l02240"></a>02240                 <span class="keywordflow">return</span> $this-&gt;m_ActiveRecord;
<a name="l02241"></a>02241             }
<a name="l02242"></a>02242         }
<a name="l02243"></a>02243 
<a name="l02244"></a>02244         <span class="keywordflow">if</span> ($recId==null || $recId==<span class="stringliteral">&#39;&#39;</span>)
<a name="l02245"></a>02245             $recId = <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;getFormInputs(<span class="stringliteral">&#39;_selectedId&#39;</span>);
<a name="l02246"></a>02246         <span class="keywordflow">if</span> ($recId==null || $recId==<span class="stringliteral">&#39;&#39;</span>)
<a name="l02247"></a>02247             <span class="keywordflow">return</span> null;
<a name="l02248"></a>02248         $this-&gt;m_RecordId = $recId;
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="comment">// TODO: may consider cache the current record in session</span>
<a name="l02251"></a>02251         <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()){
<a name="l02252"></a>02252                $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;setActiveRecordId($this-&gt;m_RecordId);
<a name="l02253"></a>02253                $rec = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;getActiveRecord();
<a name="l02254"></a>02254        
<a name="l02255"></a>02255                <span class="comment">// update the record row</span>
<a name="l02256"></a>02256                $this-&gt;m_DataPanel-&gt;setRecordArr($rec);
<a name="l02257"></a>02257        
<a name="l02258"></a>02258                $this-&gt;m_ActiveRecord = $rec;
<a name="l02259"></a>02259         }
<a name="l02260"></a>02260         <span class="keywordflow">return</span> $rec;
<a name="l02261"></a>02261     }
<a name="l02262"></a>02262 
<a name="l02263"></a>02263        <span class="keyword">public</span> function getRecordId(){
<a name="l02264"></a>02264        <span class="keywordflow">return</span> $this-&gt;m_RecordId;
<a name="l02265"></a>02265     }
<a name="l02266"></a>02266     <span class="keyword">public</span> function setRecordId($val){
<a name="l02267"></a>02267        $this-&gt;m_RecordId = $val;
<a name="l02268"></a>02268        <span class="keywordflow">return</span> $val; 
<a name="l02269"></a>02269     }
<a name="l02270"></a>02270     
<a name="l02277"></a><a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">02277</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a66ca3cc82efeedbd58aa6923c1410bb7">setActiveRecord</a>($record)
<a name="l02278"></a>02278     {
<a name="l02279"></a>02279         <span class="comment">// update the record row</span>
<a name="l02280"></a>02280         $this-&gt;m_DataPanel-&gt;setRecordArr($record);           
<a name="l02281"></a>02281         <span class="keywordflow">if</span>(!isset($this-&gt;m_ActiveRecord[<span class="stringliteral">&quot;Id&quot;</span>]) &amp;&amp; 
<a name="l02282"></a>02282               $this-&gt;m_RecordId!=null &amp;&amp; 
<a name="l02283"></a>02283               (strtoupper($this-&gt;m_FormType) == <span class="stringliteral">&#39;EDIT&#39;</span> || $this-&gt;m_FormType==null )){     
<a name="l02284"></a>02284                      <span class="keywordflow">if</span>($this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()){    
<a name="l02285"></a>02285                             $this-&gt;m_ActiveRecord = $this-&gt;<a class="code" href="class_easy_form.html#ae4300c4a8e77a43c8af9242c2363b23b">getDataObj</a>()-&gt;fetchById($this-&gt;m_RecordId)-&gt;toArray();
<a name="l02286"></a>02286                      }                    
<a name="l02287"></a>02287         }
<a name="l02288"></a>02288               <span class="keywordflow">if</span>(is_array($record)){              
<a name="l02289"></a>02289                <span class="keywordflow">foreach</span>($record as $key=&gt;$value){
<a name="l02290"></a>02290                      <span class="keywordflow">if</span>($key==<span class="stringliteral">&#39;extend&#39;</span>)<span class="keywordflow">continue</span>;
<a name="l02291"></a>02291                      $this-&gt;m_ActiveRecord[$key] = $record[$key];
<a name="l02292"></a>02292                }        
<a name="l02293"></a>02293               }
<a name="l02294"></a>02294               
<a name="l02295"></a>02295     }
<a name="l02296"></a>02296 
<a name="l02302"></a><a class="code" href="class_easy_form.html#a543d4488b170c3e8c3283cae6650b12b">02302</a>     <span class="keyword">protected</span> function <a class="code" href="class_easy_form.html#a543d4488b170c3e8c3283cae6650b12b">setClientScripts</a>()
<a name="l02303"></a>02303     {
<a name="l02304"></a>02304         <span class="comment">// load custom js class</span>
<a name="l02305"></a>02305         <span class="keywordflow">if</span> ($this-&gt;m_jsClass != <span class="stringliteral">&quot;Openbiz.Form&quot;</span> &amp;&amp; $this-&gt;m_jsClass != <span class="stringliteral">&quot;Openbiz.TableForm&quot;</span> )
<a name="l02306"></a>02306             <a class="code" href="class_biz_system.html#aa26ed2b3200c70e2037b46220a7e22aa">BizSystem::clientProxy</a>()-&gt;appendScripts($this-&gt;m_jsClass, $this-&gt;m_jsClass . <span class="stringliteral">&quot;.js&quot;</span>);
<a name="l02307"></a>02307         <span class="comment">/*</span>
<a name="l02308"></a>02308 <span class="comment">        if ($this-&gt;m_FormType == &#39;LIST&#39;)</span>
<a name="l02309"></a>02309 <span class="comment">        {</span>
<a name="l02310"></a>02310 <span class="comment">            BizSystem::clientProxy()-&gt;appendScripts(&quot;tablekit&quot;, &quot;tablekit.js&quot;);</span>
<a name="l02311"></a>02311 <span class="comment">        }*/</span>
<a name="l02312"></a>02312     }
<a name="l02313"></a>02313     
<a name="l02314"></a>02314     <span class="keyword">protected</span> function translate()
<a name="l02315"></a>02315     {
<a name="l02316"></a>02316        $module = $this-&gt;getModuleName($this-&gt;m_Name);
<a name="l02317"></a>02317        <span class="keywordflow">if</span> (!empty($this-&gt;m_Title))
<a name="l02318"></a>02318        {
<a name="l02319"></a>02319               $trans_string = I18n::t($this-&gt;m_Title, $this-&gt;getTransKey(<span class="stringliteral">&#39;Title&#39;</span>), $module);
<a name="l02320"></a>02320               <span class="keywordflow">if</span>($trans_string){
<a name="l02321"></a>02321                      $this-&gt;m_Title = $trans_string;
<a name="l02322"></a>02322               }
<a name="l02323"></a>02323        }
<a name="l02324"></a>02324        <span class="keywordflow">if</span> (!empty($this-&gt;m_Icon))
<a name="l02325"></a>02325        {
<a name="l02326"></a>02326               $trans_string = I18n::t($this-&gt;m_Icon, $this-&gt;getTransKey(<span class="stringliteral">&#39;Icon&#39;</span>), $module);
<a name="l02327"></a>02327               <span class="keywordflow">if</span>($trans_string){
<a name="l02328"></a>02328                      $this-&gt;m_Icon = $trans_string;
<a name="l02329"></a>02329               }
<a name="l02330"></a>02330        }
<a name="l02331"></a>02331        <span class="keywordflow">if</span> (!empty($this-&gt;m_Description))
<a name="l02332"></a>02332        {
<a name="l02333"></a>02333               $trans_string = I18n::t($this-&gt;m_Description, $this-&gt;getTransKey(<span class="stringliteral">&#39;Description&#39;</span>), $module);
<a name="l02334"></a>02334               <span class="keywordflow">if</span>($trans_string){
<a name="l02335"></a>02335                      $this-&gt;m_Description = $trans_string;
<a name="l02336"></a>02336               }
<a name="l02337"></a>02337        }
<a name="l02338"></a>02338     }
<a name="l02339"></a>02339     
<a name="l02340"></a>02340     <span class="keyword">protected</span> function getTransKey($name)
<a name="l02341"></a>02341     {
<a name="l02342"></a>02342        $shortFormName = substr($this-&gt;m_Name,intval(strrpos($this-&gt;m_Name,<span class="charliteral">&#39;.&#39;</span>))+1);
<a name="l02343"></a>02343        <span class="keywordflow">return</span> strtoupper($shortFormName.<span class="charliteral">&#39;_&#39;</span>.$name);
<a name="l02344"></a>02344     }
<a name="l02345"></a>02345 }
<a name="l02346"></a>02346 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:09:13 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
