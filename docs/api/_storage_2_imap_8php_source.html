<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Mail/Storage/Imap.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Mail/Storage/Imap.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00027"></a>00027 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Abstract.php&#39;</span>;
<a name="l00028"></a>00028 
<a name="l00032"></a>00032 require_once <span class="stringliteral">&#39;Zend/Mail/Protocol/Imap.php&#39;</span>;
<a name="l00033"></a>00033 
<a name="l00037"></a>00037 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Writable/Interface.php&#39;</span>;
<a name="l00038"></a>00038 
<a name="l00042"></a>00042 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Folder/Interface.php&#39;</span>;
<a name="l00043"></a>00043 
<a name="l00047"></a>00047 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Folder.php&#39;</span>;
<a name="l00048"></a>00048 
<a name="l00052"></a>00052 require_once <span class="stringliteral">&#39;Zend/Mail/Message.php&#39;</span>;
<a name="l00053"></a>00053 
<a name="l00057"></a>00057 require_once <span class="stringliteral">&#39;Zend/Mail/Storage.php&#39;</span>;
<a name="l00058"></a>00058 
<a name="l00066"></a><a class="code" href="class_zend___mail___storage___imap.html">00066</a> <span class="keyword">class </span><a class="code" href="class_zend___mail___storage___imap.html">Zend_Mail_Storage_Imap</a> <span class="keyword">extends</span> <a class="code" href="class_zend___mail___storage___abstract.html">Zend_Mail_Storage_Abstract</a>
<a name="l00067"></a>00067                              implements <a class="code" href="interface_zend___mail___storage___folder___interface.html">Zend_Mail_Storage_Folder_Interface</a>, <a class="code" href="interface_zend___mail___storage___writable___interface.html">Zend_Mail_Storage_Writable_Interface</a>
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069     <span class="comment">// TODO: with an internal cache we could optimize this class, or create an extra class with</span>
<a name="l00070"></a>00070     <span class="comment">// such optimizations. Especially the various fetch calls could be combined to one cache call</span>
<a name="l00071"></a>00071 
<a name="l00076"></a>00076     <span class="keyword">protected</span> $_protocol;
<a name="l00077"></a>00077 
<a name="l00082"></a>00082     <span class="keyword">protected</span> $_currentFolder = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00083"></a>00083 
<a name="l00088"></a>00088     <span class="keyword">protected</span> <span class="keyword">static</span> $_knownFlags = array(<span class="stringliteral">&#39;\Passed&#39;</span>   =&gt; Zend_Mail_Storage::FLAG_PASSED,
<a name="l00089"></a>00089                                           <span class="stringliteral">&#39;\Answered&#39;</span> =&gt; Zend_Mail_Storage::FLAG_ANSWERED,
<a name="l00090"></a>00090                                           <span class="stringliteral">&#39;\Seen&#39;</span>     =&gt; Zend_Mail_Storage::FLAG_SEEN,
<a name="l00091"></a>00091                                           <span class="stringliteral">&#39;\Deleted&#39;</span>  =&gt; Zend_Mail_Storage::FLAG_DELETED,
<a name="l00092"></a>00092                                           <span class="stringliteral">&#39;\Draft&#39;</span>    =&gt; Zend_Mail_Storage::FLAG_DRAFT,
<a name="l00093"></a>00093                                           <span class="stringliteral">&#39;\Flagged&#39;</span>  =&gt; Zend_Mail_Storage::FLAG_FLAGGED);
<a name="l00094"></a>00094 
<a name="l00099"></a>00099     <span class="keyword">protected</span> <span class="keyword">static</span> $_searchFlags = array(<span class="stringliteral">&#39;\Recent&#39;</span>   =&gt; <span class="stringliteral">&#39;RECENT&#39;</span>,
<a name="l00100"></a>00100                                            <span class="stringliteral">&#39;\Answered&#39;</span> =&gt; <span class="stringliteral">&#39;ANSWERED&#39;</span>,
<a name="l00101"></a>00101                                            <span class="stringliteral">&#39;\Seen&#39;</span>     =&gt; <span class="stringliteral">&#39;SEEN&#39;</span>,
<a name="l00102"></a>00102                                            <span class="stringliteral">&#39;\Deleted&#39;</span>  =&gt; <span class="stringliteral">&#39;DELETED&#39;</span>,
<a name="l00103"></a>00103                                            <span class="stringliteral">&#39;\Draft&#39;</span>    =&gt; <span class="stringliteral">&#39;DRAFT&#39;</span>,
<a name="l00104"></a>00104                                            <span class="stringliteral">&#39;\Flagged&#39;</span>  =&gt; <span class="stringliteral">&#39;FLAGGED&#39;</span>);
<a name="l00105"></a>00105 
<a name="l00113"></a><a class="code" href="class_zend___mail___storage___imap.html#af72bacdc781201d92e9b6e2d73e4654e">00113</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___abstract.html#a2af6a7c2f914df81f57a13a6a518661a">countMessages</a>($flags = null)
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (!$this-&gt;_currentFolder) {
<a name="l00119"></a>00119             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00120"></a>00120             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;No selected folder to count&#39;</span>);
<a name="l00121"></a>00121         }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keywordflow">if</span> ($flags === null) {
<a name="l00124"></a>00124             <span class="keywordflow">return</span> <a class="code" href="class_zend___mail___storage___abstract.html#ac751e87b3d4c4bf2feb03bee8b092755">count</a>($this-&gt;_protocol-&gt;search(array(<span class="stringliteral">&#39;ALL&#39;</span>)));
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         $params = array();
<a name="l00128"></a>00128         <span class="keywordflow">foreach</span> ((array)$flags as $flag) {
<a name="l00129"></a>00129             <span class="keywordflow">if</span> (isset(self::$_searchFlags[$flag])) {
<a name="l00130"></a>00130                 $params[] = self::$_searchFlags[$flag];
<a name="l00131"></a>00131             } <span class="keywordflow">else</span> {
<a name="l00132"></a>00132                 $params[] = <span class="stringliteral">&#39;KEYWORD&#39;</span>;
<a name="l00133"></a>00133                 $params[] = $this-&gt;_protocol-&gt;escapeString($flag);
<a name="l00134"></a>00134             }
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136         <span class="keywordflow">return</span> <a class="code" href="class_zend___mail___storage___abstract.html#ac751e87b3d4c4bf2feb03bee8b092755">count</a>($this-&gt;_protocol-&gt;search($params));
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 
<a name="l00146"></a><a class="code" href="class_zend___mail___storage___imap.html#a649ca975376ecee9d4e399d550865344">00146</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a649ca975376ecee9d4e399d550865344">getSize</a>($id = 0)
<a name="l00147"></a>00147     {
<a name="l00148"></a>00148         <span class="keywordflow">if</span> ($id) {
<a name="l00149"></a>00149             <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;RFC822.SIZE&#39;</span>, $id);
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;RFC822.SIZE&#39;</span>, 1, INF);
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153 
<a name="l00161"></a><a class="code" href="class_zend___mail___storage___imap.html#a86ea515928072d5f7cf1f112d3031782">00161</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a86ea515928072d5f7cf1f112d3031782">getMessage</a>($id)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         $data = $this-&gt;_protocol-&gt;fetch(array(<span class="stringliteral">&#39;FLAGS&#39;</span>, <span class="stringliteral">&#39;RFC822.HEADER&#39;</span>), $id);
<a name="l00164"></a>00164         $header = $data[<span class="stringliteral">&#39;RFC822.HEADER&#39;</span>];
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         $flags = array();
<a name="l00167"></a>00167         <span class="keywordflow">foreach</span> ($data[<span class="stringliteral">&#39;FLAGS&#39;</span>] as $flag) {
<a name="l00168"></a>00168             $flags[] = isset(self::$_knownFlags[$flag]) ? self::$_knownFlags[$flag] : $flag;
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="keywordflow">return</span> <span class="keyword">new</span> $this-&gt;_messageClass(array(<span class="stringliteral">&#39;handler&#39;</span> =&gt; $this, <span class="stringliteral">&#39;id&#39;</span> =&gt; $id, <span class="stringliteral">&#39;headers&#39;</span> =&gt; $header, <span class="stringliteral">&#39;flags&#39;</span> =&gt; $flags));
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">/*</span>
<a name="l00175"></a>00175 <span class="comment">     * Get raw header of message or part</span>
<a name="l00176"></a>00176 <span class="comment">     *</span>
<a name="l00177"></a>00177 <span class="comment">     * @param  int               $id       number of message</span>
<a name="l00178"></a>00178 <span class="comment">     * @param  null|array|string $part     path to part or null for messsage header</span>
<a name="l00179"></a>00179 <span class="comment">     * @param  int               $topLines include this many lines with header (after an empty line)</span>
<a name="l00180"></a>00180 <span class="comment">     * @param  int $topLines include this many lines with header (after an empty line)</span>
<a name="l00181"></a>00181 <span class="comment">     * @return string raw header</span>
<a name="l00182"></a>00182 <span class="comment">     * @throws Zend_Mail_Protocol_Exception</span>
<a name="l00183"></a>00183 <span class="comment">     * @throws Zend_Mail_Storage_Exception</span>
<a name="l00184"></a>00184 <span class="comment">     */</span>
<a name="l00185"></a><a class="code" href="class_zend___mail___storage___imap.html#abc2e51c1e6f29e8121f13ea3f773e1e5">00185</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#abc2e51c1e6f29e8121f13ea3f773e1e5">getRawHeader</a>($id, $part = null, $topLines = 0)
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187         <span class="keywordflow">if</span> ($part !== null) {
<a name="l00188"></a>00188             <span class="comment">// TODO: implement</span>
<a name="l00192"></a>00192 <span class="comment"></span>            require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00193"></a>00193             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;not implemented&#39;</span>);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="comment">// TODO: toplines</span>
<a name="l00197"></a>00197         <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;RFC822.HEADER&#39;</span>, $id);
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="comment">/*</span>
<a name="l00201"></a>00201 <span class="comment">     * Get raw content of message or part</span>
<a name="l00202"></a>00202 <span class="comment">     *</span>
<a name="l00203"></a>00203 <span class="comment">     * @param  int               $id   number of message</span>
<a name="l00204"></a>00204 <span class="comment">     * @param  null|array|string $part path to part or null for messsage content</span>
<a name="l00205"></a>00205 <span class="comment">     * @return string raw content</span>
<a name="l00206"></a>00206 <span class="comment">     * @throws Zend_Mail_Protocol_Exception</span>
<a name="l00207"></a>00207 <span class="comment">     * @throws Zend_Mail_Storage_Exception</span>
<a name="l00208"></a>00208 <span class="comment">     */</span>
<a name="l00209"></a><a class="code" href="class_zend___mail___storage___imap.html#a6c52e023cb423e1ad74e7e6b7af60f9f">00209</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a6c52e023cb423e1ad74e7e6b7af60f9f">getRawContent</a>($id, $part = null)
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <span class="keywordflow">if</span> ($part !== null) {
<a name="l00212"></a>00212             <span class="comment">// TODO: implement</span>
<a name="l00216"></a>00216 <span class="comment"></span>            require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00217"></a>00217             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;not implemented&#39;</span>);
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;RFC822.TEXT&#39;</span>, $id);
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00237"></a><a class="code" href="class_zend___mail___storage___imap.html#a9162320adff1a1a4afd7f2372f753a3e">00237</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a9162320adff1a1a4afd7f2372f753a3e">__construct</a>($params)
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (is_array($params)) {
<a name="l00240"></a>00240             $params = (object)$params;
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         $this-&gt;_has[<span class="stringliteral">&#39;flags&#39;</span>] = <span class="keyword">true</span>;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="keywordflow">if</span> ($params instanceof <a class="code" href="class_zend___mail___protocol___imap.html">Zend_Mail_Protocol_Imap</a>) {
<a name="l00246"></a>00246             $this-&gt;_protocol = $params;
<a name="l00247"></a>00247             <span class="keywordflow">try</span> {
<a name="l00248"></a>00248                 $this-&gt;<a class="code" href="class_zend___mail___storage___imap.html#a186a22359a4cb080fe1562b44bbad0fb">selectFolder</a>(<span class="stringliteral">&#39;INBOX&#39;</span>);
<a name="l00249"></a>00249             } <span class="keywordflow">catch</span>(<a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a> $e) {
<a name="l00253"></a>00253                 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00254"></a>00254                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot select INBOX, is this a valid transport?&#39;</span>);
<a name="l00255"></a>00255             }
<a name="l00256"></a>00256             <span class="keywordflow">return</span>;
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">if</span> (!isset($params-&gt;user)) {
<a name="l00263"></a>00263             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00264"></a>00264             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;need at least user in params&#39;</span>);
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         $host     = isset($params-&gt;host)     ? $params-&gt;host     : <span class="stringliteral">&#39;localhost&#39;</span>;
<a name="l00268"></a>00268         $password = isset($params-&gt;password) ? $params-&gt;password : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00269"></a>00269         $port     = isset($params-&gt;port)     ? $params-&gt;port     : null;
<a name="l00270"></a>00270         $ssl      = isset($params-&gt;ssl)      ? $params-&gt;ssl      : <span class="keyword">false</span>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         $this-&gt;_protocol = <span class="keyword">new</span> Zend_Mail_Protocol_Imap();
<a name="l00273"></a>00273         $this-&gt;_protocol-&gt;connect($host, $port, $ssl);
<a name="l00274"></a>00274         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;login($params-&gt;user, $password)) {
<a name="l00278"></a>00278             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00279"></a>00279             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot login, user or password wrong&#39;</span>);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         $this-&gt;<a class="code" href="class_zend___mail___storage___imap.html#a186a22359a4cb080fe1562b44bbad0fb">selectFolder</a>(isset($params-&gt;folder) ? $params-&gt;folder : <span class="stringliteral">&#39;INBOX&#39;</span>);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00290"></a><a class="code" href="class_zend___mail___storage___imap.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">00290</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#aa69c8bf1f1dcf4e72552efff1fe3e87e">close</a>()
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292         $this-&gt;_currentFolder = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00293"></a>00293         $this-&gt;_protocol-&gt;logout();
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00302"></a><a class="code" href="class_zend___mail___storage___imap.html#a5b0d7b9e52bc856532f248f24da5d2d7">00302</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a5b0d7b9e52bc856532f248f24da5d2d7">noop</a>()
<a name="l00303"></a>00303     {
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;noop()) {
<a name="l00308"></a>00308             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00309"></a>00309             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;could not do nothing&#39;</span>);
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00322"></a><a class="code" href="class_zend___mail___storage___imap.html#ae0124a1a7eb88dee437cdde75692d06c">00322</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#ae0124a1a7eb88dee437cdde75692d06c">removeMessage</a>($id)
<a name="l00323"></a>00323     {
<a name="l00324"></a>00324         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;store(array(Zend_Mail_Storage::FLAG_DELETED), $id, null, <span class="charliteral">&#39;+&#39;</span>)) {
<a name="l00328"></a>00328             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00329"></a>00329             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot set deleted flag&#39;</span>);
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331         <span class="comment">// TODO: expunge here or at close? we can handle an error here better and are more fail safe</span>
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;expunge()) {
<a name="l00336"></a>00336             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00337"></a>00337             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;message marked as deleted, but could not expunge&#39;</span>);
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00350"></a><a class="code" href="class_zend___mail___storage___imap.html#a54ebf4d8b63be34c7e54b579b97cc591">00350</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a54ebf4d8b63be34c7e54b579b97cc591">getUniqueId</a>($id = null)
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="keywordflow">if</span> ($id) {
<a name="l00353"></a>00353             <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;UID&#39;</span>, $id);
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <span class="keywordflow">return</span> $this-&gt;_protocol-&gt;fetch(<span class="stringliteral">&#39;UID&#39;</span>, 1, INF);
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00369"></a><a class="code" href="class_zend___mail___storage___imap.html#a611119496973e6367f37fdc3575e604e">00369</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a611119496973e6367f37fdc3575e604e">getNumberByUniqueId</a>($id)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         <span class="comment">// TODO: use search to find number directly</span>
<a name="l00372"></a>00372         $ids = $this-&gt;<a class="code" href="class_zend___mail___storage___imap.html#a54ebf4d8b63be34c7e54b579b97cc591">getUniqueId</a>();
<a name="l00373"></a>00373         <span class="keywordflow">foreach</span> ($ids as $k =&gt; $v) {
<a name="l00374"></a>00374             <span class="keywordflow">if</span> ($v == $id) {
<a name="l00375"></a>00375                 <span class="keywordflow">return</span> $k;
<a name="l00376"></a>00376             }
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378 
<a name="l00382"></a>00382         require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00383"></a>00383         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;unique id not found&#39;</span>);
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00395"></a><a class="code" href="class_zend___mail___storage___imap.html#a2fff03ee7acae699bffca0b3eecb3089">00395</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a2fff03ee7acae699bffca0b3eecb3089">getFolders</a>($rootFolder = null)
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397         $folders = $this-&gt;_protocol-&gt;listMailbox((<span class="keywordtype">string</span>)$rootFolder);
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (!$folders) {
<a name="l00402"></a>00402             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00403"></a>00403             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;folder not found&#39;</span>);
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         ksort($folders, SORT_STRING);
<a name="l00407"></a>00407         $root = <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___folder.html">Zend_Mail_Storage_Folder</a>(<span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, <span class="keyword">false</span>);
<a name="l00408"></a>00408         $stack = array(null);
<a name="l00409"></a>00409         $folderStack = array(null);
<a name="l00410"></a>00410         $parentFolder = $root;
<a name="l00411"></a>00411         $parent = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         <span class="keywordflow">foreach</span> ($folders as $globalName =&gt; $data) {
<a name="l00414"></a>00414             <span class="keywordflow">do</span> {
<a name="l00415"></a>00415                 <span class="keywordflow">if</span> (!$parent || strpos($globalName, $parent) === 0) {
<a name="l00416"></a>00416                     $pos = strrpos($globalName, $data[<span class="stringliteral">&#39;delim&#39;</span>]);
<a name="l00417"></a>00417                     <span class="keywordflow">if</span> ($pos === <span class="keyword">false</span>) {
<a name="l00418"></a>00418                         $localName = $globalName;
<a name="l00419"></a>00419                     } <span class="keywordflow">else</span> {
<a name="l00420"></a>00420                         $localName = substr($globalName, $pos + 1);
<a name="l00421"></a>00421                     }
<a name="l00422"></a>00422                     $selectable = !$data[<span class="stringliteral">&#39;flags&#39;</span>] || !in_array(<span class="stringliteral">&#39;\\Noselect&#39;</span>, $data[<span class="stringliteral">&#39;flags&#39;</span>]);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424                     array_push($stack, $parent);
<a name="l00425"></a>00425                     $parent = $globalName . $data[<span class="stringliteral">&#39;delim&#39;</span>];
<a name="l00426"></a>00426                     $folder = <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___folder.html">Zend_Mail_Storage_Folder</a>($localName, $globalName, $selectable);
<a name="l00427"></a>00427                     $parentFolder-&gt;$localName = $folder;
<a name="l00428"></a>00428                     array_push($folderStack, $parentFolder);
<a name="l00429"></a>00429                     $parentFolder = $folder;
<a name="l00430"></a>00430                     <span class="keywordflow">break</span>;
<a name="l00431"></a>00431                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($stack) {
<a name="l00432"></a>00432                     $parent = array_pop($stack);
<a name="l00433"></a>00433                     $parentFolder = array_pop($folderStack);
<a name="l00434"></a>00434                 }
<a name="l00435"></a>00435             } <span class="keywordflow">while</span> ($stack);
<a name="l00436"></a>00436             <span class="keywordflow">if</span> (!$stack) {
<a name="l00440"></a>00440                 require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00441"></a>00441                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;error while constructing folder tree&#39;</span>);
<a name="l00442"></a>00442             }
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         <span class="keywordflow">return</span> $root;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00458"></a><a class="code" href="class_zend___mail___storage___imap.html#a186a22359a4cb080fe1562b44bbad0fb">00458</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a186a22359a4cb080fe1562b44bbad0fb">selectFolder</a>($globalName)
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460         $this-&gt;_currentFolder = $globalName;
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;select($this-&gt;_currentFolder)) {
<a name="l00462"></a>00462             $this-&gt;_currentFolder = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00466"></a>00466             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00467"></a>00467             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot change folder, maybe it does not exist&#39;</span>);
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 
<a name="l00478"></a><a class="code" href="class_zend___mail___storage___imap.html#a11d856c85bcf54f7f5b4dd4779dcc2d7">00478</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a11d856c85bcf54f7f5b4dd4779dcc2d7">getCurrentFolder</a>()
<a name="l00479"></a>00479     {
<a name="l00480"></a>00480         <span class="keywordflow">return</span> $this-&gt;_currentFolder;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 
<a name="l00494"></a><a class="code" href="class_zend___mail___storage___imap.html#a6a7b46e549a41d5b85129b5e26e5d78f">00494</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a6a7b46e549a41d5b85129b5e26e5d78f">createFolder</a>($name, $parentFolder = null)
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496         <span class="comment">// TODO: we assume / as the hierarchy delim - need to get that from the folder class!</span>
<a name="l00497"></a>00497         <span class="keywordflow">if</span> ($parentFolder instanceof <a class="code" href="class_zend___mail___storage___folder.html">Zend_Mail_Storage_Folder</a>) {
<a name="l00498"></a>00498             $folder = $parentFolder-&gt;getGlobalName() . <span class="charliteral">&#39;/&#39;</span> . $name;
<a name="l00499"></a>00499         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($parentFolder != null) {
<a name="l00500"></a>00500             $folder = $parentFolder . <span class="charliteral">&#39;/&#39;</span> . $name;
<a name="l00501"></a>00501         } <span class="keywordflow">else</span> {
<a name="l00502"></a>00502             $folder = $name;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;create($folder)) {
<a name="l00509"></a>00509             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00510"></a>00510             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot create folder&#39;</span>);
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00521"></a><a class="code" href="class_zend___mail___storage___imap.html#a83ba66d88511e1aaad03c049ae9e8e75">00521</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a83ba66d88511e1aaad03c049ae9e8e75">removeFolder</a>($name)
<a name="l00522"></a>00522     {
<a name="l00523"></a>00523         <span class="keywordflow">if</span> ($name instanceof <a class="code" href="class_zend___mail___storage___folder.html">Zend_Mail_Storage_Folder</a>) {
<a name="l00524"></a>00524             $name = $name-&gt;getGlobalName();
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;delete($name)) {
<a name="l00531"></a>00531             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00532"></a>00532             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot delete folder&#39;</span>);
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00546"></a><a class="code" href="class_zend___mail___storage___imap.html#ac5e5f0cd4c82fc707f3ff5abd20d9910">00546</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#ac5e5f0cd4c82fc707f3ff5abd20d9910">renameFolder</a>($oldName, $newName)
<a name="l00547"></a>00547     {
<a name="l00548"></a>00548         <span class="keywordflow">if</span> ($oldName instanceof <a class="code" href="class_zend___mail___storage___folder.html">Zend_Mail_Storage_Folder</a>) {
<a name="l00549"></a>00549             $oldName = $oldName-&gt;getGlobalName();
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;rename($oldName, $newName)) {
<a name="l00556"></a>00556             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00557"></a>00557             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot rename folder&#39;</span>);
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560 
<a name="l00569"></a>00569      <span class="comment">// not yet * @param string|Zend_Mail_Message|Zend_Mime_Message $message message as string or instance of message class</span>
<a name="l00570"></a><a class="code" href="class_zend___mail___storage___imap.html#a50066be5af9815e7e41e557a6a859bfb">00570</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a50066be5af9815e7e41e557a6a859bfb">appendMessage</a>($message, $folder = null, $flags = null)
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572         <span class="keywordflow">if</span> ($folder === null) {
<a name="l00573"></a>00573             $folder = $this-&gt;_currentFolder;
<a name="l00574"></a>00574         }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         <span class="keywordflow">if</span> ($flags === null) {
<a name="l00577"></a>00577             $flags = array(Zend_Mail_Storage::FLAG_SEEN);
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580         <span class="comment">// TODO: handle class instances for $message</span>
<a name="l00581"></a>00581         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;append($folder, $message, $flags)) {
<a name="l00585"></a>00585             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00586"></a>00586             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot create message, please check if the folder exists and your flags&#39;</span>);
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00598"></a><a class="code" href="class_zend___mail___storage___imap.html#a6552f112bcd1f8c379d10a58c020575f">00598</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a6552f112bcd1f8c379d10a58c020575f">copyMessage</a>($id, $folder)
<a name="l00599"></a>00599     {
<a name="l00600"></a>00600         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;copy($folder, $id)) {
<a name="l00604"></a>00604             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00605"></a>00605             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot copy message, does the folder exist?&#39;</span>);
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 
<a name="l00619"></a><a class="code" href="class_zend___mail___storage___imap.html#a51c2c71aa4218dc4438e415ffde1bf50">00619</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#a51c2c71aa4218dc4438e415ffde1bf50">moveMessage</a>($id, $folder) {
<a name="l00620"></a>00620         $this-&gt;<a class="code" href="class_zend___mail___storage___imap.html#a6552f112bcd1f8c379d10a58c020575f">copyMessage</a>($id, $folder);
<a name="l00621"></a>00621         $this-&gt;<a class="code" href="class_zend___mail___storage___imap.html#ae0124a1a7eb88dee437cdde75692d06c">removeMessage</a>($id);
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623 
<a name="l00633"></a><a class="code" href="class_zend___mail___storage___imap.html#ad6d27674edc1f8b1072d1bededc93cfb">00633</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___mail___storage___imap.html#ad6d27674edc1f8b1072d1bededc93cfb">setFlags</a>($id, $flags)
<a name="l00634"></a>00634     {
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (!$this-&gt;_protocol-&gt;store($flags, $id)) {
<a name="l00639"></a>00639             require_once <span class="stringliteral">&#39;Zend/Mail/Storage/Exception.php&#39;</span>;
<a name="l00640"></a>00640             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___mail___storage___exception.html">Zend_Mail_Storage_Exception</a>(<span class="stringliteral">&#39;cannot set flags, have you tried to set the recent flag or special chars?&#39;</span>);
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:18 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
