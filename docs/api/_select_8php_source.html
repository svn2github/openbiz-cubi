<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Db/Select.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/others/Zend/Db/Select.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00027"></a>00027 require_once <span class="stringliteral">&#39;Zend/Db/Adapter/Abstract.php&#39;</span>;
<a name="l00028"></a>00028 
<a name="l00032"></a>00032 require_once <span class="stringliteral">&#39;Zend/Db/Expr.php&#39;</span>;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00044"></a><a class="code" href="class_zend___db___select.html">00044</a> <span class="keyword">class </span><a class="code" href="class_zend___db___select.html">Zend_Db_Select</a>
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="keyword">const</span> DISTINCT       = <span class="stringliteral">&#39;distinct&#39;</span>;
<a name="l00048"></a>00048     <span class="keyword">const</span> COLUMNS        = <span class="stringliteral">&#39;columns&#39;</span>;
<a name="l00049"></a>00049     <span class="keyword">const</span> FROM           = <span class="stringliteral">&#39;from&#39;</span>;
<a name="l00050"></a>00050     <span class="keyword">const</span> UNION          = <span class="stringliteral">&#39;union&#39;</span>;
<a name="l00051"></a>00051     <span class="keyword">const</span> WHERE          = <span class="stringliteral">&#39;where&#39;</span>;
<a name="l00052"></a>00052     <span class="keyword">const</span> GROUP          = <span class="stringliteral">&#39;group&#39;</span>;
<a name="l00053"></a>00053     <span class="keyword">const</span> HAVING         = <span class="stringliteral">&#39;having&#39;</span>;
<a name="l00054"></a>00054     <span class="keyword">const</span> ORDER          = <span class="stringliteral">&#39;order&#39;</span>;
<a name="l00055"></a>00055     <span class="keyword">const</span> LIMIT_COUNT    = <span class="stringliteral">&#39;limitcount&#39;</span>;
<a name="l00056"></a>00056     <span class="keyword">const</span> LIMIT_OFFSET   = <span class="stringliteral">&#39;limitoffset&#39;</span>;
<a name="l00057"></a>00057     <span class="keyword">const</span> FOR_UPDATE     = <span class="stringliteral">&#39;forupdate&#39;</span>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keyword">const</span> INNER_JOIN     = <span class="stringliteral">&#39;inner join&#39;</span>;
<a name="l00060"></a>00060     <span class="keyword">const</span> LEFT_JOIN      = <span class="stringliteral">&#39;left join&#39;</span>;
<a name="l00061"></a>00061     <span class="keyword">const</span> RIGHT_JOIN     = <span class="stringliteral">&#39;right join&#39;</span>;
<a name="l00062"></a>00062     <span class="keyword">const</span> FULL_JOIN      = <span class="stringliteral">&#39;full join&#39;</span>;
<a name="l00063"></a>00063     <span class="keyword">const</span> CROSS_JOIN     = <span class="stringliteral">&#39;cross join&#39;</span>;
<a name="l00064"></a>00064     <span class="keyword">const</span> NATURAL_JOIN   = <span class="stringliteral">&#39;natural join&#39;</span>;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="keyword">const</span> SQL_WILDCARD   = <span class="charliteral">&#39;*&#39;</span>;
<a name="l00067"></a>00067     <span class="keyword">const</span> SQL_SELECT     = <span class="stringliteral">&#39;SELECT&#39;</span>;
<a name="l00068"></a>00068     <span class="keyword">const</span> SQL_UNION      = <span class="stringliteral">&#39;UNION&#39;</span>;
<a name="l00069"></a>00069     <span class="keyword">const</span> SQL_UNION_ALL  = <span class="stringliteral">&#39;UNION ALL&#39;</span>;
<a name="l00070"></a>00070     <span class="keyword">const</span> SQL_FROM       = <span class="stringliteral">&#39;FROM&#39;</span>;
<a name="l00071"></a>00071     <span class="keyword">const</span> SQL_WHERE      = <span class="stringliteral">&#39;WHERE&#39;</span>;
<a name="l00072"></a>00072     <span class="keyword">const</span> SQL_DISTINCT   = <span class="stringliteral">&#39;DISTINCT&#39;</span>;
<a name="l00073"></a>00073     <span class="keyword">const</span> SQL_GROUP_BY   = <span class="stringliteral">&#39;GROUP BY&#39;</span>;
<a name="l00074"></a>00074     <span class="keyword">const</span> SQL_ORDER_BY   = <span class="stringliteral">&#39;ORDER BY&#39;</span>;
<a name="l00075"></a>00075     <span class="keyword">const</span> SQL_HAVING     = <span class="stringliteral">&#39;HAVING&#39;</span>;
<a name="l00076"></a>00076     <span class="keyword">const</span> SQL_FOR_UPDATE = <span class="stringliteral">&#39;FOR UPDATE&#39;</span>;
<a name="l00077"></a>00077     <span class="keyword">const</span> SQL_AND        = <span class="stringliteral">&#39;AND&#39;</span>;
<a name="l00078"></a>00078     <span class="keyword">const</span> SQL_AS         = <span class="stringliteral">&#39;AS&#39;</span>;
<a name="l00079"></a>00079     <span class="keyword">const</span> SQL_OR         = <span class="stringliteral">&#39;OR&#39;</span>;
<a name="l00080"></a>00080     <span class="keyword">const</span> SQL_ON         = <span class="stringliteral">&#39;ON&#39;</span>;
<a name="l00081"></a>00081     <span class="keyword">const</span> SQL_ASC        = <span class="stringliteral">&#39;ASC&#39;</span>;
<a name="l00082"></a>00082     <span class="keyword">const</span> SQL_DESC       = <span class="stringliteral">&#39;DESC&#39;</span>;
<a name="l00083"></a>00083 
<a name="l00089"></a>00089     <span class="keyword">protected</span> $_bind = array();
<a name="l00090"></a>00090 
<a name="l00096"></a>00096     <span class="keyword">protected</span> $_adapter;
<a name="l00097"></a>00097 
<a name="l00105"></a>00105     <span class="keyword">protected</span> <span class="keyword">static</span> $_partsInit = array(
<a name="l00106"></a>00106         self::DISTINCT     =&gt; <span class="keyword">false</span>,
<a name="l00107"></a>00107         self::COLUMNS      =&gt; array(),
<a name="l00108"></a>00108         self::UNION        =&gt; array(),
<a name="l00109"></a>00109         self::FROM         =&gt; array(),
<a name="l00110"></a>00110         self::WHERE        =&gt; array(),
<a name="l00111"></a>00111         self::GROUP        =&gt; array(),
<a name="l00112"></a>00112         self::HAVING       =&gt; array(),
<a name="l00113"></a>00113         self::ORDER        =&gt; array(),
<a name="l00114"></a>00114         self::LIMIT_COUNT  =&gt; null,
<a name="l00115"></a>00115         self::LIMIT_OFFSET =&gt; null,
<a name="l00116"></a>00116         self::FOR_UPDATE   =&gt; <span class="keyword">false</span>
<a name="l00117"></a>00117     );
<a name="l00118"></a>00118 
<a name="l00124"></a>00124     <span class="keyword">protected</span> <span class="keyword">static</span> $_joinTypes = array(
<a name="l00125"></a>00125         self::INNER_JOIN,
<a name="l00126"></a>00126         self::LEFT_JOIN,
<a name="l00127"></a>00127         self::RIGHT_JOIN,
<a name="l00128"></a>00128         self::FULL_JOIN,
<a name="l00129"></a>00129         self::CROSS_JOIN,
<a name="l00130"></a>00130         self::NATURAL_JOIN,
<a name="l00131"></a>00131     );
<a name="l00132"></a>00132 
<a name="l00138"></a>00138     <span class="keyword">protected</span> <span class="keyword">static</span> $_unionTypes = array(
<a name="l00139"></a>00139         self::SQL_UNION,
<a name="l00140"></a>00140         self::SQL_UNION_ALL
<a name="l00141"></a>00141     );
<a name="l00142"></a>00142 
<a name="l00149"></a>00149     <span class="keyword">protected</span> $_parts = array();
<a name="l00150"></a>00150 
<a name="l00156"></a>00156     <span class="keyword">protected</span> $_tableCols = array();
<a name="l00157"></a>00157 
<a name="l00163"></a><a class="code" href="class_zend___db___select.html#a30f7385e90996df666bb20098382d5e8">00163</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a30f7385e90996df666bb20098382d5e8">__construct</a>(<a class="code" href="class_zend___db___adapter___abstract.html">Zend_Db_Adapter_Abstract</a> $adapter)
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165         $this-&gt;_adapter = $adapter;
<a name="l00166"></a>00166         $this-&gt;_parts = self::$_partsInit;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00174"></a><a class="code" href="class_zend___db___select.html#acefb341aec61ba20d07353167fb1e1c7">00174</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#acefb341aec61ba20d07353167fb1e1c7">getBind</a>()
<a name="l00175"></a>00175     {
<a name="l00176"></a>00176         <span class="keywordflow">return</span> $this-&gt;_bind;
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 
<a name="l00185"></a><a class="code" href="class_zend___db___select.html#a040c9428f8b07fe5c697893390d6ba0c">00185</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a040c9428f8b07fe5c697893390d6ba0c">bind</a>($bind)
<a name="l00186"></a>00186     {
<a name="l00187"></a>00187         $this-&gt;_bind = $bind;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         <span class="keywordflow">return</span> $this;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00198"></a><a class="code" href="class_zend___db___select.html#a3edda7fb95a30b73345748c9733d9ce3">00198</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a3edda7fb95a30b73345748c9733d9ce3">distinct</a>($flag = <span class="keyword">true</span>)
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200         $this-&gt;_parts[self::DISTINCT] = (bool) $flag;
<a name="l00201"></a>00201         <span class="keywordflow">return</span> $this;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00228"></a><a class="code" href="class_zend___db___select.html#af6c51b0a901e3a9685985ed094cb7fb5">00228</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#af6c51b0a901e3a9685985ed094cb7fb5">from</a>($name, $cols = <span class="charliteral">&#39;*&#39;</span>, $schema = null)
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::FROM, $name, null, $cols, $schema);
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232 
<a name="l00243"></a><a class="code" href="class_zend___db___select.html#aea685defcef537abfe24a32c3b473989">00243</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#aea685defcef537abfe24a32c3b473989">columns</a>($cols = <span class="charliteral">&#39;*&#39;</span>, $correlationName = null)
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <span class="keywordflow">if</span> ($correlationName === null &amp;&amp; count($this-&gt;_parts[self::FROM])) {
<a name="l00246"></a>00246             $correlationName = current(array_keys($this-&gt;_parts[self::FROM]));
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (!array_key_exists($correlationName, $this-&gt;_parts[self::FROM])) {
<a name="l00253"></a>00253             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00254"></a>00254             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;No table has been specified for the FROM clause&quot;</span>);
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         $this-&gt;<a class="code" href="class_zend___db___select.html#a520f2de53b0702d75a2d8bf6de4ff996">_tableCols</a>($correlationName, $cols);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">return</span> $this;
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00271"></a><a class="code" href="class_zend___db___select.html#ad7b8b7bd0811d7e46359f1fcc7fd1bd2">00271</a>     <span class="keyword">public</span> function <span class="keyword">union</span>($select = array(), $type = self::SQL_UNION)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273         <span class="keywordflow">if</span> (!is_array($select)) {
<a name="l00274"></a>00274             $select = array();
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (!in_array($type, self::$_unionTypes)) {
<a name="l00278"></a>00278             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00279"></a>00279             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Invalid union type &#39;{$type}&#39;&quot;</span>);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="keywordflow">foreach</span> ($select as $target) {
<a name="l00283"></a>00283             $this-&gt;_parts[self::UNION][] = array($target, $type);
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">return</span> $this;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00301"></a><a class="code" href="class_zend___db___select.html#a94658a5da91b02c83b03e9843165f0a0">00301</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a94658a5da91b02c83b03e9843165f0a0">join</a>($name, $cond, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#aaebd5655ee35a81910550235491f3eef">joinInner</a>($name, $cond, $cols, $schema);
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 
<a name="l00322"></a><a class="code" href="class_zend___db___select.html#aaebd5655ee35a81910550235491f3eef">00322</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#aaebd5655ee35a81910550235491f3eef">joinInner</a>($name, $cond, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00323"></a>00323     {
<a name="l00324"></a>00324         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::INNER_JOIN, $name, $cond, $cols, $schema);
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326 
<a name="l00343"></a><a class="code" href="class_zend___db___select.html#a5f824b15eaae3d1bacde8c91179733aa">00343</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a5f824b15eaae3d1bacde8c91179733aa">joinLeft</a>($name, $cond, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::LEFT_JOIN, $name, $cond, $cols, $schema);
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347 
<a name="l00365"></a><a class="code" href="class_zend___db___select.html#aa7f0eb118e2cb68d5cb0071183a22753">00365</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#aa7f0eb118e2cb68d5cb0071183a22753">joinRight</a>($name, $cond, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::RIGHT_JOIN, $name, $cond, $cols, $schema);
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 
<a name="l00387"></a><a class="code" href="class_zend___db___select.html#a0faaa3277bf83f058045a46d2b077615">00387</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a0faaa3277bf83f058045a46d2b077615">joinFull</a>($name, $cond, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::FULL_JOIN, $name, $cond, $cols, $schema);
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 
<a name="l00404"></a><a class="code" href="class_zend___db___select.html#a413fbe80886cc283bb424ac653968727">00404</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a413fbe80886cc283bb424ac653968727">joinCross</a>($name, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00405"></a>00405     {
<a name="l00406"></a>00406         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::CROSS_JOIN, $name, null, $cols, $schema);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00424"></a><a class="code" href="class_zend___db___select.html#a40e63e586fe9ab756bd6a69c1c58314c">00424</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a40e63e586fe9ab756bd6a69c1c58314c">joinNatural</a>($name, $cols = self::SQL_WILDCARD, $schema = null)
<a name="l00425"></a>00425     {
<a name="l00426"></a>00426         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>(self::NATURAL_JOIN, $name, null, $cols, $schema);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00461"></a><a class="code" href="class_zend___db___select.html#aa9b48821d6c77dd6e0332226cc2cb59b">00461</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#aa9b48821d6c77dd6e0332226cc2cb59b">where</a>($cond, $value = null, $type = null)
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463         $this-&gt;_parts[self::WHERE][] = $this-&gt;<a class="code" href="class_zend___db___select.html#a3a24d1516675e05408fede0234674516">_where</a>($cond, $value, $type, <span class="keyword">true</span>);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="keywordflow">return</span> $this;
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467 
<a name="l00480"></a><a class="code" href="class_zend___db___select.html#a32fde2efe13928ba9d264a23d3e635ec">00480</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a32fde2efe13928ba9d264a23d3e635ec">orWhere</a>($cond, $value = null, $type = null)
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482         $this-&gt;_parts[self::WHERE][] = $this-&gt;<a class="code" href="class_zend___db___select.html#a3a24d1516675e05408fede0234674516">_where</a>($cond, $value, $type, <span class="keyword">false</span>);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="keywordflow">return</span> $this;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 
<a name="l00493"></a><a class="code" href="class_zend___db___select.html#afa546a8cf74a1e159581ec378e916e6d">00493</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#afa546a8cf74a1e159581ec378e916e6d">group</a>($spec)
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495         <span class="keywordflow">if</span> (!is_array($spec)) {
<a name="l00496"></a>00496             $spec = array($spec);
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="keywordflow">foreach</span> ($spec as $val) {
<a name="l00500"></a>00500             <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\(.*\)/&#39;</span>, (<span class="keywordtype">string</span>) $val)) {
<a name="l00501"></a>00501                 $val = <span class="keyword">new</span> <a class="code" href="class_zend___db___expr.html">Zend_Db_Expr</a>($val);
<a name="l00502"></a>00502             }
<a name="l00503"></a>00503             $this-&gt;_parts[self::GROUP][] = $val;
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         <span class="keywordflow">return</span> $this;
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00520"></a><a class="code" href="class_zend___db___select.html#a00077b0efcc55c484b06225091bc0b04">00520</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a00077b0efcc55c484b06225091bc0b04">having</a>($cond)
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522         <span class="keywordflow">if</span> (func_num_args() &gt; 1) {
<a name="l00523"></a>00523             $val = func_get_arg(1);
<a name="l00524"></a>00524             $cond = $this-&gt;_adapter-&gt;quoteInto($cond, $val);
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keywordflow">if</span> ($this-&gt;_parts[self::HAVING]) {
<a name="l00528"></a>00528             $this-&gt;_parts[self::HAVING][] = self::SQL_AND . <span class="stringliteral">&quot; ($cond)&quot;</span>;
<a name="l00529"></a>00529         } <span class="keywordflow">else</span> {
<a name="l00530"></a>00530             $this-&gt;_parts[self::HAVING][] = <span class="stringliteral">&quot;($cond)&quot;</span>;
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <span class="keywordflow">return</span> $this;
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00547"></a><a class="code" href="class_zend___db___select.html#a576cf480d3f795740c323de8da66a5d5">00547</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a576cf480d3f795740c323de8da66a5d5">orHaving</a>($cond)
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (func_num_args() &gt; 1) {
<a name="l00550"></a>00550             $val = func_get_arg(1);
<a name="l00551"></a>00551             $cond = $this-&gt;_adapter-&gt;quoteInto($cond, $val);
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="keywordflow">if</span> ($this-&gt;_parts[self::HAVING]) {
<a name="l00555"></a>00555             $this-&gt;_parts[self::HAVING][] = self::SQL_OR . <span class="stringliteral">&quot; ($cond)&quot;</span>;
<a name="l00556"></a>00556         } <span class="keywordflow">else</span> {
<a name="l00557"></a>00557             $this-&gt;_parts[self::HAVING][] = <span class="stringliteral">&quot;($cond)&quot;</span>;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="keywordflow">return</span> $this;
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 
<a name="l00569"></a><a class="code" href="class_zend___db___select.html#a53365855abf67f812e9929237eb67074">00569</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a53365855abf67f812e9929237eb67074">order</a>($spec)
<a name="l00570"></a>00570     {
<a name="l00571"></a>00571         <span class="keywordflow">if</span> (!is_array($spec)) {
<a name="l00572"></a>00572             $spec = array($spec);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="comment">// force &#39;ASC&#39; or &#39;DESC&#39; on each order spec, default is ASC.</span>
<a name="l00576"></a>00576         <span class="keywordflow">foreach</span> ($spec as $val) {
<a name="l00577"></a>00577             <span class="keywordflow">if</span> ($val instanceof <a class="code" href="class_zend___db___expr.html">Zend_Db_Expr</a>) {
<a name="l00578"></a>00578                 $expr = $val-&gt;__toString();
<a name="l00579"></a>00579                 <span class="keywordflow">if</span> (empty($expr)) {
<a name="l00580"></a>00580                     <span class="keywordflow">continue</span>;
<a name="l00581"></a>00581                 }
<a name="l00582"></a>00582                 $this-&gt;_parts[self::ORDER][] = $val;
<a name="l00583"></a>00583             } <span class="keywordflow">else</span> {
<a name="l00584"></a>00584                 <span class="keywordflow">if</span> (empty($val)) {
<a name="l00585"></a>00585                     <span class="keywordflow">continue</span>;
<a name="l00586"></a>00586                 }
<a name="l00587"></a>00587                 $direction = self::SQL_ASC;
<a name="l00588"></a>00588                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/(.*\W)(&#39;</span> . self::SQL_ASC . <span class="charliteral">&#39;|&#39;</span> . self::SQL_DESC . <span class="stringliteral">&#39;)\b/si&#39;</span>, $val, $matches)) {
<a name="l00589"></a>00589                     $val = trim($matches[1]);
<a name="l00590"></a>00590                     $direction = $matches[2];
<a name="l00591"></a>00591                 }
<a name="l00592"></a>00592                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\(.*\)/&#39;</span>, $val)) {
<a name="l00593"></a>00593                     $val = <span class="keyword">new</span> Zend_Db_Expr($val);
<a name="l00594"></a>00594                 }
<a name="l00595"></a>00595                 $this-&gt;_parts[self::ORDER][] = array($val, $direction);
<a name="l00596"></a>00596             }
<a name="l00597"></a>00597         }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="keywordflow">return</span> $this;
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601 
<a name="l00609"></a><a class="code" href="class_zend___db___select.html#af21e012c087d63984ce4d94296eac021">00609</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#af21e012c087d63984ce4d94296eac021">limit</a>($count = null, $offset = null)
<a name="l00610"></a>00610     {
<a name="l00611"></a>00611         $this-&gt;_parts[self::LIMIT_COUNT]  = (int) $count;
<a name="l00612"></a>00612         $this-&gt;_parts[self::LIMIT_OFFSET] = (int) $offset;
<a name="l00613"></a>00613         <span class="keywordflow">return</span> $this;
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 
<a name="l00623"></a><a class="code" href="class_zend___db___select.html#a94c133ed7263fa11d3780db02b35f24d">00623</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a94c133ed7263fa11d3780db02b35f24d">limitPage</a>($page, $rowCount)
<a name="l00624"></a>00624     {
<a name="l00625"></a>00625         $page     = ($page &gt; 0)     ? $page     : 1;
<a name="l00626"></a>00626         $rowCount = ($rowCount &gt; 0) ? $rowCount : 1;
<a name="l00627"></a>00627         $this-&gt;_parts[self::LIMIT_COUNT]  = (int) $rowCount;
<a name="l00628"></a>00628         $this-&gt;_parts[self::LIMIT_OFFSET] = (int) $rowCount * ($page - 1);
<a name="l00629"></a>00629         <span class="keywordflow">return</span> $this;
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 
<a name="l00638"></a><a class="code" href="class_zend___db___select.html#aa65d4feb5310f0848a6350ea5315f309">00638</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#aa65d4feb5310f0848a6350ea5315f309">forUpdate</a>($flag = <span class="keyword">true</span>)
<a name="l00639"></a>00639     {
<a name="l00640"></a>00640         $this-&gt;_parts[self::FOR_UPDATE] = (bool) $flag;
<a name="l00641"></a>00641         <span class="keywordflow">return</span> $this;
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 
<a name="l00651"></a><a class="code" href="class_zend___db___select.html#a7fde2bb39646fe20b5f857dacc0515df">00651</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a7fde2bb39646fe20b5f857dacc0515df">getPart</a>($part)
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653         $part = strtolower($part);
<a name="l00654"></a>00654         <span class="keywordflow">if</span> (!array_key_exists($part, $this-&gt;_parts)) {
<a name="l00655"></a>00655             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00656"></a>00656             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Invalid Select part &#39;$part&#39;&quot;</span>);
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658         <span class="keywordflow">return</span> $this-&gt;_parts[$part];
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 
<a name="l00668"></a><a class="code" href="class_zend___db___select.html#a7ddebcb41474dfdf1c446ba326451f39">00668</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a7ddebcb41474dfdf1c446ba326451f39">query</a>($fetchMode = null, $bind = array())
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (!empty($bind)) {
<a name="l00671"></a>00671             $this-&gt;<a class="code" href="class_zend___db___select.html#a040c9428f8b07fe5c697893390d6ba0c">bind</a>($bind);
<a name="l00672"></a>00672         }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674         $stmt = $this-&gt;_adapter-&gt;query($this);
<a name="l00675"></a>00675         <span class="keywordflow">if</span> ($fetchMode == null) {
<a name="l00676"></a>00676             $fetchMode = $this-&gt;_adapter-&gt;getFetchMode();
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678         $stmt-&gt;setFetchMode($fetchMode);
<a name="l00679"></a>00679         <span class="keywordflow">return</span> $stmt;
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00687"></a><a class="code" href="class_zend___db___select.html#ab8b117c49918c18c286a6e496aaf6a1c">00687</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#ab8b117c49918c18c286a6e496aaf6a1c">assemble</a>()
<a name="l00688"></a>00688     {
<a name="l00689"></a>00689         $sql = self::SQL_SELECT;
<a name="l00690"></a>00690         <span class="keywordflow">foreach</span> (array_keys(self::$_partsInit) as $part) {
<a name="l00691"></a>00691             $method = <span class="stringliteral">&#39;_render&#39;</span> . ucfirst($part);
<a name="l00692"></a>00692             <span class="keywordflow">if</span> (method_exists($this, $method)) {
<a name="l00693"></a>00693                 $sql = $this-&gt;$method($sql);
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696         <span class="keywordflow">return</span> $sql;
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698 
<a name="l00705"></a><a class="code" href="class_zend___db___select.html#ab68b0a51171cca19ab3c33d54f1632a5">00705</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#ab68b0a51171cca19ab3c33d54f1632a5">reset</a>($part = null)
<a name="l00706"></a>00706     {
<a name="l00707"></a>00707         <span class="keywordflow">if</span> ($part == null) {
<a name="l00708"></a>00708             $this-&gt;_parts = self::$_partsInit;
<a name="l00709"></a>00709         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (array_key_exists($part, self::$_partsInit)) {
<a name="l00710"></a>00710             $this-&gt;_parts[$part] = self::$_partsInit[$part];
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712         <span class="keywordflow">return</span> $this;
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714 
<a name="l00721"></a><a class="code" href="class_zend___db___select.html#a23a4c71383d4d2dfc4ccade9fc78e5b9">00721</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a23a4c71383d4d2dfc4ccade9fc78e5b9">getAdapter</a>()
<a name="l00722"></a>00722     {
<a name="l00723"></a>00723         <span class="keywordflow">return</span> $this-&gt;_adapter;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725 
<a name="l00742"></a><a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">00742</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>($type, $name, $cond, $cols, $schema = null)
<a name="l00743"></a>00743     {
<a name="l00744"></a>00744         <span class="keywordflow">if</span> (!in_array($type, self::$_joinTypes) &amp;&amp; $type != self::FROM) {
<a name="l00748"></a>00748             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00749"></a>00749             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Invalid join type &#39;$type&#39;&quot;</span>);
<a name="l00750"></a>00750         }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752         <span class="keywordflow">if</span> (count($this-&gt;_parts[self::UNION])) {
<a name="l00753"></a>00753             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00754"></a>00754             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Invalid use of table with &quot;</span> . self::SQL_UNION);
<a name="l00755"></a>00755         }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         <span class="keywordflow">if</span> (empty($name)) {
<a name="l00758"></a>00758             $correlationName = $tableName = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00759"></a>00759         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_array($name)) {
<a name="l00760"></a>00760             <span class="comment">// Must be array($correlationName =&gt; $tableName) or array($ident, ...)</span>
<a name="l00761"></a>00761             <span class="keywordflow">foreach</span> ($name as $_correlationName =&gt; $_tableName) {
<a name="l00762"></a>00762                 <span class="keywordflow">if</span> (is_string($_correlationName)) {
<a name="l00763"></a>00763                     <span class="comment">// We assume the key is the correlation name and value is the table name</span>
<a name="l00764"></a>00764                     $tableName = $_tableName;
<a name="l00765"></a>00765                     $correlationName = $_correlationName;
<a name="l00766"></a>00766                 } <span class="keywordflow">else</span> {
<a name="l00767"></a>00767                     <span class="comment">// We assume just an array of identifiers, with no correlation name</span>
<a name="l00768"></a>00768                     $tableName = $_tableName;
<a name="l00769"></a>00769                     $correlationName = $this-&gt;_uniqueCorrelation($tableName);
<a name="l00770"></a>00770                 }
<a name="l00771"></a>00771                 <span class="keywordflow">break</span>;
<a name="l00772"></a>00772             }
<a name="l00773"></a>00773         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($name instanceof <a class="code" href="class_zend___db___expr.html">Zend_Db_Expr</a>|| $name instanceof <a class="code" href="class_zend___db___select.html">Zend_Db_Select</a>) {
<a name="l00774"></a>00774             $tableName = $name;
<a name="l00775"></a>00775             $correlationName = $this-&gt;_uniqueCorrelation(<span class="charliteral">&#39;t&#39;</span>);
<a name="l00776"></a>00776         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(.+)\s+AS\s+(.+)$/i&#39;</span>, $name, $m)) {
<a name="l00777"></a>00777             $tableName = $m[1];
<a name="l00778"></a>00778             $correlationName = $m[2];
<a name="l00779"></a>00779         } <span class="keywordflow">else</span> {
<a name="l00780"></a>00780             $tableName = $name;
<a name="l00781"></a>00781             $correlationName = $this-&gt;_uniqueCorrelation($tableName);
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784         <span class="comment">// Schema from table name overrides schema argument</span>
<a name="l00785"></a>00785         <span class="keywordflow">if</span> (!is_object($tableName) &amp;&amp; <span class="keyword">false</span> !== strpos($tableName, <span class="charliteral">&#39;.&#39;</span>)) {
<a name="l00786"></a>00786             list($schema, $tableName) = explode(<span class="charliteral">&#39;.&#39;</span>, $tableName);
<a name="l00787"></a>00787         }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         $lastFromCorrelationName = null;
<a name="l00790"></a>00790         <span class="keywordflow">if</span> (!empty($correlationName)) {
<a name="l00791"></a>00791             <span class="keywordflow">if</span> (array_key_exists($correlationName, $this-&gt;_parts[self::FROM])) {
<a name="l00795"></a>00795                 require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00796"></a>00796                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;You cannot define a correlation name &#39;$correlationName&#39; more than once&quot;</span>);
<a name="l00797"></a>00797             }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799             <span class="keywordflow">if</span> ($type == self::FROM) {
<a name="l00800"></a>00800                 <span class="comment">// append this from after the last from joinType</span>
<a name="l00801"></a>00801                 $tmpFromParts = $this-&gt;_parts[self::FROM];
<a name="l00802"></a>00802                 $this-&gt;_parts[self::FROM] = array();
<a name="l00803"></a>00803                 <span class="comment">// move all the froms onto the stack</span>
<a name="l00804"></a>00804                 <span class="keywordflow">while</span> ($tmpFromParts) {
<a name="l00805"></a>00805                     $currentCorrelationName = key($tmpFromParts);
<a name="l00806"></a>00806                     <span class="keywordflow">if</span> ($tmpFromParts[$currentCorrelationName][<span class="stringliteral">&#39;joinType&#39;</span>] != self::FROM) {
<a name="l00807"></a>00807                         <span class="keywordflow">break</span>;
<a name="l00808"></a>00808                     }
<a name="l00809"></a>00809                     $lastFromCorrelationName = $currentCorrelationName;
<a name="l00810"></a>00810                     $this-&gt;_parts[self::FROM][$currentCorrelationName] = array_shift($tmpFromParts);
<a name="l00811"></a>00811                 }
<a name="l00812"></a>00812             } <span class="keywordflow">else</span> {
<a name="l00813"></a>00813                 $tmpFromParts = array();
<a name="l00814"></a>00814             }
<a name="l00815"></a>00815             $this-&gt;_parts[self::FROM][$correlationName] = array(
<a name="l00816"></a>00816                 <span class="stringliteral">&#39;joinType&#39;</span>      =&gt; $type,
<a name="l00817"></a>00817                 <span class="stringliteral">&#39;schema&#39;</span>        =&gt; $schema,
<a name="l00818"></a>00818                 <span class="stringliteral">&#39;tableName&#39;</span>     =&gt; $tableName,
<a name="l00819"></a>00819                 <span class="stringliteral">&#39;joinCondition&#39;</span> =&gt; $cond
<a name="l00820"></a>00820                 );
<a name="l00821"></a>00821             <span class="keywordflow">while</span> ($tmpFromParts) {
<a name="l00822"></a>00822                 $currentCorrelationName = key($tmpFromParts);
<a name="l00823"></a>00823                 $this-&gt;_parts[self::FROM][$currentCorrelationName] = array_shift($tmpFromParts);
<a name="l00824"></a>00824             }
<a name="l00825"></a>00825         }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827         <span class="comment">// add to the columns from this joined table</span>
<a name="l00828"></a>00828         <span class="keywordflow">if</span> ($type == self::FROM &amp;&amp; $lastFromCorrelationName == null) {
<a name="l00829"></a>00829             $lastFromCorrelationName = <span class="keyword">true</span>;
<a name="l00830"></a>00830         }
<a name="l00831"></a>00831         $this-&gt;<a class="code" href="class_zend___db___select.html#a520f2de53b0702d75a2d8bf6de4ff996">_tableCols</a>($correlationName, $cols, $lastFromCorrelationName);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         <span class="keywordflow">return</span> $this;
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00861"></a><a class="code" href="class_zend___db___select.html#acc69a8ed7a301431db463163e6309906">00861</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#acc69a8ed7a301431db463163e6309906">_joinUsing</a>($type, $name, $cond, $cols = <span class="charliteral">&#39;*&#39;</span>, $schema = null)
<a name="l00862"></a>00862     {
<a name="l00863"></a>00863         <span class="keywordflow">if</span> (empty($this-&gt;_parts[self::FROM])) {
<a name="l00864"></a>00864             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00865"></a>00865             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;You can only perform a joinUsing after specifying a FROM table&quot;</span>);
<a name="l00866"></a>00866         }
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         $join  = $this-&gt;_adapter-&gt;quoteIdentifier(key($this-&gt;_parts[self::FROM]), <span class="keyword">true</span>);
<a name="l00869"></a>00869         $from  = $this-&gt;_adapter-&gt;quoteIdentifier($this-&gt;_uniqueCorrelation($name), <span class="keyword">true</span>);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         $cond1 = $from . <span class="charliteral">&#39;.&#39;</span> . $cond;
<a name="l00872"></a>00872         $cond2 = $join . <span class="charliteral">&#39;.&#39;</span> . $cond;
<a name="l00873"></a>00873         $cond  = $cond1 . <span class="stringliteral">&#39; = &#39;</span> . $cond2;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_zend___db___select.html#a1043e1afc9b60614fa1b56d47f7bafd3">_join</a>($type, $name, $cond, $cols, $schema);
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00884"></a>00884     <span class="keyword">private</span> function _uniqueCorrelation($name)
<a name="l00885"></a>00885     {
<a name="l00886"></a>00886         <span class="keywordflow">if</span> (is_array($name)) {
<a name="l00887"></a>00887             $c = end($name);
<a name="l00888"></a>00888         } <span class="keywordflow">else</span> {
<a name="l00889"></a>00889             <span class="comment">// Extract just the last name of a qualified table name</span>
<a name="l00890"></a>00890             $dot = strrpos($name,<span class="charliteral">&#39;.&#39;</span>);
<a name="l00891"></a>00891             $c = ($dot === <span class="keyword">false</span>) ? $name : substr($name, $dot+1);
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893         <span class="keywordflow">for</span> ($i = 2; array_key_exists($c, $this-&gt;_parts[self::FROM]); ++$i) {
<a name="l00894"></a>00894             $c = $name . <span class="charliteral">&#39;_&#39;</span> . (string) $i;
<a name="l00895"></a>00895         }
<a name="l00896"></a>00896         <span class="keywordflow">return</span> $c;
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 
<a name="l00908"></a><a class="code" href="class_zend___db___select.html#a520f2de53b0702d75a2d8bf6de4ff996">00908</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a520f2de53b0702d75a2d8bf6de4ff996">_tableCols</a>($correlationName, $cols, $afterCorrelationName = null)
<a name="l00909"></a>00909     {
<a name="l00910"></a>00910         <span class="keywordflow">if</span> (!is_array($cols)) {
<a name="l00911"></a>00911             $cols = array($cols);
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="keywordflow">if</span> ($correlationName == null) {
<a name="l00915"></a>00915             $correlationName = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         $columnValues = array();
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         <span class="keywordflow">foreach</span> (array_filter($cols) as $alias =&gt; $col) {
<a name="l00921"></a>00921             $currentCorrelationName = $correlationName;
<a name="l00922"></a>00922             <span class="keywordflow">if</span> (is_string($col)) {
<a name="l00923"></a>00923                 <span class="comment">// Check for a column matching &quot;&lt;column&gt; AS &lt;alias&gt;&quot; and extract the alias name</span>
<a name="l00924"></a>00924                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(.+)\s+&#39;</span> . self::SQL_AS . <span class="stringliteral">&#39;\s+(.+)$/i&#39;</span>, $col, $m)) {
<a name="l00925"></a>00925                     $col = $m[1];
<a name="l00926"></a>00926                     $alias = $m[2];
<a name="l00927"></a>00927                 }
<a name="l00928"></a>00928                 <span class="comment">// Check for columns that look like functions and convert to Zend_Db_Expr</span>
<a name="l00929"></a>00929                 <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\(.*\)/&#39;</span>, $col)) {
<a name="l00930"></a>00930                     $col = <span class="keyword">new</span> <a class="code" href="class_zend___db___expr.html">Zend_Db_Expr</a>($col);
<a name="l00931"></a>00931                 } elseif (preg_match(<span class="stringliteral">&#39;/(.+)\.(.+)/&#39;</span>, $col, $m)) {
<a name="l00932"></a>00932                     $currentCorrelationName = $m[1];
<a name="l00933"></a>00933                     $col = $m[2];
<a name="l00934"></a>00934                 }
<a name="l00935"></a>00935             }
<a name="l00936"></a>00936             $columnValues[] = array($currentCorrelationName, $col, is_string($alias) ? $alias : null);
<a name="l00937"></a>00937         }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939         <span class="keywordflow">if</span> ($columnValues) {
<a name="l00940"></a>00940 
<a name="l00941"></a>00941             <span class="comment">// should we attempt to prepend or insert these values?</span>
<a name="l00942"></a>00942             <span class="keywordflow">if</span> ($afterCorrelationName === <span class="keyword">true</span> || is_string($afterCorrelationName)) {
<a name="l00943"></a>00943                 $tmpColumns = $this-&gt;_parts[self::COLUMNS];
<a name="l00944"></a>00944                 $this-&gt;_parts[self::COLUMNS] = array();
<a name="l00945"></a>00945             } <span class="keywordflow">else</span> {
<a name="l00946"></a>00946                 $tmpColumns = array();
<a name="l00947"></a>00947             }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949             <span class="comment">// find the correlation name to insert after</span>
<a name="l00950"></a>00950             <span class="keywordflow">if</span> (is_string($afterCorrelationName)) {
<a name="l00951"></a>00951                 <span class="keywordflow">while</span> ($tmpColumns) {
<a name="l00952"></a>00952                     $this-&gt;_parts[self::COLUMNS][] = $currentColumn = array_shift($tmpColumns);
<a name="l00953"></a>00953                     <span class="keywordflow">if</span> ($currentColumn[0] == $afterCorrelationName) {
<a name="l00954"></a>00954                         <span class="keywordflow">break</span>;
<a name="l00955"></a>00955                     }
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957             }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959             <span class="comment">// apply current values to current stack</span>
<a name="l00960"></a>00960             <span class="keywordflow">foreach</span> ($columnValues as $columnValue) {
<a name="l00961"></a>00961                 array_push($this-&gt;_parts[self::COLUMNS], $columnValue);
<a name="l00962"></a>00962             }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964             <span class="comment">// finish ensuring that all previous values are applied (if they exist)</span>
<a name="l00965"></a>00965             <span class="keywordflow">while</span> ($tmpColumns) {
<a name="l00966"></a>00966                 array_push($this-&gt;_parts[self::COLUMNS], array_shift($tmpColumns));
<a name="l00967"></a>00967             }
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00980"></a><a class="code" href="class_zend___db___select.html#a3a24d1516675e05408fede0234674516">00980</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a3a24d1516675e05408fede0234674516">_where</a>($condition, $value = null, $type = null, $bool = <span class="keyword">true</span>)
<a name="l00981"></a>00981     {
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (count($this-&gt;_parts[self::UNION])) {
<a name="l00983"></a>00983             require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l00984"></a>00984             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Invalid use of where clause with &quot;</span> . self::SQL_UNION);
<a name="l00985"></a>00985         }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987         <span class="keywordflow">if</span> ($value !== null) {
<a name="l00988"></a>00988             $condition = $this-&gt;_adapter-&gt;quoteInto($condition, $value, $type);
<a name="l00989"></a>00989         }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         $cond = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00992"></a>00992         <span class="keywordflow">if</span> ($this-&gt;_parts[self::WHERE]) {
<a name="l00993"></a>00993             <span class="keywordflow">if</span> ($bool === <span class="keyword">true</span>) {
<a name="l00994"></a>00994                 $cond = self::SQL_AND . <span class="charliteral">&#39; &#39;</span>;
<a name="l00995"></a>00995             } <span class="keywordflow">else</span> {
<a name="l00996"></a>00996                 $cond = self::SQL_OR . <span class="charliteral">&#39; &#39;</span>;
<a name="l00997"></a>00997             }
<a name="l00998"></a>00998         }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000         <span class="keywordflow">return</span> $cond . <span class="stringliteral">&quot;($condition)&quot;</span>;
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002 
<a name="l01006"></a><a class="code" href="class_zend___db___select.html#a1ba26f0d3ab0aefe9d6ab5f1bc36fb7d">01006</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a1ba26f0d3ab0aefe9d6ab5f1bc36fb7d">_getDummyTable</a>()
<a name="l01007"></a>01007     {
<a name="l01008"></a>01008         <span class="keywordflow">return</span> array();
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010 
<a name="l01017"></a><a class="code" href="class_zend___db___select.html#a6f90f936a1d54371d2615c826dac67f5">01017</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a6f90f936a1d54371d2615c826dac67f5">_getQuotedSchema</a>($schema = null)
<a name="l01018"></a>01018     {
<a name="l01019"></a>01019         <span class="keywordflow">if</span> ($schema === null) {
<a name="l01020"></a>01020             <span class="keywordflow">return</span> null;
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022         <span class="keywordflow">return</span> $this-&gt;_adapter-&gt;quoteIdentifier($schema, <span class="keyword">true</span>) . <span class="charliteral">&#39;.&#39;</span>;
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01032"></a><a class="code" href="class_zend___db___select.html#ab058a376e582e31f47226062978f5547">01032</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#ab058a376e582e31f47226062978f5547">_getQuotedTable</a>($tableName, $correlationName = null)
<a name="l01033"></a>01033     {
<a name="l01034"></a>01034         <span class="keywordflow">return</span> $this-&gt;_adapter-&gt;quoteTableAs($tableName, $correlationName, <span class="keyword">true</span>);
<a name="l01035"></a>01035     }
<a name="l01036"></a>01036 
<a name="l01043"></a><a class="code" href="class_zend___db___select.html#ad675169e3813adfda9b913e78d66a8d5">01043</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#ad675169e3813adfda9b913e78d66a8d5">_renderDistinct</a>($sql)
<a name="l01044"></a>01044     {
<a name="l01045"></a>01045         <span class="keywordflow">if</span> ($this-&gt;_parts[self::DISTINCT]) {
<a name="l01046"></a>01046             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_DISTINCT;
<a name="l01047"></a>01047         }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="keywordflow">return</span> $sql;
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051 
<a name="l01058"></a><a class="code" href="class_zend___db___select.html#ac95b50d73fc6c67e070b02995491103c">01058</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#ac95b50d73fc6c67e070b02995491103c">_renderColumns</a>($sql)
<a name="l01059"></a>01059     {
<a name="l01060"></a>01060         <span class="keywordflow">if</span> (!count($this-&gt;_parts[self::COLUMNS])) {
<a name="l01061"></a>01061             <span class="keywordflow">return</span> null;
<a name="l01062"></a>01062         }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         $columns = array();
<a name="l01065"></a>01065         <span class="keywordflow">foreach</span> ($this-&gt;_parts[self::COLUMNS] as $columnEntry) {
<a name="l01066"></a>01066             list($correlationName, $column, $alias) = $columnEntry;
<a name="l01067"></a>01067             <span class="keywordflow">if</span> ($column instanceof <a class="code" href="class_zend___db___expr.html">Zend_Db_Expr</a>) {
<a name="l01068"></a>01068                 $columns[] = $this-&gt;_adapter-&gt;quoteColumnAs($column, $alias, <span class="keyword">true</span>);
<a name="l01069"></a>01069             } <span class="keywordflow">else</span> {
<a name="l01070"></a>01070                 <span class="keywordflow">if</span> ($column == self::SQL_WILDCARD) {
<a name="l01071"></a>01071                     $column = <span class="keyword">new</span> Zend_Db_Expr(self::SQL_WILDCARD);
<a name="l01072"></a>01072                     $alias = null;
<a name="l01073"></a>01073                 }
<a name="l01074"></a>01074                 <span class="keywordflow">if</span> (empty($correlationName)) {
<a name="l01075"></a>01075                     $columns[] = $this-&gt;_adapter-&gt;quoteColumnAs($column, $alias, <span class="keyword">true</span>);
<a name="l01076"></a>01076                 } <span class="keywordflow">else</span> {
<a name="l01077"></a>01077                     $columns[] = $this-&gt;_adapter-&gt;quoteColumnAs(array($correlationName, $column), $alias, <span class="keyword">true</span>);
<a name="l01078"></a>01078                 }
<a name="l01079"></a>01079             }
<a name="l01080"></a>01080         }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082         <span class="keywordflow">return</span> $sql .= <span class="charliteral">&#39; &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $columns);
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084 
<a name="l01091"></a><a class="code" href="class_zend___db___select.html#aca5e7e8897890cc89e495c8bcff365a9">01091</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#aca5e7e8897890cc89e495c8bcff365a9">_renderFrom</a>($sql)
<a name="l01092"></a>01092     {
<a name="l01093"></a>01093         <span class="comment">/*</span>
<a name="l01094"></a>01094 <span class="comment">         * If no table specified, use RDBMS-dependent solution</span>
<a name="l01095"></a>01095 <span class="comment">         * for table-less query.  e.g. DUAL in Oracle.</span>
<a name="l01096"></a>01096 <span class="comment">         */</span>
<a name="l01097"></a>01097         <span class="keywordflow">if</span> (empty($this-&gt;_parts[self::FROM])) {
<a name="l01098"></a>01098             $this-&gt;_parts[self::FROM] = $this-&gt;<a class="code" href="class_zend___db___select.html#a1ba26f0d3ab0aefe9d6ab5f1bc36fb7d">_getDummyTable</a>();
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101         $from = array();
<a name="l01102"></a>01102 
<a name="l01103"></a>01103         <span class="keywordflow">foreach</span> ($this-&gt;_parts[self::FROM] as $correlationName =&gt; $table) {
<a name="l01104"></a>01104             $tmp = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106             $joinType = ($table[<span class="stringliteral">&#39;joinType&#39;</span>] == self::FROM) ? self::INNER_JOIN : $table[<span class="stringliteral">&#39;joinType&#39;</span>];
<a name="l01107"></a>01107 
<a name="l01108"></a>01108             <span class="comment">// Add join clause (if applicable)</span>
<a name="l01109"></a>01109             <span class="keywordflow">if</span> (! empty($from)) {
<a name="l01110"></a>01110                 $tmp .= <span class="charliteral">&#39; &#39;</span> . strtoupper($joinType) . <span class="charliteral">&#39; &#39;</span>;
<a name="l01111"></a>01111             }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113             $tmp .= $this-&gt;<a class="code" href="class_zend___db___select.html#a6f90f936a1d54371d2615c826dac67f5">_getQuotedSchema</a>($table[<span class="stringliteral">&#39;schema&#39;</span>]);
<a name="l01114"></a>01114             $tmp .= $this-&gt;<a class="code" href="class_zend___db___select.html#ab058a376e582e31f47226062978f5547">_getQuotedTable</a>($table[<span class="stringliteral">&#39;tableName&#39;</span>], $correlationName);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116             <span class="comment">// Add join conditions (if applicable)</span>
<a name="l01117"></a>01117             <span class="keywordflow">if</span> (!empty($from) &amp;&amp; ! empty($table[<span class="stringliteral">&#39;joinCondition&#39;</span>])) {
<a name="l01118"></a>01118                 $tmp .= <span class="charliteral">&#39; &#39;</span> . self::SQL_ON . <span class="charliteral">&#39; &#39;</span> . $table[<span class="stringliteral">&#39;joinCondition&#39;</span>];
<a name="l01119"></a>01119             }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121             <span class="comment">// Add the table name and condition add to the list</span>
<a name="l01122"></a>01122             $from[] = $tmp;
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125         <span class="comment">// Add the list of all joins</span>
<a name="l01126"></a>01126         <span class="keywordflow">if</span> (!empty($from)) {
<a name="l01127"></a>01127             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_FROM . <span class="charliteral">&#39; &#39;</span> . implode(<span class="stringliteral">&quot;\n&quot;</span>, $from);
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130         <span class="keywordflow">return</span> $sql;
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132 
<a name="l01139"></a><a class="code" href="class_zend___db___select.html#a525f7b68c762c7660346b6895803557d">01139</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a525f7b68c762c7660346b6895803557d">_renderUnion</a>($sql)
<a name="l01140"></a>01140     {
<a name="l01141"></a>01141         <span class="keywordflow">if</span> ($this-&gt;_parts[self::UNION]) {
<a name="l01142"></a>01142             $parts = count($this-&gt;_parts[self::UNION]);
<a name="l01143"></a>01143             <span class="keywordflow">foreach</span> ($this-&gt;_parts[self::UNION] as $cnt =&gt; $union) {
<a name="l01144"></a>01144                 list($target, $type) = $union;
<a name="l01145"></a>01145                 <span class="keywordflow">if</span> ($target instanceof <a class="code" href="class_zend___db___select.html">Zend_Db_Select</a>) {
<a name="l01146"></a>01146                     $target = $target-&gt;assemble();
<a name="l01147"></a>01147                 }
<a name="l01148"></a>01148                 $sql .= $target;
<a name="l01149"></a>01149                 <span class="keywordflow">if</span> ($cnt &lt; $parts - 1) {
<a name="l01150"></a>01150                     $sql .= <span class="charliteral">&#39; &#39;</span> . $type . <span class="charliteral">&#39; &#39;</span>;
<a name="l01151"></a>01151                 }
<a name="l01152"></a>01152             }
<a name="l01153"></a>01153         }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155         <span class="keywordflow">return</span> $sql;
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157 
<a name="l01164"></a><a class="code" href="class_zend___db___select.html#a1f66351ccea3d5c5e8dc7d089bf7be1c">01164</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a1f66351ccea3d5c5e8dc7d089bf7be1c">_renderWhere</a>($sql)
<a name="l01165"></a>01165     {
<a name="l01166"></a>01166         <span class="keywordflow">if</span> ($this-&gt;_parts[self::FROM] &amp;&amp; $this-&gt;_parts[self::WHERE]) {
<a name="l01167"></a>01167             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_WHERE . <span class="charliteral">&#39; &#39;</span> .  implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_parts[self::WHERE]);
<a name="l01168"></a>01168         }
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">return</span> $sql;
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172 
<a name="l01179"></a><a class="code" href="class_zend___db___select.html#a517274560b38cfdde3544c42a06b3357">01179</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a517274560b38cfdde3544c42a06b3357">_renderGroup</a>($sql)
<a name="l01180"></a>01180     {
<a name="l01181"></a>01181         <span class="keywordflow">if</span> ($this-&gt;_parts[self::FROM] &amp;&amp; $this-&gt;_parts[self::GROUP]) {
<a name="l01182"></a>01182             $group = array();
<a name="l01183"></a>01183             <span class="keywordflow">foreach</span> ($this-&gt;_parts[self::GROUP] as $term) {
<a name="l01184"></a>01184                 $group[] = $this-&gt;_adapter-&gt;quoteIdentifier($term, <span class="keyword">true</span>);
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_GROUP_BY . <span class="charliteral">&#39; &#39;</span> . implode(<span class="stringliteral">&quot;,\n\t&quot;</span>, $group);
<a name="l01187"></a>01187         }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189         <span class="keywordflow">return</span> $sql;
<a name="l01190"></a>01190     }
<a name="l01191"></a>01191 
<a name="l01198"></a><a class="code" href="class_zend___db___select.html#a8a2ce01719c89f2ba5a7728080175720">01198</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a8a2ce01719c89f2ba5a7728080175720">_renderHaving</a>($sql)
<a name="l01199"></a>01199     {
<a name="l01200"></a>01200         <span class="keywordflow">if</span> ($this-&gt;_parts[self::FROM] &amp;&amp; $this-&gt;_parts[self::HAVING]) {
<a name="l01201"></a>01201             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_HAVING . <span class="charliteral">&#39; &#39;</span> . implode(<span class="charliteral">&#39; &#39;</span>, $this-&gt;_parts[self::HAVING]);
<a name="l01202"></a>01202         }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="keywordflow">return</span> $sql;
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206 
<a name="l01213"></a><a class="code" href="class_zend___db___select.html#a8af87f44010542ba0af59680137b8681">01213</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a8af87f44010542ba0af59680137b8681">_renderOrder</a>($sql)
<a name="l01214"></a>01214     {
<a name="l01215"></a>01215         <span class="keywordflow">if</span> ($this-&gt;_parts[self::ORDER]) {
<a name="l01216"></a>01216             $order = array();
<a name="l01217"></a>01217             <span class="keywordflow">foreach</span> ($this-&gt;_parts[self::ORDER] as $term) {
<a name="l01218"></a>01218                 <span class="keywordflow">if</span> (is_array($term)) {
<a name="l01219"></a>01219                     <span class="keywordflow">if</span>(is_numeric($term[0]) &amp;&amp; strval(intval($term[0])) == $term[0]) {
<a name="l01220"></a>01220                         $order[] = (int)trim($term[0]) . <span class="charliteral">&#39; &#39;</span> . $term[1];
<a name="l01221"></a>01221                     } <span class="keywordflow">else</span> {
<a name="l01222"></a>01222                         $order[] = $this-&gt;_adapter-&gt;quoteIdentifier($term[0], <span class="keyword">true</span>) . <span class="charliteral">&#39; &#39;</span> . $term[1];
<a name="l01223"></a>01223                     }
<a name="l01224"></a>01224                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_numeric($term) &amp;&amp; strval(intval($term)) == $term) {
<a name="l01225"></a>01225                     $order[] = (int)trim($term);
<a name="l01226"></a>01226                 } <span class="keywordflow">else</span> {
<a name="l01227"></a>01227                     $order[] = $this-&gt;_adapter-&gt;quoteIdentifier($term, <span class="keyword">true</span>);
<a name="l01228"></a>01228                 }
<a name="l01229"></a>01229             }
<a name="l01230"></a>01230             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_ORDER_BY . <span class="charliteral">&#39; &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $order);
<a name="l01231"></a>01231         }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233         <span class="keywordflow">return</span> $sql;
<a name="l01234"></a>01234     }
<a name="l01235"></a>01235 
<a name="l01242"></a><a class="code" href="class_zend___db___select.html#a2c1b0bf6651d5c2f6ee95d5c06496bdd">01242</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a2c1b0bf6651d5c2f6ee95d5c06496bdd">_renderLimitoffset</a>($sql)
<a name="l01243"></a>01243     {
<a name="l01244"></a>01244         $count = 0;
<a name="l01245"></a>01245         $offset = 0;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247         <span class="keywordflow">if</span> (!empty($this-&gt;_parts[self::LIMIT_OFFSET])) {
<a name="l01248"></a>01248             $offset = (int) $this-&gt;_parts[self::LIMIT_OFFSET];
<a name="l01249"></a>01249             $count = PHP_INT_MAX;
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251 
<a name="l01252"></a>01252         <span class="keywordflow">if</span> (!empty($this-&gt;_parts[self::LIMIT_COUNT])) {
<a name="l01253"></a>01253             $count = (int) $this-&gt;_parts[self::LIMIT_COUNT];
<a name="l01254"></a>01254         }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256         <span class="comment">/*</span>
<a name="l01257"></a>01257 <span class="comment">         * Add limits clause</span>
<a name="l01258"></a>01258 <span class="comment">         */</span>
<a name="l01259"></a>01259         <span class="keywordflow">if</span> ($count &gt; 0) {
<a name="l01260"></a>01260             $sql = trim($this-&gt;_adapter-&gt;limit($sql, $count, $offset));
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263         <span class="keywordflow">return</span> $sql;
<a name="l01264"></a>01264     }
<a name="l01265"></a>01265 
<a name="l01272"></a><a class="code" href="class_zend___db___select.html#a4330fb1ffbb22dd1eda025efb104464a">01272</a>     <span class="keyword">protected</span> function <a class="code" href="class_zend___db___select.html#a4330fb1ffbb22dd1eda025efb104464a">_renderForupdate</a>($sql)
<a name="l01273"></a>01273     {
<a name="l01274"></a>01274         <span class="keywordflow">if</span> ($this-&gt;_parts[self::FOR_UPDATE]) {
<a name="l01275"></a>01275             $sql .= <span class="charliteral">&#39; &#39;</span> . self::SQL_FOR_UPDATE;
<a name="l01276"></a>01276         }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278         <span class="keywordflow">return</span> $sql;
<a name="l01279"></a>01279     }
<a name="l01280"></a>01280 
<a name="l01290"></a><a class="code" href="class_zend___db___select.html#a16bce55a011068c81b25f9c03e079fcc">01290</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a16bce55a011068c81b25f9c03e079fcc">__call</a>($method, array $args)
<a name="l01291"></a>01291     {
<a name="l01292"></a>01292         $matches = array();
<a name="l01293"></a>01293 
<a name="l01300"></a>01300         <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^join([a-zA-Z]*?)Using$/&#39;</span>, $method, $matches)) {
<a name="l01301"></a>01301             $type = strtolower($matches[1]);
<a name="l01302"></a>01302             <span class="keywordflow">if</span> ($type) {
<a name="l01303"></a>01303                 $type .= <span class="stringliteral">&#39; join&#39;</span>;
<a name="l01304"></a>01304                 <span class="keywordflow">if</span> (!in_array($type, self::$_joinTypes)) {
<a name="l01305"></a>01305                     require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l01306"></a>01306                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Unrecognized method &#39;$method()&#39;&quot;</span>);
<a name="l01307"></a>01307                 }
<a name="l01308"></a>01308                 <span class="keywordflow">if</span> (in_array($type, array(self::CROSS_JOIN, self::NATURAL_JOIN))) {
<a name="l01309"></a>01309                     require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l01310"></a>01310                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Cannot perform a joinUsing with method &#39;$method()&#39;&quot;</span>);
<a name="l01311"></a>01311                 }
<a name="l01312"></a>01312             } <span class="keywordflow">else</span> {
<a name="l01313"></a>01313                 $type = self::INNER_JOIN;
<a name="l01314"></a>01314             }
<a name="l01315"></a>01315             array_unshift($args, $type);
<a name="l01316"></a>01316             <span class="keywordflow">return</span> call_user_func_array(array($this, <span class="stringliteral">&#39;_joinUsing&#39;</span>), $args);
<a name="l01317"></a>01317         }
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         require_once <span class="stringliteral">&#39;Zend/Db/Select/Exception.php&#39;</span>;
<a name="l01320"></a>01320         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_zend___db___select___exception.html">Zend_Db_Select_Exception</a>(<span class="stringliteral">&quot;Unrecognized method &#39;$method()&#39;&quot;</span>);
<a name="l01321"></a>01321     }
<a name="l01322"></a>01322 
<a name="l01328"></a><a class="code" href="class_zend___db___select.html#a7516ca30af0db3cdbf9a7739b48ce91d">01328</a>     <span class="keyword">public</span> function <a class="code" href="class_zend___db___select.html#a7516ca30af0db3cdbf9a7739b48ce91d">__toString</a>()
<a name="l01329"></a>01329     {
<a name="l01330"></a>01330         <span class="keywordflow">try</span> {
<a name="l01331"></a>01331             $sql = $this-&gt;<a class="code" href="class_zend___db___select.html#ab8b117c49918c18c286a6e496aaf6a1c">assemble</a>();
<a name="l01332"></a>01332         } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l01333"></a>01333             trigger_error($e-&gt;getMessage(), E_USER_WARNING);
<a name="l01334"></a>01334             $sql = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01335"></a>01335         }
<a name="l01336"></a>01336         <span class="keywordflow">return</span> (<span class="keywordtype">string</span>)$sql;
<a name="l01337"></a>01337     }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:01:17 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
