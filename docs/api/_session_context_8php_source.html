<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>openbiz: E:/E/GEAMP/www/openbiz/openbiz/bin/SessionContext.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>E:/E/GEAMP/www/openbiz/openbiz/bin/SessionContext.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?<a class="code" href="category_p_h_p.html">PHP</a>
<a name="l00020"></a>00020 define(<span class="stringliteral">&#39;OB_STATEFUL_DATA_SESSION_INDEX&#39;</span>, <span class="stringliteral">&#39;ob_stateful_data&#39;</span>);
<a name="l00021"></a>00021 define(<span class="stringliteral">&#39;OB_TRANSIENT_DATA_SESSION_INDEX&#39;</span>, <span class="stringliteral">&#39;ob_transient_data&#39;</span>);
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00034"></a><a class="code" href="class_session_context.html">00034</a> <span class="keyword">class </span><a class="code" href="class_session_context.html">SessionContext</a>
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036     <span class="keyword">protected</span> $_lastAccessTime;
<a name="l00037"></a>00037     <span class="keyword">protected</span> $_timeOut = <span class="keyword">false</span>;
<a name="l00038"></a>00038     <span class="keyword">protected</span> $_sessObjArr = null;
<a name="l00039"></a>00039     <span class="keyword">protected</span> $_statefulSessObjArr = null;
<a name="l00040"></a>00040     <span class="keyword">protected</span> $_viewHistory = null;
<a name="l00041"></a>00041     <span class="keyword">protected</span> $_prevViewObjNames = array();
<a name="l00042"></a>00042 
<a name="l00048"></a><a class="code" href="class_session_context.html#a095c5d389db211932136b53f25f39685">00048</a>     function <a class="code" href="class_session_context.html#a095c5d389db211932136b53f25f39685">__construct</a>()
<a name="l00049"></a>00049     {        
<a name="l00050"></a>00050         <span class="comment">// get session save handler MC or DB</span>
<a name="l00051"></a>00051         <span class="keywordflow">if</span> (defined(<span class="stringliteral">&quot;SESSION_HANDLER&quot;</span>) &amp;&amp; SESSION_HANDLER != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00052"></a>00052             include_once SESSION_HANDLER.<span class="stringliteral">&quot;.php&quot;</span>;
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054         <span class="keywordflow">else</span> {
<a name="l00055"></a>00055               <span class="keywordflow">if</span>(!file_exists(SESSION_PATH)){                  
<a name="l00056"></a>00056                      @mkdir(SESSION_PATH,0777,<span class="keyword">true</span>);
<a name="l00057"></a>00057               }
<a name="l00058"></a>00058             <span class="comment">// default is file session</span>
<a name="l00059"></a>00059             <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;SESSION_PATH&#39;</span>) &amp;&amp; is_writable(SESSION_PATH))
<a name="l00060"></a>00060                 session_save_path(SESSION_PATH);
<a name="l00061"></a>00061             <span class="comment">// we cannot write in the session save path; aborting</span>
<a name="l00062"></a>00062             <span class="keywordflow">if</span>(!is_writable(session_save_path())) 
<a name="l00063"></a>00063                 trigger_error(<span class="stringliteral">&quot;Unable to write in the session save path [&quot;</span>.session_save_path().<span class="stringliteral">&quot;]&quot;</span>, E_USER_ERROR);
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065         
<a name="l00066"></a>00066         ini_set(<span class="stringliteral">&#39;session.gc_probability&#39;</span>, 1);   <span class="comment">// force gc </span>
<a name="l00067"></a>00067         ini_set(<span class="stringliteral">&#39;session.gc_divisor&#39;</span>, 100);
<a name="l00068"></a>00068         <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;TIMEOUT&#39;</span>) &amp;&amp; TIMEOUT &gt; 0)
<a name="l00069"></a>00069             ini_set(<span class="stringliteral">&quot;session.gc_maxlifetime&quot;</span>, TIMEOUT);
<a name="l00070"></a>00070         <span class="keywordflow">else</span>
<a name="l00071"></a>00071             ini_set(<span class="stringliteral">&quot;session.gc_maxlifetime&quot;</span>, 21600); <span class="comment">// 6 hours</span>
<a name="l00072"></a>00072         
<a name="l00073"></a>00073                      
<a name="l00074"></a>00074             
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;CLI&#39;</span>) || CLI == 0) {
<a name="l00076"></a>00076             <span class="keywordflow">if</span>(isset($_REQUEST[<span class="stringliteral">&#39;cubi_sess_id&#39;</span>])){
<a name="l00077"></a>00077                 session_id($_REQUEST[<span class="stringliteral">&#39;cubi_sess_id&#39;</span>]);
<a name="l00078"></a>00078             }
<a name="l00079"></a>00079             session_start();
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081         <span class="comment">// record access time</span>
<a name="l00082"></a>00082         $curTime = time();
<a name="l00083"></a>00083         <span class="keywordflow">if</span> (isset($_SESSION[<span class="stringliteral">&quot;LastAccessTime&quot;</span>]))
<a name="l00084"></a>00084             $this-&gt;_lastAccessTime = $_SESSION[<span class="stringliteral">&quot;LastAccessTime&quot;</span>];
<a name="l00085"></a>00085         <span class="keywordflow">else</span>
<a name="l00086"></a>00086             $this-&gt;_lastAccessTime = $curTime;
<a name="l00087"></a>00087         $_SESSION[<span class="stringliteral">&quot;LastAccessTime&quot;</span>] =$curTime;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">// see if timeout</span>
<a name="l00090"></a>00090         $this-&gt;_timeOut = <span class="keyword">false</span>;
<a name="l00091"></a>00091         <span class="keywordflow">if</span> ((TIMEOUT &gt; 0) &amp;&amp; (($curTime - $this-&gt;_lastAccessTime) &gt; TIMEOUT))
<a name="l00092"></a>00092             $this-&gt;_timeOut = <span class="keyword">true</span>;
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00102"></a><a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">00102</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">setVar</a>($varName, $value)
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104         $_SESSION[$varName] = $value;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106     
<a name="l00107"></a>00107     <span class="keyword">public</span> function mergeVar($varName, $value)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109         $var = $_SESSION[$varName];
<a name="l00110"></a>00110         <span class="keywordflow">if</span>(is_array($var)){               
<a name="l00111"></a>00111               <span class="keywordflow">foreach</span>($value as $key=&gt;$value){
<a name="l00112"></a>00112                      $var[$key]=$value;
<a name="l00113"></a>00113               }
<a name="l00114"></a>00114               $_SESSION[$varName] = $var;
<a name="l00115"></a>00115         }<span class="keywordflow">else</span>{
<a name="l00116"></a>00116               $_SESSION[$varName] = $value;
<a name="l00117"></a>00117         }     
<a name="l00118"></a>00118     }
<a name="l00125"></a><a class="code" href="class_session_context.html#a65e9e5a7081d7b0d0e7f50ec77eff848">00125</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a65e9e5a7081d7b0d0e7f50ec77eff848">getVar</a>($varName)
<a name="l00126"></a>00126     {
<a name="l00127"></a>00127         <span class="keywordflow">if</span> (!isset($_SESSION[$varName]))
<a name="l00128"></a>00128             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00129"></a>00129         <span class="keywordflow">return</span> $_SESSION[$varName];
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00139"></a><a class="code" href="class_session_context.html#a8da3f41a64ce2e547143c2b7979bcccf">00139</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a8da3f41a64ce2e547143c2b7979bcccf">clearVar</a>($varName)
<a name="l00140"></a>00140     {
<a name="l00141"></a>00141         unset($_SESSION[$varName]);
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 
<a name="l00150"></a><a class="code" href="class_session_context.html#ad02799e07792566910fb84ff16ce0073">00150</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#ad02799e07792566910fb84ff16ce0073">varExists</a>($varName)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152         $exists =  (array_key_exists($varName, $_SESSION)) ? TRUE : FALSE;
<a name="l00153"></a>00153         <span class="keywordflow">return</span> $exists;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155     
<a name="l00156"></a>00156     <span class="keyword">public</span> function getNamespace()
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         $view = <a class="code" href="class_biz_system.html#a0deb004950b8dc4f51836316fd19c111">BizSystem::instance</a>()-&gt;getCurrentViewName();
<a name="l00159"></a>00159         <span class="keywordflow">if</span> ($view)
<a name="l00160"></a>00160             $namespace = $view;
<a name="l00161"></a>00161         <span class="keywordflow">else</span>
<a name="l00162"></a>00162             $namespace = <span class="stringliteral">&#39;DEFAULT_NS&#39;</span>;
<a name="l00163"></a>00163         <span class="keywordflow">return</span> $namespace;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00175"></a><a class="code" href="class_session_context.html#a4cef06818566ff457f2c502afdda36fa">00175</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a4cef06818566ff457f2c502afdda36fa">setObjVar</a>($objName, $varName, &amp;$value, $stateful=<span class="keyword">false</span> )
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177        <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/\./si&#39;</span>,$objName)){
<a name="l00178"></a>00178               $objName = $this-&gt;getNamespace().<span class="charliteral">&#39;#&#39;</span>.$objName;
<a name="l00179"></a>00179        }
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (!$stateful)
<a name="l00181"></a>00181             $this-&gt;_sessObjArr[$objName][$varName] = $value;
<a name="l00182"></a>00182         <span class="keywordflow">else</span>
<a name="l00183"></a>00183             $this-&gt;_statefulSessObjArr[$objName][$varName] = $value;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00193"></a><a class="code" href="class_session_context.html#ac0fd4d8c2da7824d6daeb17bfe2e4650">00193</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#ac0fd4d8c2da7824d6daeb17bfe2e4650">cleanObj</a>($objName, $stateful=<span class="keyword">false</span>)
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195        <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/\./si&#39;</span>,$objName)){
<a name="l00196"></a>00196               $objName = $this-&gt;getNamespace().<span class="charliteral">&#39;#&#39;</span>.$objName;
<a name="l00197"></a>00197        }
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (!$stateful)
<a name="l00199"></a>00199             unset($this-&gt;_sessObjArr[$objName]);
<a name="l00200"></a>00200         <span class="keywordflow">else</span>
<a name="l00201"></a>00201             unset($this-&gt;_statefulSessObjArr[$objName]);
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00213"></a><a class="code" href="class_session_context.html#a06e6127f955237db8e26f89d1c1e1f00">00213</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a06e6127f955237db8e26f89d1c1e1f00">getObjVar</a>($objName, $varName, &amp;$value, $stateful=<span class="keyword">false</span>)
<a name="l00214"></a>00214     {
<a name="l00215"></a>00215        <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">&#39;/\./si&#39;</span>,$objName)){
<a name="l00216"></a>00216               $objName = $this-&gt;getNamespace().<span class="charliteral">&#39;#&#39;</span>.$objName;
<a name="l00217"></a>00217        }
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (!$stateful)
<a name="l00219"></a>00219         {
<a name="l00220"></a>00220             <span class="keywordflow">if</span> (!$this-&gt;_sessObjArr)
<a name="l00221"></a>00221                 <span class="keywordflow">return</span>;
<a name="l00222"></a>00222             <span class="keywordflow">if</span> (isset($this-&gt;_sessObjArr[$objName][$varName]))
<a name="l00223"></a>00223                 $value = $this-&gt;_sessObjArr[$objName][$varName];
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225         <span class="keywordflow">else</span>
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227             <span class="keywordflow">if</span> (!$this-&gt;_statefulSessObjArr)
<a name="l00228"></a>00228                 <span class="keywordflow">return</span>;
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (isset($this-&gt;_statefulSessObjArr[$objName][$varName]))
<a name="l00230"></a>00230                 $value = $this-&gt;_statefulSessObjArr[$objName][$varName];
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00239"></a><a class="code" href="class_session_context.html#a57621c98b7c5fe807212963864fa0636">00239</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a57621c98b7c5fe807212963864fa0636">saveSessionObjects</a>()
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241         <span class="comment">// loop all objects (bizview, bizform, bizdataobj) collect their session vars</span>
<a name="l00242"></a>00242         $allobjs = <a class="code" href="class_biz_system.html#ac53aa9a66aa8dbab908914d61820ff0c">BizSystem::objectFactory</a>()-&gt;getAllObjects();
<a name="l00243"></a>00243         <span class="keywordflow">foreach</span> ($allobjs as $obj)
<a name="l00244"></a>00244         {
<a name="l00245"></a>00245             <span class="keywordflow">if</span> (method_exists($obj, <span class="stringliteral">&quot;SetSessionVars&quot;</span>))
<a name="l00246"></a>00246             {
<a name="l00247"></a>00247                 <span class="comment">//after calling $obj-&gt;setSessionVars SessObjArr and StatefulSessObjArr are filled</span>
<a name="l00248"></a>00248                 $obj-&gt;setSessionVars($this);
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250             <span class="comment">// if previous view&#39;s object is used in current view, don&#39;t discard its session data</span>
<a name="l00251"></a>00251             <span class="keywordflow">if</span> (isset($obj-&gt;m_Name) &amp;&amp; key_exists($obj-&gt;m_Name, $this-&gt;_prevViewObjNames)) {
<a name="l00252"></a>00252                 unset($this-&gt;_prevViewObjNames[$obj-&gt;m_Name]);
<a name="l00253"></a>00253                 <a class="code" href="class_biz_system.html#adb0b456d79a64e00937a2832d4bab0d7">BizSystem::log</a>(LOG_ERR, <span class="stringliteral">&quot;SESSION&quot;</span>, <span class="stringliteral">&quot;unset &quot;</span>.$obj-&gt;m_Name);
<a name="l00254"></a>00254             }
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">// discard useless previous view&#39;s session objects</span>
<a name="l00258"></a>00258         <span class="comment">//foreach($this-&gt;_prevViewObjNames as $objName=&gt;$tmp)</span>
<a name="l00259"></a>00259         <span class="comment">//    unset($this-&gt;_sessObjArr[$objName]);</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         $this-&gt;_sessObjArr[<span class="stringliteral">&quot;ViewHist&quot;</span>] = $this-&gt;_viewHistory;        
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         $this-&gt;<a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">setVar</a>(OB_TRANSIENT_DATA_SESSION_INDEX, $this-&gt;_sessObjArr);
<a name="l00264"></a>00264         $this-&gt;<a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">setVar</a>(OB_STATEFUL_DATA_SESSION_INDEX, $this-&gt;_statefulSessObjArr);
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00272"></a><a class="code" href="class_session_context.html#a90358daf5009b0ee4a020356f47d6581">00272</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a90358daf5009b0ee4a020356f47d6581">retrieveSessionObjects</a>()
<a name="l00273"></a>00273     {
<a name="l00274"></a>00274         $this-&gt;_sessObjArr = $this-&gt;<a class="code" href="class_session_context.html#a65e9e5a7081d7b0d0e7f50ec77eff848">getVar</a>(OB_TRANSIENT_DATA_SESSION_INDEX);
<a name="l00275"></a>00275         $this-&gt;_statefulSessObjArr = $this-&gt;<a class="code" href="class_session_context.html#a65e9e5a7081d7b0d0e7f50ec77eff848">getVar</a>(OB_STATEFUL_DATA_SESSION_INDEX);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (!is_array($this-&gt;_sessObjArr))
<a name="l00278"></a>00278             $this-&gt;_sessObjArr = array();
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (!is_array($this-&gt;_statefulSessObjArr))
<a name="l00280"></a>00280             $this-&gt;_statefulSessObjArr = array();
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         $this-&gt;_viewHistory = array_key_exists(<span class="stringliteral">&#39;ViewHist&#39;</span>, $this-&gt;_sessObjArr)
<a name="l00283"></a>00283             ? $this-&gt;_sessObjArr[<span class="stringliteral">&quot;ViewHist&quot;</span>]
<a name="l00284"></a>00284             : NULL;
<a name="l00285"></a>00285         <span class="keywordflow">return</span> TRUE;
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 
<a name="l00294"></a><a class="code" href="class_session_context.html#af9b280d1fbfbd5001b3d76a9f510e0f8">00294</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#af9b280d1fbfbd5001b3d76a9f510e0f8">clearSessionObjects</a>($keepObjects = <span class="keyword">false</span>)
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <span class="keywordflow">if</span> ($keepObjects == <span class="keyword">false</span>)
<a name="l00297"></a>00297         {
<a name="l00298"></a>00298             unset($this-&gt;_sessObjArr);
<a name="l00299"></a>00299             $this-&gt;_sessObjArr = array();
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301         <span class="keywordflow">else</span> <span class="comment">// add previous view&#39;s session object names in to a map</span>
<a name="l00302"></a>00302         {
<a name="l00303"></a>00303             <span class="keywordflow">if</span> (isset($this-&gt;_sessObjArr))
<a name="l00304"></a>00304             {
<a name="l00305"></a>00305                 <span class="keywordflow">foreach</span>($this-&gt;_sessObjArr as $objName=&gt;$sessobj)
<a name="l00306"></a>00306                 {
<a name="l00307"></a>00307                     <span class="comment">//echo &quot;save sess $objName &lt;br/&gt;&quot;;</span>
<a name="l00308"></a>00308                     $this-&gt;_prevViewObjNames[$objName] = 1;
<a name="l00309"></a>00309                 }
<a name="l00310"></a>00310             }
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00321"></a><a class="code" href="class_session_context.html#a4f53b2798d5780c8f60b482d133df698">00321</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a4f53b2798d5780c8f60b482d133df698">saveJSONArray</a>($jsonValue, $jsonName = NULL)
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323         $jsonArray = json_decode($jsonValue);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325         <span class="keywordflow">if</span>((<span class="keywordtype">bool</span>)$jsonName)
<a name="l00326"></a>00326         { <span class="comment">//If I want save all array in session I send the name of the array in session</span>
<a name="l00327"></a>00327             $this-&gt;<a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">setVar</a>($jsonName, $jsonArray);
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329         <span class="keywordflow">else</span>
<a name="l00330"></a>00330         {<span class="comment">//I save each value in session</span>
<a name="l00331"></a>00331             <span class="keywordflow">foreach</span>($jsonArray as $varName=&gt;$value)
<a name="l00332"></a>00332             {
<a name="l00333"></a>00333                 $this-&gt;<a class="code" href="class_session_context.html#a145fd8d048cee269f41f0bbf08c43e52">setVar</a>($varName, $value);
<a name="l00334"></a>00334             }
<a name="l00335"></a>00335         }
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00344"></a><a class="code" href="class_session_context.html#aac749f6c944ac881b7b8f20bc42ef041">00344</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#aac749f6c944ac881b7b8f20bc42ef041">getViewHistory</a>($formName)
<a name="l00345"></a>00345     {
<a name="l00346"></a>00346         $view = <a class="code" href="class_biz_system.html#a0deb004950b8dc4f51836316fd19c111">BizSystem::instance</a>()-&gt;getCurrentViewName();
<a name="l00347"></a>00347         $view_form = $formName; <span class="comment">//$view.&quot;_&quot;.$formname;</span>
<a name="l00348"></a>00348         <span class="keywordflow">return</span> $this-&gt;_viewHistory[$view_form];
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350 
<a name="l00358"></a><a class="code" href="class_session_context.html#ac505decc50daf6991762019c0e275bdb">00358</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#ac505decc50daf6991762019c0e275bdb">setViewHistory</a>($formName, $historyInfo)
<a name="l00359"></a>00359     {
<a name="l00360"></a>00360         $view = <a class="code" href="class_biz_system.html#a0deb004950b8dc4f51836316fd19c111">BizSystem::instance</a>()-&gt;getCurrentViewName();
<a name="l00361"></a>00361         $view_form = $formName; <span class="comment">//$view.&quot;_&quot;.$formname;</span>
<a name="l00362"></a>00362         <span class="keywordflow">if</span> (!$historyInfo)
<a name="l00363"></a>00363             unset($this-&gt;_viewHistory[$view_form]);
<a name="l00364"></a>00364         <span class="keywordflow">else</span>
<a name="l00365"></a>00365             $this-&gt;_viewHistory[$view_form] = $historyInfo;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00373"></a><a class="code" href="class_session_context.html#aa118461de946085fe42989193337044a">00373</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#aa118461de946085fe42989193337044a">destroy</a>()
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375         unset($this-&gt;_viewHistory);
<a name="l00376"></a>00376         unset($this-&gt;_sessObjArr);
<a name="l00377"></a>00377         unset($this-&gt;_statefulSessObjArr);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         session_destroy();
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00388"></a><a class="code" href="class_session_context.html#a9b26dca7b344e42ad15a5d174d3ef3c0">00388</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#a9b26dca7b344e42ad15a5d174d3ef3c0">isUserValid</a>()
<a name="l00389"></a>00389     {
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (CHECKUSER == <span class="stringliteral">&quot;N&quot;</span>)
<a name="l00391"></a>00391             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00392"></a>00392         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_session_context.html#a65e9e5a7081d7b0d0e7f50ec77eff848">getVar</a>(<span class="stringliteral">&quot;UserId&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00393"></a>00393             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00394"></a>00394         <span class="keywordflow">else</span>
<a name="l00395"></a>00395             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00403"></a><a class="code" href="class_session_context.html#ae879905618efdf648141e26e76390b42">00403</a>     <span class="keyword">public</span> function <a class="code" href="class_session_context.html#ae879905618efdf648141e26e76390b42">isTimeout</a>()
<a name="l00404"></a>00404     {
<a name="l00405"></a>00405         <span class="keywordflow">return</span> $this-&gt;_timeOut;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 19 2012 17:09:13 for openbiz by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
